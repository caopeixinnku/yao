/************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
* Copyright 2015 Adobe Systems Incorporated
* All Rights Reserved.
*
* NOTICE: All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any. The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
* @PreserveInCompilation
**************************************************************************/
!function(e,t){"function"==typeof define&&define.amd?define([],t):e.ccLibraries=t()}(this,function(){var e;e=window.nodeRequire?window.nodeRequire:function(){return void 0};var t,o,i;if(function(e){function n(e,t){return A.call(e,t)}function r(e,t){var o,i,n,r,a,s,c,l,d,p,h,u=t&&t.split("/"),_=v.map,f=_&&_["*"]||{};if(e&&"."===e.charAt(0))if(t){for(u=u.slice(0,u.length-1),e=e.split("/"),a=e.length-1,v.nodeIdCompat&&b.test(e[a])&&(e[a]=e[a].replace(b,"")),e=u.concat(e),d=0;d<e.length;d+=1)if(h=e[d],"."===h)e.splice(d,1),d-=1;else if(".."===h){if(1===d&&(".."===e[2]||".."===e[0]))break;d>0&&(e.splice(d-1,2),d-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((u||f)&&_){for(o=e.split("/"),d=o.length;d>0;d-=1){if(i=o.slice(0,d).join("/"),u)for(p=u.length;p>0;p-=1)if(n=_[u.slice(0,p).join("/")],n&&(n=n[i])){r=n,s=d;break}if(r)break;!c&&f&&f[i]&&(c=f[i],l=d)}!r&&c&&(r=c,s=l),r&&(o.splice(0,s,r),e=o.join("/"))}return e}function a(t,o){return function(){return u.apply(e,E.call(arguments,0).concat([t,o]))}}function s(e){return function(t){return r(t,e)}}function c(e){return function(t){m[e]=t}}function l(t){if(n(y,t)){var o=y[t];delete y[t],g[t]=!0,h.apply(e,o)}if(!n(m,t)&&!n(g,t))throw new Error("No "+t);return m[t]}function d(e){var t,o=e?e.indexOf("!"):-1;return o>-1&&(t=e.substring(0,o),e=e.substring(o+1,e.length)),[t,e]}function p(e){return function(){return v&&v.config&&v.config[e]||{}}}var h,u,_,f,m={},y={},v={},g={},A=Object.prototype.hasOwnProperty,E=[].slice,b=/\.js$/;_=function(e,t){var o,i=d(e),n=i[0];return e=i[1],n&&(n=r(n,t),o=l(n)),n?e=o&&o.normalize?o.normalize(e,s(t)):r(e,t):(e=r(e,t),i=d(e),n=i[0],e=i[1],n&&(o=l(n))),{f:n?n+"!"+e:e,n:e,pr:n,p:o}},f={require:function(e){return a(e)},exports:function(e){var t=m[e];return"undefined"!=typeof t?t:m[e]={}},module:function(e){return{id:e,uri:"",exports:m[e],config:p(e)}}},h=function(t,o,i,r){var s,d,p,h,u,v,A=[],E=typeof i;if(r=r||t,"undefined"===E||"function"===E){for(o=!o.length&&i.length?["require","exports","module"]:o,u=0;u<o.length;u+=1)if(h=_(o[u],r),d=h.f,"require"===d)A[u]=f.require(t);else if("exports"===d)A[u]=f.exports(t),v=!0;else if("module"===d)s=A[u]=f.module(t);else if(n(m,d)||n(y,d)||n(g,d))A[u]=l(d);else{if(!h.p)throw new Error(t+" missing "+d);h.p.load(h.n,a(r,!0),c(d),{}),A[u]=m[d]}p=i?i.apply(m[t],A):void 0,t&&(s&&s.exports!==e&&s.exports!==m[t]?m[t]=s.exports:p===e&&v||(m[t]=p))}else t&&(m[t]=i)},t=o=u=function(t,o,i,n,r){if("string"==typeof t)return f[t]?f[t](o):l(_(t,o).f);if(!t.splice){if(v=t,v.deps&&u(v.deps,v.callback),!o)return;o.splice?(t=o,o=i,i=null):t=e}return o=o||function(){},"function"==typeof i&&(i=n,n=r),n?h(e,t,o,i):setTimeout(function(){h(e,t,o,i)},4),u},u.config=function(e){return u(e)},t._defined=m,i=function(e,t,o){t.splice||(o=t,t=[]),n(m,e)||n(y,e)||(y[e]=[e,t,o])},i.amd={jQuery:!0}}(),i("components/almond/almond",function(){}),function(){function e(e,t,o){var i=t&&o||0,n=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){16>n&&(t[i+n++]=_[e])});16>n;)t[i+n++]=0;return t}function t(e,t){var o=t||0,i=u;return i[e[o++]]+i[e[o++]]+i[e[o++]]+i[e[o++]]+"-"+i[e[o++]]+i[e[o++]]+"-"+i[e[o++]]+i[e[o++]]+"-"+i[e[o++]]+i[e[o++]]+"-"+i[e[o++]]+i[e[o++]]+i[e[o++]]+i[e[o++]]+i[e[o++]]+i[e[o++]]}function n(e,o,i){var n=o&&i||0,r=o||[];e=e||{};var a=null!=e.clockseq?e.clockseq:v,s=null!=e.msecs?e.msecs:(new Date).getTime(),c=null!=e.nsecs?e.nsecs:A+1,l=s-g+(c-A)/1e4;if(0>l&&null==e.clockseq&&(a=a+1&16383),(0>l||s>g)&&null==e.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");g=s,A=c,v=a,s+=122192928e5;var d=(1e4*(268435455&s)+c)%4294967296;r[n++]=d>>>24&255,r[n++]=d>>>16&255,r[n++]=d>>>8&255,r[n++]=255&d;var p=s/4294967296*1e4&268435455;r[n++]=p>>>8&255,r[n++]=255&p,r[n++]=p>>>24&15|16,r[n++]=p>>>16&255,r[n++]=a>>>8|128,r[n++]=255&a;for(var h=e.node||y,u=0;6>u;u++)r[n+u]=h[u];return o?o:t(r)}function r(e,o,i){var n=o&&i||0;"string"==typeof e&&(o="binary"==e?new h(16):null,e=null),e=e||{};var r=e.random||(e.rng||a)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,o)for(var s=0;16>s;s++)o[n+s]=r[s];return o||t(r)}var a,s=this;if("function"==typeof o)try{var c=o("crypto").randomBytes;a=c&&function(){return c(16)}}catch(l){}if(!a&&s.crypto&&crypto.getRandomValues){var d=new Uint8Array(16);a=function(){return crypto.getRandomValues(d),d}}if(!a){var p=new Array(16);a=function(){for(var e,t=0;16>t;t++)0===(3&t)&&(e=4294967296*Math.random()),p[t]=e>>>((3&t)<<3)&255;return p}}for(var h="function"==typeof Buffer?Buffer:Array,u=[],_={},f=0;256>f;f++)u[f]=(f+256).toString(16).substr(1),_[u[f]]=f;var m=a(),y=[1|m[0],m[1],m[2],m[3],m[4],m[5]],v=16383&(m[6]<<8|m[7]),g=0,A=0,E=r;if(E.v1=n,E.v4=r,E.parse=e,E.unparse=t,E.BufferClass=h,"function"==typeof i&&i.amd)i("components/uuid/uuid",[],function(){return E});else if("undefined"!=typeof module&&module.exports)module.exports=E;else{var b=s.uuid;E.noConflict=function(){return s.uuid=b,E},s.uuid=E}}.call(this),i("components/dcx-js/src/AdobeDCXError",["require","exports","module"],function(){function e(e,t,o){Error.call(this),this.code=e,this.message="["+e+"] "+t,this.underlyingError=o}return e.prototype=new Error,e.prototype.name="AdobeDCXError",delete e.prototype.stack,e.INVALID_JSON="INVALID_JSON",e.READ_ONLY="READ_ONLY",e.INVALID_PARAMS="",e.INVALID_DATA="INVALID_DATA",e.DUPLICATE_VALUE="DUPLICATE_VALUE",e.NO_LOCAL_STORAGE="NO_LOCAL_STORAGE",e.INVALID_STATE="INVALID_STATE",e.DELETED_COMPOSITE="DELETED_COMPOSITE",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.NETWORK_ERROR="NETWORK_ERROR",e.COMPONENT_DOWNLOAD_ERROR="COMPONENT_DOWNLOAD_ERROR",e.COMPONENT_UPLOAD_ERROR="COMPONENT_UPLOAD_ERROR",e.UPDATE_CONFLICT="UPDATE_CONFLICT",e.NO_COMPOSITE="NO_COMPOSITE",e.ALREADY_EXISTS="ALREADY_EXISTS",e.SERVICE_IS_INACTIVE="SERVICE_IS_INACTIVE",e.EXCEEDS_QUOTA="EXCEEDS_QUOTA",e.NOT_IMPLEMENTED="NOT_IMPLEMENTED",e.RETRYABLE_SERVER_ERROR="RETRYABLE_SERVER_ERROR",e.TIMED_OUT="TIMED_OUT",e.UNEXPECTED="UNEXPECTED",e.TERMINATED_INPUTSTREAM="TERMINATED_INPUTSTREAM",e.WRONG_ENDPOINT="WRONG_ENDPOINT",e.OUT_OF_SPACE="ENOSPC",e}),function(){function e(e,t,o){var i=t&&o||0,n=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){16>n&&(t[i+n++]=_[e])});16>n;)t[i+n++]=0;return t}function t(e,t){var o=t||0,i=u;return i[e[o++]]+i[e[o++]]+i[e[o++]]+i[e[o++]]+"-"+i[e[o++]]+i[e[o++]]+"-"+i[e[o++]]+i[e[o++]]+"-"+i[e[o++]]+i[e[o++]]+"-"+i[e[o++]]+i[e[o++]]+i[e[o++]]+i[e[o++]]+i[e[o++]]+i[e[o++]]}function n(e,o,i){var n=o&&i||0,r=o||[];e=e||{};var a=null!=e.clockseq?e.clockseq:v,s=null!=e.msecs?e.msecs:(new Date).getTime(),c=null!=e.nsecs?e.nsecs:A+1,l=s-g+(c-A)/1e4;if(0>l&&null==e.clockseq&&(a=a+1&16383),(0>l||s>g)&&null==e.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");g=s,A=c,v=a,s+=122192928e5;var d=(1e4*(268435455&s)+c)%4294967296;r[n++]=d>>>24&255,r[n++]=d>>>16&255,r[n++]=d>>>8&255,r[n++]=255&d;var p=s/4294967296*1e4&268435455;r[n++]=p>>>8&255,r[n++]=255&p,r[n++]=p>>>24&15|16,r[n++]=p>>>16&255,r[n++]=a>>>8|128,r[n++]=255&a;for(var h=e.node||y,u=0;6>u;u++)r[n+u]=h[u];return o?o:t(r)}function r(e,o,i){var n=o&&i||0;"string"==typeof e&&(o="binary"==e?new h(16):null,e=null),e=e||{};var r=e.random||(e.rng||a)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,o)for(var s=0;16>s;s++)o[n+s]=r[s];return o||t(r)}var a,s=this;if("function"==typeof o)try{var c=o("crypto").randomBytes;a=c&&function(){return c(16)}}catch(l){}if(!a&&s.crypto&&crypto.getRandomValues){var d=new Uint8Array(16);a=function(){return crypto.getRandomValues(d),d}}if(!a){var p=new Array(16);a=function(){for(var e,t=0;16>t;t++)0===(3&t)&&(e=4294967296*Math.random()),p[t]=e>>>((3&t)<<3)&255;return p}}for(var h="function"==typeof Buffer?Buffer:Array,u=[],_={},f=0;256>f;f++)u[f]=(f+256).toString(16).substr(1),_[u[f]]=f;var m=a(),y=[1|m[0],m[1],m[2],m[3],m[4],m[5]],v=16383&(m[6]<<8|m[7]),g=0,A=0,E=r;if(E.v1=n,E.v4=r,E.parse=e,E.unparse=t,E.BufferClass=h,"function"==typeof i&&i.amd)i("components/dcx-js/src/components/uuid/uuid",[],function(){return E});else if("undefined"!=typeof module&&module.exports)module.exports=E;else{var b=s.uuid;E.noConflict=function(){return s.uuid=b,E},s.uuid=E}}.call(this),"function"!=typeof e)var e=o;if(i("components/dcx-js/src/AdobeDCXUtil",["require","exports","module","./components/uuid/uuid"],function(t,o){var i;try{i=t("./components/uuid/uuid")}catch(n){i=e("uuid")}o.merge=function(e){var t,o;for(t=1;t<arguments.length;++t){var i=arguments[t];if("object"==typeof i)for(o in i)i.hasOwnProperty(o)&&(e[o]=i[o])}return e},o.parentDirectory=function(e){var t=e.split("/");return t.pop(),t.join("/")},o.filePathComponents=function(e){var t=e.split("/"),o=t.pop(),i=o.split("."),n=i.length>1?i.pop():null;return{directory:t.join("/"),fileName:o,baseName:i.join("."),extension:n}},o.appendPathElements=function(){var e,t=[],o=arguments.length;for(e=0;o>e;e++){var i=arguments[e];"string"==typeof i&&""!==i&&((0!==e||1===i.length)&&"/"===i.charAt(0)&&(i=i.slice(1)),e!==o-1&&"/"===i.charAt(i.length-1)&&(i=i.slice(0,i.length-1)),t.push(i))}return t.join("/")};var r=/^[^\u0000-\u001F\u0022\u002A\u003A\u003C\u003E\u003F\u005C\u007F]*[^\u0000-\u001F\u0022\u002A\u002E\u003A\u003C\u003E\u003F\u005C\u007F]{1}$/;o.isValidPath=function(e){try{if(e.length>65535)return!1;var t=e.split("/");if(!t||0===t.length)return!1;var o,i=t.length;for(o=0;i>o;o++){var n=t[o];if(n.length>255||!r.test(t[o]))return!1}return!0}catch(a){return!1}};var a=o.noOp=function(){};o.consumeStream=function(e,t,o){e.on("data",o||a),e.on("end",t||a)},o.flatCopy=function(e){var t,o={},i=Object.keys(e),n=i.length;for(t=0;n>t;t++){var r=i[t];o[r]=e[r]}return o},o.deepCopy=function(e){return JSON.parse(JSON.stringify(e))},o.objectsEqual=function(e,t,i){var n,r,a={},s=Object.keys(e),c=s.length;for(r=0;c>r;r++){if(n=s[r],!i||!i[n]){var l=e[n],d=t[n],p=typeof l,h=typeof d;if(p!==h)return!1;if("object"===p){if(!o.objectsEqual(l,d,i))return!1}else if(l!==d)return!1}a[n]=!0}for(s=Object.keys(t),c=s.length,r=0;c>r;r++)if(n=s[r],!a[n])return!1;return!0};var s=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?");o.parseURI=function(e){var t=e.match(s);return{scheme:t[2],authority:t[4],path:t[5],query:t[7],fragment:t[9]}},o.endPointOf=function(e){var t,i=o.parseURI(e),n=i.scheme,r=i.authority,a="https"===n?443:"http"===n?80:-1;return n&&r&&(t=(n+"://"+r).toLowerCase(),a>=0&&r.indexOf(":")<0&&(t=t+":"+a)),t},o.ensureRelativeHrefStartsWithSlash=function(e){if(e){var t=o.parseURI(e),i=t.scheme,n=t.authority;i||n||"/"!==e.charAt(0)&&(e="/"+e)}return e};var c=/^([^:]+):(.*)$/,l=/^\s+|\s+$/g;return o.parseHeaders=function(e){var t,o,i,n={},r=e.split(/\r?\n/);for(t=0;t<r.length;++t){var a=r[t];if(a.length>0){var s=a.charCodeAt(0);if(!o||9!==s&&32!==s){var d=c.exec(a);d&&d.length>1&&(o=d[1].toLowerCase(),i=d[2]||"",i=i.replace(l,""),n[o]=n[o]?n[o]+","+i:i)}else n[o]=n[o]+" "+a.replace(l,"")}}return n},o.timeStamp=function(e){var t=(new Date).getTime();return e&&(t-=t%1e3),t},o.generateUuid=i,o}),i("components/dcx-js/src/AdobeDCXNode",["require","exports","module","./AdobeDCXError","./AdobeDCXUtil"],function(e){function t(e,t,o){e?this._setData(e):this._data={},this._readOnly=t,this._isRoot=o}var o=e("./AdobeDCXError"),i=e("./AdobeDCXUtil"),n="/";t.ROOT_PATH=n,Object.defineProperties(t.prototype,{id:{get:function(){return this._data.id},set:function(e){if(this._readOnly)throw new o(o.READ_ONLY,"This object is read-only.");if(this._owner)throw new o(o.READ_ONLY,"Cannot change the id of a node that is part of a branch or element.");if("string"!=typeof e||""===e)throw new o(o.INVALID_PARAMS,"Expecting a non-empty string.");this._data.id=e,this._setDirty()}},name:{get:function(){return this._data.name},set:function(e){if(this._readOnly)throw new o(o.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&"undefined"!=typeof e)throw new o(o.INVALID_PARAMS,"Expecting a string or undefined.");this._data.name=e,this._setDirty()}},type:{get:function(){return this._data.type},set:function(e){if(this._readOnly)throw new o(o.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&"undefined"!=typeof e)throw new o(o.INVALID_PARAMS,"Expecting a string or undefined.");this._data.type=e,this._setDirty()}},relationship:{get:function(){return this._data.rel},set:function(e){if(this._readOnly)throw new o(o.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&"undefined"!=typeof e)throw new o(o.INVALID_PARAMS,"Expecting a string or undefined.");this._data.rel=e,this._setDirty()}},path:{get:function(){return this._isRoot?n:this._data.path},set:function(e){if(e!==this.path){if(this._readOnly)throw new o(o.READ_ONLY,"This object is read-only.");if(this._isRoot)throw new o(o.READ_ONLY,"Cannot change the path of the root node.");if(e&&!i.isValidPath(e))throw new o(o.INVALID_PARAMS,"Expecting a valid path or undefined.");this._owner?this._owner._setPathOfNode(this,e||void 0):(this._data.path=e||void 0,this._parentPath=""),this._setDirty()}}},parentPath:{get:function(){return this._parentPath},set:function(){throw new o(o.READ_ONLY,"parentPath is read-only.")}},absolutePath:{get:function(){var e=this.path;return this._isRoot?e:e&&this._owner?i.appendPathElements(this._parentPath,e):void 0},set:function(){throw new o(o.READ_ONLY,"absolutePath is read-only.")}},isRoot:{get:function(){return this._isRoot},set:function(){throw new o(o.READ_ONLY,"isRoot is read-only.")}}}),t.prototype.getLink=function(e){if("string"!=typeof e)throw new o(o.INVALID_PARAMS,'Param "relationship" must be a string');return this._data._links?this._data._links[e]:void 0},t.prototype.setLink=function(e,t){if(this._readOnly)throw new o(o.READ_ONLY,"This object is read-only.");if("object"!=typeof e)throw new o(o.INVALID_PARAMS,'Param "link" must be an object.');if("string"!=typeof t)throw new o(o.INVALID_PARAMS,'Param "relationship" must be a string');var i=this._data._links;i||(i=this._data._links={}),i[t]=e,this._setDirty()},t.prototype.removeLink=function(e){if(this._readOnly)throw new o(o.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new o(o.INVALID_PARAMS,'Param "relationship" must be a string');var t=this._data._links;t&&(delete t[e],Object.keys(t).length<1&&delete this._data._links,this._setDirty())};var r={components:!0,children:!0,"manifest-format-version":!0,id:!0,name:!0,type:!0,state:!0,local:!0},a={components:!0,children:!0,rel:!0,path:!0,id:!0,name:!0,type:!0};return t.prototype.getCustomKeys=function(){var e,t=[],o=Object.keys(this._data),i=o.length;for(e=0;i>e;e++){var n=o[e];(this._isRoot?r[n]:a[n])||t.push(n)}return t},t.prototype.getValue=function(e){if("string"!=typeof e)throw new o(o.INVALID_PARAMS,'Param "key" must be a string');if("children"===e||"components"===e)throw new o(o.INVALID_PARAMS,"Illegal key");return this._data[e]},t.prototype.setValue=function(e,t){if(this._readOnly)throw new o(o.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new o(o.INVALID_PARAMS,'Param "key" must be a string');if("children"===e||"components"===e)throw new o(o.INVALID_PARAMS,"Illegal key");this._data[e]=t,this._setDirty()},t.prototype.removeValue=function(e){if(this._readOnly)throw new o(o.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new o(o.INVALID_PARAMS,'Param "key" must be a string');if("children"===e||"components"===e)throw new o(o.INVALID_PARAMS,"Illegal key");delete this._data[e],this._setDirty()},t.prototype.copy=function(){var e=null,o=this._data.children,i=this._data.components;try{o&&delete this._data.children,i&&delete this._data.components;var n=JSON.parse(JSON.stringify(this._data));e=new t(n)}finally{o&&(this._data.children=o),i&&(this._data.components=i)}return e},t.prototype.isEqualTo=function(e,t,o){return this._isEqual(this._data,e._data,i.merge({children:!0,components:!0},t),o)},t.prototype._isEqual=function(e,t,o,n){var r,a,s,c,l;if(!i.objectsEqual(e,t,o))return!1;if(a=e.components,s=t.components,c=a?a.length:0,l=s?s.length:0,c!==l)return!1;if(c){var d,p,h;for(r=0;c>r;r++){for(d=a[r],p=null,h=0;c>h;h++)if(d.id===s[h].id){p=s[h];break}if(!p)return!1;if(!i.objectsEqual(d,p,n))return!1}}if(a=e.children,s=t.children,c=a?a.length:0,l=s?s.length:0,c!==l)return!1;if(c)for(r=0;c>r;r++)if(!this._isEqual(a[r],s[r],o,n))return!1;return!0},t.prototype._setData=function(e){var t=this._verify(e);if(null===t)return this._data=e,this;throw t},t.prototype._verify=function(e){return"string"!=typeof e.id?new o(o.INVALID_DATA,"Node is missing an id of type string"):null},t.prototype._setDirty=function(){this._owner&&this._owner._setDirty()},t}),i("components/dcx-js/src/AdobeDCXComponent",["require","exports","module","./AdobeDCXError","./AdobeDCXUtil"],function(e){function t(e,t){e?this._setData(e):this._data={},this._readOnly=t}function o(e){this.compositeId=e,this.records={}}function i(e,t,o,i,n,r){this.id=e,this.etag=t,this.version=o,this.md5=i,this.length=n,this.type=r}var n=e("./AdobeDCXError"),r=e("./AdobeDCXUtil"),a={unmodified:"unmodified",modified:"modified",pendingDelete:"pendingDelete",committedDelete:"committedDelete"};t.STATES=a,t._UploadResults=o,t._UploadRecord=i,Object.defineProperties(t.prototype,{id:{get:function(){return this._data.id},set:function(e){if(this._readOnly)throw new n(n.READ_ONLY,"This object is read-only.");if(this._owner)throw new n(n.READ_ONLY,"Cannot change the id of a component that is part of a branch or element.");if("string"!=typeof e||""===e)throw new n(n.INVALID_PARAMS,"Expecting a non-empty string.");this._data.id=e,this._setDirty()}},name:{get:function(){return this._data.name},set:function(e){if(this._readOnly)throw new n(n.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&"undefined"!=typeof e)throw new n(n.INVALID_PARAMS,"Expecting a string or undefined.");this._data.name=e,this._setDirty()}},type:{get:function(){return this._data.type},set:function(e){if(this._readOnly)throw new n(n.READ_ONLY,"This object is read-only.");if("string"!=typeof e||""===e)throw new n(n.INVALID_PARAMS,"Expecting a non-empty string.");this._data.type=e,this._setDirty()}},path:{get:function(){return this._data.path},set:function(e){if(this._data.path!==e){if(this._readOnly)throw new n(n.READ_ONLY,"This object is read-only.");if(!r.isValidPath(e))throw new n(n.INVALID_PARAMS,"Expecting a valid path.");this._owner?this._owner._core._setPathOfComponent(this,e):(this._data.path=e,this._parentPath=""),this._setDirty()}}},parentPath:{get:function(){return this._parentPath},set:function(){throw new n(n.READ_ONLY,"parentPath is read-only.")}},absolutePath:{get:function(){return this._data.path&&this._owner?r.appendPathElements(this._parentPath,this._data.path):void 0},set:function(){throw new n(n.READ_ONLY,"absolutePath is read-only.")}},relationship:{get:function(){return this._data.rel},set:function(e){if(this._readOnly)throw new n(n.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&"undefined"!=typeof e)throw new n(n.INVALID_PARAMS,"Expecting a string or undefined.");this._data.rel=e,this._setDirty()}},state:{get:function(){return this._data.state},set:function(e){if(this._readOnly)throw new n(n.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new n(n.INVALID_PARAMS,"Expecting a string.");if(!a.hasOwnProperty(e))throw new n(n.INVALID_PARAMS,'State must be "modified", "unmodified", "pendingDelete", or "committedDelete".');this._data.state=e,this._setDirty()}},etag:{get:function(){return this._data.etag},set:function(e){if(this._readOnly)throw new n(n.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&"undefined"!=typeof e)throw new n(n.INVALID_PARAMS,"Expecting a string or undefined.");this._data.etag=e,this._setDirty()}},md5:{get:function(){return this._data.md5},set:function(e){if(this._readOnly)throw new n(n.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&"undefined"!=typeof e)throw new n(n.INVALID_PARAMS,"Expecting a string or undefined.");this._data.md5=e,this._setDirty()}},version:{get:function(){return this._data.version},set:function(e){if(this._readOnly)throw new n(n.READ_ONLY,"This object is read-only.");if("undefined"!=typeof e&&"string"!=typeof e)throw new n(n.INVALID_PARAMS,"Expecting a string or undefined.");this._data.version=e,this._setDirty()}},length:{get:function(){return this._data.length},set:function(e){if(this._readOnly)throw new n(n.READ_ONLY,"This object is read-only.");if("number"!=typeof e&&"undefined"!=typeof e)throw new n(n.INVALID_PARAMS,"Expecting a number or undefined.");this._data.length=e,this._setDirty()}},width:{get:function(){return this._data.width},set:function(e){if(this._readOnly)throw new n(n.READ_ONLY,"This object is read-only.");if("number"!=typeof e&&"undefined"!=typeof e)throw new n(n.INVALID_PARAMS,"Expecting a number or undefined.");this._data.width=e,this._setDirty()}},height:{get:function(){return this._data.height},set:function(e){if(this._readOnly)throw new n(n.READ_ONLY,"This object is read-only.");if("number"!=typeof e&&"undefined"!=typeof e)throw new n(n.INVALID_PARAMS,"Expecting a number or undefined.");this._data.height=e,this._setDirty()}}});var s={name:!0,id:!0,state:!0,path:!0,rel:!0,type:!0,etag:!0,length:!0,version:!0,md5:!0,width:!0,height:!0};return t.prototype.getCustomKeys=function(){var e,t=[],o=Object.keys(this._data),i=o.length;for(e=0;i>e;e++){var n=o[e];s[n]||t.push(n)}return t},t.prototype.getValue=function(e){if("string"!=typeof e)throw new n(n.INVALID_PARAMS,'Param "key" must be a string');return this._data[e]},t.prototype.setValue=function(e,t){if(this._readOnly)throw new n(n.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new n(n.INVALID_PARAMS,'Param "key" must be a string');this._data[e]=t,this._setDirty()},t.prototype.removeValue=function(e){if(this._readOnly)throw new n(n.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new n(n.INVALID_PARAMS,'Param "key" must be a string');delete this._data[e],this._setDirty()},t.prototype.getLink=function(e){if("string"!=typeof e)throw new n(n.INVALID_PARAMS,'Param "relationship" must be a string');return this._data._links?this._data._links[e]:void 0},t.prototype.setLink=function(e,t){if(this._readOnly)throw new n(n.READ_ONLY,"This object is read-only.");if("object"!=typeof e)throw new n(n.INVALID_PARAMS,'Param "link" must be an object.');if("string"!=typeof t)throw new n(n.INVALID_PARAMS,'Param "relationship" must be a string');var o=this._data._links;o||(o=this._data._links={}),o[t]=e,this._setDirty()},t.prototype.removeLink=function(e){if(this._readOnly)throw new n(n.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new n(n.INVALID_PARAMS,'Param "relationship" must be a string');var t=this._data._links;t&&(delete t[e],Object.keys(t).length<1&&delete this._data._links,this._setDirty())},t.prototype.isEqualTo=function(e,t){return r.objectsEqual(this._data,e._data,t)},t.prototype._setData=function(e){var t=this._verify(e);if(null===t)return this._data=e,this;throw t},t.prototype._setDirty=function(){this._owner&&this._owner._setDirty()},t.prototype._verify=function(e){return"string"!=typeof e.id?new n(n.INVALID_DATA,"Component is missing an id of type string"):null},t}),i("components/dcx-js/src/AdobeDCXFS",["require","exports","module","./AdobeDCXError","./AdobeDCXUtil"],function(e,t){var o,i=(e("./AdobeDCXError"),e("./AdobeDCXUtil"));t.canUseFileSystem=!1,t._setFS=function(e){o=e,t.canUseFileSystem=e?!0:!1},t.ensureDirectoryExists=function(e,n){var r=function(e){e&&"EEXIST"===e.code?n():n(e)},a=function(a){if(a)n();else{var s=i.parentDirectory(e);s?t.ensureDirectoryExists(s,function(t){t?n(t):o.mkdir(e,r)}):o.mkdir(e,r)}};e?o.exists(e,a):a(!0)},t.getTempFilePathAt=function(e,o){var n=function(){var r=e+i.generateUuid();t.exists(r,function(e){e?n():o(r)})};n()},t.exists=function(e,t){o.exists(e,t)},t.deleteFile=function(e,t){o.unlink(e,function(e){e&&"ENOENT"!==e.code?t(e):t()})},t.readFile=function(e,t,i){o.readFile(e,t,i)},t.writeFile=function(e,n,r,a){var s=i.parentDirectory(e);t.ensureDirectoryExists(s,function(t){t?a(t):o.writeFile(e,n,r,a)})},t.writeFileAtomically=function(e,n,r,a){var s=i.parentDirectory(e);t.ensureDirectoryExists(s,function(i){i?a(i):t.getTempFilePathAt(s+"/",function(t){o.writeFile(t,n,r,function(i){i?a(i):o.rename(t,e,a)})})})},t.createWriteStream=function(e,t){return o.createWriteStream(e,t)},t.createReadStream=function(e,t){return o.createReadStream(e,t)},t.move=function(e,n,r,a){var s=i.parentDirectory(n);t.ensureDirectoryExists(s,function(t){if(t)a(t);else if(r){var i=(new Date).getTime()/1e3;o.utimes(e,i,i,function(t){t?a(t):o.rename(e,n,a)})}else o.rename(e,n,a)})},t.info=function(e,t){o.stat(e,t)},t.directoryListing=function(e,t){var i,n,r=[],a=function(a){o.stat(e+"/"+a,function(e,o){if(!e)try{r.push({name:a,info:o}),i--}catch(s){e=s}e?n||(n=e,t(e)):0===i&&t(void 0,r)})};o.readdir(e,function(e,o){if(!e)try{var n,r=o.length;for(i=r,n=0;r>n;n++)a(o[n])}catch(s){e=s}e?t(e):0===i&&t(void 0,[])})},t.deleteDirectory=function(e,i){var n,r,a=function(){try{o.rmdir(e,i)}catch(t){i(t)}},s=function(e){e&&!n&&(n=e),r--,1>r&&(n?i(n):a())},c=function(i){var n=e+"/"+i;o.unlink(n,function(e){try{e?t.deleteDirectory(n,function(e){s(e)}):s()}catch(o){s(o)}})};o.readdir(e,function(e,t){if(!e)try{var o=t.length;if(1>o)a();else{var n;for(r=o,n=0;o>n;n++)c(t[n])}}catch(s){e=s}e&&i(e)})};var n=function(e,t,n){try{var r=t+i.generateUuid(),a=o.createWriteStream(r),s=o.createReadStream(e);s.on("end",function(){o.rename(r,t,n)}),s.pipe(a)}catch(c){n(c)}};return t.copyFile=function(e,o,r){var a=i.parentDirectory(o);t.ensureDirectoryExists(a,function(t){t?r(t):n(e,o,r)})},t}),i("components/dcx-js/src/AdobeDCXBranchCore",["require","exports","module","./AdobeDCXError","./AdobeDCXNode","./AdobeDCXComponent","./AdobeDCXFS","./AdobeDCXUtil"],function(e){function t(e,t,o){this._readOnly=o,this._owner=t,this._setData(e),this._localStorage=void 0}function o(e,t,o,n,r,a,c,l){var d=t._owner._core,p=e._owner._core,h=o&&e.id===t.id,u=p._getSourceHrefOfComponent(e),_=d.getComponentWithId(t.id),f=n&&(!_||!_.etag)&&"unmodified"===e.state,m=!h&&!u,y=m;if(r&&!_&&(u||m)&&e.id===t.id&&(t._data.id=s.generateUuid(),t.state="modified",t.etag=void 0,t.version=void 0,t.md5=void 0,t.length=void 0),a&&a._copyComponentMapping(e.id,l,t.id,c)&&(y=!1,h||(t.state="modified")),m){if(f){if(u=p._getHrefOfComponent(e),d._setSourceHrefOfComponent(u,t,c),!u&&y)throw new i(i.INVALID_STATE,"Failed to determine the source href of a component that does not have a local file.")}else if(y)throw new i(i.INVALID_STATE,"Could not use server-to-server copy for component "+e.id)}else d._setSourceHrefOfComponent(u,t,c);u&&(t.state="modified")}var i=e("./AdobeDCXError"),n=e("./AdobeDCXNode"),r=e("./AdobeDCXComponent"),a=e("./AdobeDCXFS"),s=e("./AdobeDCXUtil");return Object.defineProperties(t.prototype,{rootNode:{get:function(){return this.getChildWithAbsolutePath(n.ROOT_PATH)},set:function(){throw new i(i.READ_ONLY,'Property "rootNode" is read-only.')}},hasLocalStorage:{get:function(){return this._localStorage},set:function(){throw new i(i.READ_ONLY,"Cannot set the property hasLocalStorage.")}},isDirty:{get:function(){return this._isDirty},set:function(){throw new i(i.READ_ONLY,"Cannot set the property isDirty.")}},changeCount:{get:function(){return this._data.local?this._data.local.change||0:0},set:function(){throw new i(i.READ_ONLY,"Cannot set the property changeCount.")}}}),t.prototype.getChildWithId=function(e){return this._allNodes[e]},t.prototype.getChildWithAbsolutePath=function(e){var t=this._absolutePaths[e.toLowerCase()];return t&&t instanceof n?t:void 0},t.prototype.getChildrenOf=function(e){if(e=e?this._allNodes[e.id]:this.rootNode,!e)throw new i(i.INVALID_PARAMS,"Unknown node");var t=[],o=e._data.children;if(Array.isArray(o)){var n;for(n=0;n<o.length;n++){var r=o[n],a=this._allNodes[r.id];if(!a)throw new i(i.INVALID_DATA,"Node not in cache");t[t.length]=a}}return t},t.prototype.addChild=function(e,t,o,r){if(this._readOnly)throw new i(i.READ_ONLY,"This object is read-only.");if(t=t||s.generateUuid(),this._allNodes[t])throw new i(i.DUPLICATE_VALUE,"Node already exists in branch.");if(o&&("number"!=typeof o||o%1!==0))throw new i(i.INVALID_PARAMS,'Param "index" must be an integer.');var a=r?this._allNodes[r.id]:this.rootNode;if(!a)throw new i(i.INVALID_PARAMS,"Unknown parent node.");var c=new n;c.id=t,e&&(c.name=e),c._parentPath=a.absolutePath||a._parentPath;var l=a._data.children;return l?(o>=0&&o<=l.length||(o=l.length),o===l.length?l[o]=c._data:l.splice(o,0,c._data)):a._data.children=[c._data],this._allNodes[c.id]=c,c._owner=this._owner,this._setDirty(),c},t.prototype.removeChild=function(e){if(this._readOnly)throw new i(i.READ_ONLY,"This object is read-only.");if(!e)throw new i(i.INVALID_PARAMS,'Expecting param "node".');if(e.isRoot)throw new i(i.INVALID_PARAMS,"Cannot remove the root node.");var t=e.id;if(!t)throw new i(i.INVALID_PARAMS,'Param "node" must have an id.');var o=this._nodeDataOfParentOfNode(e);if(!o)throw new i(i.INVALID_PARAMS,"Node not found in this branch.");return o.parentNodeData.children.splice(o.index,1),0===o.parentNodeData.children.length&&delete o.parentNodeData.children,e=this._allNodes[t],this._removeNodeFromCachesRecursively(e._data),this._setDirty(),e},t.prototype.moveChild=function(e,t,o){if(this._readOnly)throw new i(i.READ_ONLY,"This object is read-only.");if(!e)throw new i(i.INVALID_PARAMS,'Expecting param "node".');if(e.isRoot)throw new i(i.INVALID_PARAMS,"Cannot move the root node.");if(t&&("number"!=typeof t||t%1!==0))throw new i(i.INVALID_PARAMS,'Param "index" must be an integer.');var n=e.id;if(!n)throw new i(i.INVALID_PARAMS,'Param "node" must have an id.');var r=this._nodeDataOfParentOfNode(e);if(e=this._allNodes[n],!r)throw new i(i.INVALID_PARAMS,"Node not found in this branch.");var a=o?this._allNodes[o.id]:this.rootNode;if(!a)throw new i(i.INVALID_PARAMS,"Unknown parent node.");if(this._nodeIdIsDescendantOf(a.id,e._data))throw new i(i.INVALID_PARAMS,"Must not create a cycle.");var s=r.parentNodeData.children.splice(r.index,1)[0];try{var c=a._data.children;c?(t>=0&&t<=c.length||(t=c.length),t===c.length?c[t]=s:c.splice(t,0,s)):a._data.children=[s]}catch(l){throw r.parentNodeData.children.splice(r.index,0,s),l}return 0===r.parentNodeData.children.length&&delete r.parentNodeData.children,this._setDirty(),this._allNodes[n]},t.prototype.copyChild=function(e,t,o,i,n,r){return this._copyChild(e,t,o,i,n,!1,r)},t.prototype.replaceChild=function(e,t,o,i){return this._copyChild(e,void 0,void 0,t,o||e.id,!0,i)},t.prototype.allComponents=function(){var e,t=[];for(e in this._allComponents)this._allComponents.hasOwnProperty(e)&&t.push(this._allComponents[e]);return t},t.prototype.getComponentWithId=function(e){return this._allComponents[e]},t.prototype.getComponentWithAbsolutePath=function(e){var t=this._absolutePaths[e.toLowerCase()];return t&&t instanceof r?t:void 0},t.prototype.getComponentsOf=function(e){if(e=e?this._allNodes[e.id]:this.rootNode,!e)throw new i(i.INVALID_PARAMS,"Unknown node");var t=[],o=e._data.components;if(Array.isArray(o)){var n;for(n=0;n<o.length;n++){var r=o[n],a=this._allComponents[r.id];if(!a)throw new i(i.INVALID_DATA,"Component not in cache");t[t.length]=a}}return t},t.prototype.addComponent=function(e,t,o,n,a,c,l,d,p,h){var u=this._localStorage;if(!u)throw new i(i.NO_LOCAL_STORAGE,"No local storage. Use AdobeDCXCompositeXfer.uploadNewComponent() followed by addComponentWithUploadResults()");if("function"!=typeof h&&a)throw new i(i.INVALID_PARAMS,'Param "callback" must be a function.');if(this._readOnly)throw new i(i.READ_ONLY,"This object is read-only.");if(p&&"string"!=typeof p)throw new i(i.INVALID_PARAMS,'Param "id" must be of type string.');if(!a&&!l)throw new i(i.INVALID_PARAMS,"Must provide either source or sourceHref.");try{if(l){var _=this._getBranchOf(this).compositeHref;if(_){var f=s.endPointOf(_),m=s.endPointOf(l);if(f&&m&&f!==m)throw new i(i.WRONG_ENDPOINT,"Given source href has an invalid endpoint: "+m)
}}var y=this._local();p=p||s.generateUuid();var v=new r;v.id=p,v.name=e,v.type=t,v.relationship=o,v.path=n,v.state="modified";var g=this,A=function(e){if(!e)try{if(p&&g._allComponents[p])throw new i(i.DUPLICATE_VALUE,'The "id" of a component must be unique.');var t=d?g._allNodes[d.id]:g.rootNode;if(!t)throw new i(i.INVALID_PARAMS,"Unknown parent node.");var o=g._normalizedAbsolutePathForItem(v,t);if(g._absolutePaths[o])throw new i(i.DUPLICATE_VALUE,"Duplicate absolute path: "+o);v._parentPath=t.absolutePath||t._parentPath;var n=t._data.components;n?n.push(v._data):t._data.components=[v._data],v._owner=g._owner,l&&g._setSourceHrefOfComponent(l,v),g._allComponents[v.id]=v,g._absolutePaths[o]=v,g._setDirty()}catch(r){u.removeComponentAsset(v,y),l&&g._setSourceHrefOfComponent(void 0,v),v=void 0,e=r}if(h)return h(e,v);if(e)throw e;return v};if(!a)return A();u.ingestComponentAsset(v,a,c,y,A)}catch(E){if(h)return h(E);throw E}},t.prototype.addComponentWithUploadResults=function(e,t,o,n,a){if(this._readOnly)throw new i(i.READ_ONLY,"This object is read-only.");if(a.compositeId!==this._owner.compositeId)throw new i(i.INVALID_PARAMS,"Param uploadResults does not appear valid to be for this composite.");var s=Object.keys(a.records);if(1!==s.length)throw new i(i.INVALID_PARAMS,"Param uploadResults must contain records of exactly one component upload.");if(this._localStorage)throw new i(i.INVALID_PARAMS,"This method is for in-browser use only. Use addComponent() instead.");var c=a.records[s[0]],l=c.id;if(this._allComponents[l])throw new i(i.DUPLICATE_VALUE,"Duplicate component id: "+l);var d=n?this._allNodes[n.id]:this.rootNode;if(!d)throw new i(i.INVALID_PARAMS,"Unknown parent node.");var p=new r;p.id=l,p.name=e,p.type=c.type,p.relationship=t,p.path=o,p.state="unmodified",p.etag=c.etag,p.length=c.length,p.version=c.version,p.md5=c.md5;var h=this._normalizedAbsolutePathForItem(p,d);if(this._absolutePaths[h])throw new i(i.DUPLICATE_VALUE,"Duplicate absolute path: "+h);p._parentPath=d.absolutePath||d._parentPath;var u=d._data.components;return u?u.push(p._data):d._data.components=[p._data],p._owner=this._owner,this._allComponents[l]=p,this._absolutePaths[h]=p,this._setDirty(),p},t.prototype.updateComponent=function(e,t,o,n){var r=this._localStorage;if(!r)throw new i(i.NO_LOCAL_STORAGE,"No local storage. Use AdobeDCXCompositeXfer.uploadComponent() to upload a new component asset and then call updateComponentWithUploadResults()");if("function"!=typeof n)throw new i(i.INVALID_PARAMS,'Param "callback" must be a function.');if(this._readOnly)throw new i(i.READ_ONLY,"This object is read-only.");if(e=this._allComponents[e.id],!e)throw new i(i.INVALID_PARAMS,"Unknown component.");try{var a=this,s=function(t){if(!t)try{"modified"!==e.state?e.state="modified":a._setDirty(),a._setSourceHrefOfComponent(void 0,e)}catch(o){t=o,e=void 0}n(t,e)};r.ingestComponentAsset(e,t,o,this._local(),s)}catch(c){n(c)}},t.prototype.updateComponentWithUploadResults=function(e,t){if(this._readOnly)throw new i(i.READ_ONLY,"This object is read-only.");if(e=this._allComponents[e.id],!e)throw new i(i.INVALID_PARAMS,"Unknown component.");if(this._localStorage)throw new i(i.INVALID_PARAMS,"This method is for in-browser use only. Use updateComponent() instead.");if(t.compositeId!==this._owner.compositeId)throw new i(i.INVALID_PARAMS,"Param uploadResults does not appear valid to be for this composite.");var o=t.records[e.id];if(!o)throw new i(i.INVALID_PARAMS,"Param uploadResults does not contain an upload record for the given component.");return e.etag=o.etag,e.version=o.version,e.md5=o.md5,e.length=o.length,e},t.prototype.removeComponent=function(e){if(this._readOnly)throw new i(i.READ_ONLY,"This object is read-only.");if(!e)throw new i(i.INVALID_PARAMS,'Expecting param "component".');var t=e.id;if(!t)throw new i(i.INVALID_PARAMS,'Param "component" must have an id.');var o=this._nodeDataOfParentOfComponent(e);if(!o)throw new i(i.INVALID_PARAMS,"Component not found in this branch.");return o.parentNodeData.components.splice(o.index,1),0===o.parentNodeData.components.length&&delete o.parentNodeData.components,e=this._allComponents[t],delete this._allComponents[t],delete this._absolutePaths[this._normalizedAbsolutePathForItem(e)],this._localStorage&&(this._localStorage.removeComponentAsset(e,this._local()),this._setSourceHrefOfComponent(void 0,e)),e._owner=void 0,e._parentPath="",this._setDirty(),e},t.prototype.moveComponent=function(e,t){if(this._readOnly)throw new i(i.READ_ONLY,"This object is read-only.");if(!e)throw new i(i.INVALID_PARAMS,'Expecting param "component".');var o=e.id;if(!o)throw new i(i.INVALID_PARAMS,'Param "component" must have an id.');var n=this._nodeDataOfParentOfComponent(e);if(!n)throw new i(i.INVALID_PARAMS,"Component not found in this branch.");var r=t?this._allNodes[t.id]:this.rootNode;if(!r)throw new i(i.INVALID_PARAMS,"Unknown parent node.");var a=this._normalizedAbsolutePathForItem(e,r);if(this._absolutePaths[a])throw new i(i.DUPLICATE_VALUE,"Duplicate absolute path: "+a);var s=n.parentNodeData.components.splice(n.index,1)[0],c=r._data.components;return c?c.push(s):r._data.components=[s],0===n.parentNodeData.components.length&&delete n.parentNodeData.components,e=this._allComponents[o],delete this._absolutePaths[this._normalizedAbsolutePathForItem(e)],e._parentPath=r.absolutePath||r._parentPath,this._absolutePaths[a]=e,this._setDirty(),e},t.prototype.copyComponent=function(e,t,o,i,n){return this._copyComponent(e,t,o,i,!1,n)},t.prototype.replaceComponent=function(e,t,o,i){return this._copyComponent(e,void 0,t,o||e.id,!0,i)},t.prototype.assetOfComponent=function(e,t){try{if(!this._localStorage)throw new i(i.NO_LOCAL_STORAGE,"No local storage.");if(!e)throw new i(i.INVALID_PARAMS,'Expecting param "component".');var o=e.id;if(!o)throw new i(i.INVALID_PARAMS,'Param "component" must have an id.');var n=this._localStorage.componentAssetPath(e,this._local());if(!t)return n;a.exists(n,function(e){t(void 0,e?n:null)})}catch(r){if(!t)throw r;t(r)}},t.prototype._getHrefOfComponent=function(e){var t,o=this._getBranchOf(e),i=o.compositeHref;return i&&"undefined"!=typeof e.version&&(t=s.appendPathElements(i,e.id),t+=";version="+e.version),t},t.prototype._setSourceHrefOfComponent=function(e,t,o){var i=t.id,n=this._componentSourceHrefLookup(!0,o);e?n[i]=e:n[i]&&delete n[i]},t.prototype._getSourceHrefOfComponent=function(e,t){var o=e.id,i=this._componentSourceHrefLookup(!1,t);return i?i[o]:void 0},t.prototype._copySourceHrefsFrom=function(e){var t=e._componentSourceHrefLookup(!1),o=this.allComponents(),i=o.length;if(i&&t){var n,r=this._componentSourceHrefLookup(!0);for(n=0;i>n;n++){var a=o[n].id;r[a]=t[a]}}},t.prototype._getBranchOf=function(e){return e._owner?this._getBranchOf(e._owner):e},t.prototype._isSameComposite=function(e){return this._getBranchOf(this)._data.id===this._getBranchOf(e)._data.id},t.prototype._stringify=function(e,t){if(e){var o=this._data.local,i=null;try{delete this._data.local,i=JSON.stringify(this._data,void 0,t?2:void 0)}catch(n){throw n}finally{o&&(this._data.local=o)}return i}return JSON.stringify(this._data,void 0,t?2:void 0)},t.prototype._setData=function(e){var t=new n(e,this._readOnly,!0);t._owner=this._owner,t._parentPath="";var o=t.id,a={},c={},l={};c[o]=t,l[n.ROOT_PATH]=t;var d=this,p=function(e,t,o,a,c){var l,h,u,_=e.components;if(Array.isArray(_))for(l=0;l<_.length;l++){var f=_[l],m=new r(f,d._readOnly);if(t[m.id])throw new i(i.INVALID_DATA,"Duplicate component id: "+m.id);if(h=m.path,!s.isValidPath(h))throw new i(i.INVALID_DATA,"Invalid component path: "+h);if(m._owner=d._owner,m._parentPath=c,u=d._normalizedAbsolutePathForItem(m),a[u])throw new i(i.INVALID_DATA,"Duplicate absolute path: "+u);t[m.id]=m,a[u]=m}var y=e.children;if(Array.isArray(y))for(l=0;l<y.length;l++){var v=y[l],g=new n(v,d._readOnly);if(o[g.id])throw new i(i.INVALID_DATA,"Duplicate node id: "+g.id);if(h=g.path,g._owner=d._owner,g._parentPath=c,h){if(!s.isValidPath(h))throw new i(i.INVALID_DATA,"Invalid node path: "+h);if(u=d._normalizedAbsolutePathForItem(g),a[u])throw new i(i.INVALID_DATA,"Duplicate absolute path: "+u);a[u]=g}o[g.id]=g,p(v,t,o,a,g.path?s.appendPathElements(c,g.path):c)}};return p(e,a,c,l,n.ROOT_PATH),this._data=e,this._allComponents=a,this._allNodes=c,this._absolutePaths=l,this._isDirty=!1,this},t.prototype._removeNodeFromCachesRecursively=function(e){var t,o=e.components;if(Array.isArray(o))for(t=0;t<o.length;t++){var i=o[t].id,n=this._allComponents[i];delete this._allComponents[i],delete this._absolutePaths[this._normalizedAbsolutePathForItem(n)],n._owner=void 0,this._localStorage&&(this._localStorage.removeComponentAsset(n,this._local()),this._setSourceHrefOfComponent(void 0,n))}var r=e.children;if(Array.isArray(r))for(t=0;t<r.length;t++)this._removeNodeFromCachesRecursively(r[t]);var a=e.id,s=this._allNodes[a];delete this._allNodes[a],s.path&&delete this._absolutePaths[this._normalizedAbsolutePathForItem(s)],s._owner=void 0},t.prototype._local=function(){if(this._readOnly)throw new i(i.READ_ONLY,"This object is read-only.");return this._data.local||(this._data.local={version:2}),this._data.local},t.prototype._componentSourceHrefLookup=function(e,t){if(e&&this._readOnly)throw new i(i.READ_ONLY,"This object is read-only.");t||(t=this._local());var o=t["componentS2SCopy#srcHref"];return!o&&e&&(o=t["componentS2SCopy#srcHref"]={}),o},t.prototype._recursiveReset=function(e,t){var o,i=e.components;if(i)for(o=i.length-1;o>=0;o--){var n=i[o];"committedDelete"===n.state?(delete i[o],delete this._allComponents[n.id],delete n._owner,this._localStorage&&this._localStorage.removeComponentAsset(n,this._local()),this._setSourceHrefOfComponent(void 0,n,this._local())):(delete n.etag,delete n.version,delete n.length,delete n.md5,n.state="modified",t&&t(n))}var r=e.children;if(r)for(o=0;o<r.length;o++)this._recursiveReset(r[o],t)},t.prototype._nodeIdIsDescendantOf=function(e,t){var o,i=t.children;if(i)for(o=0;o<i.length;o++){var n=i[o];if(n.id===e||this._nodeIdIsDescendantOf(e,n))return!0}return!1},t.prototype._recursivelyGetAllComponentsOfChild=function(e,t){t=t||[];var o,i,n=e._data||e,r=n.components;if(r)for(i=r.length,o=0;i>o;o++)t[t.length]=this._allComponents[r[o].id];var a=n.children;if(a)for(i=a.length,o=0;i>o;o++)t=this._recursivelyGetAllComponentsOfChild(a[o],t);return t},t.prototype._nodeDataOfParentOfNode=function(e,t){t=t||this._data;var o,i=e._data.id,n=t.children;if(n)for(o=0;o<n.length;o++){{var r=n[o];r.path}if(r.id===i)return{parentNodeData:t,index:o};var a=this._nodeDataOfParentOfNode(e,r);if(a)return a}return null},t.prototype._nodeDataOfParentOfComponent=function(e,t){t=t||this._data;var o,i=e._data.id,n=t.components;if(n)for(o=0;o<n.length;o++){var r=n[o];if(r.id===i)return{parentNodeData:t,index:o}}var a=t.children;if(a)for(o=0;o<a.length;o++){var s=a[o],c=this._nodeDataOfParentOfComponent(e,s);if(c)return c}return null},t.prototype._determineAbsolutePathChangesRecursively=function(e,t,o){var i,n=e.components;if(n)for(i=0;i<n.length;i++){var r=n[i],a=this._allComponents[r.id];o.push({item:a,parentPath:t,absPath:s.appendPathElements(t,r.path)})}var c=e.children;if(c)for(i=0;i<c.length;i++){var l=c[i],d=this._allNodes[l.id],p=l.path,h=p?s.appendPathElements(t,p):t;o.push({item:d,parentPath:t,absPath:p?h:void 0}),this._determineAbsolutePathChangesRecursively(l,h,o)}},t.prototype._setPathOfNode=function(e,t){var o=t?s.appendPathElements(e.parentPath,t):e.parentPath,n=[{item:e,absPath:t?o:void 0}];this._determineAbsolutePathChangesRecursively(e._data,o,n);var r,a,c=s.flatCopy(this._absolutePaths);for(r=0;r<n.length;r++){var l=n[r].item;l._data.path&&delete c[this._normalizedAbsolutePathForItem(l)]}for(r=0;r<n.length;r++)if(a=n[r],a.absPath){var d=a.absPath.toLowerCase();if(c[d])throw new i(i.DUPLICATE_VALUE,"Duplicate absolute path: "+d);c[d]=a.item}for(r=0;r<n.length;r++)a=n[r],a.parentPath&&(a.item._parentPath=a.parentPath);e._data.path=t,this._absolutePaths=c},t.prototype._setPathOfComponent=function(e,t){if(!this._allComponents[e.id])throw new i(i.INVALID_PARAMS,"Unknown component.");var o=s.appendPathElements(e.parentPath,t).toLowerCase();if(this._absolutePaths[o])throw new i(i.DUPLICATE_VALUE,"Duplicate absolute path for component: "+o);delete this._absolutePaths[this._normalizedAbsolutePathForItem(e)],this._absolutePaths[o]=e,e._data.path=t},t.prototype._setDirty=function(e){this._isDirty=!0,this._local().change=this.changeCount+1,e||"unmodified"!==this._data.state&&this._data.state||(this._data.state="modified")},t.prototype._normalizedAbsolutePathForItem=function(e,t){var o;return o=t?s.appendPathElements(t.absolutePath||t._parentPath,e.path):e.absolutePath,o.toLowerCase()},t.prototype._hasSameEndpoint=function(e){var t=this._getBranchOf(this).compositeHref,o=this._getBranchOf(e).compositeHref;if(t&&o){var i=s.endPointOf(t),n=s.endPointOf(o);if(i&&n&&i!==n)return!1}return!0},t.prototype._copyComponent=function(e,t,n,r,a,s){if(!e)throw new i(i.INVALID_PARAMS,'Expecting param "component".');if(s&&"function"!=typeof s)throw new i(i.INVALID_PARAMS,"Param callback must be a function.");var c=this,l=e._owner._core,d=this._isSameComposite(l),p=d||this._hasSameEndpoint(e),h=l._local(),u=this._localStorage,_=l._localStorage,f=u&&_;if(f&&!s&&!d)throw new i(i.INVALID_PARAMS,"Must pass a callback when copying between two different composites.");if(!f&&!p)throw new i(i.NO_LOCAL_STORAGE,"Cannot copy between two different endpoints without local storage.");var m=function(e,t,i){o(e,t,d,p,!r,f?u:void 0,i,h)},y=f?_.componentAssetPath(e,h):void 0;if(!s)return this._copyComponentModel(e,t,a,n,r,m);if(d||!y)try{s(void 0,this._copyComponentModel(e,t,a,n,r,m))}catch(v){s(v)}else{var g={};u.ingestComponentAsset(e,y,!0,g,function(o){if(o)s(o);else try{h=g,s(void 0,c._copyComponentModel(e,t,a,n,r,m))}catch(i){s(i)}})}},t.prototype._copyComponentModel=function(e,t,o,n,a,c){if(this._readOnly)throw new i(i.READ_ONLY,"This object is read-only.");if(!e)throw new i(i.INVALID_PARAMS,'Expecting param "component".');var l=e._owner,d=new r(JSON.parse(JSON.stringify(e._data)));n?(d.path=n,d.id=a||s.generateUuid()):a&&(d.id=a),d._owner=this._owner,e.id===d.id&&this._isSameComposite(l._core)||(d.state="modified",d.etag=void 0,d.version=void 0,d.md5=void 0,d.length=void 0);var p=this._allComponents[d.id];if(p&&!o)throw new i(i.DUPLICATE_VALUE,"Component already exists.");if(o&&!p)throw new i(i.INVALID_PARAMS,"Could not find existing component.");var h,u;if(o){var _=this._nodeDataOfParentOfComponent(p);if(!_)throw new i(i.INVALID_PARAMS,"Parent node of existing component not found in this branch.");var f=_.parentNodeData.id;if(u=this._allNodes[f],!u)throw new i(i.INVALID_STATE,"Unknown parent node.");h=_.index}else if(u=t?this._allNodes[t.id]:this.rootNode,!u)throw new i(i.INVALID_PARAMS,"Unknown parent node.");if(d._parentPath=u.absolutePath||u._parentPath,!s.isValidPath(d.path))throw new i(i.INVALID_PARAMS,"Component path must be a valid path for a component.");var m=this._normalizedAbsolutePathForItem(d),y=this._absolutePaths[m];if(y&&y!==p)throw new i(i.DUPLICATE_VALUE,"Duplicate absolute path: "+m);var v=this._local();c&&(v=s.deepCopy(v),c(e,d,v));var g=u._data.components;return o?g[h]=d._data:g?g.push(d._data):u._data.components=[d._data],this._data.local=v,this._allComponents[d.id]=d,this._absolutePaths[m]=d,this._setDirty(),d},t.prototype._copyChild=function(e,t,n,r,a,s,c){if(!e)throw new i(i.INVALID_PARAMS,'Expecting param "node".');var l=this,d=e._owner._core,p=this._isSameComposite(d),h=p||this._hasSameEndpoint(e),u=d._local(),_=this._localStorage,f=d._localStorage,m=_&&f,y=d._recursivelyGetAllComponentsOfChild(e);if(y.length>0){if(m&&!c&&!p)throw new i(i.INVALID_PARAMS,"Must pass a callback when copying between two different composites.");if(!m&&!h)throw new i(i.NO_LOCAL_STORAGE,"Cannot copy components between two different endpoints without local storage.")}var v=function(e,t,i){o(e,t,p,h,!0,m?_:void 0,i,u)};if(!c)return this._copyChildModel(e,t,n,s,r,a,v);var g=function(){c(void 0,l._copyChildModel(e,t,n,s,r,a,v))};if(0===y.length||p||!m)try{g()}catch(A){c(A)}else{var E,b,C={},L=y.length,S=0,w=function(e){if(e&&!b&&(b=e),S--,0===S)if(b)c(b);else try{u=C,g()}catch(t){c(t)}};for(E=0;L>E;E++){var R=y[E],D=f.componentAssetPath(R,u);D&&(S++,_.ingestComponentAsset(R,D,!0,C,w))}if(0===S)try{g()}catch(I){c(I)}}},t.prototype._copyChildModel=function(e,t,o,a,c,l,d){if(this._readOnly)throw new i(i.READ_ONLY,"This object is read-only.");var p=e._owner,h=new n(JSON.parse(JSON.stringify(e._data)));c?(h.path=c,h.id=l||s.generateUuid()):l&&(h.id=l),h._owner=this._owner,e.isRoot&&(delete h._data.local,delete h._data["manifest-format-version"]);var u=this._allNodes[h.id];if(u&&!a)throw new i(i.DUPLICATE_VALUE,"Child node already exists.");if(a&&!u)throw new i(i.INVALID_PARAMS,"Could not find existing node to replace.");var _;if(a){var f=this._nodeDataOfParentOfNode(u);if(!f)throw new i(i.INVALID_PARAMS,"Parent of existing node not found in this branch.");var m=f.parentNodeData.id;if(_=this._allNodes[m],!_)throw new i(i.INVALID_STATE,"Unknown parent node.");o=f.index}else if(_=t?this._allNodes[t.id]:this.rootNode,!_)throw new i(i.INVALID_PARAMS,"Unknown parent node.");if(h._parentPath=_.absolutePath||_._parentPath,h.path){if(!s.isValidPath(h.path))throw new i(i.INVALID_PARAMS,"Node path must be a valid path for a node.");var y=this._normalizedAbsolutePathForItem(h),v=this._absolutePaths[y];if(v&&v!==u)throw new i(i.DUPLICATE_VALUE,"Duplicate absolute path: "+y)}var g=s.flatCopy(this._allNodes),A=s.flatCopy(this._allComponents),E=s.flatCopy(this._absolutePaths),b=s.deepCopy(this._local()),C=function(e,t,o,i,n,r){delete o[e.id],e.path&&delete n[t._normalizedAbsolutePathForItem(e)];var a,s,c=e._data.children;if(c)for(s=c.length,a=0;s>a;a++)C(o[c[a].id],t,o,i,n,r);var l=e._data.components;if(l)for(s=l.length,a=0;s>a;a++){var d=i[l[a].id];delete i[d.id],delete n[t._normalizedAbsolutePathForItem(d)],t._localStorage&&(t._localStorage.removeComponentAsset(d,r),t._setSourceHrefOfComponent(void 0,d,r))}};u&&C(u,this,g,A,E,b);var L=this,S=function(e,t,o,a,c,l,p,h){if(a[e.id])throw new i(i.DUPLICATE_VALUE,"Duplicate node id: "+e.id);a[e.id]=e;var u;if(e.path){if(u=t._core._normalizedAbsolutePathForItem(e),l[u])throw new i(i.DUPLICATE_VALUE,"Duplicate absolute path: "+u);l[u]=e}var _,f,m=e._data.children;if(m)for(f=m.length,_=0;f>_;_++){var y=new n(m[_]);a[y.id]&&(y.id=s.generateUuid()),y._owner=t,y._parentPath=e.absolutePath||e._parentPath,S(y,t,o,a,c,l,p,h)}var v=e._data.components;if(v)for(f=v.length,_=0;f>_;_++){var g=new r(v[_]),A=g.id;if(c[A]&&(g.id=s.generateUuid(),g.state="modified",g.etag=void 0,g.version=void 0,g.md5=void 0,g.length=void 0),g._owner=t,g._parentPath=e.absolutePath||e._parentPath,d&&d(o.getComponentWithId(A),g,p),c[g.id])throw new i(i.DUPLICATE_VALUE,"Duplicate component id: "+g.id);if(c[g.id]=g,u=t._core._normalizedAbsolutePathForItem(g),l[u])throw new i(i.DUPLICATE_VALUE,"Duplicate absolute path: "+u);l[u]=g}};if(S(h,this._owner,p,g,A,E,b,p._local()),a)_._data.children[o]=h._data;else{var w=_._data.children;w?(o>=0&&o<=w.length||(o=w.length),o===w.length?w[o]=h._data:w.splice(o,0,h._data)):_._data.children=[h._data]}return L._allNodes=g,L._allComponents=A,L._absolutePaths=E,L._data.local=b,L._setDirty(),h},t.prototype._verifyIntegrity=function(e,t,o){var r,a=this,c=[],l=!1,d=function(e){return c.push(new i(i.INVALID_STATE,e)),t&&(l||(t("Branch for composite "+a.rootNode.id+" has the following errors:"),l=!0),t("   "+e)),!1},p=function(e,t){return e?!0:d(t)},h=[],u=function(e){(h.indexOf(e)<0||d("Item "+e.id+" encountered more than once"))&&h.push(e)},_=s.flatCopy(this._allComponents),f=s.flatCopy(this._allNodes),m=s.flatCopy(this._absolutePaths),y=Object.keys(m),v=y.length;for(r=0;v>r;r++){var g=y[r];p("/"===g.charAt(0),"Absolute path "+g+" does not start with a slash.")}var A=function(e,t){var o,i,n=e.children;if(n)for(o=0;o<n.length;o++){var r=n[o],c=f[r.id];(c||d("Node "+r.id+" is not in cache."))&&(u(c),p(c._data===r,"Node "+c.id+" _data property incorrect."),delete f[c.id],c.path&&c._owner&&(i=a._normalizedAbsolutePathForItem(c),(m[i]||d("Absolute path of node "+c.id+" ("+i+") is not in cache."))&&delete m[i]),p(c._parentPath===t,"Parent path of node "+c.id+" should be "+t+" but is "+c._parentPath),p(c._owner===a._owner,"Node "+c.id+" _owner property is not correct.")),A(r,r.path?s.appendPathElements(t,r.path):t)}var l=e.components;if(l)for(o=0;o<l.length;o++){var h=l[o],y=_[h.id];(y||d("Component "+h.id+" is not in cache."))&&(u(y),p(y._data===h,"Component "+y.id+" _data property incorrect."),delete _[y.id],y._owner&&(i=a._normalizedAbsolutePathForItem(y),(m[i]||d("Absolute path "+i+" is not in cache."))&&delete m[i]),p(y._parentPath===t,"Parent path of component "+y.id+" should be "+t+" but is "+y._parentPath),p(y._owner===a._owner,"Component "+y.id+" _owner property is not correct."))}},E=m[n.ROOT_PATH];p(E,"Cannot find root node via path")&&(p(E.id===this._data.id,"Root node has correct id"),p(E.path===n.ROOT_PATH,"Root node has correct path"),p(""===E._parentPath,"Root node has correct parent path"),p(E._owner===this._owner,"Root node has correct owner"),p(E._data===this._data,"Root node has correct data"),p(f[E.id]===E,"Cannot find root node via id")&&delete f[E.id],delete m[n.ROOT_PATH]),A(this._data,n.ROOT_PATH);var b=Object.keys(_);for(r=0;r<b.length;r++)d("Component "+b[r]+" is in cache but could not be found.");for(b=Object.keys(f),r=0;r<b.length;r++)d("Node "+b[r]+" is in cache but could not be found.");for(b=Object.keys(m),r=0;r<b.length;r++)d("Absolute path "+b[r]+" is in cache but could not be found.");if(this._localStorage){var C=this._localStorage.componentIds(this._local());for(r=0;r<C.length;r++)p(this._allComponents[C[r]],"Component "+C[r]+" is in local storage mapping but could not be found in the manifest.");if(e)for(C=Object.keys(this._allComponents),r=0;r<C.length;r++){var L=C[r],S=this._allComponents[L],w=this._localStorage.componentAssetPath(S,this._local());p(w,"Component "+L+" does not have an entry in local storage mapping.")&&o&&p(o.existsSync(w),"Asset "+w+" does not exist.")}var R=this._componentSourceHrefLookup();if(R)for(C=Object.keys(R),v=C.length,r=0;v>r;r++){var D=this._allComponents[C[r]];D?p("modified"===D.state,"Component "+C[r]+" is in local source href mapping but has a state of "+D.state):p(!1,"Component "+C[r]+" is in local source href mapping but could not be found in the manifest.")}}return c.length?c:null},t}),i("components/dcx-js/src/AdobeDCXElement",["require","exports","module","./AdobeDCXBranchCore","./AdobeDCXError","./AdobeDCXUtil"],function(e){function t(e,t,i){if(this._owner=t,e)e=this._setData(e,i);else{var r=n.generateUuid();e={id:r},this._core=new o(e,this,i),this._data=e}}var o=e("./AdobeDCXBranchCore"),i=e("./AdobeDCXError"),n=e("./AdobeDCXUtil");return Object.defineProperties(t.prototype,{rootNode:{get:function(){return this._core.rootNode},set:function(e){this._core.rootNode=e}},name:{get:function(){return this._core.rootNode.name},set:function(e){var t=this._core;if(t._readOnly)throw new i(i.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&"undefined"!=typeof e)throw new i(i.INVALID_PARAMS,"Expecting a string or undefined.");t.rootNode.name=e}},type:{get:function(){return this._core.rootNode.type},set:function(e){var t=this._core;if(t._readOnly)throw new i(i.READ_ONLY,"This object is read-only.");if("string"!=typeof e||""===e)throw new i(i.INVALID_PARAMS,"Expecting a non-empty string.");t.rootNode.type=e}},compositeHref:{get:function(){return this._owner.compositeHref},set:function(){throw new i(i.READ_ONLY,'Property "compositeHref" is read-only.')}},_localStorage:{get:function(){return this._core._localStorage},set:function(e){this._core._localStorage=e}},hasLocalStorage:{get:function(){return this._core.hasLocalStorage},set:function(e){this._core.hasLocalStorage=e}},_isDirty:{get:function(){return this._core._isDirty},set:function(e){this._core._isDirty=e}},isDirty:{get:function(){return this._isDirty},set:function(e){this._core.isDirty=e}},changeCount:{get:function(){return this._core.changeCount},set:function(e){this._core.changeCount=e}}}),t.prototype.getChildWithId=function(e){return this._core.getChildWithId(e)},t.prototype.getChildWithAbsolutePath=function(e){return this._core.getChildWithAbsolutePath(e)},t.prototype.getChildrenOf=function(e){return this._core.getChildrenOf(e)},t.prototype.addChild=function(e,t,o,i){return this._core.addChild(e,t,o,i)},t.prototype.removeChild=function(e){return this._core.removeChild(e)},t.prototype.moveChild=function(e,t,o){return this._core.moveChild(e,t,o)},t.prototype.copyChild=function(e,t,o,i,n,r){return this._core.copyChild(e,t,o,i,n,r)},t.prototype.allComponents=function(){return this._core.allComponents()},t.prototype.getComponentWithId=function(e){return this._core.getComponentWithId(e)},t.prototype.getComponentWithAbsolutePath=function(e){return this._core.getComponentWithAbsolutePath(e)},t.prototype.getComponentsOf=function(e){return this._core.getComponentsOf(e)},t.prototype.addComponent=function(e,t,o,i,n,r,a,s,c,l){return this._core.addComponent(e,t,o,i,n,r,a,s,c,l)},t.prototype.addComponentWithUploadResults=function(e,t,o,i,n){return this._core.addComponentWithUploadResults(e,t,o,i,n)},t.prototype.updateComponent=function(e,t,o,i){return this._core.updateComponent(e,t,o,i)},t.prototype.updateComponentWithUploadResults=function(e,t){return this._core.updateComponentWithUploadResults(e,t)},t.prototype.removeComponent=function(e){return this._core.removeComponent(e)},t.prototype.moveComponent=function(e,t){return this._core.moveComponent(e,t)},t.prototype.copyComponent=function(e,t,o,i,n){return this._core.copyComponent(e,t,o,i,n)},t.prototype.assetOfComponent=function(e,t){return this._core.assetOfComponent(e,t)},t.prototype.parse=function(e){if("string"!=typeof e)throw new i(i.INVALID_PARAMS,'Param "data" must be a string');var t=null;try{t=JSON.parse(e)}catch(o){throw new i(i.INVALID_JSON,"Manifest could not be parsed. Underlying error: "+o.message)}return this._setData(t,this._core._readOnly)},t.prototype.copy=function(){return new t(JSON.parse(JSON.stringify(this._data)),this._owner)},t.prototype._updateLocalDataFromBranch=function(e){if(this._readOnly)throw new i(i.READ_ONLY,"This object is read-only.");if(!this._localStorage)throw new i(i.NO_LOCAL_STORAGE,"No local storage.");if(!e._localStorage)throw new i(i.NO_LOCAL_STORAGE,"No local storage for source.");if(this._localStorage.compositePath!==e._localStorage.compositePath)throw new i(i.INVALID_PARAMS,"Branches must have same storage path.");this._core._localStorage.copyLocalStorageData(e,e._core._local(),this,this._core._local()),this._core._copySourceHrefsFrom(e._core)},t.prototype._verify=function(e){return"string"!=typeof e.id?new i(i.INVALID_DATA,"Element is missing an id of type string"):"string"!=typeof e.name?new i(i.INVALID_DATA,"Element is missing a name of type string"):"string"!=typeof e.type?new i(i.INVALID_DATA,"Element is missing a type of type string"):null},t.prototype._setData=function(e,t){var i=this._verify(e);if(null===i)return this._core=new o(e,this,t),this._data=e,this;throw i},t.prototype._local=function(){return this._core._local()},t.prototype._setDirty=function(e){this._core._setDirty(e)},t.prototype._setPathOfNode=function(e,t){this._core._setPathOfNode(e,t)},t.prototype._verifyIntegrity=function(e,t,o){return this._core._verifyIntegrity(e,t,o)},t}),i("components/dcx-js/src/AdobeDCXBranch",["require","exports","module","./AdobeDCXBranchCore","./AdobeDCXElement","./AdobeDCXError","./AdobeDCXUtil"],function(e){function t(e,t){if(e)e=this._setData(e,t);else{var o=c.generateUuid();e={"manifest-format-version":l,id:o},this.originalManifestFormatVersion=l,this._core=new r(e,this,t),this._data=e}this._pendingElements=[]}function o(e){var t,i,n=e.components;if(n)for(i=n.length,t=0;i>t;t++){var r=n[t];delete r.localStorageAssetId}var a=e.children;if(a)for(i=a.length,t=0;i>t;t++)o(a[t])}function i(e,t){t&&e.path&&delete e.path;var o,n=e.components;if("object"==typeof n)for(o=0;o<n.length;o++){var r=n[o];"number"==typeof r.version&&(r.version=r.version.toString())}var a=e.children;if("object"==typeof a)for(o=0;o<a.length;o++){var s=a[o];i(s)}}function n(e){var t=e["manifest-format-version"];if(l>t){if(4>t)throw new s(s.INVALID_DATA,"Encountered manifest format version "+e["manifest-format-version"]+". Format version conversion not yet implemented for that version.");5>t&&o(e),6>t&&i(e,!0)}}var r=e("./AdobeDCXBranchCore"),a=e("./AdobeDCXElement"),s=e("./AdobeDCXError"),c=e("./AdobeDCXUtil"),l=6;return t._newBranchAsCopyOfCore=function(e,o){var i=JSON.parse(JSON.stringify(e._data)),n=new t(i),r=n._core;return n._localStorage=o,n._resetIdentity(function(t){var i=e.getComponentWithId(t.id);if(!i)throw new s(s.INVALID_STATE,"Could not find original component.");if("modified"===i.state||!i.etag)throw new s(s.INVALID_STATE,"Cannot create a new composite from a branch that contains modified or unbound components.");var n=e._getHrefOfComponent(i);if(!n)throw new s(s.INVALID_STATE,"Cannot determine the href of component id "+i.id);r._setSourceHrefOfComponent(n,t),o&&o.removeComponentAsset(t,r._local())}),n},Object.defineProperties(t.prototype,{compositeId:{get:function(){return this._core.rootNode.id},set:function(e){var t=this._core;if(t._readOnly)throw new s(s.READ_ONLY,"This object is read-only.");if("string"!=typeof e||""===e)throw new s(s.INVALID_PARAMS,"Expecting a non-empty string.");if(t._allNodes[e])throw new s(s.DUPLICATE_VALUE,"There is already a node with the same id.");delete t._allNodes[this._data.id],this._data.id=e,t._allNodes[e]=this._core.rootNode,t._setDirty()}},rootNode:{get:function(){return this._core.rootNode},set:function(e){this._core.rootNode=e}},name:{get:function(){return this._core.rootNode.name},set:function(e){var t=this._core;if(t._readOnly)throw new s(s.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&"undefined"!=typeof e)throw new s(s.INVALID_PARAMS,"Expecting a string or undefined.");t.rootNode.name=e}},type:{get:function(){return this._core.rootNode.type},set:function(e){var t=this._core;if(t._readOnly)throw new s(s.READ_ONLY,"This object is read-only.");if("string"!=typeof e||""===e)throw new s(s.INVALID_PARAMS,"Expecting a non-empty string.");t.rootNode.type=e}},compositeHref:{get:function(){return this._data.local?this._data.local.compositeHref:void 0},set:function(e){var t=this._core;if(t._readOnly)throw new s(s.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&"undefined"!=typeof e)throw new s(s.INVALID_PARAMS,"Expecting a string or undefined.");t._local().compositeHref=c.ensureRelativeHrefStartsWithSlash(e),t._setDirty()}},_collaborationType:{get:function(){return this._data.local?this._data.local.collaborationType:void 0},set:function(e){var t=this._core;if(t._readOnly)throw new s(s.READ_ONLY,"This object is read-only.");e?t._local().collaborationType=e:delete t._local().collaborationType,t._setDirty(!0)}},manifestEtag:{get:function(){return this._data.local?this._data.local.manifestEtag:void 0},set:function(e){var t=this._core;if(t._readOnly)throw new s(s.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&"undefined"!=typeof e)throw new s(s.INVALID_PARAMS,"Expecting a string or undefined.");t._local().manifestEtag=e,t._setDirty()}},compositeState:{get:function(){return this._data.state||"unmodified"},set:function(e){var t=this._core;if(t._readOnly)throw new s(s.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new s(s.INVALID_PARAMS,"Expecting a string.");if("unmodified"!==e&&"modified"!==e&&"pendingDelete"!==e&&"committedDelete"!==e)throw new s(s.INVALID_PARAMS,'State must be "modified", "unmodified", "pendingDelete", or "committedDelete".');this._data.state=e,t._setDirty(!0)}},isBound:{get:function(){return this.manifestEtag&&this.compositeHref
},set:function(){throw new s(s.READ_ONLY,"Cannot set the property isBound. Use resetIdentity instead.")}},_localStorage:{get:function(){return this._core._localStorage},set:function(e){this._core._localStorage=e}},hasLocalStorage:{get:function(){return this._core.hasLocalStorage},set:function(e){this._core.hasLocalStorage=e}},_isDirty:{get:function(){return this._core._isDirty},set:function(e){this._core._isDirty=e}},isDirty:{get:function(){return this._core.isDirty},set:function(e){this._core.isDirty=e}},localData:{get:function(){return this._core._stringify(!1,!0)},set:function(){throw new s(s.READ_ONLY,"Cannot set the property localData.")}},remoteData:{get:function(){return this._core._stringify(!0)},set:function(){throw new s(s.READ_ONLY,"Cannot set the property remoteData.")}},pendingElements:{get:function(){return this._pendingElements},set:function(){throw new s(s.READ_ONLY,"Cannot set the property pendingElements.")}},changeCount:{get:function(){return this._core.changeCount},set:function(e){this._core.changeCount=e}}}),t.prototype.parse=function(e){if("string"!=typeof e)throw new s(s.INVALID_PARAMS,'Param "data" must be a string');var t=null;try{t=JSON.parse(e)}catch(o){throw new s(s.INVALID_JSON,"Manifest could not be parsed. Underlying error: "+o.message)}return this._setData(t,this._core._readOnly)},t.prototype.getElementWithId=function(e){return this._createElement(this._core.getChildWithId(e))},t.prototype.getElementWithAbsolutePath=function(e){return this._createElement(this._core.getChildWithAbsolutePath(e))},t.prototype.addElement=function(e,t,o,i,n,r){if("string"!=typeof e)throw new s(s.INVALID_PARAMS,"Element must have a name of type string");if("string"!=typeof t)throw new s(s.INVALID_PARAMS,"Element must have a type of type string");if("string"!=typeof o)throw new s(s.INVALID_PARAMS,"Element must have a path of type string");var a=this._core.addChild(e,i,n,r);try{a.path=o}catch(c){throw this._core.removeChild(a),c}return a._data.type=t,this._createElement(a)},t.prototype.updateElement=function(e){var t=this.getChildWithId(e.rootNode.id);if(!t)throw new s(s.INVALID_PARAMS,"Element does not exist in branch.");var o=this._core.replaceChild(e.rootNode,t.path);return this._deleteElement(e),o},t.prototype.abandonElement=function(e){this._deleteElement(e)},t.prototype.getChildWithId=function(e){return this._core.getChildWithId(e)},t.prototype.getChildWithAbsolutePath=function(e){return this._core.getChildWithAbsolutePath(e)},t.prototype.getChildrenOf=function(e){return this._core.getChildrenOf(e)},t.prototype.addChild=function(e,t,o,i){return this._core.addChild(e,t,o,i)},t.prototype.removeChild=function(e){return this._core.removeChild(e)},t.prototype.moveChild=function(e,t,o){return this._core.moveChild(e,t,o)},t.prototype.copyChild=function(e,t,o,i,n,r){return this._core.copyChild(e,t,o,i,n,r)},t.prototype.replaceChild=function(e,t,o,i){return this._core.replaceChild(e,t,o,i)},t.prototype.allComponents=function(){return this._core.allComponents()},t.prototype.getComponentWithId=function(e){return this._core.getComponentWithId(e)},t.prototype.getComponentWithAbsolutePath=function(e){return this._core.getComponentWithAbsolutePath(e)},t.prototype.getComponentsOf=function(e){return this._core.getComponentsOf(e)},t.prototype.addComponent=function(e,t,o,i,n,r,a,s,c,l){return this._core.addComponent(e,t,o,i,n,r,a,s,c,l)},t.prototype.addComponentWithUploadResults=function(e,t,o,i,n){return this._core.addComponentWithUploadResults(e,t,o,i,n)},t.prototype.updateComponent=function(e,t,o,i){return this._core.updateComponent(e,t,o,i)},t.prototype.updateComponentWithUploadResults=function(e,t){return this._core.updateComponentWithUploadResults(e,t)},t.prototype.removeComponent=function(e){return this._core.removeComponent(e)},t.prototype.moveComponent=function(e,t){return this._core.moveComponent(e,t)},t.prototype.copyComponent=function(e,t,o,i,n){return this._core.copyComponent(e,t,o,i,n)},t.prototype.replaceComponent=function(e,t,o,i){return this._core.replaceComponent(e,t,o,i)},t.prototype.assetOfComponent=function(e,t){return this._core.assetOfComponent(e,t)},t.prototype.copy=function(){return new t(JSON.parse(JSON.stringify(this._data)))},t.prototype._createElement=function(e){var t;if(e){var o=JSON.parse(JSON.stringify(e._data));o["manifest-format-version"]=this._data["manifest-format-version"],delete o.path,t=new a(o,this,this._core._readOnly),t&&this._localStorage&&(t._localStorage=this._localStorage,t._updateLocalDataFromBranch(this),this._localStorage.registerInMemoryBranchOrElement(t))}return t&&this._pendingElements.push(t),t},t.prototype._deleteElement=function(e){var t=this._pendingElements.indexOf(e);if(0>t)throw new s(s.INVALID_PARAMS,"Unknown element.");this._pendingElements.splice(t,1),this._localStorage&&this._localStorage.unregisterInMemoryBranchOrElement(e)},t.prototype._updateLocalDataFromBranch=function(e){if(this._readOnly)throw new s(s.READ_ONLY,"This object is read-only.");if(!this._localStorage)throw new s(s.NO_LOCAL_STORAGE,"No local storage.");if(!e._localStorage)throw new s(s.NO_LOCAL_STORAGE,"No local storage for source.");if(this._localStorage.compositePath!==e._localStorage.compositePath)throw new s(s.INVALID_PARAMS,"Branches must have same storage path.");this._core._localStorage.copyLocalStorageData(e,e._core._local(),this,this._core._local()),this._core._copySourceHrefsFrom(e._core)},t.prototype._verify=function(e){return"string"!=typeof e.id?new s(s.INVALID_DATA,"Manifest is missing an id of type string"):"string"!=typeof e.name?new s(s.INVALID_DATA,"Manifest is missing a name of type string"):"string"!=typeof e.type?new s(s.INVALID_DATA,"Manifest is missing a type of type string"):"number"!=typeof e["manifest-format-version"]?new s(s.INVALID_DATA,"Manifest is missing a manifest-format-version of type number"):null},t.prototype._setData=function(e,t){this.originalManifestFormatVersion=e["manifest-format-version"],n(e),e.local&&(e.local.version=2);var o=this._verify(e);if(null===o)return e["manifest-format-version"]=l,this._core=new r(e,this,t),this._data=e,this;throw o},t.prototype._reset=function(e,t){if(this._readOnly)throw new s(s.READ_ONLY,"This object is read-only.");this._data.local&&(delete this._data.local.manifestEtag,delete this._data.local.compositeHref),e||(this._data.id=c.generateUuid()),this._data.state="modified",this._core._recursiveReset(this._data,t),this._core._setDirty()},t.prototype._resetBinding=function(e){this._reset(!0,e)},t.prototype._resetIdentity=function(e){this._reset(!1,e)},t.prototype._local=function(){return this._core._local()},t.prototype._setDirty=function(e){this._core._setDirty(e)},t.prototype._setPathOfNode=function(e,t){this._core._setPathOfNode(e,t)},t.prototype._verifyIntegrity=function(e,t,o){return this._core._verifyIntegrity(e,t,o)},t}),i("components/dcx-js/src/AdobeDCXPushJournal",["require","exports","module","./AdobeDCXError","./AdobeDCXFS","./AdobeDCXUtil"],function(e){function t(e,t,o){o?this._setData(o,e.href):this._data={"push-journal-format-version":n,"composite-href":e.href,"uploaded-components":{}},this._filePath=t,this._waitingCallbacks=[],this._commitInProgress=!1,this._needAnotherCommit=!1}var o=e("./AdobeDCXError"),i=e("./AdobeDCXFS"),n=(e("./AdobeDCXUtil"),3);return t.readJournal=function(e,o,n,r){i.readFile(e,"utf8",function(i,a){var s;if(i&&i.code&&n&&(i=void 0),!i)try{a=JSON.parse(a),s=new t(o,e,a)}catch(c){n?s=new t(o,e):i=c}r(i,i?void 0:s)})},Object.defineProperties(t.prototype,{compositeHref:{get:function(){return this._data["composite-href"]},set:function(){throw new o(o.READ_ONLY,"This property is read-only.")}},manifestEtag:{get:function(){return this._data.etag},set:function(e){e?this._data.etag=e:delete this._data.etag}},changeCount:{get:function(){return this._data.change},set:function(e){e?this._data.change=e:delete this._data.change}},compositeHasBeenCreated:{get:function(){return this._data["composite-created"]?!0:!1},set:function(e){e?this._data["composite-created"]=!0:delete this._data["composite-created"]}},compositeHasBeenDeleted:{get:function(){return this._data["composite-deleted"]?!0:!1},set:function(e){e?this._data["composite-deleted"]=!0:delete this._data["composite-deleted"]}},isEmpty:{get:function(){return 0===Object.keys(this._data["uploaded-components"]).length&&!this.compositeHasBeenDeleted&&!this.manifestEtag},set:function(){throw new o(o.READ_ONLY,"This property is read-only.")}},isComplete:{get:function(){return this._data.etag&&this._data.change||this._data["composite-deleted"]?!0:!1},set:function(){throw new o(o.READ_ONLY,"This property is read-only.")}}}),t.prototype.recordUploadedComponent=function(e,t,o,i,n,r,a){var s={etag:t,length:n,version:o,md5:i};r&&(s["storage-name"]=r),a&&(s["source-href"]=a),this._data["uploaded-components"][e]=s},t.prototype.idsOfAllUploadedComponents=function(){return Object.keys(this._data["uploaded-components"])},t.prototype.getRecordForUploadedComponent=function(e){return this._data["uploaded-components"][e]},t.prototype.removeRecordForUploadedComponent=function(e){delete this._data["uploaded-components"][e]},t.prototype.applyToBranch=function(e,t){if(!this.isComplete)throw new o(o.INVALID_STATE,"Journal is not complete.");var i=e.isDirty;if(this.compositeHasBeenDeleted)e._data.state="committedDelete",e.manifestEtag=this.manifestEtag;else{var n,r="unmodified"!==e.compositeState&&this.changeCount!==e.changeCount,a=this.idsOfAllUploadedComponents(),s=a.length;for(n=0;s>n;n++){var c=a[n],l=e.getComponentWithId(c);if(l){var d=this.getRecordForUploadedComponent(l.id);l._data.etag=d.etag,l._data.length=d.length,l._data.version=d.version,l._data.md5=d.md5,d["source-href"]?e._core._getSourceHrefOfComponent(l)===d["source-href"]&&(l._data.state="unmodified",e._core._setSourceHrefOfComponent(void 0,l)):e.hasLocalStorage&&e._localStorage.componentAssetName(l,e._local())===d["storage-name"]?(l._data.state="unmodified",e._core._setSourceHrefOfComponent(void 0,l)):e.hasLocalStorage||(l._data.state="unmodified")}}e.manifestEtag=this.manifestEtag,r||(e._data.state="unmodified")}t&&(e._isDirty=i)},t.prototype.commitChanges=function(e){if(!this._filePath)return void(e&&e());var t=this,o=function(e){t._needAnotherCommit=!1,t._commitInProgress=!0,t._waitingCallbacks=[],i.writeFileAtomically(t._filePath,JSON.stringify(t._data),"utf8",function(i){var n,r=e.length;for(n=0;r>n;n++)try{e[n](i)}catch(a){}t._needAnotherCommit?o(t._waitingCallbacks):t._commitInProgress=!1})};t._commitInProgress?(this._needAnotherCommit=!0,e&&this._waitingCallbacks.push(e)):o(e?[e]:[])},t.prototype._setData=function(e,t){if(e["push-journal-format-version"]<=2){var o=e["uploaded-components"];if(o){var i,r=Object.keys(o),a=r.length;for(i=0;a>i;i++){var s=r[i],c=o[s];"number"==typeof c.version&&(c.version=String(c.version))}}e["push-journal-format-version"]=n}var l=this._verify(e,t);if(null===l)return this._data=e,this;throw l},t.prototype._verify=function(e,t){return e["push-journal-format-version"]!==n?new o(o.INVALID_DATA,"Wrong push journal format version."):e["composite-href"]!==t?new o(o.INVALID_DATA,"Composite and journal hrefs mismatch."):e["uploaded-components"]?null:new o(o.INVALID_DATA,"Missing component list.")},t}),i("components/dcx-js/src/AdobeDCXLocalStorage",["require","exports","module","./AdobeDCXError","./AdobeDCXUtil","./AdobeDCXFS"],function(e){function t(e,t){if("string"!=typeof e||""===e)throw new o(o.INVALID_PARAMS,'Param "compositePath" must be a non-empty string.');this._compositePath=e,this._preserveFileExtensions=t,this._inMemoryBranchesAndElements=[],this._inflightComponents=[]}var o=e("./AdobeDCXError"),i=e("./AdobeDCXUtil"),n=e("./AdobeDCXFS");Object.defineProperties(t.prototype,{compositePath:{get:function(){return this._compositePath},set:function(e){if("string"!=typeof e||""===e)throw new o(o.INVALID_PARAMS,'Param "compositePath" must be a non-empty string.');this._compositePath=e}}}),t.prototype.currentManifestPath=function(){return this._compositePath+"/manifest"},t.prototype.currentBaseManifestPath=function(){return this._compositePath+"/manifest.base"},t.prototype.pulledManifestPath=function(){return this._compositePath+"/pull.manifest"},t.prototype.pulledBaseManifestPath=function(){return this._compositePath+"/pull.manifest.base"},t.prototype.pushedManifestPath=function(){return this._compositePath+"/push.manifest"},t.prototype.resolvePulledBranch=function(e,t){var i=this;n.writeFileAtomically(this.currentManifestPath(),e.localData,"utf8",function(e){e?(e.code!==o.OUT_OF_SPACE&&(e=new o(o.INVALID_STATE,"Could not write current manifest.",e)),t(e)):n.move(i.pulledManifestPath(),i.currentBaseManifestPath(),!1,function(e){e?t(new o(o.INVALID_STATE,"Could not move pull manifest.",e)):i._deleteJournal(t)})})},t.prototype.acceptPushedBranch=function(e,t){var i=this;n.writeFileAtomically(this.currentManifestPath(),e.localData,"utf8",function(e){e?(e.code!==o.OUT_OF_SPACE&&(e=new o(o.INVALID_STATE,"Could not write current manifest.",e)),t(new o(o.INVALID_STATE,"Could not write current manifest.",e))):n.move(i.pushedManifestPath(),i.currentBaseManifestPath(),!1,function(e){e?t(new o(o.INVALID_STATE,"Could not move push manifest.",e)):i._deleteJournal(t)})})},t.prototype.discardPulledBranch=function(e){n.deleteFile(this.pulledManifestPath(),e)},t.prototype.discardPushedBranch=function(e){var t=this;n.deleteFile(this.pushedManifestPath(),function(o){o?e(o):t._deleteJournal(e)})},t.prototype.discardBaseBranch=function(e){n.deleteFile(this.currentBaseManifestPath(),e)},t.prototype.registerInMemoryBranchOrElement=function(e){if(this._inMemoryBranchesAndElements.indexOf(e)>=0)throw new o(o.INVALID_STATE,"Branch or element is already registered.");this._inMemoryBranchesAndElements.push(e)},t.prototype.unregisterInMemoryBranchOrElement=function(e){var t=this._inMemoryBranchesAndElements.indexOf(e);if(0>t)throw new o(o.INVALID_STATE,"Unknown branch or element.");this._inMemoryBranchesAndElements.splice(t,1)},t.prototype._deleteJournal=function(e){n.deleteFile(this.pushJournalPath(),e)};var r=/(\/)|(\.$)/;return t.prototype.componentAssetName=function(e,t){var o=t["copyOnWrite#storageIds"],i=o?o[e.id]:null;return i&&r.test(i)&&(i=null),i},t.prototype.componentAssetPath=function(e,t){var o=this.componentAssetName(e,t);return o?this._componentPathFromName(o):null},t.prototype.ingestComponentAsset=function(e,t,i,r,a){var s=this,c=this._newFileNameForComponent(e),l=this._componentPathFromName(c);this._inflightComponents.push(c);var d=function(t){if(!t)try{s._setComponentName(e,r,c)}catch(i){t=i}var n=s._inflightComponents.indexOf(c);0>n&&!t&&(t=new o(o.INVALID_STATE,"Could not find inflight component.")),s._inflightComponents.splice(n,1),a(t)};i?n.copyFile(t,l,d):n.move(t,l,!0,d)},t.prototype.removeComponentAsset=function(e,t){var o=t["copyOnWrite#storageIds"];o&&delete o[e.id]},t.prototype.componentIds=function(e){var t=e["copyOnWrite#storageIds"];return t?Object.keys(t):[]},t.prototype.copyLocalStorageData=function(e,t,o,i){var n,r=o.allComponents(),a=r.length,s=t["copyOnWrite#storageIds"];if(s){var c=i["copyOnWrite#storageIds"];for(c||(c=i["copyOnWrite#storageIds"]={}),n=0;a>n;n++){var l=r[n],d=l.id,p=e.getComponentWithId(d);if(p&&p.etag===l.etag){var h=s[d];h&&(c[d]=h)}}}},t.prototype.removeUnusedLocalFiles=function(e,t){var i,r,a,s,c,l=this,d=function(e){l._deleteComponentAsset(e,function(e){e&&!i&&(i=e),c--,0===c&&t(i)})},p=function(){try{var e,o=s.length,i=[];for(e=0;o>e;e++){var n=s[e].name,p=s[e].info;!r[n]&&p.mtime.getTime()<a&&l._inflightComponents.indexOf(n)<0&&i.push(n)}if(c=o=i.length,c>0)for(e=0;o>e;e++)d(i[e])}catch(h){return void t(h)}0===c&&t()};this._gatherComponentAssetNames([this.currentManifestPath(),this.currentBaseManifestPath(),this.pulledManifestPath(),this.pulledBaseManifestPath(),this.pushedManifestPath()],e,function(e,n,c,l){if(i)return void t(i);if(!e)try{if(1>n||!l)throw new o(o.INVALID_STATE,1>n?"No manifest found.":"Invalid time stamp");r=c,a=l}catch(d){e=d}e&&(i=e),s&&(i?t(i):p())}),n.directoryListing(this._compositePath+"/components",function(e,o){if(i)return void t(i);if(!e)try{s=o}catch(n){e=n}e&&(i=e),r&&(i?t(i):p())})},t.prototype.tempPathForComponent=function(){return this._compositePath+"/tmp/"+i.generateUuid()},t.prototype.deleteTempFiles=function(e){n.deleteDirectory(this._compositePath+"/tmp",e)},t.prototype.clientDataPath=function(){return this._compositePath+"/clientdata"},t.prototype.pushJournalPath=function(){return this._compositePath+"/push.journal"},t.prototype._copyComponentMapping=function(e,t,o,i){var n=t["copyOnWrite#storageIds"];if(!n)return void 0;var r=i["copyOnWrite#storageIds"];r||(r=i["copyOnWrite#storageIds"]={});var a=n[e];return a&&(r[o]=a),a},t.prototype._componentPathFromName=function(e){return this._compositePath+"/components/"+e},t.prototype._newFileNameForComponent=function(e){var t=i.generateUuid();if(this._preserveFileExtensions){var o=e.path?i.filePathComponents(e.path).extension:null;o&&(t=t+"."+o)}return t},t.prototype._setComponentName=function(e,t,o){var i=t["copyOnWrite#storageIds"];i||(i=t["copyOnWrite#storageIds"]={}),i[e.id]=o},t.prototype._gatherComponentAssetNames=function(e,t,o){try{var r,a,s={},c=t||i.timeStamp(!0),l=e.length,d=l,p=0,h=function(e){if(e){e=e["copyOnWrite#storageIds"];var t,o=Object.keys(e);for(t=0;t<o.length;t++){var i=e[o[t]];s[i]=!0}}},u=function(e){n.exists(e,function(t){t?(p++,n.info(e,function(t,i){if(!t)try{var r=i.mtime.getTime();c>r&&(c=r),n.readFile(e,"utf8",function(e,t){if(d--,!e)try{t=JSON.parse(t),h(t.local)}catch(i){e=i}e&&!a&&(a=e),0===d&&o(a,p,s,c)})}catch(l){t=l}t&&(d--,a||(a=t),0===d&&o(a))})):(d--,0===d&&o(a,p,s,c))})};for(r=0;l>r;r++)u(e[r]);for(l=this._inMemoryBranchesAndElements.length,r=0;l>r;r++)h(this._inMemoryBranchesAndElements[r]._local())}catch(_){o(_)}},t.prototype._deleteComponentAsset=function(e,t){n.deleteFile(this._componentPathFromName(e),t)},t}),i("components/dcx-js/src/AdobeDCXComposite",["require","exports","module","./AdobeDCXError","./AdobeDCXBranch","./AdobeDCXPushJournal","./AdobeDCXLocalStorage","./AdobeDCXFS","./AdobeDCXUtil"],function(e){function t(e,t,o,n,r,a){r=s.ensureRelativeHrefStartsWithSlash(r),this._options=a||{},o?this._setPath(o):r?(this._href=r,e&&(this._name=e),t&&(this._type=t),n&&(this._id=n)):t&&(this._current=new i,e&&(this._current._data.name=e),this._current._data.type=t,n&&(this._current.compositeId=n)),this._autoRemoveUnusedLocalFiles=!0,this._options.xhrBaseBranchSupport&&(this._baseBranchData=void 0,this._pushedBranchData=void 0,this._pulledBranchData=void 0),this._collaborationType=c.PRIVATE}var o=e("./AdobeDCXError"),i=e("./AdobeDCXBranch"),n=e("./AdobeDCXPushJournal"),r=e("./AdobeDCXLocalStorage"),a=e("./AdobeDCXFS"),s=e("./AdobeDCXUtil"),c={PRIVATE:void 0,SHARED_BY_USER:"sharedByUser",SHARED_WITH_USER:"sharedWithUser"};return t.newCompositeAsCopyOf=function(e,n,r,a,c,l,d){var p=e._core;if(p||e.current&&(p=e.current._core),!p)throw new o(o.INVALID_PARAMS,"compositeBranchOrElement must be a branch, an element or a composite with a current branch.");var h=new t(void 0,void 0,void 0,void 0,void 0,d);return a&&(h.path=a),h._current=i._newBranchAsCopyOfCore(p,this._localStorage),h.id=c||s.generateUuid(),n&&(h.name=n),r&&(h.type=r),l&&(h.href=l),h},t.COLLABORATION=c,Object.defineProperties(t.prototype,{id:{get:function(){return this._current?this._current.compositeId:this._id},set:function(e){if("string"!=typeof e)throw new o(o.INVALID_PARAMS,"Expecting a string.");this._current&&(this._current.compositeId=e),this._id=e}},name:{get:function(){return this._current?this._current.name:this._name},set:function(e){if("string"!=typeof e)throw new o(o.INVALID_PARAMS,"Expecting a string.");this._current&&(this._current.name=e),this._name=e}},type:{get:function(){return this._current?this._current.type:this._type},set:function(e){if("string"!=typeof e)throw new o(o.INVALID_PARAMS,"Expecting a string.");this._current&&(this._current.type=e),this._type=e}},href:{get:function(){return this._current?this._current.compositeHref:this._href},set:function(e){if("string"!=typeof e)throw new o(o.INVALID_PARAMS,"Expecting a string.");e=s.ensureRelativeHrefStartsWithSlash(e),this._current&&(this._current.compositeHref=e),this._href=e}},collaborationType:{get:function(){return this._current?this._current._collaborationType:this._collaborationType},set:function(e){if(e!==c.PRIVATE&&e!==c.SHARED_BY_USER&&e!==c.SHARED_WITH_USER)throw new o(o.INVALID_PARAMS,"Invalid value: ."+e);this._current&&(this._current._collaborationType=e),this._collaborationType=e}},path:{get:function(){return this._path},set:function(e){if("string"!=typeof e)throw new o(o.INVALID_PARAMS,"Expecting a string.");this._setPath(e)}},isBound:{get:function(){return this._current&&this._current.isBound||!this._current&&this._href},set:function(){throw new o(o.READ_ONLY,"Cannot set the property isBound. Use resetIdentity or resetBinding instead.")}},hasLocalStorage:{get:function(){return this._localStorage},set:function(){throw new o(o.READ_ONLY,"Cannot set the property hasLocalStorage.")}},autoRemoveUnusedLocalFiles:{get:function(){if(!this._localStorage)throw new o(o.NO_LOCAL_STORAGE,"No local storage.");return this._autoRemoveUnusedLocalFiles},set:function(e){if(!this._localStorage)throw new o(o.NO_LOCAL_STORAGE,"No local storage.");this._autoRemoveUnusedLocalFiles=e}},clientDataStoragePath:{get:function(){if(!this._localStorage)throw new o(o.NO_LOCAL_STORAGE,"No local storage.");return this._localStorage.clientDataPath()},set:function(){throw new o(o.READ_ONLY,'Property "clientDataStoragePath" is read-only.')}},current:{get:function(){return this._current},set:function(){throw new o(o.READ_ONLY,'Property "current" is read-only.')}}}),t.prototype.loadCurrentFromLocalStorage=function(e){if(!this._localStorage)throw new o(o.NO_LOCAL_STORAGE,"No local storage.");var t=this;this._loadBranch(this._localStorage.currentManifestPath(),!1,function(o,i){if(!o&&i)try{t._current=i,t._currentBranchCommittedAtDate=s.timeStamp(!0)}catch(n){o=n}e(o,o?void 0:i)})},t.prototype.commitChanges=function(e){if(!this._localStorage)throw new o(o.NO_LOCAL_STORAGE,"No local storage.");if(!this._current)return e(new o(o.INVALID_STATE,"Current branch is not in memory."));var t=this;a.writeFileAtomically(this._localStorage.currentManifestPath(),this._current.localData,"utf8",function(o){if(!o)try{t._currentBranchCommittedAtDate=s.timeStamp(!0),t._current._isDirty=!1}catch(i){o=i}e(o)})},t.prototype.tempAssetPath=function(){if(!this._localStorage)throw new o(o.NO_LOCAL_STORAGE,"No local storage.");return this._localStorage.tempPathForComponent()},t.prototype.deleteTempFiles=function(e){if(!this._localStorage)throw new o(o.NO_LOCAL_STORAGE,"No local storage.");this._localStorage.deleteTempFiles(function(t){e&&e(t)})},t.prototype.removeUnusedLocalFiles=function(e){if(!this._localStorage)throw new o(o.NO_LOCAL_STORAGE,"No local storage.");this._localStorage.removeUnusedLocalFiles(this._currentBranchCommittedAtDate,e)},t.prototype.removeLocalStorage=function(e){if(!this._localStorage)throw new o(o.NO_LOCAL_STORAGE,"No local storage.");return this._path?void a.deleteDirectory(this._path,e):e(new o(o.INVALID_STATE,"No path set."))},t.prototype.loadBaseBranch=function(e){if(!this._localStorage&&!this._baseBranchData)throw new o(o.NO_LOCAL_STORAGE,"No local storage.");if(this._localStorage)this._loadBranch(this._localStorage.currentBaseManifestPath(),!0,e);else{var t,n;try{n=new i(void 0,!0).parse(this._baseBranchData)}catch(r){t=r}e(t,n)}},t.prototype.loadPulledBranch=function(e){if(!this._localStorage)throw new o(o.NO_LOCAL_STORAGE,"No local storage.");this._loadBranch(this._localStorage.pulledManifestPath(),!1,e)},t.prototype.loadPushedBranch=function(e){if(!this._localStorage)throw new o(o.NO_LOCAL_STORAGE,"No local storage.");this._loadBranch(this._localStorage.pushedManifestPath(),!1,e)},t.prototype.resolvePullWithBranch=function(e,t){if(!e)throw new o(o.INVALID_PARAMS,"Need a branch.");if(e===this._current)throw new o(o.INVALID_PARAMS,"Cannot resolve current.");if(this._localStorage&&!t)throw new o(o.INVALID_PARAMS,"Need a callback function.");if(this._localStorage){var i=this;i._localStorage.resolvePulledBranch(e,function(o){if(!o)try{i._current=e,i._autoRemoveUnusedLocalFiles&&i._localStorage.removeUnusedLocalFiles(i._currentBranchCommittedAtDate,function(){})}catch(n){o=n}t(o,o?void 0:i._current)})}else{if(this._options.xhrBaseBranchSupport&&(this._baseBranchData=this._pulledBranchData,this._pulledBranchData=void 0),this._current=e,!t)return this._current;t(void 0,this._current)}},t.prototype.acceptPush=function(e){if(this._localStorage&&!e)throw new o(o.INVALID_PARAMS,"Need a callback function.");var t,i,r=this,a=function(o){if(!o)if(t)try{r._localStorage?(t.applyToBranch(i),r._localStorage.acceptPushedBranch(i,function(o){if(!o)try{t.applyToBranch(r._current,!0),r._autoRemoveUnusedLocalFiles&&r._localStorage.removeUnusedLocalFiles(r._currentBranchCommittedAtDate,function(){})}catch(i){o=i}e(o)})):(t.applyToBranch(r._current,!0),r._options.xhrBaseBranchSupport&&(r._baseBranchData=r._pushedBranchData,r._pushedBranchData=void 0),r._pushJournal=void 0,e&&e())}catch(n){o=n}else e&&e();if(o){if(!e)throw o;e(o)}};if(!this._localStorage)return t=this._pushJournal,a();var s,c=2;n.readJournal(r._localStorage.pushJournalPath(),r,!1,function(e,i){c--,s?a():(e?"ENOENT"!==e.code&&(s=new o(o.INVALID_STATE,"Failed to load push journal.",e)):t=i,c||a())}),this._loadBranch(this._localStorage.currentManifestPath(),!1,function(e,t){c--,s?a():(e?s=new o(o.INVALID_STATE,"Failed to load current manifest.",e):i=t,c||a())})},t.prototype.discardPulledBranch=function(e){if(!this._localStorage)throw new o(o.NO_LOCAL_STORAGE,"No local storage.");var t=this;this._localStorage.discardPulledBranch(function(o){if(!o){try{t._autoRemoveUnusedLocalFiles&&t._localStorage.removeUnusedLocalFiles(t._currentBranchCommittedAtDate,function(){})}catch(i){o=i}e(o)}o&&e(o)})},t.prototype.discardPushedBranch=function(e){if(!this._localStorage)throw new o(o.NO_LOCAL_STORAGE,"No local storage.");var t=this;this._localStorage.discardPushedBranch(function(o){if(!o){try{t._autoRemoveUnusedLocalFiles&&t._localStorage.removeUnusedLocalFiles(t._currentBranchCommittedAtDate,function(){})}catch(i){o=i}e(o)}o&&e(o)})},t.prototype.resetBinding=function(e){delete this._href,this._current&&this._current._resetBinding(),this._localStorage?this._discardEveryBranchButCurrent(e):(this._baseBranchData=void 0,this._pushedBranchData=void 0,this._pulledBranchData=void 0,e&&e())},t.prototype.resetIdentity=function(e){delete this._href,this._current?(this._current._resetIdentity(),this._id=this._current.compositeId):this._id=s.generateUuid(),this._localStorage?this._discardEveryBranchButCurrent(e):(this._baseBranchData=void 0,this._pushedBranchData=void 0,this._pulledBranchData=void 0,e&&e())},t.prototype._loadBranch=function(e,t,n){if("function"!=typeof n)throw new o(o.INVALID_PARAMS,'Param "callback" must be a function.');var r=this;a.exists(e,function(o){o?a.readFile(e,"utf8",function(e,o){var a;if(!e)try{a=new i(void 0,t).parse(o),a._localStorage=r._localStorage}catch(s){e=s}n(e,a)}):n()})},t.prototype._discardEveryBranchButCurrent=function(e){if(!this._localStorage)throw new o(o.NO_LOCAL_STORAGE,"No local storage.");var t,i=this,n=3,r=function(o){o&&!t&&(t=o),n--,0===n&&(!t&&i._autoRemoveUnusedLocalFiles&&i._localStorage.removeUnusedLocalFiles(i._currentBranchCommittedAtDate,function(){}),e(t))};this._localStorage.discardPushedBranch(r),this._localStorage.discardPulledBranch(r),this._localStorage.discardBaseBranch(r)},t.prototype._setPath=function(e){this._localStorage?this._localStorage.compositePath=e:a.canUseFileSystem&&(this._localStorage=new r(e,this._options.preserveFileExtensions),this._current&&(this._current._localStorage=this._localStorage)),this._path=e},t}),"function"!=typeof e)var e=o;return i("components/dcx-js/src/AdobeNetworkHTTPService",["require","exports","module","./AdobeDCXUtil","./AdobeDCXError","./AdobeDCXFS"],function(t){function o(e){this.filename=e}function i(){}function n(e){this._requestQueue=[],this._requestsOutstanding=[],this._rejectedAuths=[],this._authCallback=e,this._isActive=!0,this._waitingForAuthentication=!1,this._currentAuthId=c.generateUuid(),this._https=a,this._XMLHttpRequest=r,this._maxOutstanding=5}var r,a,s,c=t("./AdobeDCXUtil"),l=t("./AdobeDCXError"),d=t("./AdobeDCXFS");"undefined"!=typeof global&&global.Buffer?(a=e("https"),s=e("url")):r=window.XMLHttpRequest;var p=c.merge,h=3e5;return Object.defineProperties(n.prototype,{isActive:{get:function(){return this._isActive},set:function(e){var t=this._isActive;t!==e&&(this._isActive=e,e||(this._authValue=void 0,this._checkQueue()))}},crossOriginCredentials:{get:function(){return this._withCredentials},set:function(e){this._withCredentials=e}},maxOutstanding:{get:function(){return this._maxOutstanding},set:function(e){this._maxOutstanding=e,this._checkQueue()}}}),n.prototype._forceXhr=function(t){this._https=void 0,this._XMLHttpRequest=t||r||e("xhr2")},n.FileContent=o,n.StreamProvider=i,n.prototype.setAdditionalHeaders=function(e){this._additionalHeaders=e||{}},n.prototype.setAdditionalNodeOptions=function(e){this._additionalNodeOptions=e},n.prototype.setApiKey=function(e){this._apiKey=e},n.prototype.setTimeout=function(e){this._timeout=e},n.prototype.setAuthToken=function(e){e?(this._authValue="Bearer "+e,this.resume()):(this._authValue=void 0,this._currentAuthId=c.generateUuid())},n.prototype.resume=function(){this._currentAuthId=c.generateUuid(),this._waitingForAuthentication=!1,this._checkQueue()},n.prototype.setRequestHooks=function(e,t){this._beforeHook=e,this._afterHook=t},n.prototype.invoke=function(e,t,i,n,r,a){r=r||{};var s=r.responseType;if(s instanceof o){if(!d.canUseFileSystem)throw new l(l.INVALID_PARAMS,"No filesystem access")}else if("buffer"===s){if("function"!=typeof Buffer)throw new l(l.INVALID_PARAMS,"No Buffer class")}else if("blob"===s){if("function"!=typeof Blob)throw new l(l.INVALID_PARAMS,"No Blob class")}else if(s&&"text"!==s&&"json"!==s&&"arraybuffer"!==s)throw new l(l.INVALID_PARAMS,"Unsupported response type");i=p({},i,this._additionalHeaders),this._apiKey&&(i["x-api-key"]=this._apiKey);var h={method:e,href:t,headers:i,callback:a,body:n,options:r},u=r.reuseRequestDesc;if(u){if(this._requestQueue.indexOf(u)>=0||this._requestsOutstanding.indexOf(u)>=0)throw new l(l.INVALID_PARAMS,"Request descriptor still in use.");h=c.merge(u,h)}return this._doRequest(h),h},n.prototype._doRequest=function(e){function t(t,o){u&&u.end();var i=f._requestsOutstanding.indexOf(e);i>=0&&f._requestsOutstanding.splice(i,1);var n=e.callback;n&&(e.callback=void 0,t&&(t.clientRequest=e.clientRequest,t.xhr=e.xhr),t&&t.code!==l.SERVICE_IS_INACTIVE&&!f._isActive?t=new l(l.SERVICE_IS_INACTIVE,"Service is now inactive",t):e.timedOut&&(t=new l(l.TIMED_OUT,"timed out request",t)),n(t,o)),f._isActive&&f._checkQueue()}function n(i){function n(){return a?void 0:(a=!0,u=void 0,t(void 0,i))}var r=!1,a=!1,s=f._requestsOutstanding.indexOf(e);if(0>s)return void f._checkQueue();if(e.response=i,401===i.statusCode&&f._authCallback)f._requestsOutstanding.splice(s,1),f._requestQueue.unshift(e),f._authFail(e),c.consumeStream(i);else{var p=e.progress;200===i.statusCode||201===i.statusCode||202===i.statusCode?(i.on("data",function(e){e.length&&p&&p(e.length),u||y.push(e)}),f._https&&g instanceof o&&(u=d.createWriteStream(g.filename),i.pipe(u),r=!0)):c.consumeStream(i),i.once("end",function(){var o=f._requestsOutstanding.indexOf(e);if(!(0>o||(f._requestsOutstanding.splice(o,1),f._checkQueue(),r||a)))return a=!0,i.response=Buffer.concat(y),"arraybuffer"===g?i.response=new ArrayBuffer(i.response):"text"===g&&(i.response=i.response.toString()),t(void 0,i)}),i.once("close",function(){return a?void 0:(a=!0,t(new l(l.NETWORK_ERROR,"incomplete response")))}),r&&(u.once("finish",n),u.once("close",n))
}}function r(){var i=e.progress;if(i&&h.response){var n=h.response.length;i(n-m),m=n}if(4===h.readyState){if(0===h.status)return t(new l(l.UNEXPECTED,"XHR failure"));var r=f._requestsOutstanding.indexOf(e);if(0>r)return void f._checkQueue();if(f._requestsOutstanding.splice(r,1),401!==h.status||!f._authCallback){if(e.xhr=h,e.response=h,h.statusCode=h.status,h.headers=c.parseHeaders(h.getAllResponseHeaders()),g instanceof o){var a=h.response.response;return void d.writeFileAtomically(g.filename,a,void 0,function(e){return e?t(new l(l.UNEXPECTED,"Can't create file",e,h)):t(void 0,h)})}return i&&v&&i(v.length||v.size),t(void 0,h)}f._requestQueue.unshift(e),f._authFail(e),f._checkQueue()}}function a(o){o.pipe(_),o.on("error",function(o){return f.abort(e),t(new l(l.TERMINATED_INPUTSTREAM,"Input stream terminated abnormally",o))})}var h,u,_,f=this,m=0,y=[],v=e.body,g=e.options.responseType;if(!this._isActive)return t(new l(l.SERVICE_IS_INACTIVE,"Network request in inactive state"));if(this._waitingForAuthentication||this._requestsOutstanding.length>=this._maxOutstanding||e.options.noSoonerThen)this._requestQueue.push(e),this._waitingForAuthentication||this._checkQueue();else{var A=e.headers;if(null===A.Authorization)delete A.Authorization;else{if(!this._allowAuthTokenToBeSentInsecurely_DONT_USE_THIS_IN_PRODUCTION&&0!==e.href.indexOf("https:"))return t(new l(l.INVALID_PARAMS,"Must not send auth token over unsecured connection"));this._authValue&&(A.Authorization=this._authValue)}if(this._currentAuthId&&(e.authId=this._currentAuthId),this._beforeHook&&this._beforeHook(e),A["X-Request-Id"]=c.generateUuid(),this._https){this._requestsOutstanding.push(e);var E=s.parse(e.href),b=p({},this._additionalNodeOptions,E);b.method=e.method||"GET",b.headers=A,console.log(b.method+" "+e.href),_=this._https.request(b,n),e.clientRequest=_,_.once("error",t),f._timeout&&_.setTimeout(f._timeout,function(){e.timedOut=!0,_.abort()}),e.bytesSent=0,e.bytesReported=0,_.once("end",function(){if(e.progress){var t=e.bytesSent-e.bytesReported;t>0&&(e.progress(t),e.bytesReported+=t)}});var C=_.write;if(_.write=function(t){var o=t&&t.length;return o&&(e.bytesSent+=o),C.call(_,t,function(){e.progress&&t&&(e.progress(o),e.bytesReported+=o)})},v instanceof o){var L=d.createReadStream(v.filename);a(L)}else if(v instanceof i)if(v.getStream){var S=v.getStream();a(S)}else v.getStreamAsync&&v.getStreamAsync(function(o,i){return o?(f.abort(e),t(new l(l.TERMINATED_INPUTSTREAM,"Error creating input stream",o))):void a(i)});else if(v instanceof Buffer)_.write(v),_.end();else if(v instanceof ArrayBuffer)_.write(new Buffer(new Int8Array(v))),_.end();else if("string"==typeof v)_.write(new Buffer(v,"utf8")),_.end();else{if(v)return t(new l(l.INVALID_PARAMS,"Invalid data type"));_.end()}this._afterHook&&this._afterHook(e,_)}else{if(v instanceof o)return d.canUseFileSystem?void d.readFile(v.filename,{},function(o,i){return o?t(o):(e.body=i,void f._doRequest(e))}):t(new l(l.INVALID_PARAMS,"Can't use FileContent without filesystem support"));"function"==typeof Buffer&&v instanceof Buffer&&(e.body=v=new Int8Array(v)),this._requestsOutstanding.push(e),h=new this._XMLHttpRequest,h.open(e.method,e.href,!0),this._withCredentials&&(h.withCredentials=!0),g&&(h.responseType=g instanceof o?"buffer":g),h.onreadystatechange=r;var w;for(w in A)A.hasOwnProperty(w)&&h.setRequestHeader(w,A[w]);e.xhr=h,f._timeout&&(h.timeout=f._timeout,h.ontimeout=function(){e.timedOut=!0,h.abort()}),v?h.send(v):h.send(),this._afterHook&&this._afterHook(e,h)}}},n.prototype._authFail=function(e){if(this._authCallback){var t=e.authId;if(-1!==this._rejectedAuths.indexOf(t))return;this._authValue=null,this._waitingForAuthentication=!0,this._rejectedAuths.unshift(t)>this._maxOutstanding&&(this._rejectedAuths.length=this._maxOutstanding),this._authCallback(this)}},n.prototype._checkQueue=function(){if(!this._isActive){var e=this._requestsOutstanding;this._requestsOutstanding=[],e.forEach(function(e){e.xhr&&e.xhr.abort(),e.clientRequest&&e.clientRequest.abort();var t=e.callback;if(t){e.callback=void 0;var o=new l(l.SERVICE_IS_INACTIVE,"Network request in inactive state");t(o)}});var t=this._requestQueue;return this._requestQueue=[],t.forEach(function(e){var t=new l(l.SERVICE_IS_INACTIVE,"Network request in inactive state"),o=e.callback;o&&(e.callback=void 0,o(t))}),void(this._checkQueueTimerId&&(clearTimeout(this._checkQueueTimerId),this._checkQueueTimerId=void 0,this._checkQueueTimerWhen=void 0))}for(var o,i=Date.now(),n=i+h,r=0;;){if(this._waitingForAuthentication||this._requestsOutstanding.length>=this._maxOutstanding||r>=this._requestQueue.length)break;var a=this._requestQueue[r];o=a.options.noSoonerThen||i,o&&o>n&&(o=a.options.noSoonerThen=n),i>=o?(this._requestQueue.splice(r,1),a.options.noSoonerThen=void 0,this._doRequest(a)):r++}if(!this._waitingForAuthentication&&this._requestsOutstanding.length<this._maxOutstanding&&this._requestQueue.length>0){var s,c,d=this._requestQueue.length;for(c=0;d>c;c++)o=this._requestQueue[c].options.noSoonerThen,o&&o>n&&(o=this._requestQueue[c].options.noSoonerThen=n),o&&(s=s&&o>s?s:o);if(s&&(!this._checkQueueTimerWhen||this._checkQueueTimerWhen>s)){this._checkQueueTimerId&&clearTimeout(this._checkQueueTimerId),this._checkQueueTimerWhen=s;var p=this;this._checkQueueTimerId=setTimeout(function(){p._checkQueueTimerWhen=void 0,p._checkQueueTimerId=void 0,p._checkQueue()},s-i)}}},n.prototype.abort=function(e){var t=this._requestQueue.indexOf(e);return t>=0?void this._requestQueue.splice(t,1):(t=this._requestsOutstanding.indexOf(e),void(t>=0&&(this._requestsOutstanding.splice(t,1),e.xhr&&e.xhr.abort(),e.clientRequest&&e.clientRequest.abort(),this._checkQueue())))},n.prototype.abortAllWithToken=function(e){if(e){var t;for(t=0;t<this._requestQueue.length;++t)this._requestQueue[t].token===e&&(this._requestQueue.splice(t,1),--t);for(t=0;t<this._requestsOutstanding.length;++t)if(this._requestsOutstanding[t].token===e){var o=this._requestsOutstanding[t];this._requestsOutstanding.splice(t,1),--t,o.xhr&&o.xhr.abort(),o.clientRequest&&o.clientRequest.abort()}this._checkQueue()}},n}),i("components/dcx-js/src/AdobeStorageSession",["require","exports","module","./AdobeDCXError","./AdobeDCXComposite","./AdobeDCXUtil","./AdobeNetworkHTTPService"],function(e){function t(e,t,o,i){if(!o||!_[o.code]){if(i){var n=i.statusCode;n>=500&&600>n&&(501===n?(e=r.NOT_IMPLEMENTED,t="Unimplemented request"):507===n?(e=r.EXCEEDS_QUOTA,t="Quota exceeded"):(e=r.RETRYABLE_SERVER_ERROR,t="Server error"))}o=new r(e,t,o)}return i&&(o.response=i),o}function o(e,o,i){return t(r.NETWORK_ERROR,e,o,i)}function i(e,o,i){return t(r.UNEXPECTED_RESPONSE,e,o,i)}function n(e,t){if(this._service=e,this._server=t,this._endPoint=s.endPointOf(t),!this._endPoint)throw new r(r.INVALID_PARAMS,"Could not determine endpoint from: "+t);this.SYNC_ASYNC_DEFAULT_DELAY=5,this.ASYNC_DEFAULT_DELAY=1,this.DEFAULT_POLL_DELAY=10}var r=e("./AdobeDCXError"),a=e("./AdobeDCXComposite"),s=e("./AdobeDCXUtil"),c=e("./AdobeNetworkHTTPService"),l=s.merge,d=s.appendPathElements,p="If-Match",h="If-None-Match",u="application/vnd.adobe.dcx-manifest+json",_={};return _[r.SERVICE_IS_INACTIVE]=1,_[r.NOT_IMPLEMENTED]=1,_[r.EXCEEDS_QUOTA]=1,_[r.RETRYABLE_SERVER_ERROR]=1,_[r.TIMED_OUT]=1,_[r.TERMINATED_INPUTSTREAM]=1,_[r.WRONG_ENDPOINT]=1,_[r.OUT_OF_SPACE]=1,n.wrapError=t,n.FileContent=c.FileContent,n.StreamProvider=c.StreamProvider,n.prototype.isValidHref=function(e){var t=s.endPointOf(e);return!t||t===this._endPoint},n.prototype.getCollection=function(e,t,n){function a(t,r){if(t)return n(o("Error retrieving a collection",t,r));if(200===r.statusCode){var d=r.responseText||r.response,p=JSON.parse(d);s?s.children=s.children.concat(p.children):s=p;var h=r.headers["x-children-next-start"];if(h){var u=e+"&start="+h;l._service.invoke("GET",u,c,void 0,{responseType:"text"},a)}else n(void 0,s,r.headers.etag,r.headers)}else 304===r.statusCode?n(void 0,null,r.headers.etag,r.headers):n(i("Unexpected status code while getting a collection",void 0,r))}if(e=this._resolveUrl(e),!e)return n(new r(r.WRONG_ENDPOINT,"Wrong endpoint: "+e));e+="?order=asc&orderby=name";var s,c={};t&&(c[h]=t);var l=this,d=this._service.invoke("GET",e,c,void 0,{responseType:"text"},a);return d},n.prototype.getAsset=function(e,t,n,a){function c(e,t){return e?a(o("Error downloading an asset",e,t)):void(200===t.statusCode?a(void 0,t):304===t.statusCode?a(void 0,t):a(i("Unexpected response getting an asset",e,t)))}if(e=this._resolveUrl(e),!e)return a(new r(r.WRONG_ENDPOINT,"Wrong endpoint: "+e));var d,p={};return"string"==typeof t?p[h]=t:l(p,t),d=this._service.invoke("GET",e,p,void 0,{responseType:n},c),d.progress=s.noOp,d},n.prototype.getComponent=function(e,t,o){var i=this.getComponentHref(e,e.version);return this.getAsset(i,void 0,t,o)},n.prototype.getAssetAsType=function(e,t,o,n){function r(e,t){if(e)return n(e);if(200===t.statusCode){var o=t.response||t.responseText;n(void 0,o,t.headers.etag,t)}else 304===t.statusCode?n(void 0,null,t.headers.etag,t):n(i("Unexpected response getting asset",e,t))}return this.getAsset(e,o,t,r)},n.prototype.getSyncGroups=function(e,t){var o=d(this._server,"assets");return this.getCollection(o,e,t)},n.prototype.getSyncGroup=function(e,t,o){var i=d(this._server,"assets",e);return this.getCollection(i,t,o)},n.prototype.getCompositeManifest=function(e,t,o){var i=e.href;return i&&(i=this._resolveUrl(i)),i?(i=d(i,"manifest"),this.getAssetAsType(i,"text",t,o)):o(new r(r.WRONG_ENDPOINT,"Wrong endpoint: "+i))},n.prototype.headRequest=function(e,t){return this._service.invoke("HEAD",e,{},void 0,void 0,function(e,o){return e?t(e):void t(e,o)})},n.prototype.createCompositeDirectory=function(e,t,n){function a(e,t,i){var n={"Content-Type":"application/vnd.adobe.directory+json","X-Update":"content"};t&&(n[p]="*"),c._service.invoke("PUT",l,n,void 0,void 0,function(e,t){return e?i(o("Error Creating composite directory",e,t)):409===t.statusCode?(e=new r(r.ALREADY_EXISTS,e),e.response=t,i(e)):void i(void 0,t)})}var c=this,l=this._resolveUrl(e.href);return l?void a(e,t,function(r,d){if(r)return n(r);var p=d.statusCode;if(200===p||201===p)n(void 0,d);else if(404===p){var h=s.parentDirectory(l);c._service.invoke("PUT",h,{},void 0,void 0,function(r,s){if(r)return n(o("Error creating composite directory",r,s));var c=s.statusCode;200===c||201===c||409===c?a(e,t,function(e,t){if(e)return n(e);var i=t.statusCode;200===i||201===i?n(void 0,t):n(o("Error creating composite directory",e,t))}):n(i("Unexpected response creating composite directory",r,s))})}else n(i("Unexpected response creating composite directory",r,d))}):n(new r(r.WRONG_ENDPOINT,"Wrong endpoint: "+l))},n.prototype.deleteCompositeDirectory=function(e,t){var n=this,a=this._resolveUrl(e.href);if(!a)return t(new r(r.WRONG_ENDPOINT,"Wrong endpoint: "+a));var s={"If-Match":"*"};a+="?recursive=true&invocation_mode=sync,async";var c=this._service.invoke("DELETE",a,s,void 0,void 0,function(e,r){if(e)return t(o("Error deleting composite directory",e,r));var a=r.statusCode;return 200===a||204===a||404===a?t(void 0,r):202===a?n._handle202Response(r,c,n.SYNC_ASYNC_DEFAULT_DELAY,t):void t(i("Unexpected response deleting composite directory",e,r))})},n.prototype.leaveSharedComposite=function(e,t){if(e.collaborationType!==a.COLLABORATION.SHARED_WITH_USER)throw new r(r.INVALID_STATE,"Composite's collaboration type must be sharedWithUser.");return this.deleteCompositeDirectory(e,t)},n.prototype.uploadComponent=function(e,t,o,i,n,a){if(!e._owner||!e._owner.compositeHref)throw new r(r.INVALID_STATE,"Component must be part of a branch of a bound composite.");return this.uploadAssetForComponentId(e.id,e.type,e._owner.compositeHref,t,o,i,n,a)},n.prototype.uploadAssetForComponentId=function(e,t,n,a,s,c,l,d){function h(e,t){e?delete f[p]:f[p]="*";var n=u._service.invoke("PUT",_,f,l,void 0,function(e,n){if(e)return t(o("Error uploading component",e,n));var a=n.statusCode;if(200===a||201===a||204===a){var s;try{s=JSON.parse(n.responseText||n.response)}catch(c){return e=new r(r.INVALID_DATA,"Invalid JSON returned by server",c),e.response=n,t(e,n,s)}t(void 0,n,s)}else 507===a?(e=new r(r.EXCEEDS_QUOTA,"Exceeds quota",e),e.response=n,t(e)):(e=i("Unexpected response uploading component",e),e.response=n,t(e))});return n.token=c,n}var u=this,_=this._constructComponentHref(n,e);s&&(_+="?intermediates=false");var f={};t&&(f["Content-Type"]=t);var m=h(a,function(e,t,o){if(e){if(t=e.response,!t)return d(e);var i=t.statusCode;return void(404===i||409===i||412===i?h(!a,d):d(e))}d(void 0,t,o)});return m},n.prototype.copyAssetToComponentId=function(e,t,n,a,s,c,l,d){function h(e,t,n){e?delete m[p]:m[p]="*";var r=_._service.invoke("PUT",f,m,void 0,{responseType:"text"},function(e,a){if(e)return n(o("Error uploading component",e,a));var s=a.statusCode;200===s||201===s||204===s?n(void 0,a,t):202===s?_._handle202Response(a,r,_.SYNC_ASYNC_DEFAULT_DELAY,function(e,o){n(e,o,t)}):n(i("Unexpected response copying a component asset",e,a),a,t)});return r.token=c,r}var u=this._makeRelativeUrl(l);if(!u)return d(new r(r.WRONG_ENDPOINT,"Cannot copy asset: "+l));var _=this,f=this._constructComponentHref(n,e);f+="?invocation_mode=sync,async",s&&(f+="&intermediates=false");var m={};t&&(m["Content-Type"]=t),m.Link="<"+u+">;rel=source";var y=function(e,t,o){var i;if(e){if(t=e.response,!t)return d(e);var n=t.statusCode;return void(o||404!==n&&409!==n&&412!==n?507===n?(e=new r(r.EXCEEDS_QUOTA,"Exceeds quota",e),e.response=t,d(e)):d(e):h(!a,!0,y))}try{i=JSON.parse(t.responseText||t.response)}catch(s){return e=new r(r.INVALID_DATA,"Invalid JSON returned by server",s),e.response=t,d(e)}d(void 0,t,i)},v=h(a,!0,y);return v},n.prototype.updateManifest=function(e,t,n,a){var s=this.getBranchManifestHref(e),c={"Content-Type":u},l=e.manifestEtag;n?c["If-Match"]="*":l&&(c["If-Match"]=l);var d=this._service.invoke("PUT",s,c,t,void 0,function(e,t){if(e)return a(o("Error updating manifest",e,t));var n=t.statusCode;!t.headers.etag||200!==n&&201!==n&&204!==n?412===n?(e=new r(r.UPDATE_CONFLICT,"Manifest has been changed"),e.response=t,a(e)):a(i("Unexpected response updating manifest",e,t)):a(void 0,t)});return d},n.prototype.getHrefForComposite=function(e,t){var o=e.type;if(!o)throw new r(r.INVALID_STATE,"Composite needs a type");if(!e.id)throw new r(r.INVALID_STATE,"Composite needs an id");if(e.href)return e.href;var i=this._resolveUrl(d("assets",t,e.id));return i},n.prototype.getCompositeManifestHref=function(e){var t=this._resolveUrl(e.href);if(!t)throw new r(r.WRONG_ENDPOINT,"Wrong endpoint: "+t);return d(t,"manifest")},n.prototype.getBranchManifestHref=function(e){var t=this._resolveUrl(e.compositeHref);if(!t)throw new r(r.WRONG_ENDPOINT,"Wrong endpoint: "+t);return d(t,"manifest")},n.prototype.getComponentHref=function(e,t){var o=e._owner;if(!o||!o.compositeHref)throw new r(r.INVALID_STATE,"Component must be part of a branch of a bound composite.");return o._core&&o._core._getSourceHrefOfComponent(e)||this._constructComponentHref(o.compositeHref,e.id,t)},n.prototype._constructComponentHref=function(e,t,o){var i=d(this._resolveUrl(e),t);return i&&"undefined"!=typeof o&&(i+=";version="+o),i},n.prototype._resolveUrl=function(e){var t=s.endPointOf(e);return t?t!==this._endPoint?void 0:e:s.appendPathElements(this._server,e)},n.prototype._makeRelativeUrl=function(e){var t=s.endPointOf(e);if(t){if(t!==this._endPoint)return void 0;var o=s.parseURI(e);(o.scheme||o.authority)&&(e=o.path,o.query&&(e+="?"+o.query),o.fragment&&(e+="#"+o.fragment))}return e},n.prototype._parseAsyncResponse=function(e){var t=e.responseText||e.response;if(!t)throw new r(r.INVALID_DATA,"No body data.");var o={},i=t.indexOf("\n");if(-1===i)throw new r(r.INVALID_DATA,"Could not find status line.");var n=t.slice(0,13===t.charCodeAt(i-1)?i-1:i),a=n.split(" ");if(o.statusCode=parseInt(a[1],10),!o.statusCode)throw new r(r.INVALID_DATA,"Could not find status code.");a.length>2&&(o.statusText=a[2]);var c=t.search(/\r?\n\r?\n/);-1===c&&(c=t.length);var l=t.slice(i+1,c);o.headers=s.parseHeaders(l);var d="\r"===t.charAt(c)?c+2:c+1;return o.response=t.slice(d),o},n.prototype._pollForAsyncResponse=function(e,t,n,r){var a=this,s=Date.now()+1e3*t,c={responseType:"text",reuseRequestDesc:n,noSoonerThen:s};n=this._service.invoke("GET",e,void 0,void 0,c,function(t,s){if(t)return r(o("Error polling for an asynchronous reponse",t,s));var c=s.statusCode;if(202===c){var l=s.headers["retry-after"];l&&(l=parseInt(l,10)),a._pollForAsyncResponse(e,l||a.DEFAULT_POLL_DELAY,n,r)}else if(200===c){try{s=a._parseAsyncResponse(s)}catch(d){return r(i("Error parsing response body.",d,s))}c=s.statusCode,200===c||201===c||204===c?r(void 0,s):r(i("Unexpected response copying a component asset",t,s))}else r(i("Unexpected response polling for an asynchronous response",t,s))})},n.prototype._handle202Response=function(e,t,o,n){var r,a=e.responseText||e.response;try{r=JSON.parse(a)}catch(s){return n(i("Error parsing 202 response body.",s,e))}var c=r.href;if(!c)return n(i("202 response missing an href.",void 0,e));var l=e.headers["retry-after"];l=l?parseInt(l,10):o,this._pollForAsyncResponse(this._resolveUrl(c),l,t,n)},n}),i("components/dcx-js/src/AdobeDCXCompositeXfer",["require","exports","module","./AdobeDCXComposite","./AdobeDCXComponent","./AdobeDCXBranch","./AdobeDCXError","./AdobeDCXPushJournal","./AdobeStorageSession","./AdobeDCXUtil","./AdobeDCXFS"],function(e,t){function o(e,t,o){return _.wrapError(h.UNEXPECTED_RESPONSE,e,t,o)}function i(e,t,o){this._storageSession=e,this._callback=t,this._cleanup=o,this._componentsPending=0,this.bytesTransfered=0,this.bytesTotal=0,this.onProgress=f.noOp;var i=this;this._reportProgress=function(e){if(e>0){i.bytesTransfered+=e;var t=i.onProgress;t&&t(i.bytesTransfered,i.bytesTotal)}}}function n(e,t,i,n,r){function a(e){e||(t.compositeHasBeenCreated=!0);var o,i=t._compositeCreationCallbacks,n=i.length;for(o=0;n>o;o++)try{i[o](e)}catch(r){}t._compositeCreationCallbacks=void 0}e.isBound||t.compositeHasBeenCreated?r():t._compositeCreationCallbacks?t._compositeCreationCallbacks.push(r):(t._compositeCreationCallbacks=[r],n.createCompositeDirectory(e,i,function(t,r){if(t){if(t.code!==h.ALREADY_EXISTS)return a(o("Unexpected response creating a composite directory",t,r));if(i)a();else{var s=n.getCompositeManifestHref(e);n.headRequest(s,function(e,t){return e?a(e):404!==t.statusCode?(e=new h(h.INVALID_STATE,"Composite already exists and overwriteExisting not specified"),a(e)):void a()})}}else a()}))}function r(e,t,o,i,n){if("number"!=typeof t)throw new h(h.UNEXPECTED_RESPONSE,"No length");var r=i.headers.etag,a=i.headers["x-latest-version"],s=n.md5;if(!r)throw new h(h.UNEXPECTED_RESPONSE,"No etag");if(!a)throw new h(h.UNEXPECTED_RESPONSE,"No version");if(!s)throw new h(h.UNEXPECTED_RESPONSE,"No md5");return new d._UploadRecord(e,r,a,s,t,o)}function a(e,t,o,i){var n=i.headers.etag,r=i.headers["x-latest-version"],a=t.md5,s=t.size;if("number"!=typeof s)throw new h(h.UNEXPECTED_RESPONSE,"No length");if(!n)throw new h(h.UNEXPECTED_RESPONSE,"No etag");if(!r)throw new h(h.UNEXPECTED_RESPONSE,"No version");if(!a)throw new h(h.UNEXPECTED_RESPONSE,"No md5");return new d._UploadRecord(e,n,r,a,s,o)}var s,c,l=e("./AdobeDCXComposite"),d=e("./AdobeDCXComponent"),p=e("./AdobeDCXBranch"),h=e("./AdobeDCXError"),u=e("./AdobeDCXPushJournal"),_=e("./AdobeStorageSession"),f=e("./AdobeDCXUtil"),m=e("./AdobeDCXFS"),y=_.FileContent,v=d.STATES,g="all",A="min",E="none";return i.prototype._callCallback=function(e,t){var o=this._callback;o&&(this._callback=void 0,o(e,t))},i.prototype._xferComplete=function(e,t){var o=this._cleanup;o?(this._cleanup=void 0,o(e,t)):this._callCallback(e,t)},i.prototype.abort=function(e){this._aborted||(this._aborted=!0,this._storageSession._service.abortAllWithToken(this)),e||(this._callback=void 0,e=new Error("Aborted")),this._xferComplete(e)},t.pullComposite=function(e,t,o){if(!e.hasLocalStorage)throw new h(h.INVALID_PARAMS,"No local storage. Use AdobeDCXCompositeXfer.pullCompositeManifestOnly() to pull down the composite without local storage.");return this._pullComposite(e,t,g,o)},t.pullMinimumComposite=function(e,t,o){if(!e.hasLocalStorage)throw new h(h.INVALID_PARAMS,"No local storage. Use AdobeDCXCompositeXfer.pullCompositeManifestOnly() to pull down the composite without local storage.");return this._pullComposite(e,t,A,o)},t.pullCompositeManifestOnly=function(e,t,o){return this._pullComposite(e,t,E,o)},t.downloadComponents=function(e,o,n,r){function a(e){return e._owner?a(e._owner):e}var s=a(o),c=new i(n,r);return c._referenceBranch=s,t._pullComponents(c,s,e||o.allComponents()),c},t.pushComposite=function(e,o,n,r){var a,s=e._localStorage,c=function(t,o){if(a._owner&&e.hasLocalStorage&&s.unregisterInMemoryBranchOrElement(a._owner),!e.hasLocalStorage){var i=a._journal;e._pushJournal=i.isEmpty?void 0:i}a._callCallback(t,o)};a=new i(n,r,c),a._composite=e,a._overwriteExisting=o;var l=!e.isBound;if(a._compositeIsNew=l,e.hasLocalStorage)e._loadBranch(s.currentManifestPath(),!1,function(o,i){return o?a._xferComplete(o):(a._owner=i,e._localStorage.registerInMemoryBranchOrElement(i),void u.readJournal(s.pushJournalPath(),e,!0,function(o,i){return o?a._xferComplete(o):(a._journal=i,void t._pushComposite(e,a))}))});else{var d=e.href;if(!d)return a._xferComplete(new h(h.INVALID_STATE,"New composite has no href"));a._owner=e.current.copy(),a._journal=e._pushJournal||new u(e),t._pushComposite(e,a)}return a},t.uploadNewComponent=function(e,t,o,i,n,r){if(o._localStorage)throw new h(h.INVALID_PARAMS,"For in-browser use only. Use composite.current.addComponent() to add a new component asset");return s(i||f.generateUuid(),t,!0,o.collaborationType===l.COLLABORATION.SHARED_WITH_USER,e,o.id,o.href,n,r)},t.uploadComponent=function(e,t,o,i,n){if(o._localStorage)throw new h(h.INVALID_PARAMS,"For in-browser use only. Use composite.current.updateComponent() to update a component asset");return s(e.id,e.type,!1,o.collaborationType===l.COLLABORATION.SHARED_WITH_USER,t,o.id,o.href,i,n)},t.copyAssetForNewComponent=function(e,t,o,i,n,r){if(o._localStorage)throw new h(h.INVALID_PARAMS,"For in-browser use only. Use composite.current.addComponent() to add a new component asset");return c(i||f.generateUuid(),t,!0,o.collaborationType===l.COLLABORATION.SHARED_WITH_USER,e,o.id,o.href,n,r)},t.getURLForComponent=function(e,t){if(e._owner._localStorage)throw new h(h.INVALID_PARAMS,"For in-browser use only.");return t.getComponentHref(e,e.version)},t._pullComposite=function(e,o,n,r){function a(t,o){if(t){var i=t.pulledBranch;return void(i?(i.compositeState=v.unmodified,i.hasLocalStorage?m.writeFileAtomically(e._localStorage.pulledManifestPath(),t.pulledBranch.localData,"utf8",function(){s._callCallback(t)}):s._callCallback(t)):s._callCallback(t))}return null===o?s._callCallback(void 0,null):(o.compositeState=v.unmodified,void(o.hasLocalStorage?m.writeFileAtomically(e._localStorage.pulledManifestPath(),o.localData,"utf8",function(e){return e?s._callCallback(e):(o._isDirty=!1,void s._callCallback(void 0,o))}):(e._options.xhrBaseBranchSupport&&(e._pulledBranchData=o.localData),s._callCallback(void 0,o))))}if("string"!=typeof e.href)throw new h(h.INVALID_STATE,"Composite must have an href");var s,c=function(i,r){if(i)return s._xferComplete(i);var a;r?(a=r.manifestEtag,s._referenceBranch=r):e.current&&(a=e.current.manifestEtag,s._referenceBranch=e.current);var c=o.getCompositeManifest(e,a,function(o,i,a){if(o)return s._xferComplete(o.response&&404===o.response.statusCode?new h(h.NO_COMPOSITE,"Composite missing or deleted",o.underlyingError||o):o);if(null===i&&!r)return s._xferComplete(void 0,null);var c;if(i)try{c=(new p).parse(i),c._localStorage=e._localStorage,c.compositeHref=e.href,c._collaborationType=e.collaborationType,c.manifestEtag=a,(c.compositeState===v.committedDelete||c.compositeState===v.pendingDelete)&&s._storageSession.deleteCompositeDirectory(e,function(e){return s._xferComplete(e?new h(h.DELETED_COMPOSITE,"Error deleting composite directory",e):new h(h.DELETED_COMPOSITE,"Composite is deleted"))}),s._referenceBranch&&c.hasLocalStorage&&c._updateLocalDataFromBranch(s._referenceBranch)}catch(l){return s._xferComplete(new h(h.INVALID_JSON,"Corrupted manifest",l))}else c=r;var d,u,_=c.allComponents();for(d=0;d<_.length;++d)u=_[d],u.state===v.pendingDelete||u.state===v.committedDelete?c.removeComponent(u):u.state=v.unmodified;_=void 0,n===g?_=c.allComponents():n===A&&(u=c.getComponentWithAbsolutePath("/META-INF/metadata.xml"),u&&(_=[u])),_?t._pullComponents(s,c,_):s._xferComplete(void 0,c)});c&&(c.token=s,c.progress=s._reportProgress)};return s=new i(o,r,a),s._composite=e,e.hasLocalStorage?e.loadPulledBranch(c):c(),s},t._pullComponents=function(e,o,i){function n(t,i){if(e._componentsPending-=1,t&&(e.failedComponents=e.failedComponents||[],e.failedComponents.push({component:i,error:t})),0===e._componentsPending&&!e._aborted){var n=e.failedComponents;if(n){t=new h(h.COMPONENT_DOWNLOAD_ERROR,"Failed to download all components");var r,a=n.length;for(r=0;a>r;r++){var s=n[r].error;if(s.code===h.OUT_OF_SPACE){t=new h(s.code,s.message);break}}return t.pulledBranch=o,t.failedComponents=n,e._xferComplete(t)}e._xferComplete(void 0,o)}}function r(o){if(!e._aborted){e.bytesTotal+=o.length||0;var i=o._owner._localStorage,r=i.tempPathForComponent(o),a=f.parentDirectory(r);m.ensureDirectoryExists(a,function(i){if(i)return e.abort(i);var a=t._pullComponent(o,r,c,n);a.progress=e._reportProgress,a.token=e})}}function a(e){o.assetOfComponent(e,function(t,o){"string"!=typeof o?r(e):n(void 0,e)})}if(!o.hasLocalStorage)throw new h(h.INVALID_PARAMS,"No local storage.");var s,c=e._storageSession;for(e._componentsPending=i.length,s=0;s<i.length;++s){var l,d=i[s];if(e._referenceBranch){var p=e._referenceBranch.getComponentWithId(d.id);p&&(l=p.etag)}d.etag!==l?r(d):a(d)}0===e._componentsPending&&e._xferComplete(void 0,o)},t._pullComponent=function(e,t,i,n){var r=e._owner;if(!e._owner.hasLocalStorage)throw new h(h.INVALID_PARAMS,"No local storage. Use AdobeDCXCompositeXfer.pullCompositeManifestOnly() to pull down the composite without local storage.");var a=i.getComponent(e,new y(t),function(i,a){i?n(i,e):200===a.statusCode?void 0!==e.length&&null!==e.length&&Number(a.headers["content-length"])!==e.length?n(new h(h.UNEXPECTED_RESPONSE,"Incorrect content length",i,a)):r._localStorage.ingestComponentAsset(e,t,!1,r._local(),function(t){n(t,e,a.headers.etag)}):304===a.statusCode?n(void 0,e,a.headers.etag):n(o("Unexpected response getting a component",i,a),e)});return a},t._pushComposite=function(e,o){function i(t){if(c)return o._xferComplete(t);var i=p.getCompositeManifestHref(e);p.headRequest(i,function(e,i){return e?o._xferComplete(e):404===i.statusCode?(t=new h(h.NO_COMPOSITE,"Composite does not exist; may have been deleted"),o._xferComplete(t)):o._xferComplete(t)})}var r=e.href;if(!r)return o._xferComplete(new h(h.INVALID_STATE,"New composite has no href"));var a=o._owner,s=o._journal,c=o._compositeIsNew,d=o._overwriteExisting,p=o._storageSession,u=a.changeCount,_=a.remoteData.length+50;return o.bytesTotal=_,a.compositeState===v.committedDelete?o._xferComplete(new h(h.DELETED_COMPOSITE,"Attempt to push a deleted composite")):c||a.compositeState!==v.unmodified?a.compositeState===v.pendingDelete?c&&!d?o._xferComplete(new h(h.DELETED_COMPOSITE,"Attempt to delete unbound composite")):e.collaborationType===l.COLLABORATION.SHARED_WITH_USER?o._xferComplete(new h(h.INVALID_STATE,"Attempt to delete composite that is shared with this user.")):t._deleteComposite(o,d,function(e,t){o._xferComplete(e,t)}):void n(e,s,d,p,function(n){return n?o._xferComplete(n):void t._pushComponents(o,a,function(){var t=o.failedComponents;if(t){n=new h(h.COMPONENT_UPLOAD_ERROR,"One or more components failed to upload.");var r,c=t.length;for(r=0;c>r;r++){var l=t[r].error;if(l.code===h.EXCEEDS_QUOTA){n=new h(l.code,l.message);break}}return n.failedComponents=t,i(n)}a.compositeState=v.unmodified;var f=a.remoteData;o.bytesTotal+=f.length,o.bytesTotal-=_;var y=p.updateManifest(a,f,d,function(t,n){if(t)return i(t);var r=n.headers.etag;s.manifestEtag=r,s.changeCount=u,s.commitChanges(function(t){return t?o._xferComplete(t):(s.applyToBranch(a),a.compositeState=v.unmodified,void(e.hasLocalStorage?m.writeFileAtomically(e._localStorage.pushedManifestPath(),a.localData,"utf8",function(e){return e?o._xferComplete(e):(a._isDirty=!1,void o._xferComplete(void 0,a))}):(e._options.xhrBaseBranchSupport&&(e._pushedBranchData=a.localData),o._xferComplete(void 0,a))))})});y&&(y.progress=o._reportProgress,y.token=o)})}):o._xferComplete()},t._deleteComposite=function(e,t,o){var i=e._composite,n=e._owner,r=e._storageSession;n.compositeState=v.committedDelete;var a=n.remoteData;e.bytesTotal=a.length,r.updateManifest(n,a,t,function(t){return t?o(t):void r.deleteCompositeDirectory(i,function(t){return t?o(t):(e._journal.compositeHasBeenDeleted=!0,void e._journal.commitChanges(function(e){return e?o(e):void(i.hasLocalStorage?m.writeFileAtomically(i._localStorage.pushedManifestPath(),n.localData,"utf8",function(e){return e?o(e):void o(void 0,n)}):o(void 0,n))}))})})},t._pushComponents=function(e,t,o){function i(t,i,n){i?p[t.id]=i:delete p[t.id],n&&(e.failedComponents=e.failedComponents||[],e.failedComponents.push({component:t,error:n})),0===Object.keys(p).length&&u.commitChanges(o)}function n(t,o,n){i(t,"uploading"),m.info(o,function(r,a){if(r)return r=new h(h.INVALID_STATE,"Component asset missing",r),void i(t,null,r);var s=a.size,d=f.filePathComponents(o).fileName,p=u.getRecordForUploadedComponent(t.id);if(p&&p.length===s&&p["storage-name"]===d)return t.etag=p.etag,t.version=p.version,t.md5=p.md5,t.length=p.length,t.state=v.unmodified,void i(t,null);e.bytesTotal+=s;var _=e._storageSession.uploadComponent(t,n,c.collaborationType===l.COLLABORATION.SHARED_WITH_USER,e,new y(o),function(e,o,n){if(!e){var r=o.headers.etag,a=o.headers["x-latest-version"],c=n.md5;r||(e=new h(h.UNEXPECTED_RESPONSE,"No etag")),a||(e=new h(h.UNEXPECTED_RESPONSE,"No version")),c||(e=new h(h.UNEXPECTED_RESPONSE,"No md5")),e||(t.etag=r,t.version=a,t.md5=c,t.length=s,t.state=v.unmodified,u.recordUploadedComponent(t.id,r,a,c,s,d),u.commitChanges())}i(t,null,e)});_&&(_.progress=e._reportProgress,_.token=e)})}function r(o,r,a){var s=u.getRecordForUploadedComponent(o.id);if(s&&s["source-href"]===r)return o.etag=s.etag,o.version=s.version,o.md5=s.md5,o.length=s.length,void(o.state=v.unmodified);i(o,"copying");var p=e._storageSession.copyAssetToComponentId(o.id,o.type,e._composite.href,a,c.collaborationType===l.COLLABORATION.SHARED_WITH_USER,e,r,function(e,s,c){if(e){if(d){var l=d.componentAssetPath(o,t._local());if(l)return n(o,l,a)}}else{var p=s.headers.etag,_=s.headers["x-latest-version"],f=c.md5,m=c.size;p||(e=new h(h.UNEXPECTED_RESPONSE,"No etag")),_||(e=new h(h.UNEXPECTED_RESPONSE,"No version")),f||(e=new h(h.UNEXPECTED_RESPONSE,"No md5")),m||(e=new h(h.UNEXPECTED_RESPONSE,"No length")),e||(o.etag=p,o.version=_,o.md5=f,o.length=m,o.state=v.unmodified,u.recordUploadedComponent(o.id,p,_,f,m,void 0,r),u.commitChanges())}i(o,null,e)});p&&(p.progress=e._reportProgress,p.token=e)}var a,s=t.allComponents(),c=e._composite,d=c._localStorage,p={},u=e._journal;for(a=0;a<s.length;++a){var _=s[a],g=_.state,A=_.etag,E=!A;if(g||(g=v.unmodified),E||g===v.modified){var b=t._core._getSourceHrefOfComponent(_);if(t.hasLocalStorage||b){var C=E||e._compositeIsNew;b?r(_,b,C):n(_,d.componentAssetPath(_,t._local()),C)}else{var L=new h(h.INVALID_STATE,"Component should not be modified or new without local storage");e.failedComponents=e.failedComponents||[],e.failedComponents.push({component:_,error:L})}}else g===v.unmodified?u.removeRecordForUploadedComponent(_.id):(g===v.committedDelete||g===v.pendingDelete)&&t.removeComponent(_)}0===Object.keys(p).length&&o()},s=function(e,t,o,n,a,s,c,l,p){if("function"!=typeof p)throw new h(h.INVALID_PARAMS,'Param "callback" must be a function.');var u=a.length||a.byteLength||a.size,_=new i(l,p);
_.bytesTotal=u;var f=l.uploadAssetForComponentId(e,t,c,o,n,_,a,function(o,i,n){var a;if(!o)try{a=new d._UploadResults(s),u=u||f.bytesSent,a.records[e]=r(e,u,t,i,n)}catch(c){o=c,a=void 0}_._xferComplete(o,a)});return f&&(f.progress=_._reportProgress,f.token=_),_},c=function(e,t,o,n,r,s,c,l,p){if("function"!=typeof p)throw new h(h.INVALID_PARAMS,'Param "callback" must be a function.');var u=new i(l,p),_=l.copyAssetToComponentId(e,t,c,o,n,u,r,function(o,i,n){if(!u._aborted){var r;if(!o)try{r=new d._UploadResults(s),r.records[e]=a(e,n,t,i)}catch(c){o=c,r=void 0}p(o,r)}});return _&&(_.progress=u._reportProgress,_.token=u),u},t}),i("components/dcx-js/src/AdobeDCX",["require","exports","module","./AdobeDCXComposite","./AdobeDCXLocalStorage","./AdobeNetworkHTTPService","./AdobeStorageSession","./AdobeDCXCompositeXfer","./AdobeDCXUtil","./AdobeDCXError","./AdobeDCXFS"],function(e){function t(e,t){e&&c._setFS(e),this._compositeOptions=a.merge({},t)}var o=e("./AdobeDCXComposite"),i=(e("./AdobeDCXLocalStorage"),e("./AdobeNetworkHTTPService")),n=e("./AdobeStorageSession"),r=e("./AdobeDCXCompositeXfer"),a=e("./AdobeDCXUtil"),s=e("./AdobeDCXError"),c=e("./AdobeDCXFS");return t.COLLABORATION={PRIVATE:o.COLLABORATION.PRIVATE,SHARED_BY_USER:o.COLLABORATION.SHARED_BY_USER,SHARED_WITH_USER:o.COLLABORATION.SHARED_WITH_USER},t.AdobeDCXError=s,t.FileContent=i.FileContent,t.StreamProvider=i.StreamProvider,t.prototype.newEmptyComposite=function(e,t,i,n){var r=new o(e,t,null,n,null,this._compositeOptions);return i&&(r.path=i),r},t.prototype.newCompositeFromLocalStorage=function(e,t){try{if("string"!=typeof e)throw new s(s.INVALID_PARAMS,"");var i=new o(null,null,e,null,null,this._compositeOptions);i.loadCurrentFromLocalStorage(function(e){t(e,e?void 0:i)}),i.deleteTempFiles()}catch(n){t(n)}},t.prototype.newCompositeWithHref=function(e,t,i,n,r){var a=new o(i,r,null,n,e,this._compositeOptions);return t&&(a.path=t),a},t.prototype.newCompositeAsCopyOf=function(e,t,i,n,r,a){return o.newCompositeAsCopyOf(e,t,i,n,r,a,this._compositeOptions)},t.prototype.createHTTPService=function(e){return new i(e)},t.prototype.createStorageSession=function(e,t){return new n(e,t)},t.prototype.compositeXfer=r,t}),i("AdobeLibraryServices",["require","exports","module","./components/uuid/uuid","./components/dcx-js/src/AdobeDCX"],function(t){function o(){var t=typeof e;"undefined"!==t&&(this.fs=e("fs"),this.path=e("path")),this._initDCX()}var i=t("./components/uuid/uuid"),n=t("./components/dcx-js/src/AdobeDCX");return o.prototype._initDCX=function(){this.dcx=new n(this.fs,{preserveFileExtensions:!0})},o.prototype.uuid=function(){return i()},o.prototype.log=function(e){this._log&&this._log("CC Libraries: "+e)},o.prototype.getDisplayName=function(e){return this._getDisplayName?this._getDisplayName(e):e.name},o.prototype.hasFileSystem=function(){return void 0!==this.fs},o.prototype.setFileSystem=function(e){this.fs=e,this._initDCX()},o.prototype.getVulcanInterface=function(){var e=typeof VulcanInterface;return"undefined"!==e?VulcanInterface:void 0},o.prototype.getVulcanMessage=function(){var e=typeof VulcanMessage;return"undefined"!==e?VulcanMessage:void 0},o.prototype.hasCEPVulcan=function(){return void 0!==this.getVulcanInterface()&&void 0!==this.getVulcanMessage()},o.prototype.getPathSeparator=function(){return"/"},o.prototype.getFileNameFromPath=function(e){return-1===e.indexOf("/")&&-1!==e.indexOf("\\")&&(e=e.replace(/\\/g,"/")),e.split("/").pop()},new o}),i("AdobeLibraryError",["require","exports","module"],function(){function e(e,t,o,i){Error.call(this),this.code=e,this._message=t,this.message="["+e+"] "+t,this.libraryId=o,this.underlyingError=i}return e.prototype=new Error,e.prototype.name="AdobeLibraryError",delete e.prototype.stack,e.INVALID_PARAMETER="INVALID_PARAMETER",e.READ_ONLY="READ_ONLY",e.NOT_IMPLEMENTED="NOT_IMPLEMENTED",e.NOT_SUPPORTED="NOT_SUPPORTED",e.REQUIRES_FILESYSTEM="REQUIRES_FILESYSTEM",e.DELETED_LOCALLY="DELETED_LOCALLY",e.NOT_ALLOWED="NOT_ALLOWED",e.FILE_TOO_LARGE="FILE_TOO_LARGE",e.EXCEEDS_MAX_LIBRARY_SIZE="EXCEEDS_MAX_LIBRARY_SIZE",e.CORRUPTED_LIBRARY="CORRUPTED_LIBRARY",e.RENDITION_NOT_AVAILABLE="RENDITION_NOT_AVAILABLE",e.FS_ERROR="FS_ERROR",e.OUT_OF_SPACE="OUT_OF_SPACE",e.LOGGED_OUT="LOGGED_OUT",e.EXCEEDS_QUOTA="EXCEEDS_QUOTA",e.RETRYABLE_SERVER_ERROR="RETRYABLE_SERVER_ERROR",e.TRANSFER_ERROR="TRANSFER_ERROR",e.TRANSFER_ABORTED="TRANSFER_ABORTED",e.NETWORK_ERROR="NETWORK_ERROR",e.ACCESS_DENIED="ACCESS_DENIED",e.URL_VALIDATION_FAILED="URL_VALIDATION_FAILED",e}),i("AdobeLibraryConfig",["require","exports","module","./AdobeLibraryError"],function(e){function t(){this.name="config"}var o=e("./AdobeLibraryError"),i=["ROOT_DIR","POLL_INTERVAL","RENDITION_SIZES","FULL_RENDITION_CONFIG","EXTERNAL_LINK_PREFETCH","DEFAULT_LIBRARY_NAME","STORAGE_API_KEY","USER_AGENT_HEADER","SYNC_POLICY","ELEMENT_TYPE_FILTERS","AUTO_START_POLLING","SHARED_LOCAL_STORAGE","SHARED_LOCAL_STORAGE_ANALYTICS","PROXY_AUTH","WHITELISTED_DOMAINS","CLIENT_DESCRIPTION"];return t.prototype.VERSION=1,t.prototype.MAX_ELEMENTS=1e3,t.prototype.MAX_COMPONENT_SIZE=1073741824,t.prototype.VALID_RELATIONS=["rendition","primary","alternate"],t.prototype.VALID_SYNC_POLICIES=["manifestAndAssets","manifestOnly"],t.prototype.ELEMENT_TYPE_FILTERS=[],t.prototype.DL_NAMESPACE="library",t.prototype.DL_PREFIX=t.prototype.DL_NAMESPACE+"#",t.prototype.VERSION_KEY=t.prototype.DL_PREFIX+"version",t.prototype.CATEGORY_KEY=t.prototype.DL_PREFIX+"category",t.prototype.RELATIONSHIP_KEY=t.prototype.DL_PREFIX+"rel",t.prototype.WIDTH_KEY=t.prototype.DL_PREFIX+"width",t.prototype.HEIGHT_KEY=t.prototype.DL_PREFIX+"height",t.prototype.LENGTH_KEY=t.prototype.DL_PREFIX+"length",t.prototype.IS_FULL_SIZE_KEY=t.prototype.DL_PREFIX+"isFullSize",t.prototype.MODIFIED_KEY=t.prototype.DL_PREFIX+"modified",t.prototype.CREATED_KEY=t.prototype.DL_PREFIX+"created",t.prototype.LINK_TYPE_KEY=t.prototype.DL_PREFIX+"linktype",t.prototype.LINK_URL_KEY=t.prototype.DL_PREFIX+"linkurl",t.prototype.REPRESENTATION_ORDER_KEY=t.prototype.DL_PREFIX+"representationOrder",t.prototype.COMPOSITE_TYPE="application/vnd.adobe.library+dcx",t.prototype.LINK_REPRESENTATION_TYPE="application/vnd.adobe.library.link+dcx",t.prototype.ELEMENTS_NAME="elements",t.prototype.CATEGORIES_NAME="categories",t.prototype.ANALYTICS_ELEMENT_UPDATE_THRESHOLD=500,t.prototype.PUBLIC_USER_ID="public",t.prototype.DEFAULT_CLOUD_ID="creative_cloud",t.prototype.STORAGE_ASSETS_PATH="/assets/",t.prototype.LIBRARY_SYNC_GROUP="adobe-libraries",t.prototype.PUBLIC_STORAGE_ASSETS_PATH="/public/",t.prototype.PUBLIC_LIBRARY_SYNC_GROUP="libraries",t.prototype.STORAGE_API_KEY="",t.prototype.USER_AGENT_HEADER=void 0,t.prototype.SYNCING_ENABLED=!0,t.prototype.DEFAULT_MAX_SYNC_INTERVAL=1e4,t.prototype.RETRY_FAIL_MAX_SYNC_INTERVAL=6e4,t.prototype.MAX_SYNC_INTERVAL=t.prototype.DEFAULT_MAX_SYNC_INTERVAL,t.prototype.POLL_INTERVAL=1,t.prototype.AUTO_START_POLLING=!1,t.prototype.RENDITION_SIZES={},t.prototype.FULL_RENDITION_CONFIG={},t.prototype.BACKOFF_INTERVALS=[1,1,2,3,5,8,13,21,34,55],t.prototype.ERROR_RETRY_INTERVALS=[30,60,120],t.prototype.NETWORK_TIMEOUT=6e5,t.prototype.RETRY_RANDOM_SECONDS=30,t.prototype.RENDITION_MAX_RETRIES=2,t.prototype.DEFAULT_RENDITION_RETRY_INTERVAL=1e3,t.prototype.RENDITION_RETRY_INTERVAL=t.prototype.DEFAULT_RENDITION_RETRY_INTERVAL,t.prototype.DEFAULT_RENDITION_404_BACKOFF=3e5,t.prototype.RENDITION_404_BACKOFF=t.prototype.DEFAULT_RENDITION_404_BACKOFF,t.prototype.LOCAL_RENDITION_MAX_RETRIES=5,t.prototype.LOCAL_RENDITION_RETRY_INTERVAL=200,t.prototype.MAX_UPDATE_CONFLICTS=5,t.prototype.WHITELISTED_DOMAINS=[],t.prototype.ADOBE_AUTHENTICATED_DOMAINS=["adobe.com","adobe.io","fotolia.net"],t.prototype.SYNC_POLICY="manifestAndAssets",t.prototype.RENDITION_CACHE_FILE="cache.json",t.prototype.RENDITION_CACHE_PLACEHOLDER="<placeholder>",t.prototype.SHARED_LOCAL_STORAGE=!0,t.prototype.SHARED_LOCAL_STORAGE_VERSION=7,t.prototype.SHARED_LOCAL_STORAGE_MIN_CLIENT_VERSION=5,t.prototype.SHARED_LOCAL_STORAGE_MAX_CLIENT_VERSION=7,t.prototype.VULCAN_PREFIX="vulcan.SuiteMessage.",t.prototype.VULCAN_STARTUP_MESSAGE="cclibraries.service.Initialized",t.prototype.VULCAN_SHUTDOWN_REQUEST="cclibraries.service.TerminateServiceRequest",t.prototype.VULCAN_QUERY_REQUEST="cclibraries.service.QueryRequest",t.prototype.VULCAN_QUERY_RESPONSE="cclibraries.service.QueryResponse",t.prototype.VULCAN_LIBRARY_CHANGED_LOCAL_TYPE="cclibraries.service.LibraryChangedLocal",t.prototype.VULCAN_LIBRARY_CHANGED_REMOTE_TYPE="cclibraries.service.LibraryChangedRemote",t.prototype.VULCAN_LIBRARY_DELETED_TYPE="cclibraries.service.LibraryDeleted",t.prototype.VULCAN_COLLECTIONS_LOADED_TYPE="cclibraries.service.LibrariesLoaded",t.prototype.VULCAN_COLLECTIONS_UNLOADED_TYPE="cclibraries.service.LibrariesUnloaded",t.prototype.setParameter=function(e,t){if(-1===i.indexOf(e))throw new o(o.INVALID_PARAMETER,"Parameter not configurable");if("SYNC_POLICY"===e&&-1===this.VALID_SYNC_POLICIES.indexOf(t))throw new o(o.INVALID_PARAMETER,"Invalid value for SYNC_POLICY");"POLL_INTERVAL"===e&&(t=Math.max(1,t)),this[e]=t},new t}),i("utils/AdobeLibraryMimeTypeUtils",["require","exports","module"],function(){function e(e){var t=e.match(/application\/x-adobe-libraries-(.+)/);return t?[t[1]]:[]}function t(e){return["application/x-adobe-libraries-"+e]}var o={},i={"application/andrew-inset":["ez"],"application/applixware":["aw"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomsvc+xml":["atomsvc"],"application/ccxml+xml":["ccxml"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cu-seeme":["cu"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/font-tdpfr":["pfr"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/hyperstudio":["stk"],"application/illustrator":["ai"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/java-archive":["jar"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["js"],"application/json":["json"],"application/jsonml+json":["jsonml"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4s"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-signature":["asc","sig"],"application/photoshop":["psd"],"application/photoshop.large":["psb"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/prs.cww":["cww"],"application/pskc+xml":["pskcxml"],"application/rdf+xml":["rdf"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/vnd.3gpp.pic-bw-large":["plb"],"application/vnd.3gpp.pic-bw-small":["psb"],"application/vnd.3gpp.pic-bw-var":["pvb"],"application/vnd.3gpp2.tcap":["tcap"],"application/vnd.3m.post-it-notes":["pwn"],"application/vnd.accpac.simply.aso":["aso"],"application/vnd.accpac.simply.imp":["imp"],"application/vnd.acucobol":["acu"],"application/vnd.acucorp":["atc","acutc"],"application/vnd.adobe.air-application-installer-package+zip":["air"],"application/vnd.adobe.characterstyle+json":["style"],"application/vnd.adobe.characterstyle+snippet":["idms"],"application/vnd.adobe.charts+zip":["zip"],"application/vnd.adobe.color+json":["ase"],"application/vnd.adobe.colortheme+json":["ase"],"application/vnd.adobe.cube+txt":["cube"],"application/vnd.adobe.formscentral.fcdt":["fcdt"],"application/vnd.adobe.fxp":["fxp","fxpl"],"application/vnd.adobe.indesign-idms":["idms"],"application/vnd.adobe.layerstyle":["asl"],"application/vnd.adobe.look+xml":["look"],"application/vnd.adobe.muse-collection":["muse"],"application/vnd.adobe.paragraphstyle+json":["style"],"application/vnd.adobe.paragraphstyle+snippet":["idms"],"application/vnd.adobe.ribbon.brush+zip":["brush"],"application/vnd.adobe.scatter.brush+zip":["brush"],"application/vnd.adobe.vector.brush+zip":["brush"],"application/vnd.adobe.xdp+xml":["xdp"],"application/vnd.adobe.xfdf":["xfdf"],"application/vnd.ahead.space":["ahead"],"application/vnd.airzip.filesecure.azf":["azf"],"application/vnd.airzip.filesecure.azs":["azs"],"application/vnd.amazon.ebook":["azw"],"application/vnd.americandynamics.acc":["acc"],"application/vnd.amiga.ami":["ami"],"application/vnd.android.package-archive":["apk"],"application/vnd.anser-web-certificate-issue-initiation":["cii"],"application/vnd.anser-web-funds-transfer-initiation":["fti"],"application/vnd.antix.game-component":["atx"],"application/vnd.apple.installer+xml":["mpkg"],"application/vnd.apple.mpegurl":["m3u8"],"application/vnd.aristanetworks.swi":["swi"],"application/vnd.astraea-software.iota":["iota"],"application/vnd.audiograph":["aep"],"application/vnd.blueice.multipass":["mpm"],"application/vnd.bmi":["bmi"],"application/vnd.businessobjects":["rep"],"application/vnd.chemdraw+xml":["cdxml"],"application/vnd.chipnuts.karaoke-mmd":["mmd"],"application/vnd.cinderella":["cdy"],"application/vnd.claymore":["cla"],"application/vnd.cloanto.rp9":["rp9"],"application/vnd.clonk.c4group":["c4g","c4d","c4f","c4p","c4u"],"application/vnd.cluetrust.cartomobile-config":["c11amc"],"application/vnd.cluetrust.cartomobile-config-pkg":["c11amz"],"application/vnd.commonspace":["csp"],"application/vnd.contact.cmsg":["cdbcmsg"],"application/vnd.cosmocaller":["cmc"],"application/vnd.crick.clicker":["clkx"],"application/vnd.crick.clicker.keyboard":["clkk"],"application/vnd.crick.clicker.palette":["clkp"],"application/vnd.crick.clicker.template":["clkt"],"application/vnd.crick.clicker.wordbank":["clkw"],"application/vnd.criticaltools.wbs+xml":["wbs"],"application/vnd.ctc-posml":["pml"],"application/vnd.cups-ppd":["ppd"],"application/vnd.curl.car":["car"],"application/vnd.curl.pcurl":["pcurl"],"application/vnd.dart":["dart"],"application/vnd.data-vision.rdz":["rdz"],"application/vnd.dece.data":["uvf","uvvf","uvd","uvvd"],"application/vnd.dece.ttml+xml":["uvt","uvvt"],"application/vnd.dece.unspecified":["uvx","uvvx"],"application/vnd.dece.zip":["uvz","uvvz"],"application/vnd.denovo.fcselayout-link":["fe_launch"],"application/vnd.dna":["dna"],"application/vnd.dolby.mlp":["mlp"],"application/vnd.dpgraph":["dpg"],"application/vnd.dreamfactory":["dfac"],"application/vnd.ds-keypoint":["kpxx"],"application/vnd.dvb.ait":["ait"],"application/vnd.dvb.service":["svc"],"application/vnd.dynageo":["geo"],"application/vnd.ecowin.chart":["mag"],"application/vnd.enliven":["nml"],"application/vnd.epson.esf":["esf"],"application/vnd.epson.msf":["msf"],"application/vnd.epson.quickanime":["qam"],"application/vnd.epson.salt":["slt"],"application/vnd.epson.ssf":["ssf"],"application/vnd.eszigno3+xml":["es3","et3"],"application/vnd.ezpix-album":["ez2"],"application/vnd.ezpix-package":["ez3"],"application/vnd.fdf":["fdf"],"application/vnd.fdsn.mseed":["mseed"],"application/vnd.fdsn.seed":["seed","dataless"],"application/vnd.flographit":["gph"],"application/vnd.fluxtime.clip":["ftc"],"application/vnd.framemaker":["fm","frame","maker","book"],"application/vnd.frogans.fnc":["fnc"],"application/vnd.frogans.ltf":["ltf"],"application/vnd.fsc.weblaunch":["fsc"],"application/vnd.fujitsu.oasys":["oas"],"application/vnd.fujitsu.oasys2":["oa2"],"application/vnd.fujitsu.oasys3":["oa3"],"application/vnd.fujitsu.oasysgp":["fg5"],"application/vnd.fujitsu.oasysprs":["bh2"],"application/vnd.fujixerox.ddd":["ddd"],"application/vnd.fujixerox.docuworks":["xdw"],"application/vnd.fujixerox.docuworks.binder":["xbd"],"application/vnd.fuzzysheet":["fzs"],"application/vnd.genomatix.tuxedo":["txd"],"application/vnd.geogebra.file":["ggb"],"application/vnd.geogebra.tool":["ggt"],"application/vnd.geometry-explorer":["gex","gre"],"application/vnd.geonext":["gxt"],"application/vnd.geoplan":["g2w"],"application/vnd.geospace":["g3w"],"application/vnd.gmx":["gmx"],"application/vnd.google-earth.kml+xml":["kml"],"application/vnd.google-earth.kmz":["kmz"],"application/vnd.grafeq":["gqf","gqs"],"application/vnd.groove-account":["gac"],"application/vnd.groove-help":["ghf"],"application/vnd.groove-identity-message":["gim"],"application/vnd.groove-injector":["grv"],"application/vnd.groove-tool-message":["gtm"],"application/vnd.groove-tool-template":["tpl"],"application/vnd.groove-vcard":["vcg"],"application/vnd.hal+xml":["hal"],"application/vnd.handheld-entertainment+xml":["zmm"],"application/vnd.hbci":["hbci"],"application/vnd.hhe.lesson-player":["les"],"application/vnd.hp-hpgl":["hpgl"],"application/vnd.hp-hpid":["hpid"],"application/vnd.hp-hps":["hps"],"application/vnd.hp-jlyt":["jlt"],"application/vnd.hp-pcl":["pcl"],"application/vnd.hp-pclxl":["pclxl"],"application/vnd.ibm.minipay":["mpy"],"application/vnd.ibm.modcap":["afp","listafp","list3820"],"application/vnd.ibm.rights-management":["irm"],"application/vnd.ibm.secure-container":["sc"],"application/vnd.iccprofile":["icc","icm"],"application/vnd.igloader":["igl"],"application/vnd.immervision-ivp":["ivp"],"application/vnd.immervision-ivu":["ivu"],"application/vnd.insors.igm":["igm"],"application/vnd.intercon.formnet":["xpw","xpx"],"application/vnd.intergeo":["i2g"],"application/vnd.intu.qbo":["qbo"],"application/vnd.intu.qfx":["qfx"],"application/vnd.ipunplugged.rcprofile":["rcprofile"],"application/vnd.irepository.package+xml":["irp"],"application/vnd.is-xpr":["xpr"],"application/vnd.isac.fcs":["fcs"],"application/vnd.jam":["jam"],"application/vnd.jcp.javame.midlet-rms":["rms"],"application/vnd.jisp":["jisp"],"application/vnd.joost.joda-archive":["joda"],"application/vnd.kahootz":["ktz","ktr"],"application/vnd.kde.karbon":["karbon"],"application/vnd.kde.kchart":["chrt"],"application/vnd.kde.kformula":["kfo"],"application/vnd.kde.kivio":["flw"],"application/vnd.kde.kontour":["kon"],"application/vnd.kde.kpresenter":["kpr","kpt"],"application/vnd.kde.kspread":["ksp"],"application/vnd.kde.kword":["kwd","kwt"],"application/vnd.kenameaapp":["htke"],"application/vnd.kidspiration":["kia"],"application/vnd.kinar":["kne","knp"],"application/vnd.koan":["skp","skd","skt","skm"],"application/vnd.kodak-descriptor":["sse"],"application/vnd.las.las+xml":["lasxml"],"application/vnd.llamagraphics.life-balance.desktop":["lbd"],"application/vnd.llamagraphics.life-balance.exchange+xml":["lbe"],"application/vnd.lotus-1-2-3":["123"],"application/vnd.lotus-approach":["apr"],"application/vnd.lotus-freelance":["pre"],"application/vnd.lotus-notes":["nsf"],"application/vnd.lotus-organizer":["org"],"application/vnd.lotus-screencam":["scm"],"application/vnd.lotus-wordpro":["lwp"],"application/vnd.macports.portpkg":["portpkg"],"application/vnd.mcd":["mcd"],"application/vnd.medcalcdata":["mc1"],"application/vnd.mediastation.cdkey":["cdkey"],"application/vnd.mfer":["mwf"],"application/vnd.mfmp":["mfm"],"application/vnd.micrografx.flo":["flo"],"application/vnd.micrografx.igx":["igx"],"application/vnd.mif":["mif"],"application/vnd.mobius.daf":["daf"],"application/vnd.mobius.dis":["dis"],"application/vnd.mobius.mbk":["mbk"],"application/vnd.mobius.mqy":["mqy"],"application/vnd.mobius.msl":["msl"],"application/vnd.mobius.plc":["plc"],"application/vnd.mobius.txf":["txf"],"application/vnd.mophun.application":["mpn"],"application/vnd.mophun.certificate":["mpc"],"application/vnd.mozilla.xul+xml":["xul"],"application/vnd.ms-artgalry":["cil"],"application/vnd.ms-cab-compressed":["cab"],"application/vnd.ms-excel":["xls","xlm","xla","xlc","xlt","xlw"],"application/vnd.ms-excel.addin.macroenabled.12":["xlam"],"application/vnd.ms-excel.sheet.binary.macroenabled.12":["xlsb"],"application/vnd.ms-excel.sheet.macroenabled.12":["xlsm"],"application/vnd.ms-excel.template.macroenabled.12":["xltm"],"application/vnd.ms-fontobject":["eot"],"application/vnd.ms-htmlhelp":["chm"],"application/vnd.ms-ims":["ims"],"application/vnd.ms-lrm":["lrm"],"application/vnd.ms-officetheme":["thmx"],"application/vnd.ms-pki.seccat":["cat"],"application/vnd.ms-pki.stl":["stl"],"application/vnd.ms-powerpoint":["ppt","pps","pot"],"application/vnd.ms-powerpoint.addin.macroenabled.12":["ppam"],"application/vnd.ms-powerpoint.presentation.macroenabled.12":["pptm"],"application/vnd.ms-powerpoint.slide.macroenabled.12":["sldm"],"application/vnd.ms-powerpoint.slideshow.macroenabled.12":["ppsm"],"application/vnd.ms-powerpoint.template.macroenabled.12":["potm"],"application/vnd.ms-project":["mpp","mpt"],"application/vnd.ms-word.document.macroenabled.12":["docm"],"application/vnd.ms-word.template.macroenabled.12":["dotm"],"application/vnd.ms-works":["wps","wks","wcm","wdb"],"application/vnd.ms-wpl":["wpl"],"application/vnd.ms-xpsdocument":["xps"],"application/vnd.mseq":["mseq"],"application/vnd.musician":["mus"],"application/vnd.muvee.style":["msty"],"application/vnd.mynfc":["taglet"],"application/vnd.neurolanguage.nlu":["nlu"],"application/vnd.nitf":["ntf","nitf"],"application/vnd.noblenet-directory":["nnd"],"application/vnd.noblenet-sealer":["nns"],"application/vnd.noblenet-web":["nnw"],"application/vnd.nokia.n-gage.data":["ngdat"],"application/vnd.nokia.radio-preset":["rpst"],"application/vnd.nokia.radio-presets":["rpss"],"application/vnd.novadigm.edm":["edm"],"application/vnd.novadigm.edx":["edx"],"application/vnd.novadigm.ext":["ext"],"application/vnd.oasis.opendocument.chart":["odc"],"application/vnd.oasis.opendocument.chart-template":["otc"],"application/vnd.oasis.opendocument.database":["odb"],"application/vnd.oasis.opendocument.formula":["odf"],"application/vnd.oasis.opendocument.formula-template":["odft"],"application/vnd.oasis.opendocument.graphics":["odg"],"application/vnd.oasis.opendocument.graphics-template":["otg"],"application/vnd.oasis.opendocument.image":["odi"],"application/vnd.oasis.opendocument.image-template":["oti"],"application/vnd.oasis.opendocument.presentation":["odp"],"application/vnd.oasis.opendocument.presentation-template":["otp"],"application/vnd.oasis.opendocument.spreadsheet":["ods"],"application/vnd.oasis.opendocument.spreadsheet-template":["ots"],"application/vnd.oasis.opendocument.text":["odt"],"application/vnd.oasis.opendocument.text-master":["odm"],"application/vnd.oasis.opendocument.text-template":["ott"],"application/vnd.oasis.opendocument.text-web":["oth"],"application/vnd.olpc-sugar":["xo"],"application/vnd.oma.dd2+xml":["dd2"],"application/vnd.openofficeorg.extension":["oxt"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":["pptx"],"application/vnd.openxmlformats-officedocument.presentationml.slide":["sldx"],"application/vnd.openxmlformats-officedocument.presentationml.slideshow":["ppsx"],"application/vnd.openxmlformats-officedocument.presentationml.template":["potx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":["xlsx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.template":["xltx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":["docx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.template":["dotx"],"application/vnd.osgeo.mapguide.package":["mgp"],"application/vnd.osgi.dp":["dp"],"application/vnd.osgi.subsystem":["esa"],"application/vnd.palm":["pdb","pqa","oprc"],"application/vnd.pawaafile":["paw"],"application/vnd.pg.format":["str"],"application/vnd.pg.osasli":["ei6"],"application/vnd.picsel":["efif"],"application/vnd.pmi.widget":["wg"],"application/vnd.pocketlearn":["plf"],"application/vnd.powerbuilder6":["pbd"],"application/vnd.previewsystems.box":["box"],"application/vnd.proteus.magazine":["mgz"],"application/vnd.publishare-delta-tree":["qps"],"application/vnd.pvi.ptid1":["ptid"],"application/vnd.quark.quarkxpress":["qxd","qxt","qwd","qwt","qxl","qxb"],"application/vnd.realvnc.bed":["bed"],"application/vnd.recordare.musicxml":["mxl"],"application/vnd.recordare.musicxml+xml":["musicxml"],"application/vnd.rig.cryptonote":["cryptonote"],"application/vnd.rim.cod":["cod"],"application/vnd.rn-realmedia":["rm"],"application/vnd.rn-realmedia-vbr":["rmvb"],"application/vnd.route66.link66+xml":["link66"],"application/vnd.sailingtracker.track":["st"],"application/vnd.seemail":["see"],"application/vnd.sema":["sema"],"application/vnd.semd":["semd"],"application/vnd.semf":["semf"],"application/vnd.shana.informed.formdata":["ifm"],"application/vnd.shana.informed.formtemplate":["itp"],"application/vnd.shana.informed.interchange":["iif"],"application/vnd.shana.informed.package":["ipk"],"application/vnd.simtech-mindmapper":["twd","twds"],"application/vnd.smaf":["mmf"],"application/vnd.smart.teacher":["teacher"],"application/vnd.solent.sdkm+xml":["sdkm","sdkd"],"application/vnd.spotfire.dxp":["dxp"],"application/vnd.spotfire.sfs":["sfs"],"application/vnd.stardivision.calc":["sdc"],"application/vnd.stardivision.draw":["sda"],"application/vnd.stardivision.impress":["sdd"],"application/vnd.stardivision.math":["smf"],"application/vnd.stardivision.writer":["sdw","vor"],"application/vnd.stardivision.writer-global":["sgl"],"application/vnd.stepmania.package":["smzip"],"application/vnd.stepmania.stepchart":["sm"],"application/vnd.sun.xml.calc":["sxc"],"application/vnd.sun.xml.calc.template":["stc"],"application/vnd.sun.xml.draw":["sxd"],"application/vnd.sun.xml.draw.template":["std"],"application/vnd.sun.xml.impress":["sxi"],"application/vnd.sun.xml.impress.template":["sti"],"application/vnd.sun.xml.math":["sxm"],"application/vnd.sun.xml.writer":["sxw"],"application/vnd.sun.xml.writer.global":["sxg"],"application/vnd.sun.xml.writer.template":["stw"],"application/vnd.sus-calendar":["sus","susp"],"application/vnd.svd":["svd"],"application/vnd.symbian.install":["sis","sisx"],"application/vnd.syncml+xml":["xsm"],"application/vnd.syncml.dm+wbxml":["bdm"],"application/vnd.syncml.dm+xml":["xdm"],"application/vnd.tao.intent-module-archive":["tao"],"application/vnd.tcpdump.pcap":["pcap","cap","dmp"],"application/vnd.tmobile-livetv":["tmo"],"application/vnd.trid.tpt":["tpt"],"application/vnd.triscape.mxs":["mxs"],"application/vnd.trueapp":["tra"],"application/vnd.ufdl":["ufd","ufdl"],"application/vnd.uiq.theme":["utz"],"application/vnd.umajin":["umj"],"application/vnd.unity":["unityweb"],"application/vnd.uoml+xml":["uoml"],"application/vnd.vcx":["vcx"],"application/vnd.visio":["vsd","vst","vss","vsw"],"application/vnd.visionary":["vis"],"application/vnd.vsf":["vsf"],"application/vnd.wap.wbxml":["wbxml"],"application/vnd.wap.wmlc":["wmlc"],"application/vnd.wap.wmlscriptc":["wmlsc"],"application/vnd.webturbo":["wtb"],"application/vnd.wolfram.player":["nbp"],"application/vnd.wordperfect":["wpd"],"application/vnd.wqd":["wqd"],"application/vnd.wt.stf":["stf"],"application/vnd.xara":["xar"],"application/vnd.xfdl":["xfdl"],"application/vnd.yamaha.hv-dic":["hvd"],"application/vnd.yamaha.hv-script":["hvs"],"application/vnd.yamaha.hv-voice":["hvp"],"application/vnd.yamaha.openscoreformat":["osf"],"application/vnd.yamaha.openscoreformat.osfpvg+xml":["osfpvg"],"application/vnd.yamaha.smaf-audio":["saf"],"application/vnd.yamaha.smaf-phrase":["spf"],"application/vnd.yellowriver-custom-menu":["cmp"],"application/vnd.zul":["zir","zirz"],"application/vnd.zzazz.deck+xml":["zaz"],"application/voicexml+xml":["vxml"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/x-7z-compressed":["7z"],"application/x-abiword":["abw"],"application/x-ace-compressed":["ace"],"application/x-apple-diskimage":["dmg"],"application/x-authorware-bin":["aab","x32","u32","vox"],"application/x-authorware-map":["aam"],"application/x-authorware-seg":["aas"],"application/x-bcpio":["bcpio"],"application/x-bittorrent":["torrent"],"application/x-blorb":["blb","blorb"],"application/x-bzip":["bz"],"application/x-bzip2":["bz2","boz"],"application/x-cbr":["cbr","cba","cbt","cbz","cb7"],"application/x-cdlink":["vcd"],"application/x-cfs-compressed":["cfs"],"application/x-chat":["chat"],"application/x-chess-pgn":["pgn"],"application/x-conference":["nsc"],"application/x-cpio":["cpio"],"application/x-csh":["csh"],"application/x-debian-package":["deb","udeb"],"application/x-dgc-compressed":["dgc"],"application/x-director":["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"],"application/x-doom":["wad"],"application/x-dtbncx+xml":["ncx"],"application/x-dtbook+xml":["dtb"],"application/x-dtbresource+xml":["res"],"application/x-dvi":["dvi"],"application/x-envoy":["evy"],"application/x-eva":["eva"],"application/x-font-bdf":["bdf"],"application/x-font-ghostscript":["gsf"],"application/x-font-linux-psf":["psf"],"application/x-font-otf":["otf"],"application/x-font-pcf":["pcf"],"application/x-font-snf":["snf"],"application/x-font-ttf":["ttf","ttc"],"application/x-font-type1":["pfa","pfb","pfm","afm"],"application/font-woff":["woff"],"application/x-freearc":["arc"],"application/x-futuresplash":["spl"],"application/x-gca-compressed":["gca"],"application/x-glulx":["ulx"],"application/x-gnumeric":["gnumeric"],"application/x-gramps-xml":["gramps"],"application/x-gtar":["gtar"],"application/x-hdf":["hdf"],"application/x-install-instructions":["install"],"application/x-iso9660-image":["iso"],"application/x-java-jnlp-file":["jnlp"],"application/x-latex":["latex"],"application/x-lzh-compressed":["lzh","lha"],"application/x-mie":["mie"],"application/x-mobipocket-ebook":["prc","mobi"],"application/x-ms-application":["application"],"application/x-ms-shortcut":["lnk"],"application/x-ms-wmd":["wmd"],"application/x-ms-wmz":["wmz"],"application/x-ms-xbap":["xbap"],"application/x-msaccess":["mdb"],"application/x-msbinder":["obd"],"application/x-mscardfile":["crd"],"application/x-msclip":["clp"],"application/x-msdownload":["exe","dll","com","bat","msi"],"application/x-msmediaview":["mvb","m13","m14"],"application/x-msmetafile":["wmf","wmz","emf","emz"],"application/x-msmoney":["mny"],"application/x-mspublisher":["pub"],"application/x-msschedule":["scd"],"application/x-msterminal":["trm"],"application/x-mswrite":["wri"],"application/x-netcdf":["nc","cdf"],"application/x-nzb":["nzb"],"application/x-pkcs12":["p12","pfx"],"application/x-pkcs7-certificates":["p7b","spc"],"application/x-pkcs7-certreqresp":["p7r"],"application/x-rar-compressed":["rar"],"application/x-research-info-systems":["ris"],"application/x-sh":["sh"],"application/x-shar":["shar"],"application/x-shockwave-flash":["swf"],"application/x-silverlight-app":["xap"],"application/x-sql":["sql"],"application/x-stuffit":["sit"],"application/x-stuffitx":["sitx"],"application/x-subrip":["srt"],"application/x-sv4cpio":["sv4cpio"],"application/x-sv4crc":["sv4crc"],"application/x-t3vm-image":["t3"],"application/x-tads":["gam"],"application/x-tar":["tar"],"application/x-tcl":["tcl"],"application/x-tex":["tex"],"application/x-tex-tfm":["tfm"],"application/x-texinfo":["texinfo","texi"],"application/x-tgif":["obj"],"application/x-ustar":["ustar"],"application/x-wais-source":["src"],"application/x-x509-ca-cert":["der","crt"],"application/x-xfig":["fig"],"application/x-xliff+xml":["xlf"],"application/x-xpinstall":["xpi"],"application/x-xz":["xz"],"application/x-zmachine":["z1","z2","z3","z4","z5","z6","z7","z8"],"application/xaml+xml":["xaml"],"application/xcap-diff+xml":["xdf"],"application/xenc+xml":["xenc"],"application/xhtml+xml":["xhtml","xht"],"application/xml":["xml","xsl"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/adpcm":["adp"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mp4":["mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/vnd.dece.audio":["uva","uvva"],"audio/vnd.digital-winds":["eol"],"audio/vnd.dra":["dra"],"audio/vnd.dts":["dts"],"audio/vnd.dts.hd":["dtshd"],"audio/vnd.lucent.voice":["lvp"],"audio/vnd.ms-playready.media.pya":["pya"],"audio/vnd.nuera.ecelp4800":["ecelp4800"],"audio/vnd.nuera.ecelp7470":["ecelp7470"],"audio/vnd.nuera.ecelp9600":["ecelp9600"],"audio/vnd.rip":["rip"],"audio/webm":["weba"],"audio/x-aac":["aac"],"audio/x-aiff":["aif","aiff","aifc"],"audio/x-caf":["caf"],"audio/x-flac":["flac"],"audio/x-matroska":["mka"],"audio/x-mpegurl":["m3u"],"audio/x-ms-wax":["wax"],"audio/x-ms-wma":["wma"],"audio/x-pn-realaudio":["ram","ra"],"audio/x-pn-realaudio-plugin":["rmp"],"audio/x-wav":["wav"],"audio/xm":["xm"],"chemical/x-cdx":["cdx"],"chemical/x-cif":["cif"],"chemical/x-cmdf":["cmdf"],"chemical/x-cml":["cml"],"chemical/x-csml":["csml"],"chemical/x-xyz":["xyz"],"image/bmp":["bmp"],"image/cgm":["cgm"],"image/g3fax":["g3"],"image/gif":["gif"],"image/ief":["ief"],"image/jpeg":["jpeg","jpg","jpe"],"image/jpg":["jpg"],"image/ktx":["ktx"],"image/png":["png"],"image/prs.btif":["btif"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/tiff":["tiff","tif"],"image/vnd.adobe.photoshop":["psd"],"image/vnd.adobe.shape+svg":["shape"],"image/vnd.dece.graphic":["uvi","uvvi","uvg","uvvg"],"image/vnd.dvb.subtitle":["sub"],"image/vnd.djvu":["djvu","djv"],"image/vnd.dwg":["dwg"],"image/vnd.dxf":["dxf"],"image/vnd.fastbidsheet":["fbs"],"image/vnd.fpx":["fpx"],"image/vnd.fst":["fst"],"image/vnd.fujixerox.edmics-mmr":["mmr"],"image/vnd.fujixerox.edmics-rlc":["rlc"],"image/vnd.ms-modi":["mdi"],"image/vnd.ms-photo":["wdp"],"image/vnd.net-fpx":["npx"],"image/vnd.wap.wbmp":["wbmp"],"image/vnd.xiff":["xif"],"image/webp":["webp"],"image/x-3ds":["3ds"],"image/x-adobe-photoshop-brush":["abr"],"image/x-cmu-raster":["ras"],"image/x-cmx":["cmx"],"image/x-freehand":["fh","fhc","fh4","fh5","fh7"],"image/x-icon":["ico"],"image/x-mrsid-image":["sid"],"image/x-pcx":["pcx"],"image/x-pict":["pic","pct"],"image/x-portable-anymap":["pnm"],"image/x-portable-bitmap":["pbm"],"image/x-portable-graymap":["pgm"],"image/x-portable-pixmap":["ppm"],"image/x-rgb":["rgb"],"image/x-tga":["tga"],"image/x-xbitmap":["xbm"],"image/x-xpixmap":["xpm"],"image/x-xwindowdump":["xwd"],"message/rfc822":["eml","mime"],"model/iges":["igs","iges"],"model/mesh":["msh","mesh","silo"],"model/vnd.collada+xml":["dae"],"model/vnd.dwf":["dwf"],"model/vnd.gdl":["gdl"],"model/vnd.gtw":["gtw"],"model/vnd.mts":["mts"],"model/vnd.vtu":["vtu"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["x3db","x3dbz"],"model/x3d+vrml":["x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"text/cache-manifest":["appcache"],"text/calendar":["ics","ifb"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in"],"text/prs.lines.tag":["dsc"],"text/richtext":["rtx"],"text/sgml":["sgml","sgm"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vnd.curl":["curl"],"text/vnd.curl.dcurl":["dcurl"],"text/vnd.curl.scurl":["scurl"],"text/vnd.curl.mcurl":["mcurl"],"text/vnd.dvb.subtitle":["sub"],"text/vnd.fly":["fly"],"text/vnd.fmi.flexstor":["flx"],"text/vnd.graphviz":["gv"],"text/vnd.in3d.3dml":["3dml"],"text/vnd.in3d.spot":["spot"],"text/vnd.sun.j2me.app-descriptor":["jad"],"text/vnd.wap.wml":["wml"],"text/vnd.wap.wmlscript":["wmls"],"text/x-asm":["s","asm"],"text/x-c":["c","cc","cxx","cpp","h","hh","dic"],"text/x-fortran":["f","for","f77","f90"],"text/x-java-source":["java"],"text/x-opml":["opml"],"text/x-pascal":["p","pas"],"text/x-nfo":["nfo"],"text/x-setext":["etx"],"text/x-sfv":["sfv"],"text/x-uuencode":["uu"],"text/x-vcalendar":["vcs"],"text/x-vcard":["vcf"],"video/3gpp":["3gp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/jpeg":["jpgv"],"video/jpm":["jpm","jpgm"],"video/mj2":["mj2","mjp2"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/vnd.dece.hd":["uvh","uvvh"],"video/vnd.dece.mobile":["uvm","uvvm"],"video/vnd.dece.pd":["uvp","uvvp"],"video/vnd.dece.sd":["uvs","uvvs"],"video/vnd.dece.video":["uvv","uvvv"],"video/vnd.dvb.file":["dvb"],"video/vnd.fvt":["fvt"],"video/vnd.mpegurl":["mxu","m4u"],"video/vnd.ms-playready.media.pyv":["pyv"],"video/vnd.uvvu.mp4":["uvu","uvvu"],"video/vnd.vivo":["viv"],"video/webm":["webm"],"video/x-f4v":["f4v"],"video/x-fli":["fli"],"video/x-flv":["flv"],"video/x-m4v":["m4v"],"video/x-matroska":["mkv","mk3d","mks"],"video/x-mng":["mng"],"video/x-ms-asf":["asf","asx"],"video/x-ms-vob":["vob"],"video/x-ms-wm":["wm"],"video/x-ms-wmv":["wmv"],"video/x-ms-wmx":["wmx"],"video/x-ms-wvx":["wvx"],"video/x-msvideo":["avi"],"video/x-sgi-movie":["movie"],"video/x-smv":["smv"],"x-conference/x-cooltalk":["ice"]},n={};
return Object.keys(i).forEach(function(e){var t=i[e];t.forEach(function(t){n[t]=n[t]||[],n[t].push(e)})}),o.getExtensions=function(t){return t?i[t.toLowerCase()]||e(t.toLowerCase()):[]},o.getMimeTypes=function(e){return e?n[e.toLowerCase()]||t(e.toLowerCase()):[]},o}),i("utils/AdobeLibraryManifestUtils",["require","exports","module","../components/dcx-js/src/AdobeDCX","../components/dcx-js/src/AdobeDCXError","../AdobeLibraryConfig","../AdobeLibraryServices","../AdobeLibraryError"],function(e){var t=e("../components/dcx-js/src/AdobeDCX"),o=e("../components/dcx-js/src/AdobeDCXError"),i=e("../AdobeLibraryConfig"),n=e("../AdobeLibraryServices"),r=e("../AdobeLibraryError"),a={},s={};a.isCompatibleType=function(e,t){return e===t||e===s[t]},a.validateLibraryId=function(e,t){if(t){if(e&&e.length>=30&&e.match(/^[0-9A-Z\-]+$/i))return!0}else if(e&&e.match(/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i))return!0;return!1},a.validateLibrary=function(e){var t=e.current&&e.current.rootNode.getValue(i.VERSION_KEY);return t!==i.VERSION?!1:!0},a.areManifestsEqual=function(e,t){try{var o=JSON.parse(e),i=JSON.parse(t);if(delete o["manifest-format-version"],delete i["manifest-format-version"],JSON.stringify(o)===JSON.stringify(i))return!0}catch(n){}return!1},a.getDCXKey=function(e,t){if(!e||!("string"==typeof e||e instanceof String)||""===e)throw new r(r.INVALID_PARAMETER,"Invalid namespace");if(!t||!("string"==typeof t||t instanceof String)||""===t)throw new r(r.INVALID_PARAMETER,"Invalid key");return e+"#"+t},a.getCustomDCXData=function(e){var t=e.getCustomKeys(),o=[];return t.forEach(function(t){var n=t.split("#"),r=n.length>=2;r&&n.forEach(function(e){""===e&&(r=!1)});var a=0===t.indexOf(i.DL_PREFIX);r&&!a&&o.push({namespace:n.shift(),key:n.join("#"),value:e.getValue(t)})}),o},a.copyCustomDCXData=function(e,t){var o=a.getCustomDCXData(e);o.forEach(function(e){t.setValue(a.getDCXKey(e.namespace,e.key),e.value)});var n=e.getValue(i.REPRESENTATION_ORDER_KEY);n&&t.setValue(i.REPRESENTATION_ORDER_KEY,n)},a.checkDeletedState=function(e,t){if(e.deletedLocally){if(t)return t(new r(r.DELETED_LOCALLY,"deleted/orphan object")),!0;throw new r(r.DELETED_LOCALLY,"deleted/orphan object")}return!1},a.checkEncoding=function(e,t,o){if(-1===t.indexOf(e)){var i=t.join(", ");return o(new r(r.INVALID_PARAMETER,"Unsupported encoding. Supported encodings are: "+i)),!1}return!0},a.sortRepresentations=function(e){if(!(e.length<2))for(var t,o,i,n;;){for(t=!1,o=1;o<e.length;o++)i=e[o-1],n=e[o],n._getOrder()<i._getOrder()&&(e[o-1]=n,e[o]=i,t=!0);if(!t)break}},a.removeMissingComponents=function(e,t){if(!e||!t)return void 0;var o=0;return t.forEach(function(t){var i=t.component,r=t.error;i&&r&&r.response&&404===r.response.statusCode&&(e.removeComponent(i),o++,n.log("Removed missing component: "+i.id+" from library "+e.compositeId))}),n.log("Fixed "+o+" of "+t.length+" components that failed to download"),t.length===o?e:void 0};var c=function(e,t){var o;return e.elements.some(function(e){return e.representations.some(function(e){return e.id===t?(o=e,!0):void 0})}),o};return a.removeMissingLocalComponents=function(e,t){if(e&&t){var i=0,r=[];t.forEach(function(t){var a=t.component,s=t.error;if(a&&s&&s.code===o.INVALID_STATE){var l=c(e,a.id);l?r.push(l):e._dcxBranch.removeComponent(a),i++,n.log("Removed missing local component: "+a.id+" from library "+e.id)}}),i>0&&(e.beginOperation(),r.forEach(function(e){e.element.removeRepresentation(e)}),e.endOperation()),n.log("Fixed "+i+" of "+t.length+" components that failed to upload")}},a.collaborationStateToDCX=function(e){return"incoming"===e?t.COLLABORATION.SHARED_WITH_USER:"outgoing"===e?t.COLLABORATION.SHARED_BY_USER:t.COLLABORATION.PRIVATE},a.collaborationStateFromDCX=function(e){return e===t.COLLABORATION.SHARED_WITH_USER?"incoming":e===t.COLLABORATION.SHARED_BY_USER?"outgoing":void 0},a.getElementReference=function(e,t,o){return"cloud-asset://"+e+i.STORAGE_ASSETS_PATH+i.LIBRARY_SYNC_GROUP+"/"+t+";node="+o},a}),i("utils/AdobeLibraryFileUtils",["require","exports","module","../AdobeLibraryServices"],function(e){var t=e("../AdobeLibraryServices"),o={},i=function(e){return e+".TEMP_"+t.uuid()},n=function(e){var t=e.match(/(.*)\.TEMP_[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i);return t&&t[1]?t[1]:e};return o.ensurePathExists=function(e,o){function i(e,t,o){var a=t.slice(0,e).join(n),s=function(){e<t.length?i(e+1,t,o):o(null)};r.exists(a,function(e){e?s():r.mkdir(a,s)})}var n=t.getPathSeparator(),r=t.fs,a=e.split(n);i(2,a,o)},o.copyFile=function(e,o,n){var r=t.fs;try{var a=i(o),s=r.createWriteStream(a),c=r.createReadStream(e),l=!1;c.on("end",function(){l||r.rename(a,o,n)}),c.on("error",function(e){l=!0,n(e)}),c.pipe(s)}catch(d){n(d)}},o.normaliseTempFileName=function(e){return n(e)},o.getFileExtension=function(e){var t=e&&e.replace(/^.*[\\\/]/,""),o=t?t.lastIndexOf("."):-1;return-1!==o?t.substr(o+1).toLowerCase():void 0},o.recursiveDeleteDirectory=function(e,i){var n=t.getPathSeparator(),r=t.fs,a=function(e){e&&"ENOENT"===e.code&&(e=null),i&&i(e)};r.exists(e,function(t){t?r.readdir(e,function(t,i){function s(t){t&&"ENOENT"===t.code&&(t=null),c=c||t,l++,l===i.length&&(c?a(c):r.rmdir(e,a))}if(t)return void a(t);if(!i||0===i.length)return void r.rmdir(e,a);var c=null,l=0;i.forEach(function(t){var i=e+n+t;r.stat(i,function(e,t){c=c||e,t&&t.isDirectory()?o.recursiveDeleteDirectory(i,s):r.unlink(i,s)})})}):a(null)})},o.moveLibrary=function(e,o,i){var n=t.fs;if(o===e.id)return void i(null);var r=e._collection._getCompositeDir(o),a=e._getCompositeDir(),s=e._collection._getRenditionCacheDir(o),c=e._getRenditionCacheDir();n.rename(r,a,function(t){return t?void i(t):(e._dcxComposite.path=a,void n.rename(s,c,i))})},o.readLibraryDirectory=function(e,i){var n=t.fs,r=e._getTempDir();o.recursiveDeleteDirectory(r,function(){var t=e._getCompositeDir();n.readdir(t,i)})},o.doesRootDirExist=function(e,o){var i=t.fs,n=e._getCompositeDir();i.exists(n,function(e){o(null,e)})},o.deleteLibraryFromDisk=function(e,i,n){if(t.hasFileSystem()){var r=e._getCompositeDir(i),a=e._getRenditionCacheDir(i);o.recursiveDeleteDirectory(r,function(){o.recursiveDeleteDirectory(a,n)})}else n&&n(null)},o}),i("utils/AdobeLibraryErrorUtils",["require","exports","module","../components/dcx-js/src/AdobeDCXError","../AdobeLibraryError"],function(e){var t=e("../components/dcx-js/src/AdobeDCXError"),o=e("../AdobeLibraryError"),i={};return i.getErrorStatusCode=function(e){if(!e)return void 0;var o=e.code===t.UNEXPECTED_RESPONSE&&e.response&&e.response.statusCode;return o?o:e.underlyingError?i.getErrorStatusCode(e.underlyingError):void 0},i.getSyncError=function(e,n){if(e){var r;return r=e.code===t.SERVICE_IS_INACTIVE?new o(o.LOGGED_OUT,"no access token: call updateAccessToken() and try again",n,e):e.code===t.NETWORK_ERROR?new o(o.NETWORK_ERROR,"error connecting to server",n,e):e.code===t.EXCEEDS_QUOTA?new o(o.EXCEEDS_QUOTA,"push failed due to insufficient remaining quota",n,e):e.code===t.OUT_OF_SPACE?new o(o.OUT_OF_SPACE,"not enough disk space",n,e):e.code===t.NOT_IMPLEMENTED?new o(o.NOT_IMPLEMENTED,"tried to call an API not implemented on the server",n,e):e.code===t.RETRYABLE_SERVER_ERROR?new o(o.RETRYABLE_SERVER_ERROR,"intermittent server failure - can retry later",n,e):e.code===t.INVALID_DATA||e.code===t.INVALID_JSON?new o(o.CORRUPTED_LIBRARY,"unable to read manifest",n,e):403===i.getErrorStatusCode(e)?new o(o.ACCESS_DENIED,"server returned 403 Forbidden response",n,e):new o(o.TRANSFER_ERROR,"something went wrong during a push/pull operation",n,e)}},i.getCommitError=function(e,i,n){if(e){var r,a=n?" - "+n:"";return r=e.code===t.INVALID_DATA||e.code===t.INVALID_JSON?new o(o.CORRUPTED_LIBRARY,"unable to read manifest"+a,i,e):e.code===t.OUT_OF_SPACE?new o(o.OUT_OF_SPACE,"not enough disk space"+a,i,e):new o(o.FS_ERROR,"filesystem error"+a,i,e)}},i.getErrorPriority=function(e){var t=[o.EXCEEDS_MAX_LIBRARY_SIZE,o.RENDITION_NOT_AVAILABLE,o.URL_VALIDATION_FAILED,o.CORRUPTED_LIBRARY,o.TRANSFER_ABORTED,o.TRANSFER_ERROR,o.NETWORK_ERROR,o.EXCEEDS_QUOTA,o.RETRYABLE_SERVER_ERROR,o.LOGGED_OUT,o.FILE_TOO_LARGE,o.FS_ERROR,o.OUT_OF_SPACE,o.ACCESS_DENIED,o.NOT_ALLOWED,o.DELETED_LOCALLY,o.REQUIRES_FILESYSTEM,o.NOT_SUPPORTED,o.NOT_IMPLEMENTED,o.INVALID_PARAMETER,o.READ_ONLY],i=e&&e.code&&t.indexOf(e.code);return void 0!==i?i:-1},i.errorToString=function(e){var t="";return e&&(e.message&&(t+=e.message),e.libraryId&&(t+=" library: "+e.libraryId),e.underlyingError?t+="\n<- "+i.errorToString(e.underlyingError):e.response&&e.response.statusCode&&(t+=": "+e.response.statusCode),e.failedComponents&&(t+="\n<- Failed Components:",e.failedComponents.forEach(function(e){var o=e.component&&e.component.id,i=e.error,n=i&&i.message,r=i&&i.response&&i.response.statusCode;t+="\n    ["+o+"] "+n+(r?": "+r:"")}))),t},i.isErrorCode=function(e){return e?o.hasOwnProperty(e)&&o[e]===e:!1},i}),i("utils/AdobeLibrarySyncUtils",["require","exports","module","../AdobeLibraryConfig","../AdobeLibraryError","../components/dcx-js/src/AdobeDCXUtil"],function(e){var t=e("../AdobeLibraryConfig"),o=e("../AdobeLibraryError"),i=e("../components/dcx-js/src/AdobeDCXUtil"),n={};n.getBackoffTicks=function(e){var o=t.BACKOFF_INTERVALS,i=Math.max(0,Math.min(e,o.length-1));return o[i]-1},n.getRetryAfterHeader=function(e){if(e){var o=e["retry-after"]||e["Retry-After"];if(o)try{var i=parseInt(o,10);if(i)return Math.max(0,i);var n=Date.parse(o);if(n){var r=(new Date).valueOf(),a=Math.max(0,n-r)/1e3,s=Math.floor(Math.random()*t.RETRY_RANDOM_SECONDS);return a+s}}catch(c){}}return 0},n.getLocationHeader=function(e){if(e){var t=e.location||e.Location;if(t)return t}},n.getContentTypeHeader=function(e){if(e){var t=e["content-type"]||e["Content-Type"];if(t){var o=t.indexOf(";");return o>0&&(t=t.substring(0,o)),t}}},n.isUnrecoverableClientError=function(e){return e?e>=400&&500>e&&401!==e&&407!==e&&408!==e:!1};var r=function(e,t){return t.some(function(t){if(e===t)return!0;var o=e.indexOf("."+t);return-1!==o&&o===e.length-t.length-1})};return n.isAdobeDomain=function(e){return e?r(e,t.ADOBE_AUTHENTICATED_DOMAINS):!1},n.validateURL=function(e){if(!e)return new o(o.URL_VALIDATION_FAILED,"URL not specified");var a=i.parseURI(e);if("https"!==a.scheme)return new o(o.URL_VALIDATION_FAILED,"URL must be https://");var s=n.isAdobeDomain(a.authority),c=s||r(a.authority,t.WHITELISTED_DOMAINS);return c?null:new o(o.URL_VALIDATION_FAILED,"URL domain not in whitelist")},n}),i("AdobeLibraryRepresentation",["require","exports","module","./AdobeLibraryServices","./AdobeLibraryConfig","./AdobeLibraryError","./utils/AdobeLibraryMimeTypeUtils","./utils/AdobeLibraryManifestUtils","./utils/AdobeLibraryFileUtils","./utils/AdobeLibraryErrorUtils","./utils/AdobeLibrarySyncUtils"],function(e){function t(e,t,o){this._element=e,this._dcxNode=t,this._dcxComponent=o,this._deletedLocally=!1,this._pendingDownloadCallbacks=[]}var o=e("./AdobeLibraryServices"),i=e("./AdobeLibraryConfig"),n=e("./AdobeLibraryError"),r=e("./utils/AdobeLibraryMimeTypeUtils"),a=e("./utils/AdobeLibraryManifestUtils"),s=e("./utils/AdobeLibraryFileUtils"),c=e("./utils/AdobeLibraryErrorUtils"),l=e("./utils/AdobeLibrarySyncUtils");return t.prototype._markDeletedLocally=function(e){this._deletedLocally=e},t.prototype._toJSON=function(){var e={id:this.id,type:this.type,relationship:this.relationship};return o.hasFileSystem()&&(e._componentPath=this._getComponentPath()),e},t.prototype._getOrder=function(){return this._getDCXElement().getValue(i.REPRESENTATION_ORDER_KEY)||0},t.prototype._setComponentInBrowser=function(e,t,o){var i=this,n=this._element._library._collection._syncManager;n.uploadNewComponent(e,t,this,function(e,t){if(a.checkDeletedState(i,o))return void o(e);if(e)return void o(e);a.copyCustomDCXData(i._dcxNode,t);var n=i._element._library._dcxBranch;n.removeChild(i._dcxNode),i._dcxComponent=t,delete i._dcxNode,i._commit(),o(null)})},t.prototype._setComponentFromPath=function(e,t,r){var c=o.fs,l=this,d=e&&o.getFileNameFromPath(e),p=s.getFileExtension(d),h=this.id+"."+p;c.stat(e,function(s,c){return c&&c.size>i.MAX_COMPONENT_SIZE?void r(new n(n.FILE_TOO_LARGE,"File exceeds maximum size for a representation")):void o.storageInterface.notifyStartWrite(l._element._library,[],function(){var o=l._element._library._dcxBranch;o.addComponent(d,l.type,l.relationship,h,e,t,void 0,l._element._dcxNode,l.id,function(e,t){if(!a.checkDeletedState(l,r)){if(e)return void r(e);a.copyCustomDCXData(l._dcxNode,t),o.removeChild(l._dcxNode),l._dcxComponent=t,delete l._dcxNode,l._commit(),r(null)}})})})},t.prototype._setComponent=function(e,t,i,n){function l(e){return a.checkDeletedState(u,n)?void 0:e?void n(c.getCommitError(e,u._element._library.id,"error writing representation contents")):void u._setComponentFromPath(p,!1,n)}function d(){"buffer"===t?h.writeFile(p,e,l):h.writeFile(p,e,t,l)}var p,h=o.fs,u=this,_=this.element.library.collection._getTempDir();s.ensurePathExists(_,function(e){if(!a.checkDeletedState(u,n)){if(e)return void n(c.getCommitError(e,u._element._library.id,"error creating temp directory"));if(!i){var t=r.getExtensions(u.type)[0];i=u.id+"."+t}p=_+o.getPathSeparator()+i,d()}})},t.prototype._getCurrentComponentPath=function(){return this._dcxComponent?this._element._library._dcxBranch.assetOfComponent(this._dcxComponent):void 0},t.prototype._getComponentPath=function(e,t){if(!e)return this._getCurrentComponentPath();if(this.isExternalLink())this._getExternalLinkPath(e);else if(this._dcxComponent){var o=this._getCurrentComponentPath();if(o||t)e(null,o);else{var i=this,n=this._element._library;n._networkLock.obtain(function(t){if(t)return void e(t);if(a.checkDeletedState(i,e))return void n._networkLock.release();n._setSyncState("downloading");var o=n._collection._syncManager;o.downloadRepresentation(i,function(t){if(n._networkLock.release(),n._setSyncState(),!a.checkDeletedState(i,e)){if(t)return void e(c.getSyncError(t,i._element._library.id));n._commit(!0,!0),i._getComponentPath(e,!0)}})})}}else e(null)},t.prototype._setRenditionCache=function(e,t,o,i){var n=this.element;n._lock.obtain(function(){n._setRenditionCache(e,t,o),n._lock.release(),i()})},t.prototype._getCachedExternalLinkPath=function(e){var t=null,o=this.element._lookupRenditionPath(this.id);if(e||o!==i.RENDITION_CACHE_PLACEHOLDER||(o=void 0),c.isErrorCode(o)&&(t=new n(o,"Broken link, or access denied",this.element.library.id),o=void 0),!t&&!o){var r=this._dcxNode.getValue(i.LINK_URL_KEY);t=l.validateURL(r)}return{err:t,path:o}},t.prototype._getExternalLinkPath=function(e){var t=this,s=this.element.library,d=s.collection,p=d._getTempDir(),h=this._getCachedExternalLinkPath();if(h.err||h.path)return void e(h.err,h.path);if(i.SHARED_LOCAL_STORAGE)return void o.storageInterface.downloadExternalLink(t,e);if(this._pendingDownloadCallbacks.push(e),!(this._pendingDownloadCallbacks.length>1)){var u=function(e,o){var i=t._pendingDownloadCallbacks;t._pendingDownloadCallbacks=[],i.forEach(function(t){t(e,o)})},_=function(e,i){return e?void u(e):c.isErrorCode(i)?void t._setRenditionCache(t.id,i,!0,function(){u(new n(i,"Broken link, or access denied",s.id))}):void t.element.setRenditionCache(t.id,i,function(e,i){o.storageInterface.notifyDownloadRendition(t.element),u(e,i)})},f=this._dcxNode.getValue(i.LINK_URL_KEY),m=(new Date).valueOf();o.log("Downloading from external URL: "+f),o.storageInterface.getAssetFromURL(d,f,{},p,function(e,i,s,d){if(o.log("Finished downloading from external URL: "+((new Date).valueOf()-m)+"ms"),!a.checkDeletedState(t,_)){var p=e&&e.response&&e.response.statusCode;if(l.isUnrecoverableClientError(p))return void _(null,n.RENDITION_NOT_AVAILABLE);if(e)return void _(c.getSyncError(e));var h=l.getContentTypeHeader(d&&d.headers)||t.type,u=r.getExtensions(h)[0]||"data",f=i+"."+u;o.fs.rename(i,f,function(e){return e?void _(c.getCommitError(e)):void _(null,f)})}})}},t.prototype._testExternalLink=function(e){var t=this,r=this._getCachedExternalLinkPath(!0);if(r.err)return void e(null,!1);if(r.path)return void e(null,!0);var a=this._dcxNode.getValue(i.LINK_URL_KEY),s=(new Date).valueOf();o.log("HEAD request of external URL: "+a),o.storageInterface.doHeadRequestOfURL(this.element.library.collection,a,function(r,a){if(o.log("Finished HEAD request of external URL: "+((new Date).valueOf()-s)+"ms"),r)return void e(null,!0);var c=a&&a.statusCode;l.isUnrecoverableClientError(c)?t._setRenditionCache(t.id,n.RENDITION_NOT_AVAILABLE,!0,function(){e(null,!1)}):c&&c>=200&&400>c?t._setRenditionCache(t.id,i.RENDITION_CACHE_PLACEHOLDER,!1,function(){e(null,!0)}):e(null,!0)})},t.prototype._getDCXElement=function(){return this._dcxComponent||this._dcxNode},t.prototype._commit=function(){this._element._commit()},t.prototype.jasmineToString=function(){return this.toString()},Object.defineProperties(t.prototype,{id:{get:function(){return this._getDCXElement().id},set:function(){throw new n(n.READ_ONLY,"Cannot change the id of an existing representation",this._element._library.id)}},element:{get:function(){return this._element},set:function(){throw new n(n.READ_ONLY,"element is a read-only property",this._element._library.id)}},writable:{get:function(){return this._element.writable},set:function(){throw new n(n.READ_ONLY,"writable is a read-only property",this._element._library.id)}},type:{get:function(){var e=this._getDCXElement().type;return e===i.LINK_REPRESENTATION_TYPE&&(e=this._getDCXElement().getValue(i.LINK_TYPE_KEY)),e},set:function(){throw new n(n.READ_ONLY,"Cannot change the content type of an existing representation",this._element._library.id)}},relationship:{get:function(){return this._dcxComponent?this._dcxComponent.relationship:this._dcxNode.getValue(i.RELATIONSHIP_KEY)||this._dcxNode.getValue("relationship")},set:function(){throw new n(n.READ_ONLY,"Cannot change the relationship of an existing representation",this._element._library.id)}},width:{get:function(){return this._dcxComponent?this._dcxComponent.getValue("width"):this._dcxNode.getValue(i.WIDTH_KEY)},set:function(e){if(a.checkDeletedState(this),!this.writable)throw new n(n.NOT_ALLOWED,"you do not have write access to this library",this._element._library.id);if(!this._dcxComponent&&!this.isExternalLink())throw new n(n.INVALID_PARAMETER,"Cannot set width on a representation without contents",this._element._library.id);if("number"!=typeof e||0>e)throw new n(n.INVALID_PARAMETER,"Invalid width",this._element._library.id);this._dcxComponent?this._dcxComponent.setValue("width",e):this._dcxNode.setValue(i.WIDTH_KEY,e),this._commit()}},height:{get:function(){return this._dcxComponent?this._dcxComponent.getValue("height"):this._dcxNode.getValue(i.HEIGHT_KEY)},set:function(e){if(a.checkDeletedState(this),!this.writable)throw new n(n.NOT_ALLOWED,"you do not have write access to this library",this._element._library.id);if(!this._dcxComponent&&!this.isExternalLink())throw new n(n.INVALID_PARAMETER,"Cannot set height on a representation without contents",this._element._library.id);if("number"!=typeof e||0>e)throw new n(n.INVALID_PARAMETER,"Invalid height",this._element._library.id);this._dcxComponent?this._dcxComponent.setValue("height",e):this._dcxNode.setValue(i.HEIGHT_KEY,e),this._commit()}},isFullSize:{get:function(){return this._getDCXElement().getValue(i.IS_FULL_SIZE_KEY)},set:function(e){if(a.checkDeletedState(this),!this.writable)throw new n(n.NOT_ALLOWED,"you do not have write access to this library",this._element._library.id);if(!this._dcxComponent&&!this.isExternalLink())throw new n(n.INVALID_PARAMETER,"Cannot set isFullSize on a representation without contents",this._element._library.id);if("boolean"!=typeof e)throw new n(n.INVALID_PARAMETER,"Invalid isFullSize",this._element._library.id);this._getDCXElement().setValue(i.IS_FULL_SIZE_KEY,e),this._commit()}},contentLength:{get:function(){if(this.isExternalLink())return this._dcxNode.getValue(i.LENGTH_KEY);if(this._dcxComponent){if(void 0===this._dcxComponent.length&&o.hasFileSystem()){var e=this._getCurrentComponentPath(),t="statSync";try{var n=o.fs[t](e);return n&&n.size}catch(r){}}return this._dcxComponent.length}return void 0},set:function(e){if(!this.isExternalLink())throw new n(n.READ_ONLY,"setContentLength can only be used for an externally-linked representation",this._element._library.id);if("number"!=typeof e||0>e)throw new n(n.INVALID_PARAMETER,"Invalid content length",this._element._library.id);this._dcxNode.setValue(i.LENGTH_KEY,e),this._commit()}},deletedLocally:{get:function(){return this._deletedLocally},set:function(){throw new n(n.READ_ONLY,"deletedLocally is a read-only property",this._element._library.id)}}}),t.prototype.isCompatibleType=function(e){if(this._dcxComponent){var t=s.getFileExtension(this._dcxComponent.path),o=r.getExtensions(e);if(-1===o.indexOf(t))return!1}return a.isCompatibleType(e,this.type)},t.prototype.toString=function(){return JSON.stringify(this._toJSON())},t.prototype.getValue=function(e,t){if(e===i.DL_NAMESPACE)throw new n(n.INVALID_PARAMETER,"Reserved namespace",this._element._library.id);var o=a.getDCXKey(e,t);return this._getDCXElement().getValue(o)},t.prototype.getValues=function(){return a.getCustomDCXData(this._getDCXElement())},t.prototype.setValue=function(e,t,o){if(a.checkDeletedState(this),!this.writable)throw new n(n.NOT_ALLOWED,"you do not have write access to this library",this._element._library.id);if(e===i.DL_NAMESPACE)throw new n(n.INVALID_PARAMETER,"Reserved namespace",this._element._library.id);var r,s=a.getDCXKey(e,t);try{r=JSON.parse(JSON.stringify(o))}catch(c){throw new n(n.INVALID_PARAMETER,"Value cannot be serialized to JSON",this._element._library.id)}this._getDCXElement().setValue(s,r),this._commit()},t.prototype.updateContent=function(e,t,i,r){if(!a.checkDeletedState(this,r)){if(!this.writable)return void r(new n(n.NOT_ALLOWED,"you do not have write access to this library",this._element._library.id));if(this._dcxComponent||this.isExternalLink())return void r(new n(n.INVALID_PARAMETER,"Cannot modify representation content once set",this._element._library.id));if(o.hasFileSystem()){if(!a.checkEncoding(t,["utf8","ascii","base64","buffer"],r))return;this._setComponent(e,t,i,r)}else{if(void 0!==t)return void r(new n(n.INVALID_PARAMETER,"Encoding parameter not supported in-browser"));this._setComponentInBrowser(e,i,r)}}},t.prototype.updateContentFromPath=function(e,t,i){return"function"==typeof t&&(i=t,t=!1),o.hasFileSystem()?a.checkDeletedState(this,i)?void 0:this.writable?this._dcxComponent||this.isExternalLink()?void i(new n(n.INVALID_PARAMETER,"Cannot modify representation content once set",this._element._library.id)):void this._setComponentFromPath(e,!t,i):void i(new n(n.NOT_ALLOWED,"you do not have write access to this library",this._element._library.id)):void i(new n(n.REQUIRES_FILESYSTEM,"path-based APIs require a filesystem",this._element._library.id))},t.prototype.updateContentFromURL=function(e,t,s,d){if(!o.hasFileSystem()&&!e)return void d(new n(n.NOT_IMPLEMENTED,"not yet implemented updateContentFromURL without a filesystem",this._element._library.id));if(!a.checkDeletedState(this,d)){if(!this.writable)return void d(new n(n.NOT_ALLOWED,"you do not have write access to this library",this._element._library.id));if("boolean"!=typeof e)return void d(new n(n.INVALID_PARAMETER,"Invalid createLink parameter: must be Boolean",this._element._library.id));if(this._dcxComponent||this.isExternalLink())return void d(new n(n.INVALID_PARAMETER,"Cannot modify representation content once set",this._element._library.id));if(e)return this._dcxNode.setValue(i.LINK_TYPE_KEY,this._dcxNode.type),this._dcxNode.type=i.LINK_REPRESENTATION_TYPE,this._dcxNode.setValue(i.LINK_URL_KEY,t),this._commit(),void d(null);var p=this,h=this.element.library.collection,u=h._getTempDir();o.storageInterface.getAssetFromURL(h,t,s,u,function(e,t,i,n){if(e)return void d(c.getSyncError(e));if(!a.checkDeletedState(p,d)){var s=l.getContentTypeHeader(n&&n.headers);if(s){var h=r.getExtensions(s)[0],u=t+"."+h;o.fs.rename(t,u,function(e){return e?void d(c.getCommitError(e)):void p._setComponentFromPath(u,!1,d)})}else p._setComponentFromPath(t,!1,d)}})}},t.prototype.getContentPath=function(e){return o.hasFileSystem()?void(a.checkDeletedState(this,e)||this._getComponentPath(e)):void e(new n(n.REQUIRES_FILESYSTEM,"path-based APIs require a filesystem",this._element._library.id))},t.prototype.getCachedContentPath=function(){if(!o.hasFileSystem())return void 0;if(this.isExternalLink()){var e=this._getCachedExternalLinkPath();return e.path}return this._dcxComponent?this._getCurrentComponentPath()||void 0:void 0},t.prototype.getContent=function(e,t){var i=o.fs,n=this;if(!a.checkDeletedState(this,t))if(o.hasFileSystem()){if(!a.checkEncoding(e,["utf8","ascii","base64","buffer"],t))return;this._getComponentPath(function(o,r){if(o||!r)return void t(o);if(!a.checkDeletedState(n,t)){var s=function(e,o){e&&c.getCommitError(e,n._element._library.id,"error reading content from disk"),t(e,o)};"buffer"===e?i.readFile(r,s):i.readFile(r,e,s)}})}else{if(!a.checkEncoding(e,["text","blob","arraybuffer"],t))return;if(!this._dcxComponent)return void t(null);var r=this._element._library._collection._syncManager;r.getSharedCloudContent(this,e,t)}},t.prototype.getContentURL=function(){if(this.isExternalLink())return this._dcxNode.getValue(i.LINK_URL_KEY);if(this._dcxComponent){var e=this._element._library._collection._syncManager;return e.getSharedCloudContentURL(this)}return void 0},t.prototype.getAuthenticatedContentURL=function(e){var t=this.getContentURL(),o=this._element._library._collection._syncManager;o.appendAccessTokenToURL(t,e)},t.prototype.isExternalLink=function(){return void 0!==this._dcxNode&&this._dcxNode.type===i.LINK_REPRESENTATION_TYPE},t.prototype.testExternalLink=function(e){return this.isExternalLink()&&this.getContentURL()?void this._testExternalLink(e):void e(new n(n.INVALID_PARAMETER,"Not an external link",this._element._library.id))},t.prototype.getCachedExternalLinkError=function(){if(!this.isExternalLink()||!this.getContentURL())return new n(n.INVALID_PARAMETER,"Not an external link",this._element._library.id);var e=this._getCachedExternalLinkPath();return e.err},t}),i("AdobeLibraryAnalytics",["require","exports","module","./AdobeLibraryServices","./AdobeLibraryConfig"],function(e){function t(e){if(e.type){var t=e.type.match(/application\/vnd\.adobe\.element\.(.*)\+dcx/);return t&&2===t.length?t[1]:e.type}return null}function o(e){if(!e)return{};var t={libraryID:e.id,libraryElementCount:e._elements.length};return e.collaboration&&(t.libraryShared=e.collaboration),t}function i(e){var t=e.getPrimaryRepresentation(),o=null;return t&&t.getValues().forEach(function(e){"trackingdata"===e.key&&(o||(o={}),o[e.namespace]=e.value)}),o}function n(e){if(!e)return{};var n=o(e._library);n.elementID=e.id,n.elementType=t(e);var r=i(e);return r&&(n.trackingData=JSON.stringify(r)),n}function r(e){if(!e)return{};var t=n(e._element);return t.representationType=e.type,t}function a(){return null!==d.analytics&&void 0!==d.analytics}function s(e){a()&&e&&d.analytics.reportError(e.code+(e.underlyingError?":"+e.underlyingError.code:""))}var c,l,d=e("./AdobeLibraryServices"),p=e("./AdobeLibraryConfig"),h=function(e){a()&&d.analytics.reportEvent("createLibrary",{libraryID:e.id})},u=function(e){a()&&d.analytics.reportEvent("deleteLibrary",o(e))},_=function(e){a()&&(c=e,l=Date.now(),d.analytics.reportEvent("createElement",n(e)))},f=function(e,t){if(a()){if(e===c&&Date.now()-l<p.ANALYTICS_ELEMENT_UPDATE_THRESHOLD)return;c=e,l=Date.now();var o=n(e);o.updateType=t?"info":"representation",d.analytics.reportEvent("updateElement",o)}},m=function(e,t,o){if(a()){var i=r(e);i.opType=t,i.details=o,d.analytics.reportEvent("useElement",i)}},y=function(e,t){if(a()){var o=n(e);o.details=t,d.analytics.reportEvent("checkoutElement",o)}},v=function(e){a()&&d.analytics.reportEvent("deleteElement",n(e))},g=function(e,t){if(a()){c=e,l=Date.now();var o=n(e);o.oldLibraryID=t._library.id,o.oldElementID=t.id,d.analytics.reportEvent("copyElement",o)}},A=function(e,t){if(a()){c=e,l=Date.now();var o=n(e);o.oldLibraryID=t._library.id,o.oldElementID=t.id,d.analytics.reportEvent("moveElement",o)}},E=function(e){a()&&d.analytics.reportEvent("collisionLibrary",n(e))},b=function(e){a()&&d.analytics.reportEvent("createRepresentation",r(e))},C=function(e){a()&&d.analytics.reportEvent("deleteRepresentation",r(e))},L=function(e,t){if(a()){var o=n(e);o.opType=t,d.analytics.reportEvent("createLink",o)}},S=function(e){a()&&d.analytics.reportEvent("shareElementLink",n(e))},w=function(e){a()&&d.analytics.reportEvent("shareLibraryLink",o(e))},R=function(e,t){if(a()){var i=o(e);i.details=t,i.logs=!0,d.analytics.reportEvent("unexpectedState",i)}};return{reportCreateLibrary:h,reportDeleteLibrary:u,reportCreateElement:_,reportUpdateElement:f,reportCopyElement:g,reportMoveElement:A,reportUseElement:m,reportCheckoutElement:y,reportDeleteElement:v,reportCollisionElement:E,reportCreateRepresentation:b,reportDeleteRepresentation:C,reportCreateLink:L,reportShareElementLink:S,reportShareLibraryLink:w,reportError:s,reportUnexpectedState:R}}),i("utils/AdobeLibraryLock",["require","exports","module"],function(){function e(){this._isLocked=!1,this._pendingContinuations=[]}return e.prototype.obtain=function(e,t){this._isLocked?this._pendingContinuations.push({continuation:e,thisObject:t}):(this._isLocked=!0,e.apply(t,[null]))},e.prototype.release=function(){if(this._pendingContinuations.length>0){var e=this._pendingContinuations.shift();setTimeout(function(){e.continuation.apply(e.thisObject,[null])})}else this._isLocked=!1},e.prototype.abortPendingOperations=function(e){var t=this._pendingContinuations;this._pendingContinuations=[],t.forEach(function(t){t.continuation.apply(t.thisObject,[e])})},e.prototype.isLocked=function(){return this._isLocked},e.prototype.hasPendingRequest=function(){return this._pendingContinuations.length>0},e}),i("utils/AdobeLibraryAsyncJoin",["require","exports","module","../AdobeLibraryError"],function(e){function t(){this._operations=[],this._isRunning=!1}var o=e("../AdobeLibraryError");return t.prototype.addOperation=function(e,t,i){if(this._isRunning)throw new o(o.INVALID_PARAMETER,"Cannot add operations after calling run()");this._operations.push({operation:e,argsArray:t||[],thisObject:i})},t.prototype.run=function(e,t){function i(t,o,i){e&&e(t,o,i)}function n(e,n,p){if(e&&t&&t(e),!c){if(a=a||e,l[p])return c=!0,void i(new o(o.INVALID_PARAMETER,"Operation not valid: calls callback multiple times"));if(s++,d[p]=n,l[p]=!0,s===r){c=!0;var h=d.reduce(function(e,t){return e||t},!1)?!0:!1;i(a||null,h,d)}}}if(this._isRunning)throw new o(o.INVALID_PARAMETER,"Cannot call run() more than once");this._isRunning=!0;var r=this._operations.length;0===r&&i(null,!1,[]);var a,s=0,c=!1,l=[],d=[];this._operations.forEach(function(e,t){e.argsArray.push(function(e,o){n(e,o,t)}),e.operation.apply(e.thisObject,e.argsArray)})},t}),i("utils/AdobeLibraryRenditionUtils",["require","exports","module","../AdobeLibraryConfig","../AdobeLibraryServices","./AdobeLibraryAsyncJoin","./AdobeLibraryFileUtils"],function(e){var t=e("../AdobeLibraryConfig"),o=e("../AdobeLibraryServices"),i=e("./AdobeLibraryAsyncJoin"),n=e("./AdobeLibraryFileUtils"),r={},a={"application/x-indesign":!0,"application/postscript":!0,"application/illustrator":!0,"application/pdf":!0,"application/vnd.adobe.psremix":!0,"application/vnd.adobe.pstouch":!0,"application/vnd.adobe.ideas":!0,"application/vnd.adobe.ase":!0,"image/jpeg":!0,"image/jpg":!0,"image/pjpeg":!0,"image/tiff":!0,"image/gif":!0,"image/bmp":!0,"image/x-ms-bmp":!0,"image/svg+xml":!0,"image/png":!0,"image/x-png":!0,"image/jp2":!0,"image/psd":!0,"image/vnd.adobe.photoshop":!0,"application/photoshop":!0,"application/x-photoshop":!0,"image/raw":!0,"image/dng":!0,"image/x-adobe-dng":!0,"video/mp4":!0,"video/mpeg":!0,"video/x-ms-wmv":!0,"video/3gpp":!0,"video/3gpp2":!0,"video/quicktime":!0,"video/x-msvideo":!0,"video/x-flv":!0,"video/x-ms-asf":!0,"video/x-m4v":!0,"video/mp2t":!0,"application/mxf":!0,"application/x-shockwave-flash":!0,"application/vnd.adobe.brushes.brush+ucf":!0,"application/vnd.adobe.collage":!0,"application/vnd.adobe.proto":!0,"application/msword":!0,"application/msexcel":!0,"application/mspowerpoint":!0,"application/vnd.ms-publisher":!0,"application/vnd.openxmlformats-officedocument.wordprocessingml.document":!0,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":!0,"application/vnd.openxmlformats-officedocument.presentationml.presentation":!0,"application/vnd.adobe.charts+zip":!0,"text/plain":!0,"text/rtf":!0},s=function(e,t){var i=o.fs;
i.stat(e,function(o,r){return o?void t(o):void(r&&r.isDirectory()?n.recursiveDeleteDirectory(e,t):i.unlink(e,t))})},c=function(e,r,a){var c=o.getPathSeparator(),l=o.fs;if(!e._dcxComposite.autoRemoveUnusedLocalFiles)return void a(null);var d={};Object.keys(r.renditions).forEach(function(t){var o=r.renditions[t];Object.keys(o).forEach(function(t){var i=o[t];d[i]=!0,delete e._pendingRenditionCacheItems[i]})});var p=e._getRenditionCacheDir();l.readdir(p,function(o,r){if(o)return void a(o);var l=new i;r.forEach(function(o){var i=n.normaliseTempFileName(o);o===t.RENDITION_CACHE_FILE||d[o]||e._pendingRenditionCacheItems[i]||l.addOperation(s,[p+c+o])}),l.run(a)})};return r.readRenditionCacheData=function(e,i){var n=o.getPathSeparator(),r=o.fs,a=e._getRenditionCacheDir();r.readFile(a+n+t.RENDITION_CACHE_FILE,"utf8",function(e,t){var o={};if(!e&&t)try{o=JSON.parse(t)}catch(n){}o.renditions=o.renditions||{},i(null,o)})},r.writeRenditionCacheData=function(e,i,r){var a=o.getPathSeparator(),s=o.fs,l=e._getRenditionCacheDir();n.ensurePathExists(l,function(n){if(n)return void r(n);var d=l+a+t.RENDITION_CACHE_FILE,p=d+o.uuid();s.writeFile(p,JSON.stringify(i,void 0,2),"utf8",function(t){return t?void r(t):void s.rename(p,d,function(t){return t?void r(t):void c(e,i,r)})})})},r.copyRenditionCache=function(e,n,r,a){var s=n._library._getRenditionCacheDir()+o.getPathSeparator(),c=new i,l=r||{};Object.keys(l).forEach(function(t){c.addOperation(e.setRenditionCache,[t,s+l[t]],e)}),t.SHARED_LOCAL_STORAGE?(c.run(),a(null)):c.run(a)},r.canComputeRenditionFromMimeType=function(e){return a[e]?!0:!1},r.canComputeRendition=function(e){var t=void 0!==e._dcxComponent;return t&&r.canComputeRenditionFromMimeType(e.type)?!0:!1},r.shouldPrefetchFullRendition=function(e){var o=t.FULL_RENDITION_CONFIG||{},i=o[e.type];if(!i)return!1;var n=!1;return Object.keys(i).forEach(function(t){var o=i[t];if("IF_NO_MATCHING_REPRESENTATION"===o.condition&&o.types){var r=e.representations.every(function(e){return-1===o.types.indexOf(e.type)});n=n||r}}),n},r.shouldPrefetchExternalLink=function(e){if(!e.isExternalLink())return!1;var o=t.EXTERNAL_LINK_PREFETCH||{};return o[e.element.type]?!0:!1},r.prefetchRenditions=function(e,o){var n=new i,a=t.RENDITION_SIZES||{};e.elements.forEach(function(e){var t=a[e.type]||a["*"]||[];t.forEach(function(t){n.addOperation(e.getRenditionPath,[t],e)}),r.shouldPrefetchFullRendition(e)&&n.addOperation(e.getRenditionPath,[void 0],e),e.representations.forEach(function(e){r.shouldPrefetchExternalLink(e)?n.addOperation(e.getContentPath,[],e):e.isExternalLink()&&n.addOperation(e.testExternalLink,[],e)})}),n.run(function(e){o&&o(e)})},r.addToRenditionSizeConfig=function(e){var o=t.RENDITION_SIZES,i=o["*"]||[];i=JSON.parse(JSON.stringify(i));var n=e["*"]||[];Object.keys(o).forEach(function(t){if(!e[t]){var i=o[t];n.forEach(function(e){-1===i.indexOf(e)&&i.push(e)}),o[t]=i}}),Object.keys(e).forEach(function(t){var n=o[t]||JSON.parse(JSON.stringify(i)),r=e[t];r.forEach(function(e){-1===n.indexOf(e)&&n.push(e)}),o[t]=n}),t.setParameter("RENDITION_SIZES",o)},r.addToFullRenditionConfig=function(e){var o=t.FULL_RENDITION_CONFIG;Object.keys(e).forEach(function(t){var i=o[t]||{},n=e[t];n.forEach(function(e){e.id&&(i[e.id]=e)}),o[t]=i}),t.setParameter("FULL_RENDITION_CONFIG",o)},r.addToPendingSetRenditionCache=function(e,t,o,i,n){e=e||{data:[],callbacks:[]};var r=[];return e.data.forEach(function(i,n){e.callbacks[n]||i.element!==t.id||i.size!==o||"CLEAR"!==i.path||r.unshift(n)}),r.forEach(function(t){e.data.splice(t,1),e.callbacks.splice(t,1)}),e.data.push({element:t.id,size:o,path:i}),e.callbacks.push(n),e},r}),i("utils/AdobeLibraryFeatureUtils",["require","exports","module","../AdobeLibraryServices"],function(e){var t=e("../AdobeLibraryServices"),o={};return o.supportsClearRenditionCache=function(){var e=t.storageInterface.getServiceInfo(),o=e?e.apiVersion:0;return o>=7},o}),i("utils/AdobeLibraryListenerManager",["require","exports","module","../AdobeLibraryServices","../AdobeLibraryError"],function(e){function t(e){this._restrictedTypes=e,this._listeners={}}var o=e("../AdobeLibraryServices"),i=e("../AdobeLibraryError");return t.prototype._checkType=function(e){if(this._restrictedTypes&&-1===this._restrictedTypes.indexOf(e)){var t="["+this._restrictedTypes.join(", ")+"]";throw new i(i.INVALID_PARAMETER,e+" is not allowed. Should be one of: "+t)}},t.prototype.add=function(e,t){this._checkType(e),this._listeners[e]=this._listeners[e]||[],this._listeners[e].push(t)},t.prototype.remove=function(e,t){this._checkType(e);var o=this._listeners[e];if(o){var i=o.indexOf(t);-1!==i&&o.splice(i,1)}},t.prototype.removeAll=function(e){e?(this._checkType(e),delete this._listeners[e]):this._listeners={}},t.prototype.notify=function(e,t){this._checkType(e);var i=this._listeners[e];i&&i.slice(0).forEach(function(e){try{e.apply(void 0,t||[])}catch(i){o.log("Error in listener callback: "+(i?i.toString():"")),i&&i.stack&&o.log(i.stack)}})},t.prototype.hasListeners=function(e){this._checkType(e);var t=this._listeners[e];return t&&t.length>0?!0:!1},t.prototype.forEach=function(e){var t=this._listeners;Object.keys(t).forEach(function(o){t[o].forEach(function(t){e(o,t)})})},t}),i("AdobeLibraryElement",["require","exports","module","./AdobeLibraryServices","./AdobeLibraryConfig","./AdobeLibraryRepresentation","./AdobeLibraryAnalytics","./AdobeLibraryError","./utils/AdobeLibraryLock","./utils/AdobeLibraryManifestUtils","./utils/AdobeLibraryFileUtils","./utils/AdobeLibraryRenditionUtils","./utils/AdobeLibraryErrorUtils","./utils/AdobeLibraryFeatureUtils","./utils/AdobeLibraryListenerManager"],function(e){function t(e,t){this._library=e,this._renditionCache={},this._lock=new s,this._listenerManager=new u(["change"]),this._setDCXNode(t)}var o=e("./AdobeLibraryServices"),i=e("./AdobeLibraryConfig"),n=e("./AdobeLibraryRepresentation"),r=e("./AdobeLibraryAnalytics"),a=e("./AdobeLibraryError"),s=e("./utils/AdobeLibraryLock"),c=e("./utils/AdobeLibraryManifestUtils"),l=e("./utils/AdobeLibraryFileUtils"),d=e("./utils/AdobeLibraryRenditionUtils"),p=e("./utils/AdobeLibraryErrorUtils"),h=e("./utils/AdobeLibraryFeatureUtils"),u=e("./utils/AdobeLibraryListenerManager");return t.prototype._setDCXNode=function(e,t){var o=this;this._dcxNode=e,this._representations=[],this._deletedLocally=!1;var r=this._library._dcxBranch.getChildrenOf(e);r.forEach(function(e){var t=new n(o,e);o._representations.push(t)});var a=this._library._dcxBranch.getComponentsOf(e);a.forEach(function(e){var t=new n(o,void 0,e);o._representations.push(t)}),c.sortRepresentations(this._representations);var s=e.getValue(i.CATEGORY_KEY);this._library._categories.forEach(function(e){e.id===s&&(o._category=e)}),this._clearRenditionCache(t,!1),this._displayName=void 0},t.prototype._markDeletedLocally=function(e){this._deletedLocally=e,this._representations.forEach(function(t){t._markDeletedLocally(e)}),e&&this._listenerManager.removeAll()},t.prototype._removeAllListeners=function(){this._listenerManager.removeAll()},t.prototype._toJSON=function(){var e={id:this.id,name:this.name,type:this.type,category:this._category&&this._category._id,representations:[]};return this._representations.forEach(function(t){e.representations.push(t._toJSON())}),e.representations.sort(function(e,t){return e.type>t.type?1:e.type<t.type?-1:0}),e},t.prototype._addRepresentation=function(e,t){t?this._representations.unshift(e):this._representations.push(e)},t.prototype._removeRepresentation=function(e){var t=this._representations.indexOf(e);-1!==t&&this._representations.splice(t,1)},t.prototype._doCreateRepresentation=function(e,t,o){var r=this._library._dcxBranch.addChild(void 0,void 0,o?0:void 0,this._dcxNode);if(r.type=e,r.setValue(i.RELATIONSHIP_KEY,t),o)r.setValue(i.REPRESENTATION_ORDER_KEY,0),this._representations.forEach(function(e){var t=e._getDCXElement(),o=t.getValue(i.REPRESENTATION_ORDER_KEY);void 0!==o&&t.setValue(i.REPRESENTATION_ORDER_KEY,o+1)});else{var a=this.representations[this.representations.length-1],s=Math.max(this.representations.length,a?a._getOrder()+1:0);r.setValue(i.REPRESENTATION_ORDER_KEY,s)}var c=new n(this,r);return this._addRepresentation(c,o),c},t.prototype._lookupRenditionPath=function(e){var t="existsSync",n=o.getPathSeparator(),r=this._renditionCache[e];if(r&&r!==i.RENDITION_CACHE_PLACEHOLDER&&r){if(r===i.RENDITION_CACHE_PLACEHOLDER||p.isErrorCode(r))return r;var a=this._library._getRenditionCacheDir()+n+r;if(i.SHARED_LOCAL_STORAGE||o.fs[t](a))return a}return void 0},t.prototype._getNewRenditionPath=function(e,t){var i=this,n=o.getPathSeparator(),r=this._library._getRenditionCacheDir();l.ensurePathExists(r,function(a){if(!c.checkDeletedState(i,t)){var s=o.uuid()+"."+(e||"png"),l=r+n+s;t(a,l,s)}})},t.prototype._updateModifiedTime=function(){var e=(new Date).valueOf();this._dcxNode.setValue(i.MODIFIED_KEY,e)},t.prototype._updateCreatedTime=function(){var e=(new Date).valueOf();this._dcxNode.setValue(i.CREATED_KEY,e),this._dcxNode.setValue(i.MODIFIED_KEY,e)},t.prototype._clearRenditionCache=function(e,t){var n=this,r=this._renditionCache;this._renditionCache={};var a=t&&i.SHARED_LOCAL_STORAGE&&h.supportsClearRenditionCache();Object.keys(r).forEach(function(t){!e&&!n.getRepresentationById(t)||p.isErrorCode(r[t])?a&&o.storageInterface.setRenditionCache(n,t,"CLEAR"):n._renditionCache[t]=r[t]})},t.prototype._commit=function(e){this._displayName=void 0,this._updateModifiedTime(),this._clearRenditionCache(!0,!0),this._library._commit(),this._listenerManager.notify("change"),r.reportUpdateElement(this,e)},t.prototype._commitRenditionCache=function(){this._library._commit(!0,!0),this._listenerManager.notify("change")},t.prototype._setRenditionCache=function(e,t,i){this._renditionCache[e]=t,this._commitRenditionCache(),i&&o.storageInterface.notifyDownloadRendition(this)},t.prototype._wrapOperation=function(e,t){var o=this._library._wrapOperation(function(){var o=this._library._wrapOperation(e,t);return this._updateModifiedTime(),o},this);return this._listenerManager.notify("change"),o},t.prototype.jasmineToString=function(){return this.toString()},Object.defineProperties(t.prototype,{id:{get:function(){return this._dcxNode.id},set:function(){throw new a(a.READ_ONLY,"Cannot change the id of an existing element",this._library.id)}},library:{get:function(){return this._library},set:function(){throw new a(a.READ_ONLY,"library is a read-only property",this._library.id)}},writable:{get:function(){return this._library.writable},set:function(){throw new a(a.READ_ONLY,"writable is a read-only property",this.id)}},index:{get:function(){return this._library._elements.indexOf(this)},set:function(){throw new a(a.READ_ONLY,"index is a read-only property",this._library.id)}},name:{get:function(){return this._dcxNode.name||""},set:function(e){if(c.checkDeletedState(this),!this.writable)throw new a(a.NOT_ALLOWED,"you do not have write access to this library",this._library.id);this._dcxNode.name=e,this._commit(!0)}},displayName:{get:function(){return void 0===this._displayName&&(this._displayName=o.getDisplayName(this)||""),this._displayName},set:function(){throw new a(a.READ_ONLY,"displayName is a read-only property",this._library.id)}},type:{get:function(){return this._dcxNode.type},set:function(){throw new a(a.READ_ONLY,"Cannot change the type of an existing element",this._library.id)}},tags:{get:function(){return this._dcxNode.getValue("tags")||[]},set:function(e){if(c.checkDeletedState(this),!this.writable)throw new a(a.NOT_ALLOWED,"you do not have write access to this library",this._library.id);if(!e||e.constructor!==Array)throw new a(a.INVALID_PARAMETER,"tags must be an array",this._library.id);var t=e.every(function(e){return"string"==typeof e});if(!t)throw new a(a.INVALID_PARAMETER,"tags must be an array of strings",this._library.id);this._dcxNode.setValue("tags",e),this._commit()}},category:{get:function(){return this._category},set:function(e){if(c.checkDeletedState(this),!this.writable)throw new a(a.NOT_ALLOWED,"you do not have write access to this library",this._library.id);if(!e&&this._library._categories.length>0||e&&-1===this._library._categories.indexOf(e))throw new a(a.INVALID_PARAMETER,"Invalid category",this._library.id);this._library._removeElementFromFilter(this),this._category=e,this._library._addElementToFilter(this,!0),this._dcxNode.setValue(i.CATEGORY_KEY,e&&e.id),this._commit(!0)}},modified:{get:function(){return this._dcxNode.getValue(i.MODIFIED_KEY)},set:function(){throw new a(a.READ_ONLY,"Cannot change the modified timestamp of an element directly",this._library.id)}},created:{get:function(){return this._dcxNode.getValue(i.CREATED_KEY)},set:function(){throw new a(a.READ_ONLY,"Cannot change the created timestamp of an element directly",this._library.id)}},representations:{get:function(){return this._representations},set:function(){throw new a(a.READ_ONLY,"Cannot modify representation list directly",this._library.id)}},deletedLocally:{get:function(){return this._deletedLocally},set:function(){throw new a(a.READ_ONLY,"deletedLocally is a read-only property",this._library.id)}}}),t.prototype.toString=function(){return JSON.stringify(this._toJSON())},t.prototype.addChangeListener=function(e){c.checkDeletedState(this),this._listenerManager.add("change",e)},t.prototype.removeChangeListener=function(e){this._listenerManager.remove("change",e)},t.prototype.createRepresentation=function(e,t){if(c.checkDeletedState(this),!this.writable)throw new a(a.NOT_ALLOWED,"you do not have write access to this library",this._library.id);return this._wrapOperation(function(){if(e===i.LINK_REPRESENTATION_TYPE)throw new a(a.INVALID_PARAMETER,"Cannot create external link representation directly - use updateContentFromURL instead",this._library.id);if(-1===i.VALID_RELATIONS.indexOf(t))throw new a(a.INVALID_PARAMETER,"Unsupported relationship",this._library.id);if(0===this._representations.length&&"primary"!==t)throw new a(a.INVALID_PARAMETER,"First representation must be primary",this._library.id);if(this._representations.length>0&&"primary"===t){var o=this;this._representations.forEach(function(e){if("primary"===e.relationship)throw new a(a.INVALID_PARAMETER,"Cannot have more than one primary representation",o._library.id)})}var n=this._doCreateRepresentation(e,t);return this._clearRenditionCache(!1,!0),r.reportCreateRepresentation(n),n},this)},t.prototype.createHigherFidelityPrimaryRepresentation=function(e){if(c.checkDeletedState(this),!this.writable)throw new a(a.NOT_ALLOWED,"you do not have write access to this library",this._library.id);return this._wrapOperation(function(){if(e===i.LINK_REPRESENTATION_TYPE)throw new a(a.INVALID_PARAMETER,"Cannot create external link representation directly - use updateContentFromURL instead",this._library.id);var t=this.getPrimaryRepresentation();if(!t)throw new a(a.INVALID_PARAMETER,"Must already have a primary representation",this._library.id);t._dcxComponent?t._dcxComponent.relationship="rendition":t._dcxNode.setValue(i.RELATIONSHIP_KEY,"rendition");var o=this._doCreateRepresentation(e,"primary",!0);return r.reportCreateRepresentation(o),o},this)},t.prototype.removeRepresentation=function(e){if(c.checkDeletedState(this),!this.writable)throw new a(a.NOT_ALLOWED,"you do not have write access to this library",this._library.id);return this._wrapOperation(function(){this._removeRepresentation(e),e._dcxComponent?this._library._dcxBranch.removeComponent(e._dcxComponent):this._library._dcxBranch.removeChild(e._dcxNode),this._clearRenditionCache(!1,!0),r.reportDeleteRepresentation(e),e._markDeletedLocally(!0)},this)},t.prototype.removeAllRepresentations=function(){if(c.checkDeletedState(this),!this.writable)throw new a(a.NOT_ALLOWED,"you do not have write access to this library",this._library.id);return this._wrapOperation(function(){for(;this._representations[0];)this.removeRepresentation(this._representations[0])},this)},t.prototype.getPrimaryRepresentation=function(){var e;return this._representations.forEach(function(t){e||"primary"!==t.relationship||(e=t)}),e},t.prototype._getRenditionCandidate=function(e){var t,o,i,n,r,a,s,c,l=0;for(o=0;o<this._representations.length&&(i=this._representations[o],n=Math.max(i.width||0,i.height||0),r=i.isFullSize?Number.POSITIVE_INFINITY:n,a="primary"===i.relationship,s="rendition"===i.relationship,c=!t||a&&"primary"!==t.relationship||s&&"primary"!==t.relationship&&"rendition"!==t.relationship||s&&"rendition"===t.relationship&&r>l,c&&d.canComputeRendition(i)&&(t=i,l=r),!s||"image/png"!==i.type||!e||n!==e);o++);return t},t.prototype.getRenditionUrl=function(e,t){var o=this;c.checkDeletedState(this,t)||this._library._waitForCommit(function(){if(!c.checkDeletedState(o,t)){var i=o._getRenditionCandidate(e);if(i){var n=o._library._collection._syncManager;return void n.getSharedCloudRenditionUrl(i,e,t)}t(new a(a.RENDITION_NOT_AVAILABLE,"no representation that can be converted into a rendition",o._library.id))}})},t.prototype.getRenditionPath=function(e,t){var n=this;return o.hasFileSystem()?void(c.checkDeletedState(this,t)||this._library._waitForCommit(function(){if(!c.checkDeletedState(n,t)){if(i.SHARED_LOCAL_STORAGE)return void o.storageInterface.getRenditionPath(n,e,t);var r=function(e,o){n._lock.release(),t(e,o)};n._lock.obtain(function(){if(!c.checkDeletedState(n,r)){var t=this._lookupRenditionPath(e||"full");if(t)return void r(null,t);var i=this._getRenditionCandidate(e);if(i){if("rendition"===i.relationship&&"image/png"===i.type&&e&&Math.max(i.width||0,i.height||0)===e)return void i.getContentPath(r);var s=this._library._collection._syncManager;return void s.getSharedCloudRendition(i,e,function(t,i){return c.checkDeletedState(n,r)?void 0:t?void r(new a(a.RENDITION_NOT_AVAILABLE,"error generating rendition from shared cloud",n._library.id,t)):void n._getNewRenditionPath(void 0,function(t,a,s){if(!c.checkDeletedState(n,r)){if(t)return void r(p.getCommitError(t,n._library.id,"unable to create rendition cache directory"));n._library._pendingRenditionCacheItems[s]=!0,o.fs.rename(i,a,function(t){if(!c.checkDeletedState(n,r)){if(t)return void r(p.getCommitError(t,n._library.id,"unable to write rendition to cache"));n._setRenditionCache(e||"full",s,!0),r(null,a)}})}})})}r(new a(a.RENDITION_NOT_AVAILABLE,"no representation that can be converted into a rendition",n._library.id))}},n)}})):void t(new a(a.REQUIRES_FILESYSTEM,"path-based APIs require a filesystem",this._library.id))},t.prototype.setRenditionCache=function(e,t,n){if("string"!=typeof t)return void n(new a(a.INVALID_PARAMETER,"path must be a string",this._library.id));if(!o.hasFileSystem())return void n(new a(a.REQUIRES_FILESYSTEM,"path-based APIs require a filesystem",this._library.id));if(!c.checkDeletedState(this,n)){if(!this.writable)return void n(new a(a.NOT_ALLOWED,"you do not have write access to this library",this._library.id));if(i.SHARED_LOCAL_STORAGE)return void o.storageInterface.setRenditionCache(this,e,t,n);var r=this,s=function(e,t){r._lock.release(),n(e,t)};this._lock.obtain(function(){c.checkDeletedState(r,s)||this._getNewRenditionPath(l.getFileExtension(t),function(o,i,n){if(!c.checkDeletedState(r,s)){if(o)return void s(p.getCommitError(o,r._library.id,"unable to create rendition cache directory"));r._library._pendingRenditionCacheItems[n]=!0,l.copyFile(t,i,function(t){if(!c.checkDeletedState(r,s)){if(t)return void s(p.getCommitError(t,r._library.id,"unable to write rendition to cache"));r._setRenditionCache(e||"full",n,!1),s(null,i)}})}})},this)}},t.prototype.getReference=function(){return c.getElementReference(this.library._collection._syncManager._storageHost,this.library.id,this.id)},t.prototype.getRepresentationById=function(e){var t;return this.representations.forEach(function(o){o.id===e&&(t=o)}),t},t}),i("AdobeLibraryCategory",["require","exports","module","./AdobeLibraryError","./utils/AdobeLibraryManifestUtils"],function(e){function t(e,t){this._library=e,this._dcxNode=t,this._deletedLocally=!1}var o=e("./AdobeLibraryError"),i=e("./utils/AdobeLibraryManifestUtils");return t.prototype._markDeletedLocally=function(e){this._deletedLocally=e},t.prototype._toJSON=function(){var e={id:this.id,name:this.name};return e},t.prototype.jasmineToString=function(){return this.toString()},Object.defineProperties(t.prototype,{id:{get:function(){return this._dcxNode.id},set:function(){throw new o(o.READ_ONLY,"Cannot change the id of an existing category",this._library.id)}},writable:{get:function(){return this._library.writable},set:function(){throw new o(o.READ_ONLY,"writable is a read-only property",this._library.id)}},name:{get:function(){return this._dcxNode.name},set:function(e){if(i.checkDeletedState(this),!this.writable)throw new o(o.NOT_ALLOWED,"you do not have write access to this library",this._library.id);this._dcxNode.name=e,this._library._commit()}},deletedLocally:{get:function(){return this._deletedLocally},set:function(){throw new o(o.READ_ONLY,"deletedLocally is a read-only property",this._library.id)}}}),t.prototype.toString=function(){return JSON.stringify(this._toJSON())},t}),i("AdobeLibraryComposite",["require","exports","module","./components/dcx-js/src/AdobeDCXError","./AdobeLibraryElement","./AdobeLibraryCategory","./AdobeLibraryConfig","./AdobeLibraryAnalytics","./AdobeLibraryError","./AdobeLibraryServices","./utils/AdobeLibraryAsyncJoin","./utils/AdobeLibraryLock","./utils/AdobeLibraryRenditionUtils","./utils/AdobeLibraryManifestUtils","./utils/AdobeLibraryErrorUtils","./utils/AdobeLibraryFileUtils","./utils/AdobeLibraryListenerManager"],function(e){function t(e,t){var o=this;this._collection=e,this._dcxComposite=t,this._dcxBranch=t.current,this._listenerManager=new f(["change"]),this._writable=!0,this._filterCache={},this._transactionCount=0,this._commitInProgress=!1,this._pendingCommit=!1,this._onCommitCallbacks=[],this._renditionCacheLock=new d,this._pendingRenditionCacheItems={},this._networkLock=new d,this._syncState=void 0,this._deletedLocally=!1,this._deletedFromServer=!1,this._waitForSyncToFinishCallbacks=[],this._errors=[],this._pushFailedDueToQuota=!1,this._numUpdateConflicts=0;var a=this._dcxBranch.getChildrenOf();a.forEach(function(e){e.name===r.ELEMENTS_NAME?o._dcxElementsNode=e:e.name===r.CATEGORIES_NAME&&(o._dcxCategoriesNode=e)}),this._dcxElementsNode||(this._dcxElementsNode=this._dcxBranch.addChild(r.ELEMENTS_NAME)),this._dcxCategoriesNode||(this._dcxCategoriesNode=this._dcxBranch.addChild(r.CATEGORIES_NAME)),this._categories=[];var s=this._dcxBranch.getChildrenOf(this._dcxCategoriesNode);s.forEach(function(e){var t=new n(o,e);o._categories.push(t)}),this._elements=[];var l=this._dcxBranch.getChildrenOf(this._dcxElementsNode);l.forEach(function(e){var t=new i(o,e);o._addElementToFilter(t),o._elements.push(t)}),c.hasFileSystem()||(this._dcxBaseBranch=this._dcxBranch.copy())}var o=e("./components/dcx-js/src/AdobeDCXError"),i=e("./AdobeLibraryElement"),n=e("./AdobeLibraryCategory"),r=e("./AdobeLibraryConfig"),a=e("./AdobeLibraryAnalytics"),s=e("./AdobeLibraryError"),c=e("./AdobeLibraryServices"),l=e("./utils/AdobeLibraryAsyncJoin"),d=e("./utils/AdobeLibraryLock"),p=e("./utils/AdobeLibraryRenditionUtils"),h=e("./utils/AdobeLibraryManifestUtils"),u=e("./utils/AdobeLibraryErrorUtils"),_=e("./utils/AdobeLibraryFileUtils"),f=e("./utils/AdobeLibraryListenerManager");return t.prototype._markDeletedLocally=function(e){this._deletedLocally=e,this._categories.forEach(function(t){t._markDeletedLocally(e)}),this._elements.forEach(function(t){t._markDeletedLocally(e)}),e&&this._listenerManager.removeAll()},t.prototype._removeAllListeners=function(){this._listenerManager.removeAll(),this._elements.forEach(function(e){e._removeAllListeners()})},t.prototype._toJSON=function(){var e={id:this.id,name:this.name,categories:[],elements:[],renditionCache:{}};return this._categories.forEach(function(t){e.categories.push(t._toJSON())}),this._elements.forEach(function(t){e.elements.push(t._toJSON()),e.renditionCache[t.id]=JSON.parse(JSON.stringify(t._renditionCache))}),e},t.prototype._getRenditionCache=function(){var e={};return this._elements.forEach(function(t){e[t.id]=JSON.parse(JSON.stringify(t._renditionCache))}),e},t.prototype._setRenditionCache=function(e){this._elements.forEach(function(t){e[t.id]&&(t._renditionCache=e[t.id])})},t.prototype._loadRenditionCache=function(e){var t=this;p.readRenditionCacheData(this,function(o,i){!o&&i&&(t._setRenditionCache(i.renditions),i.hasOwnProperty("collaboration")&&t._setCollaboration(i.collaboration)),e(null)})},t.prototype._saveRenditionCache=function(e){var t=this;if(!c.hasFileSystem()||r.SHARED_LOCAL_STORAGE)return void(e&&e(null));var o=function(o){t._renditionCacheLock.release(),e&&e(o)};this._renditionCacheLock.obtain(function(){var e={};e.renditions=this._getRenditionCache(),e.collaboration=this.collaboration,p.writeRenditionCacheData(this,e,o)},this)},t.prototype._doCommit=function(e){function t(){if(e&&!r.SHARED_LOCAL_STORAGE){if(n._deletedLocally)return;n._collection._clearSyncErrors(),n._push(),n._collection._resetPollBackoff()}}function o(){var e=n._onCommitCallbacks;n._onCommitCallbacks=[],e.forEach(function(e){n._waitForCommit(e)}),t()}function i(e,t){e&&(e=u.getCommitError(e,n.id,t)),n._collection._reportCommitError(e)}var n=this;return c.hasFileSystem()?this._commitInProgress?void(this._pendingCommit=!0):(this._commitInProgress=!0,void c.storageInterface.commitManifest(this,function(t){i(t,"Failed to write composite to disk"),n._saveRenditionCache(function(t){i(t,"Failed to write rendition cache to disk"),n._commitInProgress=!1,n._pendingCommit?(n._pendingCommit=!1,0===n._transactionCount&&n._doCommit(e)):o()})})):void o()},t.prototype._waitForCommit=function(e){this._commitInProgress||this._transactionCount>0?this._onCommitCallbacks.push(e):e()},t.prototype._notifyChange=function(){this._listenerManager.notify("change"),this._collection._notifyChange()},t.prototype._commit=function(e,t){0===this._transactionCount&&(t||(this._updateModifiedTime(),this._notifyChange()),this._doCommit(!e))},t.prototype._wrapOperation=function(e,t){this.beginOperation();var o;try{o=e.call(t)}catch(i){throw this._transactionCount--,i}return this.endOperation(),o},t.prototype._updateModifiedTime=function(){var e=(new Date).valueOf();this._dcxBranch.rootNode.setValue(r.MODIFIED_KEY,e)},t.prototype._updateCreatedTime=function(){var e=(new Date).valueOf();this._dcxBranch.rootNode.setValue(r.CREATED_KEY,e),this._dcxBranch.rootNode.setValue(r.MODIFIED_KEY,e)},t.prototype._ensureOrder=function(e,t,o,i){var n=this[e],r="_categories"===e?this._dcxCategoriesNode:this._dcxElementsNode,a=n.indexOf(t),c=n.indexOf(o);if(-1===a||-1===c)throw new s(s.INVALID_PARAMETER,"Items not found",this.id);a!==c&&c!==a+1&&(i?(n.splice(a,1),c=n.indexOf(o),n.splice(c,0,t),this._dcxBranch.moveChild(t._dcxNode,c,r)):(n.splice(c,1),a=n.indexOf(t),n.splice(a+1,0,o),this._dcxBranch.moveChild(o._dcxNode,a+1,r)))},t.prototype._getFilterKey=function(e,t){var o=e&&-1!==r.ELEMENT_TYPE_FILTERS.indexOf(e);return(o?e:"*")+"_"+(t?t.id:"*")},t.prototype._removeElementFromFilter=function(e){var t=this._getFilterKey(e.type,e.category);if(this._filterCache[t]){var o=this._filterCache[t].indexOf(e);-1!==o&&this._filterCache[t].splice(o,1)}},t.prototype._addElementToFilter=function(e,t){var o=this._getFilterKey(e.type,e.category);this._filterCache[o]=this._filterCache[o]||[],this._filterCache[o].push(e),t&&this._ensureFilterOrderForElement(e)},t.prototype._ensureFilterOrderForElement=function(e){var t=this._getFilterKey(e.type,e.category);this._filterCache[t]=this._filterCache[t]||[];var o=this._elements;this._filterCache[t].sort(function(e,t){var i=o.indexOf(e),n=o.indexOf(t);return n>i?-1:i>n?1:0})},t.prototype._doCreateElement=function(e,t,o,n){var a=this._dcxBranch.addChild(e,void 0,n,this._dcxElementsNode);a.path=a.id,a.type=t,o&&a.setValue(r.CATEGORY_KEY,o.id);var s=new i(this,a);return s._updateCreatedTime(),void 0!==n&&n>=0&&n<this._elements.length?this._elements.splice(n,0,s):this._elements.push(s),this._addElementToFilter(s,void 0!==n),s},t.prototype._doRemoveElement=function(e,t){var o=this._elements.indexOf(e);-1!==o&&this._elements.splice(o,1),this._removeElementFromFilter(e),t&&this._dcxBranch.removeChild(e._dcxNode),e._markDeletedLocally(!0)},t.prototype._doCopyDCXElement=function(e,t,o,n,r){var a=this;t.beginOperation(),c.storageInterface.notifyStartWrite(t,[this],function(){t._dcxBranch.copyChild(e._dcxNode,t._dcxElementsNode,void 0,n,n,function(n,s){if(!h.checkDeletedState(a,r)){if(n)return t.endOperation(),void r(n);var l=new i(t,s);t._addElementToFilter(l),t._elements.push(l);var d=function(){h.checkDeletedState(a,r)||(t.endOperation(),o&&a._wrapOperation(function(){a._doRemoveElement(e,!0)}),r(null,l))};c.hasFileSystem()?p.copyRenditionCache(l,e,e._renditionCache,d):d()}})})},t.prototype._doCopyElement=function(e,t,o,i){if(e._library!==this||-1===this._elements.indexOf(e))return void i(new s(s.INVALID_PARAMETER,"element doesn't exist in library",this.id));if(t._elements.length>=r.MAX_ELEMENTS)return void i(new s(s.EXCEEDS_MAX_LIBRARY_SIZE,"Library cannot have more than "+r.MAX_ELEMENTS+" elements",this.id));var n=e.id,a=t._elements.every(function(e){return e.id!==n});a||(n=c.uuid()),this._doCopyDCXElement(e,t,o,n,i)},t.prototype.jasmineToString=function(){return this.toString()},t.prototype._setSyncState=function(e){this._syncState!==e&&(this._syncState=e,this._collection._updateSyncState(),this._checkSyncFinishedAndNotify())},t.prototype._isSyncing=function(){return void 0!==this._syncState},t.prototype._checkSyncFinishedAndNotify=function(){if(!this._isSyncing()){var e=this._waitForSyncToFinishCallbacks;this._waitForSyncToFinishCallbacks=[],e.forEach(function(e){e()})}},t.prototype._waitForSyncToFinish=function(e){this._waitForSyncToFinishCallbacks.push(e),this._checkSyncFinishedAndNotify()},t.prototype._setCollaboration=function(e){if(this.collaboration!==e){var t=h.collaborationStateToDCX(e);this._dcxComposite.collaborationType=t,this._commit(!0,!0),this._notifyChange()}},t.prototype._isDeletedError=function(e){var t=e&&(e.code===o.NO_COMPOSITE||e.code===o.DELETED_COMPOSITE),i=e&&e.code===o.UNEXPECTED_RESPONSE&&e.response&&401===e.response.statusCode;return t||this.collection.isPublic&&i},t.prototype._mergeAndSwitchToBranch=function(e,t,o){function n(t,n){if(!h.checkDeletedState(s,o)){if(t)return void o(u.getCommitError(t,s.id));c.log("Starting merge "+(d?"(local)":"(remote)")),n.name!==s.name&&(e.name=s.name);var f=e.rootNode.getValue(r.MODIFIED_KEY),m=Math.max(f||0,s.modified||0);m&&f!==m&&e.rootNode.setValue(r.MODIFIED_KEY,m);var y,v,g=e.getChildrenOf();g.forEach(function(e){e.name===r.ELEMENTS_NAME?y=e:e.name===r.CATEGORIES_NAME&&(v=e)}),y||(y=e.addChild(r.ELEMENTS_NAME)),v||(v=e.addChild(r.CATEGORIES_NAME));var A={},E=[],b=[],C=new l;s._elements.forEach(function(t){var o=t.id,l=t._dcxNode,h=t.modified,u=e.getChildWithId(o),_=u&&u.getValue(r.MODIFIED_KEY),f=n&&n.getChildWithId(o),m=f&&f.getValue(r.MODIFIED_KEY);if(h&&_&&!m&&(m=0),s._dcxBranch=e,!m&&!_||m&&!_&&h!==m){c.log("1: created locally");var v=e.copyChild(l,y,void 0,void 0,void 0);t._setDCXNode(v,!0)}else if(m&&!_&&h===m)c.log("2: deleted on server"),b.push(t);else if(m===h&&m===_)c.log("3: no changes"),t._setDCXNode(u,!0);else if(m===h&&m!==_)c.log("4: updated on server"),t._setDCXNode(u,d),E.push(t);else if(m!==h&&m===_){c.log("5: updated locally");var g=e.replaceChild(l,void 0,void 0);t._setDCXNode(g,!0)}else if(m!==h&&m!==_){c.log("6: updated locally and on server (conflict)");var L=t._renditionCache;t._setDCXNode(u),E.push(t);var S=c.uuid(),w=e.copyChild(l,y,void 0,S,S),R=new i(s,w);s._addElementToFilter(R),s._elements.push(R),A[R.id]=!0,c.hasFileSystem()&&C.addOperation(p.copyRenditionCache,[R,t,L]),a.reportCollisionElement(t)}else c.log("ERROR: unexpected merge case: base="+m+", current="+h+", pulled="+_);s._dcxBranch=s._dcxComposite.current,A[o]=!0}),b.forEach(function(e){s._doRemoveElement(e,!1)
}),s._dcxBranch=e,s._dcxElementsNode=y,s._dcxCategoriesNode=v;var L=s._dcxBranch.getChildrenOf(s._dcxElementsNode);L.forEach(function(t){if(!A[t.id]){var o=t.getValue(r.MODIFIED_KEY),a=n&&n.getChildWithId(t.id),l=a&&a.getValue(r.MODIFIED_KEY);if(l&&o&&l===o)c.log("7: deleted locally"),e.removeChild(t);else{c.log("8: created on server");var d=new i(s,t);s._addElementToFilter(d),s._elements.push(d)}}}),s._transactionCount++,C.run(function(){h.checkDeletedState(s,o)||(s._transactionCount--,c.storageInterface.resolvePullWithBranch(s,e,_,d,function(t){if(!h.checkDeletedState(s,o)){if(t)return void o(u.getCommitError(t,s.id));c.hasFileSystem()||(s._dcxBaseBranch=e.copy()),r.SHARED_LOCAL_STORAGE||d||p.prefetchRenditions(s),E.forEach(function(e){e._listenerManager.notify("change")}),s._notifyChange(),o(null)}}))})}}var s=this,d=void 0!==t,_=e.localData;this._waitForCommit(function(){h.checkDeletedState(s,o)||(t?n(null,t):"unmodified"===s._dcxBranch.compositeState?n(null,s._dcxBranch):c.hasFileSystem()?s._dcxComposite.loadBaseBranch(n):n(null,s._dcxBaseBranch))})},t.prototype._pull=function(e){var t=this;if(!this._dcxComposite.href||!this._dcxBranch.isBound)return void e(null,!1);if(this._deletedFromServer)return void e(null,!1);var o=function(o,i){h.checkDeletedState(t,e)||(o&&t._collection._reportSyncError(o),t._setSyncState(),t._networkLock.release(),e(o,i))};this._networkLock.obtain(function(i){return i?void e(null):void(h.checkDeletedState(t,e)||(this._setSyncState("downloading"),this._collection._syncManager.pullComposite(this._dcxComposite,this._collection,function(i,n){return h.checkDeletedState(t,e)?void 0:t._isDeletedError(i)?void(c.hasFileSystem()&&"modified"===t._dcxBranch.compositeState&&"incoming"!==t.collaboration?(t._doRebindToServer(e),t._networkLock.release()):(t._deletedFromServer=!0,t._notifyChange(),o(null,!0))):i?void o(u.getSyncError(i,t.id)):n?void t._mergeAndSwitchToBranch(n,void 0,function(i){h.checkDeletedState(t,e)||o(i,!0)}):void o(null,!1)})))},this)},t.prototype._pushWithParameters=function(e,t){var i=this,n=function(e,o){t&&t(null,o)};if(!r.SYNCING_ENABLED)return void n(null,!1);if(this._collection._retryTimeoutId)return void n(null,!1);if(this._dcxBranch.isBound&&"modified"!==this._dcxBranch.compositeState)return void n(null,!1);if(this._deletedFromServer)return void n(null,!1);if(!this.writable)return void n(null,!1);if(this._pushPending)return void n(null,!1);var l=function(e,t){h.checkDeletedState(i,n)||(i._pushFailedDueToQuota=!1,e&&(i._collection._reportSyncError(e),e.code===s.EXCEEDS_QUOTA&&(i._pushFailedDueToQuota=!0)),i._setSyncState(),i._networkLock.release(),n(null,t))};this._pushPending=!0,this._networkLock.obtain(function(t){return t?void n(null,!1):void this._waitForCommit(function(){if(!h.checkDeletedState(i,n)){i._pushPending=!1;var t;c.hasFileSystem()||(t=i._dcxBranch.copy()),i._setSyncState("uploading"),i._collection._syncManager.pushComposite(i._dcxComposite,i._collection,e,function(e){if(!h.checkDeletedState(i,n)){if(i._isDeletedError(e))return void(c.hasFileSystem()&&"modified"===i._dcxBranch.compositeState&&"incoming"!==i.collaboration?(i._doRebindToServer(n),i._networkLock.release()):(i._deletedFromServer=!0,i._notifyChange(),l(null,!0)));if(e&&e.code===s.TRANSFER_ABORTED)return void l(null,!0);if(e&&e.code===o.UPDATE_CONFLICT){if(c.log("Push failed due to conflict: "+i.id),i._numUpdateConflicts++,i._numUpdateConflicts<=r.MAX_UPDATE_CONFLICTS)return i._sync(!1,n),void i._networkLock.release();a.reportUnexpectedState(i,"updateConflict"),c.log("Reached maximum number of update-conflict retries: "+i.id)}return i._numUpdateConflicts=0,e&&e.code===o.COMPONENT_UPLOAD_ERROR&&(c.log("Push failed due to component upload failure: "+i.id),h.removeMissingLocalComponents(i,e.failedComponents)),e?void l(u.getSyncError(e,i.id)):void c.storageInterface.acceptPush(i,function(e){if(!h.checkDeletedState(i,n)){if(e)return void l(u.getCommitError(e,i.id),!0);c.hasFileSystem()||(i._dcxBaseBranch=t),l(null,!0)}})}})}})},this)},t.prototype._push=function(e){this._pushWithParameters(!1,e)},t.prototype._abortPushOrPull=function(){this._networkLock.abortPendingOperations(new s(s.TRANSFER_ABORTED)),this._collection._syncManager.abortPushOrPull(this.id)},t.prototype._deleteFromServer=function(e,t){var i=this;if(!this._dcxComposite.href||!this._dcxBranch.isBound)return void t(null);if(this._deletedFromServer)return void t(null);this._deletingFromServerInProgress||this._abortPushOrPull(),this._deletingFromServerInProgress=!0;var n=function(e){i._deletingFromServerInProgress=!1,i._networkLock.release(),t(e)};this._networkLock.obtain(function(r){return r?void t(null):this._deletedFromDisk?void n(null):(this._setSyncState("uploading"),this._dcxBranch.compositeState="pendingDelete",this._commit(!0,!0),void this._waitForCommit(function(){return i._deletedFromDisk?void n(null):void i._collection._syncManager.pushDeletedComposite(i._dcxComposite,i._collection,i.collaboration,e,function(t){t?i._isDeletedError(t)?t=null:(e||t.code!==o.UPDATE_CONFLICT)&&(t=u.getSyncError(t,i.id),i._collection._reportSyncError(t)):i._deletedFromServer=!0,i._setSyncState(),n(t)})}))},this)},t.prototype._doRebindToServer=function(e){var t=this;this._deletedFromServer=!1;var o="incoming"===this.collaboration?"resetIdentity":"resetBinding",i=this.id;this._dcxComposite[o](function(o){if(!h.checkDeletedState(t,e)){if(o)return void e(o);t._transactionCount++,t.id!==i&&(t._collection._libraryIdMap[t.id]=t,delete t._collection._libraryIdMap[i]),_.moveLibrary(t,i,function(o){if(!h.checkDeletedState(t,e)){if(t._transactionCount--,o)return void e(o);t._collection._syncManager.prepareCompositeForPush(t._dcxComposite),t._setCollaboration(),t._commit(!1,!0),t._pushWithParameters(!0,e)}})}})},t.prototype._sync=function(e,t){function o(e,o){t&&n._waitForSyncToFinish(function(){t(e,o)})}function i(e,t){return h.checkDeletedState(n,o)?void 0:e?void o(e,t):void n._push(function(e,i){h.checkDeletedState(n,o)||o(e,t||i)})}var n=this;return r.SHARED_LOCAL_STORAGE||!r.SYNCING_ENABLED?void o(null,!1):this._collection._retryTimeoutId?void o(null,!1):(this._collection._clearSyncErrors(this.id),void(e?i(null,!1):this._pull(i)))},t.prototype._getCompositeDir=function(){return this._collection._getCompositeDir(this.id)},t.prototype._getRenditionCacheDir=function(){return this._collection._getRenditionCacheDir(this.id)},Object.defineProperties(t.prototype,{id:{get:function(){return this._publicId||this._dcxComposite.id},set:function(){throw new s(s.READ_ONLY,"Cannot change the id of an existing library",this.id)}},collection:{get:function(){return this._collection},set:function(){throw new s(s.READ_ONLY,"collection is a read-only property",this.id)}},writable:{get:function(){return this._writable},set:function(){throw new s(s.READ_ONLY,"writable is a read-only property",this.id)}},name:{get:function(){return this._dcxComposite.name||""},set:function(e){if(h.checkDeletedState(this),!this.writable)throw new s(s.NOT_ALLOWED,"you do not have write access to this library",this.id);this._dcxComposite.name=e,this._commit()}},modified:{get:function(){return this._dcxBranch.rootNode.getValue(r.MODIFIED_KEY)},set:function(){throw new s(s.READ_ONLY,"Cannot change the modified timestamp of a library directly",this.id)}},created:{get:function(){return this._dcxBranch.rootNode.getValue(r.CREATED_KEY)},set:function(){throw new s(s.READ_ONLY,"Cannot change the created timestamp of a library directly",this.id)}},categories:{get:function(){return this._categories},set:function(){throw new s(s.READ_ONLY,"Cannot modify categories list directly",this.id)}},elements:{get:function(){return this._elements},set:function(){throw new s(s.READ_ONLY,"Cannot modify elements list directly",this.id)}},deletedFromServer:{get:function(){return this._deletedFromServer},set:function(){throw new s(s.READ_ONLY,"deletedFromServer is a read-only property",this.id)}},deletedLocally:{get:function(){return this._deletedLocally},set:function(){throw new s(s.READ_ONLY,"deletedLocally is a read-only property",this.id)}},quotaExceeded:{get:function(){return this._pushFailedDueToQuota},set:function(){throw new s(s.READ_ONLY,"quotaExceeded is a read-only property",this.id)}},collaboration:{get:function(){var e=this._dcxComposite.collaborationType;return h.collaborationStateFromDCX(e)},set:function(){throw new s(s.READ_ONLY,"collaboration is a read-only property",this.id)}},syncState:{get:function(){return this._syncState},set:function(){throw new s(s.READ_ONLY,"syncState is a read-only property")}},syncProgress:{get:function(){var e=this._collection._syncProgressMap[this.id];return e&&e.progress},set:function(){throw new s(s.READ_ONLY,"syncProgress is a read-only property")}}}),t.prototype.toString=function(){return JSON.stringify(this._toJSON())},t.prototype.addChangeListener=function(e){h.checkDeletedState(this),this._listenerManager.add("change",e)},t.prototype.removeChangeListener=function(e){this._listenerManager.remove("change",e)},t.prototype.createElement=function(e,t,o,i){if(h.checkDeletedState(this),!this.writable)throw new s(s.NOT_ALLOWED,"you do not have write access to this library",this.id);if(this._elements.length>=r.MAX_ELEMENTS)throw new s(s.EXCEEDS_MAX_LIBRARY_SIZE,"Library cannot have more than "+r.MAX_ELEMENTS+" elements",this.id);if(!o&&this._categories.length>0)throw new s(s.INVALID_PARAMETER,"Must provide a category for a new element, if the library has categories",this.id);if(o&&-1===this._categories.indexOf(o))throw new s(s.INVALID_PARAMETER,"Invalid category",this.id);return this._wrapOperation(function(){var n=this._doCreateElement(e,t,o,i);return a.reportCreateElement(n),n},this)},t.prototype.removeElement=function(e){if(h.checkDeletedState(this),!this.writable)throw new s(s.NOT_ALLOWED,"you do not have write access to this library",this.id);return this._wrapOperation(function(){this._doRemoveElement(e,!0),a.reportDeleteElement(e)},this)},t.prototype.moveElementAfter=function(e,t){if(h.checkDeletedState(this),!this.writable)throw new s(s.NOT_ALLOWED,"you do not have write access to this library",this.id);return this._wrapOperation(function(){this._ensureOrder("_elements",t,e),this._ensureFilterOrderForElement(e)},this)},t.prototype.moveElementBefore=function(e,t){if(h.checkDeletedState(this),!this.writable)throw new s(s.NOT_ALLOWED,"you do not have write access to this library",this.id);return this._wrapOperation(function(){this._ensureOrder("_elements",e,t,!0),this._ensureFilterOrderForElement(e)},this)},t.prototype.copyElement=function(e,t,o){return h.checkDeletedState(this,o)?void 0:e?t?t.writable?this._doCopyElement(e,t,!1,function(t,i){return t?void o(t):(a.reportCopyElement(i,e),void o(null,i))}):void o(new s(s.NOT_ALLOWED,"you do not have write access to this library",t.id)):void o(new s(s.INVALID_PARAMETER,"No destination library specified",this.id)):void o(new s(s.INVALID_PARAMETER,"No element specified",this.id))},t.prototype.moveElement=function(e,t,o){return h.checkDeletedState(this,o)?void 0:this.writable?e?t?this===t?void o(new s(s.INVALID_PARAMETER,"Move must have a different destination library",this.id)):this._doCopyElement(e,t,!0,function(t,i){return t?void o(t):(a.reportMoveElement(i,e),void o(null,i))}):void o(new s(s.INVALID_PARAMETER,"No destination library specified",this.id)):void o(new s(s.INVALID_PARAMETER,"No element specified",this.id)):void o(new s(s.NOT_ALLOWED,"you do not have write access to this library",this.id))},t.prototype.createCategory=function(e,t){if(h.checkDeletedState(this),!this.writable)throw new s(s.NOT_ALLOWED,"you do not have write access to this library",this.id);return this._wrapOperation(function(){var o=this._dcxBranch.addChild(e,void 0,t,this._dcxCategoriesNode),i=new n(this,o);return void 0!==t&&t>=0&&t<this._categories.length?this._categories.splice(t,0,i):this._categories.push(i),1===this._categories.length&&this._elements.forEach(function(e){e.category=i}),i},this)},t.prototype.removeCategory=function(e,t,o){if(h.checkDeletedState(this),!this.writable)throw new s(s.NOT_ALLOWED,"you do not have write access to this library",this.id);return this._wrapOperation(function(){function i(){n._dcxBranch.removeChild(e._dcxNode),n._categories.splice(r,1),e._markDeletedLocally(!0)}var n=this,r=this._categories.indexOf(e);if(-1===r)throw new s(s.INVALID_PARAMETER,"Category not found",this.id);if(t){var a=[];this._elements.forEach(function(t){t.category===e&&a.push(t)}),a.forEach(function(e){n.removeElement(e)}),i()}else{if(1===this._categories.length){if(void 0!==o)throw new s(s.INVALID_PARAMETER,"Invalid replacement category",this.id)}else{var c=!1;if(this._elements.forEach(function(t){t.category===e&&(c=!0)}),c){var l=o&&-1!==this._categories.indexOf(o)&&o!==e;if(!l)throw new s(s.INVALID_PARAMETER,"Invalid replacement category",this.id)}}i(),this._elements.forEach(function(t){t.category===e&&(t.category=o)})}},this)},t.prototype.moveCategoryAfter=function(e,t){if(h.checkDeletedState(this),!this.writable)throw new s(s.NOT_ALLOWED,"you do not have write access to this library",this.id);return this._wrapOperation(function(){this._ensureOrder("_categories",t,e)},this)},t.prototype.moveCategoryBefore=function(e,t){if(h.checkDeletedState(this),!this.writable)throw new s(s.NOT_ALLOWED,"you do not have write access to this library",this.id);return this._wrapOperation(function(){this._ensureOrder("_categories",e,t,!0)},this)},t.prototype.beginOperation=function(){if(h.checkDeletedState(this),!this.writable)throw new s(s.NOT_ALLOWED,"you do not have write access to this library",this.id);this._transactionCount++},t.prototype.endOperation=function(){if(h.checkDeletedState(this),!this.writable)throw new s(s.NOT_ALLOWED,"you do not have write access to this library",this.id);this._transactionCount--,this._commit()},t.prototype.getFilteredElements=function(e,t){if(!e)throw new s(s.INVALID_PARAMETER,"must specify element type to filter",this.id);if("*"!==e&&-1===r.ELEMENT_TYPE_FILTERS.indexOf(e))throw new s(s.INVALID_PARAMETER,"must specify '*', or an element type in config.ELEMENT_TYPE_FILTERS",this.id);var o=this._getFilterKey(e,t);return this._filterCache[o]=this._filterCache[o]||[],this._filterCache[o]},t.prototype.sync=function(e){h.checkDeletedState(this,e)||this._sync(!1,e)},t.prototype.rebindToServer=function(e){if(!c.hasFileSystem())return void e(new s(s.REQUIRES_FILESYSTEM,"rebindToServer requires a filesystem",this.id));if(!h.checkDeletedState(this,e))return this.writable?this._deletedFromServer?void this._doRebindToServer(e):void e(null):void e(new s(s.NOT_ALLOWED,"you do not have write access to this library",this.id))},t.prototype.getElementById=function(e){var t;return this.elements.forEach(function(o){o.id===e&&(t=o)}),t},t}),i("AdobeLibrarySyncManager",["require","exports","module","./components/dcx-js/src/AdobeStorageSession","./components/dcx-js/src/AdobeDCXCompositeXfer","./components/dcx-js/src/AdobeDCXUtil","./components/dcx-js/src/AdobeDCXError","./AdobeLibraryConfig","./AdobeLibraryError","./AdobeLibraryServices","./utils/AdobeLibrarySyncUtils","./utils/AdobeLibraryErrorUtils","./utils/AdobeLibraryFileUtils","./utils/AdobeLibraryManifestUtils"],function(t){function o(e,t){this._collection=e,this._isPublic=t.IS_PUBLIC,this._storageHost=t.STORAGE_HOSTNAME,this._storageAssetsPath=this._isPublic?s.PUBLIC_STORAGE_ASSETS_PATH:s.STORAGE_ASSETS_PATH,this._apiKey=s.STORAGE_API_KEY,this._syncGroup=this._isPublic?s.PUBLIC_LIBRARY_SYNC_GROUP:s.LIBRARY_SYNC_GROUP,this._XHR=t.XHR,this._getAccessToken=t.getAccessToken,this._httpServices=[],this._storageService=this._createStorageSession(),this._renditionStorageService=this._createStorageSession(),this._temporaryStorageServices={},this._lastSyncGroupState={},this._hasSetAuthToken=!1,this._authToken=void 0,this._inProgressSyncMap={},s.SHARED_LOCAL_STORAGE||this._isPublic||this._updateAuthToken()}var i=t("./components/dcx-js/src/AdobeStorageSession"),n=t("./components/dcx-js/src/AdobeDCXCompositeXfer"),r=t("./components/dcx-js/src/AdobeDCXUtil"),a=t("./components/dcx-js/src/AdobeDCXError"),s=t("./AdobeLibraryConfig"),c=t("./AdobeLibraryError"),l=t("./AdobeLibraryServices"),d=t("./utils/AdobeLibrarySyncUtils"),p=t("./utils/AdobeLibraryErrorUtils"),h=t("./utils/AdobeLibraryFileUtils"),u=t("./utils/AdobeLibraryManifestUtils");return o.prototype._getNodeTunnelOptions=function(){if(void 0===this.NODE_TUNNEL_OPTIONS){this.NODE_TUNNEL_OPTIONS={};var t=typeof e,o=typeof process;if("undefined"!==t&&"undefined"!==o&&process.env)try{var i=e("tunnel");process.env.CCLIBRARIES_CHARLES_PORT?(this.NODE_TUNNEL_OPTIONS.agent=i.httpsOverHttp({proxy:{host:"localhost",port:process.env.CCLIBRARIES_CHARLES_PORT}}),this.NODE_TUNNEL_OPTIONS.rejectUnauthorized=!1,l.log("Tunneling through Charles proxy: http://localhost:"+process.env.CCLIBRARIES_CHARLES_PORT)):process.env.CCLIBRARIES_HTTPS_PROXY&&(this.NODE_TUNNEL_OPTIONS.agent=i.httpsOverHttp({proxy:{host:process.env.CCLIBRARIES_HTTPS_PROXY,port:process.env.CCLIBRARIES_HTTPS_PROXY_PORT,proxyAuth:s.PROXY_AUTH}}),l.log("Tunneling through system proxy: "+process.env.CCLIBRARIES_HTTPS_PROXY+":"+process.env.CCLIBRARIES_HTTPS_PROXY_PORT))}catch(n){l.log("Unable to load tunnel module.")}}return this.NODE_TUNNEL_OPTIONS},o.prototype._getCommonRequestHeaders=function(){var e={};return s.USER_AGENT_HEADER&&(e["User-Agent"]=s.USER_AGENT_HEADER),e},o.prototype._setAuthToken=function(e){this._hasSetAuthToken=!0,this._authToken=e,this._httpServices.forEach(function(t){e?(t.isActive=!0,t.setAuthToken(e)):t.isActive=!1})},o.prototype._updateAuthToken=function(e){var t=this;this._getAccessToken(function(o,i){!o&&i?t._setAuthToken(i):(o&&o.code===c.ACCESS_DENIED&&(t._collection._reportSyncError(o),t._collection._updateSyncState()),t._setAuthToken()),e&&e(null,i)})},o.prototype._getAuthToken=function(e){this._isPublic?e(null,void 0):this._hasSetAuthToken?e(null,this._authToken):this._updateAuthToken(e)},o.prototype._authHandler=function(){this._updateAuthToken()},o.prototype._createStorageSession=function(){var e;return this._isPublic?e=l.dcx.createHTTPService():(e=l.dcx.createHTTPService(this._authHandler.bind(this)),this._httpServices.push(e)),e.setApiKey(this._apiKey),e.setTimeout(s.NETWORK_TIMEOUT),e.setAdditionalNodeOptions(this._getNodeTunnelOptions()),e.setAdditionalHeaders(this._getCommonRequestHeaders()),this._XHR&&e._forceXhr(this._XHR),l.dcx.createStorageSession(e,this._getStorageHost())},o.prototype._createTemporaryStorageSession=function(e,t){var o;return t?(o=l.dcx.createHTTPService(this._authHandler.bind(this)),o.setApiKey(this._apiKey),o.setAdditionalHeaders(this._getCommonRequestHeaders()),o.setAuthToken(this._authToken),this._httpServices.push(o)):o=l.dcx.createHTTPService(),o.setTimeout(s.NETWORK_TIMEOUT),o.setAdditionalNodeOptions(this._getNodeTunnelOptions()),l.dcx.createStorageSession(o,e)},o.prototype._getTemporaryStorageSession=function(e){var t=r.parseURI(e),o=t.scheme+"://"+t.authority,i=d.isAdobeDomain(t.authority);return this._temporaryStorageServices[o]||(this._temporaryStorageServices[o]=this._createTemporaryStorageSession(o,i)),this._temporaryStorageServices[o]},o.prototype.getServerComposites=function(e){var t=this,o=this._lastSyncGroupState.etag;this._storageService.getCollection(this.getSyncGroupPath(),o,function(o,i,n,r){if(o)return void(o.response&&404===o.response.statusCode?e(null,[]):e(o));if(!i){var a=Math.max(s.DEFAULT_MAX_SYNC_INTERVAL,1e3*d.getRetryAfterHeader(r));return s.MAX_SYNC_INTERVAL=a,void e(null,[])}s.MAX_SYNC_INTERVAL=s.DEFAULT_MAX_SYNC_INTERVAL;var c=t._lastSyncGroupState.compositeEtags||{},l={},p=[],h={},_=i.children||[];_.forEach(function(e){if(e&&u.validateLibraryId(e.name,!1)){var t=e.etag&&c[e.name]===e.etag;p.push(e),h[e.name]={isUnmodified:t,collaboration:e.collaboration},l[e.name]=e.etag}}),t._lastSyncGroupState={etag:n,compositeEtags:l},e(null,p,h)})},o.prototype.clearSyncGroupCache=function(){this._lastSyncGroupState={}},o.prototype.doHeadRequest=function(e,t){var o=this._storageService.getCompositeManifestHref(e);this._storageService.headRequest(o,t)},o.prototype.hasCompositeChangedOnServer=function(e,t){this.doHeadRequest(e,function(o,i){if(o)return void t(!0);var n=i&&i.headers&&i.headers.etag,r=e.current&&e.current.manifestEtag;t(n!==r)})},o.prototype.downloadRepresentation=function(e,t){var o=e._dcxComponent,i=e.element.library._dcxBranch;n.downloadComponents([o],i,this._storageService,t)},o.prototype.abortPushOrPull=function(e){this._inProgressSyncMap[e]&&(this._inProgressSyncMap[e].abort(new c(c.TRANSFER_ABORTED,"abort push or pull operation")),delete this._inProgressSyncMap[e])},o.prototype.pullComposite=function(e,t,o){var i=this,r=e.id;if(!r&&e.href){var d=e.href.split("/");r=d&&d[d.length-1]}var p="manifestOnly"===s.SYNC_POLICY||!l.hasFileSystem(),h=p?"pullCompositeManifestOnly":"pullComposite";l.log("Started pulling: "+r+(p?" (manifest only)":""));var _=(new Date).valueOf();t._updateProgress(r),this._inProgressSyncMap[r]=n[h](e,this._storageService,function(n,s){var d=(new Date).valueOf()-_;return l.log("Finished pulling: "+r+(n?" ["+n.code+"]":"")+" duration="+d),delete i._inProgressSyncMap[r],t._updateProgress(r),n&&n.code===a.COMPONENT_DOWNLOAD_ERROR?void i.doHeadRequest(e,function(e,t){var i=!e&&t&&200===t.statusCode;if(i){var r=u.removeMissingComponents(n.pulledBranch,n.failedComponents);if(r)return void o(null,r)}o(n,s)}):n&&n.code===c.TRANSFER_ABORTED?void o(null,void 0):void o(n,s)});var f=this._inProgressSyncMap[r];f.onProgress=function(e,o){0!==o&&t._updateProgress(r,e,o)}},o.prototype.pushComposite=function(e,t,o,i){var r=this,a=e.id;l.log("Started pushing: "+a);var s=(new Date).valueOf();t._updateProgress(a),this._inProgressSyncMap[a]=n.pushComposite(e,o,this._storageService,function(e){var o=(new Date).valueOf()-s;l.log("Finished pushing: "+a+(e?" ["+e.code+"]":"")+" duration="+o),delete r._inProgressSyncMap[a],t._updateProgress(a),i(e)});var c=this._inProgressSyncMap[a];c.onProgress=function(e,o){0!==o&&t._updateProgress(a,e,o)}},o.prototype.pushDeletedComposite=function(e,t,o,i,n){var r=this;"incoming"===o?(l.log("Deleting incoming collaboration without pushing: "+e.id),this._storageService.deleteCompositeDirectory(e,n)):(l.log("Pushing deleted composite: "+e.id),this.pushComposite(e,t,i,function(o){if(o){if(o.code===a.UNEXPECTED_RESPONSE&&o.response&&404===o.response.statusCode)return void r._storageService.deleteCompositeDirectory(e,n);if(o.code===a.UPDATE_CONFLICT){var i=o;return void r.pullComposite(e,t,function(t){return t&&t.code===a.NO_COMPOSITE?void r._storageService.deleteCompositeDirectory(e,n):t&&t.code===a.DELETED_COMPOSITE?void n(null):t?void n(t):void n(i)})}}n(o)}))},o.prototype._getStorageHost=function(){return"https://"+this._storageHost},o.prototype._getStorageRoot=function(){return this._getStorageHost()+this._storageAssetsPath},o.prototype.getSyncGroupPath=function(){return r.appendPathElements(this._getStorageRoot(),this._syncGroup)},o.prototype.getCompositePath=function(e){return r.appendPathElements(this._getStorageRoot(),this._syncGroup,e)},o.prototype.getComponentPath=function(e,t){return r.appendPathElements(this._getStorageRoot(),this._syncGroup,e,t)},o.prototype._getSharedCloudRenditionUrl=function(e,t,o,i){if(!e._dcxComponent)return void i("representation must be a component to generate a rendition");var n=this.getComponentPath(e._element._library.id,e.id)+"/:rendition";if(n+=";size="+(t||"full"),void 0!==e._dcxComponent.version&&(n+=";version="+e._dcxComponent.version),o){var r=this._apiKey;return void this._getAuthToken(function(e,t){n+="?accept=image/png&api_key="+r+(t?"&user_token="+t:""),i(null,n)})}i(null,n)},o.prototype._getAssetAsType=function(e,t,o,n,r,a){var c=this;a=a||0;var h=function(){c._getAssetAsType(e,t,o,n,r,a)};if(a>0&&"uploading"===e.element.library.syncState)return void setTimeout(h,s.RENDITION_RETRY_INTERVAL);var u=o+l.getPathSeparator()+l.uuid()+".png",_=new i.FileContent(u);this._renditionStorageService.getAssetAsType(t,_,n,function(t){var o=t&&t.response&&t.response.headers,i=1e3*d.getRetryAfterHeader(o);if(s.RENDITION_RETRY_INTERVAL=Math.max(s.DEFAULT_RENDITION_RETRY_INTERVAL,i),s.RENDITION_404_BACKOFF=Math.max(s.DEFAULT_RENDITION_404_BACKOFF,i),404===p.getErrorStatusCode(t)){if(a<s.RENDITION_MAX_RETRIES)return l.log("404 fetching rendition: retrying"),a++,void setTimeout(h,s.RENDITION_RETRY_INTERVAL);l.log("404 fetching rendition: reached maximum retries"),l.log("Backing off rendition fetch of "+e.id+" for "+s.RENDITION_404_BACKOFF+"ms"),e._lastRendition404=(new Date).valueOf()}r(t,u)})},o.prototype.getSharedCloudRenditionUrl=function(e,t,o){var i=s.SHARED_LOCAL_STORAGE?!1:!0;this._getSharedCloudRenditionUrl(e,t,i,o)},o.prototype.getSharedCloudRendition=function(e,t,o){var i=this;if(e.element.library.deletedFromServer)return l.log("Error: Trying to fetch rendition from deleted library."),void o("Error: library deleted");var n=(new Date).valueOf(),r=n-(e._lastRendition404||0);return r<s.RENDITION_404_BACKOFF?void o("Error: got 404 on last rendition attempt - backing off"):void this._getSharedCloudRenditionUrl(e,t,!1,function(t,n){if(t)return void o(t);var r={Accept:"image/png"},a=e.element.library.collection._getTempDir();h.ensurePathExists(a,function(t){return t?void o(t):void i._getAssetAsType(e,n,a,r,o)})})},o.prototype.getSharedCloudContentURL=function(e){return this._storageService.getComponentHref(e._dcxComponent,e._dcxComponent.version)},o.prototype.appendAccessTokenToURL=function(e,t){if(!e)return void t(null,void 0);var o=this._apiKey;this._getAuthToken(function(i,n){e+="?api_key="+o+(n?"&user_token="+n:""),t(null,e)})},o.prototype.getSharedCloudContent=function(e,t,o){var i=this._storageService.getComponentHref(e._dcxComponent,e._dcxComponent.version),n={};this._storageService.getAssetAsType(i,t,n,function(e,t){return e?void o(e):void o(null,t)})},o.prototype.getAssetFromURL=function(e,t,o,n,r){var s=this;l.log("getAssetFromURL: "+e);var c=this._getTemporaryStorageSession(e),p=o+l.getPathSeparator()+l.uuid(),u=new i.FileContent(p);r=r||0,t=t||{},h.ensurePathExists(o,function(i){return i?void n(i):void c.getAssetAsType(e,u,t,function(e,i,c,l){if(e&&e.code===a.UNEXPECTED_RESPONSE){var h=e.response&&e.response.statusCode;if(301===h||302===h||303===h||307===h){var u=d.getLocationHeader(e.response.headers);if(u&&5>r)return void s.getAssetFromURL(u,t,o,n,r+1)}}n(e,p,c,l)})})},o.prototype.doHeadRequestOfURL=function(e,t){var o=this._getTemporaryStorageSession(e);o.headRequest(e,t)},o.prototype.prepareCompositeForPush=function(e){e.href=this.getCompositePath(e.id)},o.prototype.updateAccessToken=function(e){this._setAuthToken(e)},o.prototype.isLoggedIn=function(){return this._isPublic||this._httpServices[0].isActive},o.prototype.uploadNewComponent=function(e,t,o,i){var r=o._element._library._dcxComposite;n.uploadNewComponent(e,o.type,r,o.id,this._storageService,function(e,n){if(e)return void i(e);var a=t?t.lastIndexOf("."):-1,s=-1!==a&&t.substr(a+1).toLowerCase(),c=o.id+"."+s,l=r.current.addComponentWithUploadResults(t,o.relationship,c,o._element._dcxNode,n);i(null,l)})},o}),i("AdobeLibraryCollection",["require","exports","module","./components/dcx-js/src/AdobeDCXError","./AdobeLibraryComposite","./AdobeLibraryServices","./AdobeLibraryConfig","./AdobeLibrarySyncManager","./AdobeLibraryAnalytics","./AdobeLibraryError","./utils/AdobeLibraryAsyncJoin","./utils/AdobeLibraryFileUtils","./utils/AdobeLibraryManifestUtils","./utils/AdobeLibraryErrorUtils","./utils/AdobeLibrarySyncUtils","./utils/AdobeLibraryRenditionUtils","./utils/AdobeLibraryListenerManager"],function(e){function t(e){this._rootDir=r.ROOT_DIR,this._userId=e.USER_ID,this._cloudId=e.CLOUD_ID,this._cloudInfo=e.CLOUD_INFO||{},this._syncManager=new a(this,e),this._libraries=[],this._syncState="syncing",this._syncProgressMap={},this._initialSyncInProgress=!1,this._syncErrors=[],this._listenerManager=new f(["change","deepchange","sync","commitError"]),this._libraryIdMap={},this._pendingDeletes=[],this._loaded=!1,this._syncing=!1,this._lastSyncTime=0,this._pendingSyncs=[],this._backoffTicks=0,this._numBackoffs=0,this._numRetries=0}var o=e("./components/dcx-js/src/AdobeDCXError"),i=e("./AdobeLibraryComposite"),n=e("./AdobeLibraryServices"),r=e("./AdobeLibraryConfig"),a=e("./AdobeLibrarySyncManager"),s=e("./AdobeLibraryAnalytics"),c=e("./AdobeLibraryError"),l=e("./utils/AdobeLibraryAsyncJoin"),d=e("./utils/AdobeLibraryFileUtils"),p=e("./utils/AdobeLibraryManifestUtils"),h=e("./utils/AdobeLibraryErrorUtils"),u=e("./utils/AdobeLibrarySyncUtils"),_=e("./utils/AdobeLibraryRenditionUtils"),f=e("./utils/AdobeLibraryListenerManager");return t.prototype._removeAllListeners=function(){this._listenerManager.removeAll(),this._libraries.forEach(function(e){e._removeAllListeners()})},t.prototype._notifyChange=function(e){this._listenerManager.notify("deepchange"),e&&this._listenerManager.notify("change")},t.prototype._load=function(e){if(this._loaded)return void e(null);this._loaded=!0;var t=this;d.readLibraryDirectory(this,function(o,r){function a(e,o){if(p.validateLibraryId(e,t.isPublic)){var r=t._getCompositeDir(e);n.dcx.newCompositeFromLocalStorage(r,function(r,a){if(r)return n.log("Load error: DCX error loading composite for "+e),void o(h.getCommitError(r,e));if(!a||!a.current)return n.log("Load error: composite/branch not loaded for "+e),d.deleteLibraryFromDisk(t,e),void o(null);if(!p.validateLibrary(a))return n.log("Load error: failed validation for "+e),void o(null);if(!t.isPublic&&a.id!==e)return n.log("Load error: library id "+a.id+"doesn't match folder on disk "+e),void o(null);var s=new i(t,a);t.isPublic&&(s._publicId=e,s._writable=!1),"pendingDelete"===a.current.compositeState?(t._pendingDeletes.push(s),o(null)):(t._libraries.push(s),t._libraryIdMap[s.id]=s,s._loadRenditionCache(o))})}else o(null)}if(o||!r)return void e(null);var s=new l;r.forEach(function(e){s.addOperation(a,[e])}),s.run(function(){n.log("Loaded "+t._libraries.length+" libraries and "+t._pendingDeletes.length+" pending deletes"),e(null)},function(e){t._reportCommitError(e)})})},t.prototype._removeFromPendingDeletes=function(e){var t=this._pendingDeletes.indexOf(e);-1!==t&&this._pendingDeletes.splice(t,1)},t.prototype._handlePendingDeletes=function(e){var t=this,i=new l;this._pendingDeletes.forEach(function(e){i.addOperation(function(i){e._deleteFromServer(!1,function(n){return n&&n.code===o.UPDATE_CONFLICT?(t._removeFromPendingDeletes(e),t._libraries.push(e),t._libraryIdMap[e.id]=e,e._markDeletedLocally(!1),t._updateSyncState(),t._notifyChange(!0),void i(null,!0)):n?void i(n):(t._removeFromPendingDeletes(e),e._deletedFromDisk=!0,void d.deleteLibraryFromDisk(t,e.id,function(e){i(e,!0)}))})})}),i.run(e)},t.prototype._doesLibraryExist=function(e){if(this._libraryIdMap[e])return!0;var t;for(t=0;t<this._pendingDeletes.length;t++)if(this._pendingDeletes[t].id===e)return!0;return!1},t.prototype._syncNewLibrary=function(e,t,r){var a=this,s=this._syncManager.getCompositePath(e),l=n.hasFileSystem()&&this._getCompositeDir(e),d=n.dcx.newCompositeWithHref(s,l);a._libraryIdMap[e]="pending",a._updateSyncState(),a._syncManager.pullComposite(d,a,function(n,s){return n||!s?(delete a._libraryIdMap[e],a._updateSyncState(),n=n?n.code===o.NO_COMPOSITE||n.code===o.DELETED_COMPOSITE?null:h.getSyncError(n,e):new c(c.NETWORK_ERROR,"No pulled branch"),void r(n,!0)):void d.resolvePullWithBranch(s,function(o){if(o||!a.isPublic&&d.id!==e)return delete a._libraryIdMap[e],a._updateSyncState(),o=o?h.getCommitError(o,e):new c(c.CORRUPTED_LIBRARY,"Library id does not match sync group id"),void r(o,!0);var n=new i(a,d);a.isPublic&&(n._publicId=e,n._writable=!1),a._libraries.push(n),a._libraryIdMap[n.id]=n,a._updateSyncState(),n._setCollaboration(t&&t.toLowerCase()),_.prefetchRenditions(n),a._notifyChange(!0),r(null,!0)})})},t.prototype._syncNewLibraries=function(e,t){var o=this,i=new l;if(this._loadingHint){var n=[];e.forEach(function(e){-1!==o._loadingHint.indexOf(e.name)&&n.push(e)
}),e.forEach(function(e){-1===o._loadingHint.indexOf(e.name)&&n.push(e)}),e=n}e.forEach(function(e){var t=e.name,n=e.collaboration;o._doesLibraryExist(e.name)||i.addOperation(o._syncNewLibrary,[t,n],o)}),i.run(t)},t.prototype._syncExistingLibraries=function(e,t){var o=this,i=new l;this._libraries.forEach(function(t){var n=e&&e[t.id];n&&(t._setCollaboration(n.collaboration&&n.collaboration.toLowerCase()),t._deletedFromServer=!1);var r=!e||n&&n.isUnmodified;void 0===t.collaboration?i.addOperation(t._sync,[r],t):r?i.addOperation(function(e){o._syncManager.hasCompositeChangedOnServer(t._dcxComposite,function(o){t._sync(!o,e)})}):i.addOperation(t._sync,[!1],t)}),i.run(t)},t.prototype._dosync=function(e){var t=this;this._clearSyncErrors(),this._syncManager.getServerComposites(function(o,i,n){if(o)return o=h.getSyncError(o),t._reportSyncError(o),void e(null,!1);var r=new l;r.addOperation(t._syncNewLibraries,[i],t),r.addOperation(t._syncExistingLibraries,[n],t),r.addOperation(t._handlePendingDeletes,[],t),r.run(function(t,o){e(null,o)},function(e){t._reportSyncError(e)})})},t.prototype._reportSyncError=function(e){e&&(n.log("Sync error: "+h.errorToString(e)),this._syncErrors.push(e))},t.prototype._clearSyncErrors=function(e){if(e){var t=[];this._syncErrors.forEach(function(o){o.libraryId!==e&&t.push(o)}),this._syncErrors=t}else this._syncErrors=[]},t.prototype._reportCommitError=function(e){this._lastCommitError=e,e&&(n.log("Commit error: "+h.errorToString(e)),this._listenerManager.notify("commitError",[e]))},t.prototype._updateRetryState=function(){if(!this._retryTimeoutId&&"syncing"!==this._syncState){if("error"===this._syncState){var e=this.getPrimarySyncError();if(e&&e.code===c.RETRYABLE_SERVER_ERROR){if(this._numRetries++,this._numRetries>r.ERROR_RETRY_INTERVALS.length)return this._retryTime="never",n.log("Retry Failed"),void(r.MAX_SYNC_INTERVAL=r.RETRY_FAIL_MAX_SYNC_INTERVAL);n.log("Retry "+this._numRetries);var t=e.underlyingError&&e.underlyingError.response&&e.underlyingError.response.headers,o=1e3*u.getRetryAfterHeader(t);o>0?(this._numRetries=r.ERROR_RETRY_INTERVALS.length,n.log("Got Retry-After header")):o=1e3*r.ERROR_RETRY_INTERVALS[this._numRetries-1],n.log("Retrying after "+o+"ms"),this._retryTime=(new Date).valueOf()+o;var i=this;return void(this._retryTimeoutId=setTimeout(function(){i._retryTimeoutId=void 0,i._retryTime=void 0,n.log("Starting retry"),i._syncWithParameters(!1)},o))}if(e&&e.code===c.EXCEEDS_QUOTA)return r.MAX_SYNC_INTERVAL=r.RETRY_FAIL_MAX_SYNC_INTERVAL,this._numRetries=r.ERROR_RETRY_INTERVALS.length+1,void(this._retryTime="never")}this._numRetries=0,this._retryTime=void 0}},t.prototype._updateSyncState=function(){var e=this,t=this._initialSyncInProgress;Object.keys(this._libraryIdMap).forEach(function(o){var i=e._libraryIdMap[o],n="pending"===i||i._isSyncing();t=t||n});var o;t?o="syncing":(this._syncErrors.length>0?(o="error",e._syncManager.clearSyncGroupCache(),s.reportError(this.getPrimarySyncError())):o="ok",this._syncProgressMap={},this._syncProgress=void 0);var i=this._syncState;this._syncState=o,this._updateRetryState(),(i!==o||"error"===this._syncState)&&this._listenerManager.notify("sync"),e._ensureDefaultLibrary()},t.prototype._updateProgress=function(e,t,o){o?this._syncProgressMap[e]={bytesLoaded:t||0,bytesTotal:o}:this._syncProgressMap[e]?(0===this._syncProgressMap[e].bytesTotal&&(this._syncProgressMap[e].bytesTotal=1e4),this._syncProgressMap[e].bytesLoaded=this._syncProgressMap[e].bytesTotal):this._syncProgressMap[e]={bytesLoaded:0,bytesTotal:0};var i=!1,n=t||0,r=o||0,a=r>0?Math.max(0,Math.min(100,Math.round(n/o*100))):void 0;this._syncProgressMap[e].progress!==a&&(this._syncProgressMap[e].progress=a,i=!0);var s=0,c=0,l=0,d=0,p=this._syncProgressMap;Object.keys(p).forEach(function(e){s++,p[e].bytesTotal>0&&c++,l+=p[e].bytesLoaded,d+=p[e].bytesTotal});var h=d>0?l*c/(d*s):0,u=Math.max(0,Math.min(100,Math.round(100*h)));(!this._syncProgress||this._syncProgress<u||100===this._syncProgress&&100>u)&&(this._syncProgress=u,i=!0),i&&this._listenerManager.notify("sync")},t.prototype._setInitialSyncState=function(e,t){this._initialSyncInProgress=e,this._loadingHint=t,this._updateSyncState()},t.prototype._resetPollBackoff=function(){this._backoffTicks=0,this._numBackoffs=0},t.prototype._getBaseDir=function(){var e=n.getPathSeparator(),t=this._userId.replace(/@/g,"_");return this._rootDir+e+t+e+this._cloudId},t.prototype._getCompositeDir=function(e){var t=n.getPathSeparator(),o=this._getBaseDir()+t+"dcx";return e&&(o+=t+e),o},t.prototype._getTempDir=function(){var e=n.getPathSeparator();return this._getBaseDir()+e+".tmp"},t.prototype._getRenditionCacheDir=function(e){var t=n.getPathSeparator(),o=this._getBaseDir()+t+"renditions";return e&&(o+=t+e),o},t.prototype._ensureDefaultLibrary=function(){var e="ok"===this.syncState&&!this.initialSyncInProgress&&r.SYNCING_ENABLED,t=0;this.libraries.forEach(function(e){e.deletedLocally||e.deletedFromServer||t++}),!this.isPublic&&r.DEFAULT_LIBRARY_NAME&&e&&0===t&&(n.log("Creating default library: "+r.DEFAULT_LIBRARY_NAME),this.createLibrary(r.DEFAULT_LIBRARY_NAME))},t.prototype._doRemoveLibrary=function(e,t){var o=this,i=function(e){t&&t(e)},n=this._libraries.indexOf(e);-1!==n&&(this._libraries.splice(n,1),delete this._libraryIdMap[e.id]),e._removeAllListeners(),r.SHARED_LOCAL_STORAGE?(e._dcxBranch.compositeState="pendingDelete",e._commit(!1,!0),e._markDeletedLocally(!0),i(null)):(o._pendingDeletes.push(e),r.SYNCING_ENABLED?e._deleteFromServer(!0,function(t){return e._markDeletedLocally(!0),t?void i(null):(o._removeFromPendingDeletes(e),e._deletedFromDisk=!0,void d.deleteLibraryFromDisk(o,e.id,i))}):(e._dcxBranch.compositeState="pendingDelete",e._commit(!0,!0),e._markDeletedLocally(!0),i(null))),this._notifyChange(!0)},Object.defineProperties(t.prototype,{libraries:{get:function(){return this._libraries},set:function(){throw new c(c.READ_ONLY,"Cannot modify libraries list directly")}},commitError:{get:function(){return this._lastCommitError},set:function(){throw new c(c.READ_ONLY,"commitError is a read-only property")}},syncState:{get:function(){return this._syncState},set:function(){throw new c(c.READ_ONLY,"syncState is a read-only property")}},syncErrors:{get:function(){return this._syncErrors},set:function(){throw new c(c.READ_ONLY,"syncErrors is a read-only property")}},syncProgress:{get:function(){return this._syncProgress},set:function(){throw new c(c.READ_ONLY,"syncProgress is a read-only property")}},initialSyncInProgress:{get:function(){return this._initialSyncInProgress},set:function(){throw new c(c.READ_ONLY,"initialSyncInProgress is a read-only property")}},isPolling:{get:function(){return void 0!==this._pollTimerId},set:function(){throw new c(c.READ_ONLY,"isPolling is a read-only property")}},retryTime:{get:function(){return"never"!==this._retryTime?this._retryTime:void 0},set:function(){throw new c(c.READ_ONLY,"retryTime is a read-only property")}},userId:{get:function(){return this._userId},set:function(){throw new c(c.READ_ONLY,"userId is a read-only property")}},cloudId:{get:function(){return this._cloudId},set:function(){throw new c(c.READ_ONLY,"cloudId is a read-only property")}},cloudInfo:{get:function(){return this._cloudInfo},set:function(){throw new c(c.READ_ONLY,"cloudInfo is a read-only property")}},isPublic:{get:function(){return!1},set:function(){throw new c(c.READ_ONLY,"isPublic is a read-only property")}}}),t.prototype.addChangeListener=function(e){this._listenerManager.add("change",e)},t.prototype.removeChangeListener=function(e){this._listenerManager.remove("change",e)},t.prototype.addDeepChangeListener=function(e){this._listenerManager.add("deepchange",e)},t.prototype.removeDeepChangeListener=function(e){this._listenerManager.remove("deepchange",e)},t.prototype.createLibrary=function(e,t){var o=n.uuid(),a=r.COMPOSITE_TYPE,c=this._getCompositeDir(o),l=n.dcx.newEmptyComposite(e,a,c,o);l.current.rootNode.setValue(r.VERSION_KEY,r.VERSION),this._syncManager.prepareCompositeForPush(l);var d=new i(this,l);return d._updateCreatedTime(),this._libraries.push(d),this._libraryIdMap[d.id]=d,this._notifyChange(!0),t?d.beginOperation():d._commit(!1,!0),s.reportCreateLibrary(d),d},t.prototype.removeLibrary=function(e,t){this._doRemoveLibrary(e,t),s.reportDeleteLibrary(e)},t.prototype.removeDeletedLibraries=function(e,t){function o(e,t){var o=i._libraries.indexOf(e);-1!==o&&(i._libraries.splice(o,1),delete i._libraryIdMap[e.id]),e._deletedFromDisk=!0,d.deleteLibraryFromDisk(i,e.id,t),e._markDeletedLocally(!0)}var i=this;"function"==typeof e&&(t=e,e=void 0);var n=e&&e.exclude||[],r=new l,a=!1;this._libraries.forEach(function(e){if(e.deletedFromServer){var t=!0;n.forEach(function(o){t=t&&e!==o}),t&&(a=!0,r.addOperation(o,[e]))}}),r.run(function(e){a&&i._notifyChange(!0),t(e)})},t.prototype.sync=function(e){this._syncWithParameters(!1,!1,e)},t.prototype._syncWithParameters=function(e,t,o){var i=this,a=function(){o&&o(null)};if(r.SHARED_LOCAL_STORAGE)return n.storageInterface.sync(this),void a();if(!r.SYNCING_ENABLED)return void a();if(this._retryTimeoutId)return void a();if(e||this._resetPollBackoff(),this.isPolling){if(this._syncing)return void a()}else if(this._syncing)return void i._pendingSyncs.push(a);var s=(new Date).valueOf();return s<this._lastSyncTime+r.MAX_SYNC_INTERVAL?t?void a():void setTimeout(function(){i._syncWithParameters(e,!0,a)},r.MAX_SYNC_INTERVAL):(n.log("Start Sync "+(e?"[polling]":"")),this._syncing=!0,this._lastSyncTime=(new Date).valueOf(),void this._dosync(function(e,t){if(i._syncing=!1,i._updateSyncState(),n.log("End Sync"),t&&(i._backoffTicks=0,i._numBackoffs=0),i._pendingSyncs.length>0){var o=i._pendingSyncs;i._pendingSyncs=[],i.sync(function(){o.forEach(function(e){e()})})}a()}))},t.prototype.addSyncListener=function(e){this._listenerManager.add("sync",e)},t.prototype.removeSyncListener=function(e){this._listenerManager.remove("sync",e)},t.prototype.getPrimarySyncError=function(){var e=this._syncErrors[0];return this._syncErrors.forEach(function(t){var o=h.getErrorPriority(t),i=h.getErrorPriority(e);o>i?e=t:o===i&&e.code===t.code&&e.libraryId!==t.libraryId&&(e=new c(e.code,"multiple errors (see libraryCollection.syncErrors)",void 0))}),e},t.prototype.getNewLibrarySyncProgress=function(){var e=this;if(this._newLibraryProgress)return this._newLibraryProgress;var t=[];return Object.keys(this._libraryIdMap).forEach(function(o){"pending"===e._libraryIdMap[o]&&t.push({id:o,progress:e._syncProgressMap[o]&&e._syncProgressMap[o].progress})}),t},t.prototype.addCommitErrorListener=function(e){this._listenerManager.add("commitError",e)},t.prototype.removeCommitErrorListener=function(e){this._listenerManager.remove("commitError",e)},t.prototype.startPolling=function(){if(r.SHARED_LOCAL_STORAGE)throw new c(c.NOT_SUPPORTED,"startPolling() not supported with shared local storage");if(!this.isPolling){var e=this,t=6e4*r.POLL_INTERVAL;this._pollTimerId=setInterval(function(){if("never"!==e._retryTime){if(e._backoffTicks>0)return void e._backoffTicks--;0===e._backoffTicks&&(e._numBackoffs++,e._backoffTicks=u.getBackoffTicks(e._numBackoffs)),e._syncWithParameters(!0)}},t)}},t.prototype.stopPolling=function(){if(r.SHARED_LOCAL_STORAGE)throw new c(c.NOT_SUPPORTED,"stopPolling() not supported with shared local storage");this.isPolling&&(clearInterval(this._pollTimerId),delete this._pollTimerId),this._retryTimeoutId&&(clearTimeout(this._retryTimeoutId),delete this._retryTimeoutId)},t.prototype.getDefaultLibrary=function(){var e;return this.libraries.forEach(function(t){"incoming"!==t.collaboration&&(!e||(e.created||0)>(t.created||0))&&(e=t)}),e},t.prototype.getLibraryById=function(e){var t;return this.libraries.forEach(function(o){o.id===e&&(t=o)}),t},t.prototype.updateAccessToken=function(e){if(r.SHARED_LOCAL_STORAGE)throw new c(c.NOT_SUPPORTED,"updateAccessToken() not supported with shared local storage");this._syncManager.updateAccessToken(e),n.log("defined")},t.prototype.isLoggedIn=function(){if(r.SHARED_LOCAL_STORAGE)throw new c(c.NOT_SUPPORTED,"isLoggedIn() not supported with shared local storage");return this._syncManager.isLoggedIn()},t.prototype.getTempDir=function(e){if(!n.hasFileSystem())return void e(new c(c.REQUIRES_FILESYSTEM,"getTempDir only supported when you have a filesystem"));var t=this._getTempDir();d.ensurePathExists(t,function(o){e(o,t)})},t}),i("AdobeLibraryPublicCollection",["require","exports","module","./AdobeLibraryCollection","./AdobeLibraryError","./AdobeLibraryConfig","./AdobeLibraryServices","./utils/AdobeLibraryAsyncJoin","./utils/AdobeLibraryFileUtils"],function(e){function t(e){e.IS_PUBLIC=!0,e.USER_ID=n.PUBLIC_USER_ID,this._newLibrariesLoading={},o.call(this,e)}var o=e("./AdobeLibraryCollection"),i=e("./AdobeLibraryError"),n=e("./AdobeLibraryConfig"),r=e("./AdobeLibraryServices"),a=e("./utils/AdobeLibraryAsyncJoin"),s=e("./utils/AdobeLibraryFileUtils");return Object.keys(o.prototype).forEach(function(e){0===e.indexOf("_")&&(t.prototype[e]=o.prototype[e])}),t.prototype._dosync=function(e){var t=this;this._clearSyncErrors();var o=new a;this._libraries.forEach(function(e){o.addOperation(function(o){t._syncManager.hasCompositeChangedOnServer(e._dcxComposite,function(t){e._sync(!t,o)})})}),o.run(function(t,o){e(null,o)},function(e){t._reportSyncError(e)})},Object.defineProperties(t.prototype,{libraries:{get:function(){return this._libraries},set:function(){throw new i(i.READ_ONLY,"Cannot modify libraries list directly")}},commitError:{get:function(){return this._lastCommitError},set:function(){throw new i(i.READ_ONLY,"commitError is a read-only property")}},syncState:{get:function(){return this._syncState},set:function(){throw new i(i.READ_ONLY,"syncState is a read-only property")}},syncErrors:{get:function(){return this._syncErrors},set:function(){throw new i(i.READ_ONLY,"syncErrors is a read-only property")}},syncProgress:{get:function(){return this._syncProgress},set:function(){throw new i(i.READ_ONLY,"syncProgress is a read-only property")}},isPolling:{get:function(){return void 0!==this._pollTimerId},set:function(){throw new i(i.READ_ONLY,"isPolling is a read-only property")}},retryTime:{get:function(){return"never"!==this._retryTime?this._retryTime:void 0},set:function(){throw new i(i.READ_ONLY,"retryTime is a read-only property")}},cloudId:{get:function(){return this._cloudId},set:function(){throw new i(i.READ_ONLY,"cloudId is a read-only property")}},cloudInfo:{get:function(){return this._cloudInfo},set:function(){throw new i(i.READ_ONLY,"cloudInfo is a read-only property")}},isPublic:{get:function(){return!0},set:function(){throw new i(i.READ_ONLY,"isPublic is a read-only property")}}}),t.prototype.addChangeListener=function(e){o.prototype.addChangeListener.call(this,e)},t.prototype.removeChangeListener=function(e){o.prototype.removeChangeListener.call(this,e)},t.prototype.loadLibrary=function(e,t){function o(t,o){var n=i._newLibrariesLoading[e];delete i._newLibrariesLoading[e],n.forEach(function(e){e(t,o)})}var i=this;if(this.getLibraryById(e))return void t(null,this.getLibraryById(e));var a=this._newLibrariesLoading[e];return a?void a.push(t):(this._newLibrariesLoading[e]=[t],n.SHARED_LOCAL_STORAGE?void r.storageInterface.loadPublicLibrary(this,e,o):void this._syncNewLibrary(e,void 0,function(t){return t?void o(t):void o(null,i.getLibraryById(e))}))},t.prototype.unloadLibrary=function(e,t){var o=this._libraries.indexOf(e);return-1===o?void t(null):(this._libraries.splice(o,1),delete this._libraryIdMap[e.id],e._markDeletedLocally(!0),n.SHARED_LOCAL_STORAGE?r.storageInterface.unloadPublicLibrary(e,t):(e._deletedFromDisk=!0,s.deleteLibraryFromDisk(this,e.id,t)),void this._listenerManager.notify("change"))},t.prototype.unloadDeletedLibraries=function(e,t){o.prototype.removeDeletedLibraries.call(this,e,t)},t.prototype.sync=function(e){o.prototype.sync.call(this,e)},t.prototype.addSyncListener=function(e){o.prototype.addSyncListener.call(this,e)},t.prototype.removeSyncListener=function(e){o.prototype.removeSyncListener.call(this,e)},t.prototype.getPrimarySyncError=function(){return o.prototype.getPrimarySyncError.call(this)},t.prototype.getNewLibrarySyncProgress=function(){return o.prototype.getNewLibrarySyncProgress.call(this)},t.prototype.addCommitErrorListener=function(e){o.prototype.addCommitErrorListener.call(this,e)},t.prototype.removeCommitErrorListener=function(e){o.prototype.removeCommitErrorListener.call(this,e)},t.prototype.startPolling=function(){o.prototype.startPolling.call(this)},t.prototype.stopPolling=function(){o.prototype.stopPolling.call(this)},t.prototype.getLibraryById=function(e){return o.prototype.getLibraryById.call(this,e)},t}),i("AdobeLibraryCollectionManager",["require","exports","module","./utils/AdobeLibraryListenerManager"],function(e){function t(){this._collections=[],this._listenerManager=new o(["change"])}var o=e("./utils/AdobeLibraryListenerManager");return t.prototype.getLibraryCollection=function(e,t){var o;return this._collections.forEach(function(i){i.isPublic||i.userId!==e||i.cloudId!==t||(o=i)}),o},t.prototype.getPublicLibraryCollection=function(e){var t;return this._collections.forEach(function(o){o.isPublic&&o.cloudId===e&&(t=o)}),t},t.prototype.addLibraryCollection=function(e){this._collections.push(e),this._listenerManager.notify("change")},t.prototype.removeLibraryCollection=function(e){var t=this._collections.indexOf(e);-1!==t&&(this._collections.splice(t,1),this._listenerManager.notify("change"))},t.prototype.removeAllLibraryCollections=function(){this._collections=[],this._listenerManager.notify("change")},t.prototype.getLoadedCollections=function(){return this._collections},t.prototype.addLoadedCollectionsListener=function(e){this._listenerManager.add("change",e)},t.prototype.removeLoadedCollectionsListener=function(e){this._listenerManager.remove("change",e)},t}),i("AdobeLibraryMessageChannel",["require","exports","module","./AdobeLibraryServices","./utils/AdobeLibraryListenerManager"],function(e){function t(e){this._socket=e,this._listenerManager=new a,this._socketListenerManager=new a,this._pendingWriteState={},this._pendingWriteDependencyMap={},this._init()}function o(e){return e+"_req"}function i(e){return e+"_res"}function n(e,t,o){return e+"#"+t+"#"+o}var r=e("./AdobeLibraryServices"),a=e("./utils/AdobeLibraryListenerManager");return t.prototype._init=function(){var e=this;this._addSocketListener("message",function(t){var o=JSON.parse(t);e._logReceive(o.type),e._listenerManager.notify(o.type,[o.data])})},t.prototype._addSocketListener=function(e,t){this._socketListenerManager.add(e,t),this._socket.addListener(e,t)},t.prototype._removeSocketListeners=function(){var e=this;this._socketListenerManager.forEach(function(t,o){e._socket.removeListener(t,o)}),this._socketListenerManager.removeAll()},t.prototype._logSend=function(e){this._logCallback&&this._logCallback("SEND "+e)},t.prototype._logReceive=function(e){this._logCallback&&this._logCallback("RECEIVE "+e)},t.prototype.setPendingWriteState=function(e,t,o){var i=n(e,t,o);this._pendingWriteState[i]=!0},t.prototype.setPendingWriteDependency=function(e,t,o,i,r,a){var s=n(e,t,o),c=n(i,r,a);s!==c&&(this._pendingWriteDependencyMap[s]=this._pendingWriteDependencyMap[s]||{},this._pendingWriteDependencyMap[s][c]={userId:i,cloudId:r,id:a})},t.prototype.clearPendingWriteState=function(e,t,o){var i=n(e,t,o),r=[];return Object.keys(this._pendingWriteDependencyMap[i]||{}).forEach(function(e){r.push(this._pendingWriteDependencyMap[i][e])},this),delete this._pendingWriteState[i],delete this._pendingWriteDependencyMap[i],r},t.prototype.getPendingWriteState=function(e,t,o,i){var r=n(e,t,o),a=!1;return!i&&this._pendingWriteState[r]&&(a=this._pendingWriteState[r]),Object.keys(this._pendingWriteDependencyMap).forEach(function(e){var t=this._pendingWriteDependencyMap[e];t[r]&&(a=this._pendingWriteState[e]||a)},this),a},t.prototype.setLogCallback=function(e){this._logCallback=e},t.prototype.addListener=function(e,t){this._listenerManager.add(e,t)},t.prototype.removeListener=function(e,t){this._listenerManager.remove(e,t)},t.prototype.send=function(e,t){try{this._logSend(e),this._socket.send(JSON.stringify({type:e,data:t}))}catch(o){this._socketListenerManager.notify("error",[o])}},t.prototype.addCallListener=function(e,t){var n=this;this.addListener(o(e),function(o){var r=o.id;t(o.data,function(t){n.send(i(e),{id:r,data:t})})})},t.prototype.removeCallListener=function(e){this.removeListener(o(e))},t.prototype.call=function(e,t,n){var a=this,s=r.uuid(),c=function(t){t.id===s&&(a.removeListener(i(e),c),n(t.data))};this.addListener(i(e),c),this.send(o(e),{id:s,data:t})},t.prototype.onOpen=function(e){this._addSocketListener("open",e)},t.prototype.onClose=function(e){this._addSocketListener("close",e)},t.prototype.onError=function(e){this._addSocketListener("error",e)},t.prototype.shutdown=function(){var e=this;this._addSocketListener("close",function(){e._removeSocketListeners(),e._listenerManager.removeAll()}),this._socket.close()},t}),i("AdobeLibraryWebSocket",["require","exports","module","./AdobeLibraryConfig","./utils/AdobeLibraryListenerManager"],function(e){function t(e){this._socket=new WebSocket("ws://127.0.0.1:"+e+"/?version="+o.SHARED_LOCAL_STORAGE_VERSION),this._socket.onopen=this._onSocketOpen.bind(this),this._socket.onclose=this._onSocketClose.bind(this),this._socket.onmessage=this._onSocketMessage.bind(this),this._socket.onerror=this._onSocketError.bind(this),this._listenerManager=new i(["open","close","message","error"])}var o=e("./AdobeLibraryConfig"),i=e("./utils/AdobeLibraryListenerManager");return t.prototype._onSocketOpen=function(){this._listenerManager.notify("open")},t.prototype._onSocketClose=function(){this._listenerManager.notify("close")},t.prototype._onSocketMessage=function(e){this._listenerManager.notify("message",[e.data])},t.prototype._onSocketError=function(e){this._listenerManager.notify("error",[e])},t.prototype.send=function(e){this._socket.send(e)},t.prototype.addListener=function(e,t){this._listenerManager.add(e,t)},t.prototype.removeListener=function(e,t){this._listenerManager.remove(e,t)},t.prototype.close=function(){this._socket.close(),this._socket.onopen=void 0,this._socket.onclose=void 0,this._socket.onmessage=void 0,this._socket.onerror=void 0,this._listenerManager.removeAll()},t}),i("AdobeLibraryStorageInterfaceFS",["require","exports","module","./AdobeLibraryError"],function(e){function t(e){return function(t,o){e&&e(t,o)}}function o(e){this._storageInterface=e}var i=e("./AdobeLibraryError"),n={rename:!0,renameSync:!1,ftruncate:!1,ftruncateSync:!1,truncate:!1,truncateSync:!1,chown:!1,chownSync:!1,fchown:!1,fchownSync:!1,lchown:!1,lchownSync:!1,chmod:!1,chmodSync:!1,fchmod:!1,fchmodSync:!1,lchmod:!1,lchmodSync:!1,stat:!0,lstat:!1,fstat:!1,statSync:!1,lstatSync:!1,fstatSync:!1,link:!1,linkSync:!1,symlink:!1,symlinkSync:!1,readlink:!1,readlinkSync:!1,realpath:!1,realpathSync:!1,unlink:!0,unlinkSync:!1,rmdir:!0,rmdirSync:!1,mkdir:!0,mkdirSync:!1,readdir:!0,readdirSync:!1,close:!1,closeSync:!1,open:!1,openSync:!1,utimes:!0,utimesSync:!1,futimes:!1,futimesSync:!1,fsync:!1,fsyncSync:!1,write:!1,writeSync:!1,read:!1,readSync:!1,readFile:!0,readFileSync:!1,writeFile:!0,writeFileSync:!1,appendFile:!1,appendFileSync:!1,watchFile:!1,unwatchFile:!1,watch:!1,exists:!0,existsSync:!1,createReadStream:!1,createWriteStream:!1};return o.prototype._fsCall=function(e,o,i){var n=t(i),r={method:e,args:o};this._storageInterface._channel.call("fscall",r,function(e){n.apply(null,e)})},o.prototype._pipeCall=function(e,o,i,n){var r=t(n),a={readStream:{path:e,options:o},writeStream:i};this._storageInterface._channel.call("fspipe",a,r)},Object.keys(n).forEach(function(e){o.prototype[e]=n[e]?function(){var t,o=Array.prototype.slice.call(arguments);"function"==typeof o[o.length-1]&&(t=o.pop()),this._fsCall(e,o,t)}:function(){var t=new i(i.NOT_IMPLEMENTED,e+" is not implemented in shared local storage"),o=arguments[arguments.length-1];if("function"==typeof o)return void o(t);throw t}}),o.prototype.createReadStream=function(e){var t=this,o={};return o.on=function(e,t){o[e]=t},o.pipe=function(i,n){t._pipeCall(e,n,i,function(e){o[e.event]&&o[e.event].apply(null,e.args)})},o},o.prototype.createWriteStream=function(e,t){return{path:e,options:t}},o}),i("AdobeLibraryStorageInterface",["require","exports","module","./components/dcx-js/src/AdobeDCXComposite","./components/dcx-js/src/AdobeDCXBranch","./AdobeLibraryCollection","./AdobeLibraryPublicCollection","./AdobeLibraryComposite","./AdobeLibraryError","./AdobeLibraryConfig","./AdobeLibraryServices","./AdobeLibraryMessageChannel","./AdobeLibraryWebSocket","./AdobeLibraryStorageInterfaceFS","./utils/AdobeLibraryAsyncJoin","./utils/AdobeLibraryManifestUtils","./utils/AdobeLibraryRenditionUtils"],function(e){function t(e){this._collectionManager=e,this._acceptPushedBranchListeners=[],this._downloadRenditionListeners=[],this._rootListeners=[],this._baseBranches={},this._pendingSetRenditionCache={},l.SHARED_LOCAL_STORAGE&&(this._connect(),this.fs=new u(this),d.hasFileSystem()||d.setFileSystem(this.fs))}function o(e){return function(t,o){e&&e(t,o)}}var i=e("./components/dcx-js/src/AdobeDCXComposite"),n=e("./components/dcx-js/src/AdobeDCXBranch"),r=e("./AdobeLibraryCollection"),a=e("./AdobeLibraryPublicCollection"),s=e("./AdobeLibraryComposite"),c=e("./AdobeLibraryError"),l=e("./AdobeLibraryConfig"),d=e("./AdobeLibraryServices"),p=e("./AdobeLibraryMessageChannel"),h=e("./AdobeLibraryWebSocket"),u=e("./AdobeLibraryStorageInterfaceFS"),_=e("./utils/AdobeLibraryAsyncJoin"),f=e("./utils/AdobeLibraryManifestUtils"),m=e("./utils/AdobeLibraryRenditionUtils");return t.prototype._getBase=function(e){var t=this._baseBranches[e];return t&&t.base},t.prototype._setBase=function(e,t){this._baseBranches[e]=this._baseBranches[e]||{},this._baseBranches[e].base=t},t.prototype._getServicePort=function(e){function t(t){var o;try{o=JSON.parse(t)}catch(i){}return o?void e(o.port):void e()}var o=l.VULCAN_PREFIX+l.VULCAN_QUERY_REQUEST,i=l.VULCAN_PREFIX+l.VULCAN_QUERY_RESPONSE;if(d.hasCEPVulcan()){var n,r=d.getVulcanInterface(),a=d.getVulcanMessage(),s=function(o){return r.removeMessageListener(i,s),clearTimeout(n),o?void t(r.getPayload(o)):void e()};r.addMessageListener(i,s),n=setTimeout(s,3e3);var c=new a(o);c.setPayload(""),r.dispatchMessage(c)}else d.vulcanCall&&d.vulcanCall(o,"",i,t)},t.prototype._connectToPort=function(e){if(!this._isConnected&&e){try{var t=new h(e);this._channel=new p(t),this._isConnected=!0}catch(o){}this._isConnected&&(this._channel.addListener("environmentinfo",this._onEnvironmentInfo.bind(this)),this._channel.addListener("collectionadded",this._onCollectionAdded.bind(this)),this._channel.addListener("collectionremoved",this._onCollectionRemoved.bind(this)),this._channel.addListener("syncstate",this._onSyncState.bind(this)),this._channel.addListener("librarychange",this._onLibraryChange.bind(this)),this._channel.addListener("renditioncachechange",this._onRenditionCacheChange.bind(this)),this._channel.addListener("librarydeleted",this._onLibraryDeleted.bind(this)),this._channel.onOpen(this._sendConfiguration.bind(this)),this._channel.onClose(this._onDisconnect.bind(this)))}},t.prototype._connect=function(){this._getServicePort(this._connectToPort.bind(this))},t.prototype.shutdown=function(){this._collectionManager.removeAllLibraryCollections(),this._isConnected&&this._onDisconnect()},t.prototype._onDisconnect=function(){this._isConnected=!1,this._collectionManager.removeAllLibraryCollections(),this._channel.shutdown(),this._channel=void 0},t.prototype._sendConfiguration=function(){this._channel.send("configure",{CLIENT_DESCRIPTION:l.CLIENT_DESCRIPTION,RENDITION_SIZES:l.RENDITION_SIZES,FULL_RENDITION_CONFIG:l.FULL_RENDITION_CONFIG,DEFAULT_LIBRARY_NAME:l.DEFAULT_LIBRARY_NAME,SHARED_LOCAL_STORAGE_ANALYTICS:l.SHARED_LOCAL_STORAGE_ANALYTICS})},t.prototype._onEnvironmentInfo=function(e){this._serviceInfo=e,e.whitelistedDomains&&(l.WHITELISTED_DOMAINS=e.whitelistedDomains),this._collectionManager._collections.forEach(function(e){e._listenerManager.notify("sync")})},t.prototype._onCollectionAdded=function(e){var t=this;l.ROOT_DIR=e.rootDir;var o,i=new _,n={CLOUD_ID:e.cloudId,CLOUD_INFO:e.cloudInfo,STORAGE_HOSTNAME:e.storageHost};e.isPublic?o=new a(n):(n.USER_ID=e.userId,o=new r(n)),e.libraries.forEach(function(e){i.addOperation(t.loadExistingLibrary,[o,e.id,e.path,e.manifest,e.deletedFromServer,e.renditionCache],t)}),i.run(function(){t._collectionManager.addLibraryCollection(o)})},t.prototype._getLibraryCollection=function(e){return e.isPublic?this._collectionManager.getPublicLibraryCollection(e.cloudId):this._collectionManager.getLibraryCollection(e.userId,e.cloudId)},t.prototype._onCollectionRemoved=function(e){var t=this._getLibraryCollection(e);t&&this._collectionManager.removeLibraryCollection(t)},t.prototype._onSyncState=function(e){var t=this._getLibraryCollection(e);t&&(t._syncState=e.state,t._syncProgress=e.progress,t._syncProgressMap=e.progressMap,t._newLibraryProgress=e.newLibraryProgress,t._initialSyncInProgress=e.initialSyncInProgress,t._syncErrors=[],e.errors.forEach(function(e){t._syncErrors.push(new c(e.code,e.message,e.libraryId))}),e.libraryStates.forEach(function(e){var o=t.getLibraryById(e.id);o&&(o._syncState=e.state)}),t._listenerManager.notify("sync"))},t.prototype._onLibraryChange=function(e){var t=this._getLibraryCollection(e);if(t){var o=t.getLibraryById(e.id);o?(o._deletedFromServer=e.deletedFromServer,e.renditionCache=e.renditionCache||{},o._setRenditionCache(e.renditionCache),this.updateExistingLibrary(t,o,e.manifest,void 0,function(){o._setRenditionCache(e.renditionCache)})):this.loadExistingLibrary(t,e.id,e.path,e.manifest,e.deletedFromServer,e.renditionCache)}},t.prototype._onRenditionCacheChange=function(e){var t=this._getLibraryCollection(e),o=t&&t.getLibraryById(e.id),i=o&&o.getElementById(e.elementId);i&&e.renditionCache&&(i._renditionCache=e.renditionCache)},t.prototype._onLibraryDeleted=function(e){var t=this._getLibraryCollection(e);t&&this._deleteLibrary(t,e.id)},t.prototype.isConnected=function(){return this._isConnected},t.prototype.reconnect=function(){this._isConnected||this._connect()},t.prototype.getServiceInfo=function(){return this._serviceInfo?{updateRequired:this._serviceInfo.updateRequired,version:this._serviceInfo.codeVersion,buildNumber:this._serviceInfo.buildNumber,apiVersion:this._serviceInfo.version,environment:this._serviceInfo.environment,syncingEnabled:this._serviceInfo.syncingEnabled}:void 0},t.prototype.updateConfiguration=function(){l.SHARED_LOCAL_STORAGE&&this._isConnected&&this._channel&&this._sendConfiguration()},t.prototype.sync=function(e){this._channel.send("sync",{isPublic:e.isPublic,userId:e.userId,cloudId:e.cloudId})},t.prototype.commitManifest=function(e,t){var o=this;if(l.SHARED_LOCAL_STORAGE){var i=e._dcxBranch.localData,n=this._pendingSetRenditionCache[e.id]||{data:[],callbacks:[]};delete this._pendingSetRenditionCache[e.id];var r={isPublic:e.collection.isPublic,userId:e.collection.userId,cloudId:e.collection.cloudId,id:e.id,current:i,base:this._getBase(e.id),renditions:n.data};d.log("Start commit"),this._channel.call("commit",r,function(r){d.log("Finish commit: "+(r.success?"success":"fail")),r.success?(d.log("Update base after commit"),o._setBase(e.id,i),r.renditions&&r.renditions.forEach(function(t,o){if(t){var i=t.split("/").pop(),r=n.data[o],a=e.getElementById(r.element);a&&(a._renditionCache=a._renditionCache||{},a._renditionCache[r.size]=i);var s=n.callbacks[o];s&&s(null,t)}})):(o._pendingSetRenditionCache[e.id]=n,e._waitForCommit(function(){o.notifyStartWrite(e,[],function(){e._deletedFromServer=r.deletedFromServer,o.updateExistingLibrary(e.collection,e,r.manifest,void 0,function(){e._commit(!0,!0)})})})),t()})}else e._dcxComposite.commitChanges(t)},t.prototype.resolvePullWithBranch=function(e,t,o,i,n){d.log("resolvePullWithBranch"),l.SHARED_LOCAL_STORAGE?(e._dcxComposite._current=t,this._setBase(e.id,o),n()):i?(e._dcxComposite._current=t,n()):e._dcxComposite.resolvePullWithBranch(t,n)
},t.prototype.acceptPush=function(e,t){var o=this;e._dcxComposite.acceptPush(function(i){o._acceptPushedBranchListeners.forEach(function(t){t(e)}),t(i)})},t.prototype.onAcceptPushedBranch=function(e){this._acceptPushedBranchListeners.push(e)},t.prototype.removeOnAcceptPushedBranchListeners=function(){this._acceptPushedBranchListeners=[]},t.prototype._deleteLibrary=function(e,t){d.log("deleteLibrary");var o=e.getLibraryById(t);if(o){var i=e._libraries.indexOf(o);-1!==i&&(e._libraries.splice(i,1),delete e._libraryIdMap[o.id]),o._markDeletedLocally(!0),e._notifyChange(!0)}},t.prototype._loadBranch=function(e,t,o){var i;try{i=new n(void 0,o).parse(t),i._localStorage=e._localStorage}catch(r){}return i},t.prototype._addLibrary=function(e,t,o,n,r){o=o||e._getCompositeDir(t);var a=new i(null,null,o,null,null,{preserveFileExtensions:!0}),l=this._loadBranch(a,n,!1);if(!l)return void r(new c(c.CORRUPTED_LIBRARY,"Library corrupted in local storage",t));if("pendingDelete"===l.compositeState)return void r(null);a._current=l,this._setBase(t,n);var d=new s(e,a);e.isPublic&&(d._publicId=t,d._writable=!1),e._libraries.push(d),e._libraryIdMap[d.id]=d,e._notifyChange(!0),r(null,d)},t.prototype.createNewLibrary=function(e,t,i,n){var r=o(n);d.log("createNewLibrary"),this._addLibrary(e,t,void 0,i,function(e,t){return e||!t?void r(e):(t._commit(!1,!0),void t._waitForCommit(r))})},t.prototype.loadExistingLibrary=function(e,t,i,n,r,a,s){var c=o(s);d.log("loadExistingLibrary"),this._addLibrary(e,t,void 0,n,function(e,t){return e||!t?void c(e):(t._deletedFromServer=r,a&&t._setRenditionCache(a),void c(null,t))})},t.prototype.updateExistingLibrary=function(e,t,i,n,r){var a=this,s=o(r);if(f.areManifestsEqual(t._dcxBranch.localData,i))return d.log("updateExistingLibrary: already up-to-date"),void s();d.log("updateExistingLibrary: changes to update");var p=this._loadBranch(t._dcxComposite,i,!1);return p?void("pendingDelete"===p.compositeState?(e._doRemoveLibrary(t),s()):t._waitForCommit(function(){if(n){if(!f.areManifestsEqual(t._dcxBranch.localData,n))return d.log("Commit aborting: something changed and it's no longer a fast-forward"),void s(!0)}else n=a._getBase(t.id);var e=a._loadBranch(t._dcxComposite,n,!0)||p;d.log("updateExistingLibrary: base "+e.changeCount+" -> updated "+p.changeCount),t._mergeAndSwitchToBranch(p,e,function(){d.log("updateExistingLibrary: finished merge"),l.SHARED_LOCAL_STORAGE?s(null):(t._commit(!1,!0),t._waitForCommit(s))})})):void s(new c(c.CORRUPTED_LIBRARY,"Invalid manifest",t.id))},t.prototype.setRenditionCache=function(e,t,o,i){var n=this._pendingSetRenditionCache[e.library.id],r=m.addToPendingSetRenditionCache(n,e,t,o,i);this._pendingSetRenditionCache[e.library.id]=r},t.prototype.getRenditionPath=function(e,t,i,n){n=n||0;var r=this,a=o(i),s=e._lookupRenditionPath(t||"full");if(s)return void a(null,s);var c={isPublic:e.library.collection.isPublic,userId:e.library.collection.userId,cloudId:e.library.collection.cloudId,id:e.library.id,element:e.id,size:t};d.log("Get rendition path from CCLibrary process"),this._channel.call("getrenditionpath",c,function(o){return!o&&n<l.LOCAL_RENDITION_MAX_RETRIES?(d.log("getrenditionpath: rendition not found"),void setTimeout(function(){r.getRenditionPath(e,t,i,n+1)},l.LOCAL_RENDITION_RETRY_INTERVAL)):void a(null,o)})},t.prototype.notifyDownloadRendition=function(e){this._downloadRenditionListeners.forEach(function(t){t(e)})},t.prototype.onDownloadRendition=function(e){this._downloadRenditionListeners.push(e)},t.prototype.removeOnDownloadRenditionListeners=function(){this._downloadRenditionCacheListeners=[]},t.prototype.notifyStartWrite=function(e,t,i){var n=o(i);if(!l.SHARED_LOCAL_STORAGE)return void n(null);var r={userId:e.collection.userId,cloudId:e.collection.cloudId,id:e.id,dependencies:[]};t.forEach(function(e){r.dependencies.push({userId:e.collection.userId,cloudId:e.collection.cloudId,id:e.id})}),this._channel.call("startcomponentwrite",r,function(){n(null)})},t.prototype.loadPublicLibrary=function(e,t,i){var n=o(i),r={isPublic:e.isPublic,cloudId:e.cloudId,id:t};this._channel.call("loadpubliclibrary",r,function(){n(null)})},t.prototype.unloadPublicLibrary=function(e,t){var i=o(t),n={isPublic:e.collection.isPublic,cloudId:e.collection.cloudId,id:e.id};this._channel.call("unloadpubliclibrary",n,function(){i(null)})},t.prototype.getAssetFromURL=function(e,t,o,i,n){if(l.SHARED_LOCAL_STORAGE){var r={isPublic:e.isPublic,userId:e.userId,cloudId:e.cloudId,url:t,headers:o,tempDir:i};this._channel.call("downloadfile",r,function(e){n(e.err,e.tempFilePath,e.etag,{headers:e.responseHeaders})})}else e._syncManager.getAssetFromURL(t,o,i,n)},t.prototype.doHeadRequestOfURL=function(e,t,o){l.SHARED_LOCAL_STORAGE?o(null):e._syncManager.doHeadRequestOfURL(t,o)},t.prototype.downloadExternalLink=function(e,t){var o={isPublic:e.element.library.collection.isPublic,userId:e.element.library.collection.userId,cloudId:e.element.library.collection.cloudId,id:e.element.library.id,element:e.element.id,representation:e.id};d.log("Download external link from CCLibrary process"),this._channel.call("downloadexternallink",o,function(e){t(e.err,e.path)})},t}),i("AdobeLibraryExternalUtils",["require","exports","module","./AdobeLibraryServices","./utils/AdobeLibraryMimeTypeUtils","./utils/AdobeLibraryRenditionUtils"],function(e){var t=e("./AdobeLibraryServices"),o=e("./utils/AdobeLibraryMimeTypeUtils"),i=e("./utils/AdobeLibraryRenditionUtils"),n={};return n.mimeTypeToExtensions=function(e){return o.getExtensions(e)},n.extensionToMimeTypes=function(e){return o.getMimeTypes(e)},n.canGenerateRenditionFromMimeType=function(e){return i.canComputeRenditionFromMimeType(e)},n.generateUuid=function(){return t.uuid()},n}),i("AdobeLibraryExternalAnalyticsUtils",["require","exports","module","./AdobeLibraryAnalytics"],function(e){var t=e("./AdobeLibraryAnalytics"),o={};return o.reportUseElement=function(e,o,i){t.reportUseElement(e,o,i)},o.reportCheckoutElement=function(e,o){t.reportCheckoutElement(e,o)},o.reportCreateLink=function(e,o){t.reportCreateLink(e,o)},o.reportShareElementLink=function(e){t.reportShareElementLink(e)},o.reportShareLibraryLink=function(e){t.reportShareLibraryLink(e)},o}),i("main",["require","exports","module","./AdobeLibraryServices","./AdobeLibraryConfig","./AdobeLibraryCollection","./AdobeLibraryPublicCollection","./AdobeLibraryCollectionManager","./AdobeLibraryError","./AdobeLibraryStorageInterface","./AdobeLibraryExternalUtils","./AdobeLibraryExternalAnalyticsUtils","./utils/AdobeLibraryFileUtils","./utils/AdobeLibraryManifestUtils"],function(e){function t(e,t,o){var i=e+"/"+t,n=void 0!==f[i];return f[i]=f[i]||[],f[i].push(o),n}function o(e,t){var o;o=e===n.PUBLIC_USER_ID?_.getPublicLibraryCollection(t):_.getLibraryCollection(e,t);var i=e+"/"+t,r=f[i];r&&(delete f[i],r.forEach(function(e){e(null,o)}))}var i=e("./AdobeLibraryServices"),n=e("./AdobeLibraryConfig"),r=e("./AdobeLibraryCollection"),a=e("./AdobeLibraryPublicCollection"),s=e("./AdobeLibraryCollectionManager"),c=e("./AdobeLibraryError"),l=e("./AdobeLibraryStorageInterface"),d=e("./AdobeLibraryExternalUtils"),p=e("./AdobeLibraryExternalAnalyticsUtils"),h=e("./utils/AdobeLibraryFileUtils"),u=e("./utils/AdobeLibraryManifestUtils"),_=new s,f={},m={};return m.configure=function(e,t){if(i.hasFileSystem()||void 0!==t.SHARED_LOCAL_STORAGE||(t.SHARED_LOCAL_STORAGE=!1),i.hasFileSystem()&&!t.ROOT_DIR&&t.SHARED_LOCAL_STORAGE===!1)throw new c(c.INVALID_PARAMETER,"Missing ROOT_DIR option");if(i.hasFileSystem()&&t.ROOT_DIR&&t.SHARED_LOCAL_STORAGE!==!1)throw new c(c.INVALID_PARAMETER,"ROOT_DIR option doesn't apply when using shared local storage");if(!i.hasFileSystem()&&t.ROOT_DIR)throw new c(c.REQUIRES_FILESYSTEM,"ROOT_DIR option only applies when you have a filesystem");if(t.SHARED_LOCAL_STORAGE===!1&&!t.STORAGE_API_KEY)throw new c(c.INVALID_PARAMETER,"Missing STORAGE_API_KEY option");if(t.SHARED_LOCAL_STORAGE!==!1&&!i.hasCEPVulcan()&&!e.vulcanCall)throw new c(c.INVALID_PARAMETER,"Shared local storage requires either the CEP VulcanInterface/VulcanMessage as globals, or for you to pass in the vulcanCall dependency");if(t.ROOT_DIR)for(;-1!==["/","\\"].indexOf(t.ROOT_DIR.substr(-1));)t.ROOT_DIR=t.ROOT_DIR.slice(0,-1);Object.keys(t).forEach(function(e){n.setParameter(e,t[e])}),i.analytics=e.analytics,i.vulcanCall=e.vulcanCall,i._log=e.log,i._getDisplayName=e.getDisplayName,i.storageInterface&&i.storageInterface.shutdown(),i.storageInterface=new l(_),i.log("Configure: "+(n.SHARED_LOCAL_STORAGE?"<shared local storage>":n.ROOT_DIR))},m.setOption=function(e,t){var o=["ROOT_DIR","SHARED_LOCAL_STORAGE","ELEMENT_TYPE_FILTERS","STORAGE_API_KEY"];if(-1!==o.indexOf(e))throw new c(c.INVALID_PARAMETER,"Cannot reconfigure "+e);n.setParameter(e,t),i.storageInterface.updateConfiguration()},m.getLoadedCollections=function(){return _.getLoadedCollections().slice(0)},m.getLoadedCollectionById=function(e,t){return _.getLibraryCollection(e,t)},m.getLoadedPublicCollectionById=function(e){return _.getPublicLibraryCollection(e)},m.addLoadedCollectionsListener=function(e){_.addLoadedCollectionsListener(e)},m.removeLoadedCollectionsListener=function(e){_.removeLoadedCollectionsListener(e)},m.getRootDir=function(){if(!i.hasFileSystem())throw new c(c.REQUIRES_FILESYSTEM,"ROOT_DIR option only applies when you have a filesystem");return n.ROOT_DIR},m.unloadLibraryCollection=function(e){if(n.SHARED_LOCAL_STORAGE)throw new c(c.NOT_SUPPORTED,"unloadLibraryCollection() not supported with shared local storage");e.stopPolling(),e._removeAllListeners(),_.removeLibraryCollection(e)},m.loadLibraryCollection=function(e,a){function s(){_.addLibraryCollection(l),n.AUTO_START_POLLING&&l.startPolling(),o(e.USER_ID,e.CLOUD_ID)}if("function"==typeof e)return a=e,void a(new c(c.INVALID_PARAMETER,"options argument not specified"));if(n.SHARED_LOCAL_STORAGE)return void a(new c(c.NOT_SUPPORTED,"loadLibraryCollection() not supported with shared local storage"));if(i.hasFileSystem()&&!n.SHARED_LOCAL_STORAGE&&!n.ROOT_DIR)return void a(new c(c.INVALID_PARAMETER,"ROOT_DIR not configured. Make sure you call CCLibraries.configure()"));if(e=e||{},i.hasFileSystem()&&!e.USER_ID)return void a(new c(c.INVALID_PARAMETER,"Missing USER_ID option"));if(e.CLOUD_ID=e.CLOUD_ID||n.DEFAULT_CLOUD_ID,!e.STORAGE_HOSTNAME)return void a(new c(c.INVALID_PARAMETER,"Missing STORAGE_HOSTNAME option"));var l=_.getLibraryCollection(e.USER_ID,e.CLOUD_ID),d=t(e.USER_ID,e.CLOUD_ID,a);if(l&&!d)return void o(e.USER_ID,e.CLOUD_ID);if(!d)if(l=new r(e),i.hasFileSystem())h.doesRootDirExist(l,function(e,t){l._load(function(){t||l._setInitialSyncState(!0),l.sync(function(){l._setInitialSyncState(!1)}),s()})});else if("all"===e.WAIT_FOR)l._setInitialSyncState(!0),l.sync(function(){l._setInitialSyncState(!1),s()});else if(u.validateLibraryId(e.WAIT_FOR,!1)){l._setInitialSyncState(!0,[e.WAIT_FOR]),l.sync(function(){l._setInitialSyncState(!1)});var p=function(){("syncing"!==l.syncState||"pending"!==l._libraryIdMap[e.WAIT_FOR])&&(l.removeChangeListener(p),l.removeSyncListener(p),s())};l.addChangeListener(p),l.addSyncListener(p)}else l._setInitialSyncState(!0),l.sync(function(){l._setInitialSyncState(!1)}),s()},m.loadPublicLibraryCollection=function(e,r){function s(){_.addLibraryCollection(l),n.AUTO_START_POLLING&&l.startPolling(),o(n.PUBLIC_USER_ID,e.CLOUD_ID)}if("function"==typeof e)return r=e,void r(new c(c.INVALID_PARAMETER,"options argument not specified"));if(n.SHARED_LOCAL_STORAGE)return void r(new c(c.NOT_SUPPORTED,"loadPublicLibraryCollection() not supported with shared local storage"));if(i.hasFileSystem()&&!n.SHARED_LOCAL_STORAGE&&!n.ROOT_DIR)return void r(new c(c.INVALID_PARAMETER,"ROOT_DIR not configured. Make sure you call CCLibraries.configure()"));if(e=e||{},e.USER_ID)return void r(new c(c.INVALID_PARAMETER,"USER_ID not configurable for a public library collection"));if(e.CLOUD_ID=e.CLOUD_ID||n.DEFAULT_CLOUD_ID,!e.STORAGE_HOSTNAME)return void r(new c(c.INVALID_PARAMETER,"Missing STORAGE_HOSTNAME option"));var l=_.getPublicLibraryCollection(e.CLOUD_ID),d=t(n.PUBLIC_USER_ID,e.CLOUD_ID,r);return l&&!d?void o(n.PUBLIC_USER_ID,e.CLOUD_ID):void(d||(l=new a(e),i.hasFileSystem()?l._load(function(){l.sync(),s()}):s()))},m.isConnected=function(){if(!n.SHARED_LOCAL_STORAGE)throw new c(c.NOT_SUPPORTED,"isConnected() is only applicable if using shared local storage");return i.storageInterface&&i.storageInterface.isConnected()},m.reconnect=function(){if(!n.SHARED_LOCAL_STORAGE)throw new c(c.NOT_SUPPORTED,"reconnect() is only applicable if using shared local storage");i.storageInterface&&i.storageInterface.reconnect()},m.getServiceInfo=function(){if(!n.SHARED_LOCAL_STORAGE)throw new c(c.NOT_SUPPORTED,"getServiceInfo() is only applicable if using shared local storage");return i.storageInterface&&i.storageInterface.getServiceInfo()},m.isSyncingEnabled=function(){if(n.SHARED_LOCAL_STORAGE){var e=m.getServiceInfo();return e&&e.syncingEnabled?!0:!1}return n.SYNCING_ENABLED},m.enableSyncing=function(){if(n.SHARED_LOCAL_STORAGE)throw new c(c.NOT_SUPPORTED,"enableSyncing() not supported with shared local storage");n.SYNCING_ENABLED=!0,m.getLoadedCollections().forEach(function(e){e.sync()})},m.disableSyncing=function(){if(n.SHARED_LOCAL_STORAGE)throw new c(c.NOT_SUPPORTED,"disableSyncing() not supported with shared local storage");n.SYNCING_ENABLED=!1},m.resolveElementReference=function(e){var t,o=new RegExp("cloud-asset://(.+)"+n.STORAGE_ASSETS_PATH+n.LIBRARY_SYNC_GROUP+"/([A-Za-z0-9-]+);node=([A-Za-z0-9-]+)"),i=e.match(o);if(i){var r=i[1],a=i[2],s=i[3];m.getLoadedCollections().every(function(e){if(e._syncManager._storageHost===r){var o=e.getLibraryById(a);return o&&(t=o.getElementById(s)),!1}return!0})}return t},m.errors=c,m.utils=d,m.analyticsUtils=p,m}),o("main")});
//# sourceMappingURL=cc-libraries-api.min.js
//# sourceMappingURL=cc-libraries-api.min.js.map