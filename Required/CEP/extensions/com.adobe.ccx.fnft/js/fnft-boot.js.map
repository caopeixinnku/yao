{"version":3,"sources":["tophat.js","cepUtil.js","bootstrap.js","riotcontrol.js"],"names":["every","ar","fn","i","j","length","each","el","tophat","paths","idOrDone","optDone","loopFn","item","call","list","callback","queue","id","done","dset","delay","split","push","idOrDoneIsDone","join","setTimeout","loading","path","force","test","scriptpath","indexOf","scripts","ids","create","this","loaded","document","createElement","onload","onerror","onreadystatechange","readyState","async","src","urlArgs","body","appendChild","get","order","s","shift","p","str","ready","deps","req","missing","dep","key","window","iaw","cepUtil","oneTimeHandler","csInterface","CSInterface","isStage","applicationID","getApplicationID","events","EXTENSIONREADY","LOGPIP","kOpenRecentFile","kExecuteMenuCmd","kHostStatusChanged","REQUESTHOSTCLOSE","kOpenDropFiles","kOpenPreferences","kTrialExpired","kGetUserJSONDataRequest","kGetUserJSONDataResponse","NEWDOCFROMTEMPLATE","HOSTCLOSEFNFT","REQUESTDATACALC","UPDATEDATACALC","LOADEXTENSION","SAVEPRESET","DELETEPRESET","INTERACTIVEREADY","FNFTSTARTTIME","FNFTENDTIME","authenticationInfo","adobeStock","clientID","clientScope","adobeLearn","adobeAccount","imsInfo","imsInterface","IMSInterface","stageConfig","label","clientId","clientSecret","scope","redirectUri","imsServer","productionConfig","activeConfig","imsRef","imsTimeout","accessToken","accessTokenCallbacks","accessTokenInProgress","lastAccessTokenTime","Date","valueOf","needRetry","setEnvironment","mode","isIMSDataValid","event","data","handleFetchAccessToken","self","extensionId","getExtensionID","jump","clearTimeout","removeEventListener","imsFetchAccessToken","imsData","JSON","parse","e","access_token","log","console","stringify","getAccessToken","numCallbacks","index","accessTokenTimeout","currentTime","clearAccessToken","imsConnect","addEventListener","bind","localstorage","userID","imsGetCurrentUserIdHelper","userGUID","getIMSAccounts","imsFetchAccounts","createFetchContinueTokenCall","imsJumpClientID","imsJumpScope","url","imsFetchContinueToken","baseURL","encodeURIComponent","jumpURL","handleJumpURL","details","isStagingRedirectInEffect","answer","__adobe_cep__","DOMParser","VulcanInterface","getAppPath","getOSInformation","result","cep","fs","readFile","err","xmlDoc","parseFromString","configNode","getElementsByTagName","namespaces","namespace","getAttribute","properties","property","pVal","firstChild","nodeValue","ignore","imsValid","Boolean","evalExtendScript","script","evalScript","evalExtendScriptWithParams","arguments","Error","paramsArray","args","Array","prototype","slice","pop","commandName","map","arg","param","replace","sendEvent","eventType","eventData","optExtensionID","CSEvent","appId","type","dispatchEvent","getExtensionVersion","useBundleVersion","verInfo","version","sha","extensionDir","getSystemPath","SystemPath","EXTENSION","os","pathSeparator","manifestPath","fileContents","parser","extManifestElement","attributes","getNamedItem","firstElementChild","isUserSignedIn","adobeGUID","usingStageAuthentication","getIMSAccessToken","getPrimaryAccountType","accountType","accounts","accType","exception","message","getUIThemeColor","getHostEnvironment","appSkinInfo","panelBackgroundColor","color","addThemeChangeListener","util","setUIThemeMode","createJumpURL","getExtensionPath","perf","markStart","loadTime","measure","timers","CORELIBS","setHighBeamMode","analytics","pip","fnftCategory","hostData","store","Baobab","immutable","persistent","set","DataTime","HostData","hostID","hostIDlc","toLowerCase","loadAppScript","oncontextmenu","title","interfaceColor","red","classList","remove","apps","init","boot","receivedHostData","jsData","json","fnftDataReceiver","initHost","fnftFakeHostData","initPresets","fnftPresetData","initTemplates","fnftFakeStockData","fnftFakeLicensedTemplates","UI","fnft","handleUpdateCalcData","riotReady","mountApp","hostReady","appMounted","riot","mount","radarVersion","radarSessionGUID","generateGUID","ingestServer","InitHost","filters","generateFilters","displayCount","parseInt","getUserItem","setUserItem","i18n","addFromURLFile","addFromLocalLocaleFile","language","evt","riotctrl","trigger","logJSON","motor","start","startup","run","PHASES","Doc","Host","platform","comboCmd","comboPer","which","closeExtension","HostPresetData","templates","presetData","presetLUT","hostId","uuid","lastUsedTime","getTimezoneOffset","InteractiveTime","getTemplates","StockData","getStockData","stockData","LicensedData","sd","generateDefaultStockData","libraryManager","getCachedTemplates","then","licensedTemplates","TemplateFixup","licensedTemplatesLUT","templateCount","tIndex","presets","forEach","preset","isPreset","getIdByCachedElementRef","elementRef","getIdByElementRef","stockTemplate","licensedDataIndex","undefined","licensedData","modified","licensedTime","thumbnail_url","template_category","templateIds","concat","filter","template","pos","templateLUT","Done","activeItem","querySelector","focus","JSLibLateLoad","loadExternalScript","scriptTag","Ingest","INGESTCONFIG","config","fnftLoadingEndTime","getCurrentTime","toString","report","TEMPLATE_ELEMENT_TYPE","LoadTime","preventDefault","h","parseQueryString","location","hash","burnt","RETROACTIVE","on","name","ctx","apply","once","off","evtArr","evts","liveEvents","len"],"mappings":"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","file":"fnft-boot.js","sourcesContent":["(function() {\n\tvar push = 'push';\n\tvar readyState = 'readyState';\n\tvar onreadystatechange = 'onreadystatechange';\n\t// var head = document.getElementsByTagName('head')[0];\n\tvar list = {};\n\tvar ids = {};\n\tvar delay = {};\n\tvar scripts = {};\n\tvar scriptpath;\n\tvar urlArgs;\n\n\tfunction every(ar, fn) {\n\t\tfor (var i = 0, j = ar.length; i < j; ++i) {\n\t\t\tif (!fn(ar[i])) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn 1;\n\t}\n\n\tfunction each(ar, fn) {\n\t\tevery(ar, function(el) {\n\t\t\tfn(el);\n\t\t\treturn 1;\n\t\t});\n\t}\n\n\tfunction tophat(paths, idOrDone, optDone) {\n\t\tpaths = paths[push] ? paths : [paths];\n\t\tvar idOrDoneIsDone = idOrDone && idOrDone.call,\n\t\t\tdone = idOrDoneIsDone ? idOrDone : optDone,\n\t\t\tid = idOrDoneIsDone ? paths.join('') : idOrDone,\n\t\t\tqueue = paths.length;\n\n\t\tfunction loopFn(item) {\n\t\t\treturn item.call ? item() : list[item];\n\t\t}\n\t\tfunction callback() {\n\t\t\tif (!--queue) {\n\t\t\t\tlist[id] = 1;\n\t\t\t\tdone && done();\n\t\t\t\tfor (var dset in delay) {\n\t\t\t\t\tevery(dset.split('|'), loopFn) && !each(delay[dset], loopFn) && (delay[dset] = []);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tsetTimeout(function() {\n\t\t\teach(paths, function loading(path, force) {\n\t\t\t\tif (path === null) return callback();\n\n\t\t\t\tif (!force && !/^https?:\\/\\//.test(path) && scriptpath) {\n\t\t\t\t\tpath = (path.indexOf('.js') === -1) ? scriptpath + path + '.js' : scriptpath + path;\n\t\t\t\t}\n\n\t\t\t\tif (scripts[path]) {\n\t\t\t\t\tif (id) ids[id] = 1;\n\t\t\t\t\treturn (scripts[path] == 2) ? callback() : setTimeout(function() { loading(path, true); }, 0);\n\t\t\t\t}\n\n\t\t\t\tscripts[path] = 1;\n\t\t\t\tif (id) ids[id] = 1;\n\t\t\t\tcreate(path, callback);\n\t\t\t});\n\t\t}, 0);\n\t\treturn this;\n\t}\n\n\tfunction create(path, fn) {\n\t\tvar el = document.createElement('script'), loaded;\n\t\tel.onload = el.onerror = el[onreadystatechange] = function() {\n\t\t\tif ((el[readyState] && !(/^c|loade/.test(el[readyState]))) || loaded) return;\n\t\t\tel.onload = el[onreadystatechange] = null;\n\t\t\tloaded = 1;\n\t\t\tscripts[path] = 2;\n\t\t\tfn();\n\t\t};\n\t\tel.async = 1;\n\t\tel.src = urlArgs ? path + (path.indexOf('?') === -1 ? '?' : '&') + urlArgs : path;\n\t\tdocument.body.appendChild(el);\n\t\t// head.appendChild(el);\n\t}\n\n\ttophat.get = create;\n\n\ttophat.order = function(scripts, id, done) {\n\t\t(function callback(s) {\n\t\t\ts = scripts.shift();\n\t\t\t!scripts.length ? tophat(s, id, done) : tophat(s, callback);\n\t\t}());\n\t};\n\n\ttophat.path = function(p) {\n\t\tscriptpath = p;\n\t};\n\n\ttophat.urlArgs = function(str) {\n\t\turlArgs = str;\n\t};\n\n\ttophat.ready = function(deps, ready, req) {\n\t\tdeps = deps[push] ? deps : [deps];\n\t\tvar missing = [];\n\t\t!each(deps, function(dep) {\n\t\t\tlist[dep] || missing[push](dep);\n\t\t}) && every(deps, function(dep) {\n\t\t\treturn list[dep];\n\t\t}) ? ready() : ! function(key) {\n\t\t\tdelay[key] = delay[key] || [];\n\t\t\tdelay[key][push](ready);\n\t\t\treq && req(missing);\n\t\t}(deps.join('|'));\n\t\treturn tophat;\n\t};\n\n\ttophat.done = function(idOrDone) {\n\t\ttophat([null], idOrDone);\n\t};\n\n\twindow.tophat = tophat;\n}());\n","/*************************************************************************\n * ADOBE CONFIDENTIAL\n * ___________________\n *\n *  Copyright 2015 Adobe Systems Incorporated\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by all applicable intellectual property\n * laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n **************************************************************************/\n\n/**\n * Simple singleton style container so all CEP related stuff has a centralized point.\n */\nvar iaw = iaw || { };\n\niaw.cepUtil = {\n\t/**\n\t * Encapsulated interfaces\n\t */\n\toneTimeHandler: false,\n\tcsInterface: (window.__adobe_cep__) ? new CSInterface()  : null,\n\tisStage: null,\n\n\t/**\n\t * Hosting application and extension data\n\t */\n\tapplicationID:\t(window.__adobe_cep__) ? new CSInterface().getApplicationID() : 'SIMU',\n\n\t/**\n\t * Events sent to the hosting application\n\t */\n\tevents: {\n\t\tEXTENSIONREADY:\t\t\t\t'com.adobe.ccx.start.extensionReady',\n\t\tLOGPIP:\t\t\t\t\t\t'com.adobe.ccx.start.LOGPIP',\n\t\tkOpenRecentFile:\t\t\t'com.adobe.ccx.start.handleRecentFileOpen',\n\t\tkExecuteMenuCmd:\t\t\t'com.adobe.ccx.start.handleExecuteMenuCommand',\n\t\tkHostStatusChanged: \t\t'com.adobe.ccx.start.hostStatusChanged',\n\t\tREQUESTHOSTCLOSE:\t\t\t'com.adobe.ccx.start.requestHostClose',\n\t\tkOpenDropFiles:\t\t\t\t'com.adobe.ccx.start.handleDropFileOpen',\n\t\tkOpenPreferences:\t\t\t'com.adobe.ccx.start.handleOpenPreferences',\n\t\tkTrialExpired:\t\t\t\t'com.adobe.ccx.start.trialExpired',\n\t\tkGetUserJSONDataRequest: \t'com.adobe.ccx.start.getCCXUserJSONData.request',\n\t\tkGetUserJSONDataResponse: \t'com.adobe.ccx.start.getCCXUserJSONData.response',\n\t\tNEWDOCFROMTEMPLATE:\t\t\t'com.adobe.ccx.fnft.newDocFromTemplate',\n\t\tHOSTCLOSEFNFT:\t\t\t\t'com.adobe.ccx.fnft.hostRequestsClose',\n\t\tREQUESTDATACALC:\t\t\t'com.adobe.ccx.fnft.requestDataCalculation',\n\t\tUPDATEDATACALC:\t\t\t\t'com.adobe.ccx.fnft.updateDataCalculation',\n\t\tLOADEXTENSION:\t\t\t\t'com.adobe.extension.loadExtension',\n\t\tSAVEPRESET: \t\t\t\t'com.adobe.ccx.fnft.savePreset',\n\t\tDELETEPRESET: \t\t\t\t'com.adobe.ccx.fnft.deletePreset',\n\t\tINTERACTIVEREADY: \t\t\t'com.adobe.extension.interactiveReady',\n\t\tFNFTSTARTTIME: \t\t\t\t'com.adobe.ccx.fnft.loadStartTime',\n\t\tFNFTENDTIME: \t\t\t\t'com.adobe.ccx.fnft.loadEndTime'\n\t},\n\n\t/**\n\t * params for jump URL authentication\n\t */\n\tauthenticationInfo: {\n\t\tadobeStock:\t{\n\t\t\tclientID:\t\t'AdobeStockClient1',\n\t\t\tclientScope:\t'AdobeID,openid,creative_cloud,read_organizations,gnav,additional_info.address.mail_to,sao.stock'\n\t\t},\n\t\tadobeLearn: {\n\t\t\tclientID:\t\t'adobedotcom2',\n\t\t\tclientScope :\t'creative_cloud,AdobeID,openid,gnav,read_organizations,additional_info.projectedProductContext'\n\t\t},\n\t\tadobeAccount: {\n\t\t\tclientID:\t\t'adobedotcom2',\n\t\t\tclientScope:\t'creative_cloud,AdobeID,openid,gnav,read_organizations,additional_info.projectedProductContext'\n\t\t}\n\t},\n\n\t/**\n\t * IMS configuration info\n\t */\n\timsInfo: {\n\t\timsInterface: (window.__adobe_cep__) ? new IMSInterface() : null,\n\n\t\tstageConfig: {\n\t\t\tlabel:\t\t\t'Stage',\n\t\t\tclientId:\t\t'CCXInAppWelcome',\n\t\t\tclientSecret:\t'2625f91d-efa1-4685-a64d-eb36ad123f09',\n\t\t\tscope:\t\t\t'openid,AdobeID,creative_cloud',\n\t\t\tredirectUri:\t'https://oobe.adobe.com',\n\t\t\timsServer:\t\t'ims-na1-stg1.adobelogin.com'\n\t\t},\n\n\t\tproductionConfig: {\n\t\t\tlabel:\t\t\t'Production',\n\t\t\tclientId:\t\t'CCXInAppWelcome',\n\t\t\tclientSecret:\t'75606424-3628-4f70-82fb-9a1bf5dfb6b5',\n\t\t\tscope:\t\t\t'openid,AdobeID,creative_cloud',\n\t\t\tredirectUri:\t'https://oobe.adobe.com',\n\t\t\timsServer:\t\t'ims-na1.adobelogin.com'\n\t\t},\n\t\tactiveConfig:\t\t\tnull,\n\t\timsRef:\t\t\t\t\tnull,\n\t\timsTimeout:\t\t\t\tnull,\n\t\taccessToken:\t\t\tnull,\n\t\taccessTokenCallbacks:\t[],\n\t\taccessTokenInProgress:\tfalse,\n\t\tlastAccessTokenTime: \tnew Date().valueOf(),\n\t\tneedRetry: true,\n\n\t\t/**\n \t\t * Set server environment for IMS.\n\t\t *\n\t\t * @param mode          either 'stage' or 'prod'\n\t\t */\n\t\tsetEnvironment: function( mode ) {\n\n\t\t\tthis.activeConfig = (mode === 'stage') ? this.stageConfig : this.productionConfig;\n\t\t},\n\n\t\t/**\n\t\t * Check to make sure the data event is valid.\n\t\t *\n\t\t * @param event         object containing the access token and other IMS data\n\t\t */\n\t\tisIMSDataValid: function( event ) {\n\n\t\t\treturn ( event && event.data && event.data !== '');\n\t\t},\n\n\t\t/**\n\t\t * Async callback for returning the IMS token.\n\t\t *\n\t\t * @param event         object containing the access token and other IMS data\n\t\t */\n\t\thandleFetchAccessToken: function(event) {\n\t\t\tvar self = this;\n\t\t\tif (event && (event.extensionId !== iaw.cepUtil.getExtensionID())) {\n\t\t\t\t//Should filter out IMS events from other CEP extensions, like photoshop preview.\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (event && event.data && event.data.jump) {\n\t\t\t\t// Should filter out IMS jump event\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( self.imsTimeout ) {\n\t\t\t\tclearTimeout( self.imsTimeout );\n\t\t\t\tself.imsTimeout = null;\n\t\t\t}\n//            iaw.log.debug('Handling fetch access token callback: ' + JSON.stringify(event));\n\n\t\t\t// clear the event listener\n\t\t\tself.imsInterface.removeEventListener( self.imsInterface.events.imsFetchAccessToken, self.handleFetchAccessToken );\n\n\t\t\t// setup access token\n\t\t\t// support both string and object type, because CEP 6.0 takes\n\t\t\t// event.data as an object, CEP 6.1 mainline takes it as a string\n\t\t\t// at the moment. Not sure it's a potential bug or required change\n\t\t\t// in CEP, but Radar should handle both cases.\n\t\t\tif ( self.isIMSDataValid(event) ) {\n\t\t\t\tswitch (typeof event.data) {\n\t\t\t\t\tcase 'string':\n\t\t\t\t\t\tvar imsData;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\timsData = JSON.parse(event.data);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch (e) {\n\t\t\t\t\t\t\t// ignore\n\t\t\t\t\t\t}\n\t\t\t\t\t\tself.accessToken = (imsData && imsData.access_token) ? imsData.access_token : null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'object':\n\t\t\t\t\t\tself.accessToken = event.data.access_token || null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tself.accessToken = null;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (!self.accessToken) {\n\t\t\t\t\tiaw.log.console('IMS response event: ' + JSON.stringify(event));\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tiaw.log.console('Failed to get access token: ' + JSON.stringify(event));\n\t\t\t}\n\n\t\t\t// clear in progress flag...\n\t\t\tself.accessTokenInProgress = false;\n\t\t\tiaw.log.console('IMS accessToken is : ' + self.accessToken);\n\n\t\t\tif (self.accessToken === null && self.needRetry) {\n\t\t\t\t// Probably host app hasn't loaded IMS native library yet and it's related to the sequence of loading navtive libraries in host app.\n\t\t\t\t// So have to retry once for the very first fetch token if it fails.\n\t\t\t\t// Ideally, host app needs to adjust the sequence of native libraries. But to be releastic, such workaround is not avoidable.\n\t\t\t\tself.needRetry = false;\n\t\t\t\tiaw.cepUtil.imsInfo.getAccessToken();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// handle all the token requests that may have come in while\n\t\t\t// we were in the fetching process\n\t\t\tvar numCallbacks = self.accessTokenCallbacks.length;\n\n\t\t\tif ( numCallbacks ) {\n\t\t\t\tself.lastAccessTokenTime = new Date().valueOf();\n\t\t\t\tfor ( var index = 0; index < numCallbacks; ++index ) {\n\t\t\t\t\tvar callback = self.accessTokenCallbacks[index];\n\n\t\t\t\t\tif ( callback ) { callback(self.accessToken); }\n\t\t\t\t}\n\t\t\t\tself.accessTokenCallbacks = [];\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Handle timeout for access token fetch.\n\t\t */\n\t\taccessTokenTimeout: function() {\n\n\t\t\tiaw.log.console('IMS access token fetch has timed out');\n\t\t\tiaw.cepUtil.imsInfo.imsTimeout = null;\n\t\t\tiaw.cepUtil.imsInfo.handleFetchAccessToken(null);\n\t\t},\n\n\t\t/**\n\t\t * Retrieve the IMS access token.\n\t\t *\n\t\t * @param callback          function to call upon completion\n\t\t * @return A string containing the access token.\n\t\t */\n\t\tgetAccessToken: function( callback ) {\n\n\t\t\tvar self = this;\n\t\t\t// make sure we have the configuration setup - if not\n\t\t\t// the set the default to the production configuration\n\t\t\tif ( !self.activeConfig ) { self.activeConfig = self.productionConfig; }\n\n\t\t\t// make sure we are not already in progress as this is\n\t\t\t// an async exercise when getting the token\n\t\t\tif ( !self.accessTokenInProgress ) {\n\t\t\t\t// Clear the expired access token\n\t\t\t\tvar currentTime = new Date().valueOf();\n\t\t\t\tif (currentTime - self.lastAccessTokenTime >= 3600 * 24 * 1000) {\n\t\t\t\t\tiaw.log.console('Clear expired access token.');\n\t\t\t\t\tself.clearAccessToken();\n\t\t\t\t}\n\t\t\t\tif ( self.accessToken && self.accessToken.length !== 0 && callback ) {\n\t\t\t\t\tcallback(self.accessToken);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tself.accessTokenInProgress = true;\n\t\t\t\tif (callback) {\n\t\t\t\t\tself.accessTokenCallbacks.push(callback);\n\t\t\t\t}\n\n\t\t\t\t// create the IMS reference object\n\t\t\t\tif ( !self.imsRef && self.imsInterface ) {\n\t\t\t\t\tself.imsRef = self.imsInterface.imsConnect( self.activeConfig.clientId );\n\t\t\t\t}\n\n\t\t\t\t// set the event listener for getting the access token\n\t\t\t\t// this will cause the specified handler function to fire.\n\t\t\t\t// need to bind this so that 'this' in callback is exact the same.\n\t\t\t\tself.imsInterface.addEventListener( self.imsInterface.events.imsFetchAccessToken,\n\t\t\t\t\t(function( event ) {\n\t\t\t\t\t\tthis.handleFetchAccessToken( event );\n\t\t\t\t\t}).bind(this));\n\n\t\t\t\tif (iaw.localstorage.userID) {\n\t\t\t\t\tself.imsInterface.imsFetchAccessToken(\tself.imsRef,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tself.activeConfig.clientId,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tself.activeConfig.clientSecret,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tiaw.localstorage.userID,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tself.activeConfig.redirectUri,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tself.activeConfig.scope);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// get the currently logged in user's Adobe GUID to send to IMS\n\t\t\t\t\tself.imsInterface.imsGetCurrentUserIdHelper( function(userGUID) {\n\t\t\t\t\t\tif (userGUID && userGUID.length > 0) {\n\t\t\t\t\t\t\tself.imsInterface.imsFetchAccessToken(\tself.imsRef,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tself.activeConfig.clientId,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tself.activeConfig.clientSecret,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tuserGUID,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tself.activeConfig.redirectUri,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tself.activeConfig.scope);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif ( self.imsTimeout ) {\n\t\t\t\t\tclearTimeout( self.imsTimeout );\n\t\t\t\t}\n\n\t\t\t\t// If IMS doesn't respond in 10s, assume something went wrong\n\t\t\t\tself.imsTimeout = setTimeout(self.accessTokenTimeout, 10000);\n\t\t\t}\n\t\t\telse { // token running so just push the callback for later\n\t\t\t\tself.accessTokenCallbacks.push(callback);\n\t\t\t}\n\t\t},\n\n\t\tgetIMSAccounts: function() {\n\n\t\t\tvar self = this;\n\t\t\t// make sure we have the configuration setup - if not\n\t\t\t// the set the default to the production configuration\n\t\t\tif ( !self.activeConfig ) { self.activeConfig = self.productionConfig; }\n\n\t\t\t// create the IMS reference object\n\t\t\tif ( !self.imsRef && self.imsInterface ) {\n\t\t\t\tself.imsRef = self.imsInterface.imsConnect( self.activeConfig.clientId );\n\t\t\t}\n\n\t\t\t//fetch the accounts with the client ID\n\t\t\treturn self.imsInterface.imsFetchAccounts(self.imsRef, self.activeConfig.clientId);\n\t\t},\n\n\t\t/**\n\t\t * Clear access token.\n\t\t */\n\t\tclearAccessToken: function() {\n\t\t\tthis.accessToken = null;\n\t\t},\n\n\t\t/**\n\t\t * Handle the jump continue token call to get the authenicated URL.\n\t\t *\n\t\t * @param imsJumpClientID           client ID\n\t\t * @param imsJumpScope              client scope parameters\n\t\t * @param url                       base URL\n\t\t * @param callback                  completion callback\n\t\t */\n\t\tcreateFetchContinueTokenCall: function(imsJumpClientID, imsJumpScope, url, callback) {\n\n\t\t\tiaw.log.console('createFetchContinueTokenCall attempting SSO workflows');\n\n\t\t\tthis.imsInterface.addEventListener(this.imsInterface.events.imsFetchContinueToken, callback);\n\t\t\tvar baseURL = encodeURIComponent(url);\n\n\t\t\tthis.imsInterface.imsFetchContinueToken(this.imsRef,\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.accessToken,\n\t\t\t\t\t\t\t\t\t\t\t\t\timsJumpClientID,\n\t\t\t\t\t\t\t\t\t\t\t\t\tbaseURL,\n\t\t\t\t\t\t\t\t\t\t\t\t\timsJumpScope,\n\t\t\t\t\t\t\t\t\t\t\t\t\t'token',\n\t\t\t\t\t\t\t\t\t\t\t\t\t'');\n\t\t},\n\n\t\t/**\n\t\t * Create an authenicated jump URL.\n\t\t *\n\t\t * @param imsJumpClientID           client ID\n\t\t * @param imsJumpScope              client scope parameters\n\t\t * @param url                       base URL\n\t\t * @param callback                  completion callback\n\t\t */\n\t\tjumpURL: function(imsJumpClientID, imsJumpScope, url, callback) {\n\n\t\t\tvar self = this;\n\t\t\tvar handleJumpURL = function(event) { //eslint-disable-line func-style\n\t\t\t\tself.imsInterface.removeEventListener(self.imsInterface.events.imsFetchContinueToken, handleJumpURL);\n\t\t\t\tif ( callback ) {\n\t\t\t\t\tcallback((self.isIMSDataValid(event) && event.data.details.jump) ? event.data.details.jump : url);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tiaw.log.console('Attempting SSO workflows for url ' + url);\n\t\t\tthis.createFetchContinueTokenCall(imsJumpClientID, imsJumpScope, url, handleJumpURL);\n\t\t},\n\n\t\t/**\n\t\t * Detect IMS environment.\n\t\t * @return true if IMS env is redirected to stage, otherwise false.\n\t\t */\n\t\tisStagingRedirectInEffect: function() {\n\n\t\t\tvar answer = false;\n\n\t\t\tif (!window.__adobe_cep__ || !window.DOMParser) { return answer; }\n\t\t\ttry {\n\t\t\t\tvar csInterface = new CSInterface();\n\t\t\t\tvar path = VulcanInterface.getAppPath('creativecloud') + (csInterface.getOSInformation().indexOf('Win') > -1 ? '\\\\..\\\\..\\\\C3Config.xml' : '/../../C3Config.xml');\n\t\t\t\tiaw.log.console('Path of S3Config.xml: ' + path);\n\t\t\t\tvar result = window.cep.fs.readFile(path);\n\n\t\t\t\tif (0 !== result.err) {\n\t\t\t\t\treturn answer;\n\t\t\t\t}\n\n\t\t\t\tvar xmlDoc\t\t= new DOMParser().parseFromString(result.data, 'text/xml');\n\t\t\t\tvar configNode\t= xmlDoc.getElementsByTagName('C3Config')[0].getElementsByTagName('config')[0];\n\n\t\t\t\tif (configNode) {\n\t\t\t\t\tvar namespaces = configNode.getElementsByTagName('namespace');\n\n\t\t\t\t\tfor (var index = 0; index < namespaces.length; index++) {\n\t\t\t\t\t\tvar namespace = namespaces[index];\n\n\t\t\t\t\t\tif (namespace && namespace.getAttribute('name') === 'accc.container') {\n\t\t\t\t\t\t\tvar properties = namespace.getElementsByTagName('property');\n\n\t\t\t\t\t\t\tfor (var i=0; i< properties.length; i++) {\n\t\t\t\t\t\t\t\tvar property = properties[i];\n\n\t\t\t\t\t\t\t\tif (property && property.getAttribute('name') === 'IMS_ENV') {\n\t\t\t\t\t\t\t\t\t// We found the IMS environment setting. See if stage redirection is in effect.\n\t\t\t\t\t\t\t\t\tvar pVal = property.firstChild.nodeValue;\n\n\t\t\t\t\t\t\t\t\tif (pVal === 'STG') {\n\t\t\t\t\t\t\t\t\t\tanswer = true;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (ignore) {\n\t\t\t\t// ignore catches\n\t\t\t}\n\t\t\treturn answer;\n\t\t}\n\t}, // end imsInfo container\n\n\t/**\n\t * Indicate IMS operations are valid.\n\t *\n\t * @return boolean value indicating true if IMS is available, false otherwise\n\t */\n\timsValid: function() {\n\n\t\treturn Boolean(this.imsInfo.imsInterface);\n\t},\n\n\t/**\n\t * Execute an ExtendScript DOM script.\n\t *\n\t * @param script        script to execute\n\t * @param callback      completion callback method\n\t */\n\tevalExtendScript: function(script, callback) {\n\n\t\t// make sure we have a callback\n\t\tif ( !callback ) {\n\t\t\tcallback = function(result) { };\n\t\t}\n\n\t\t// call CEP ExtendScript processor\n\t\tif ( window.__adobe_cep__ ) {\n\t\t\twindow.__adobe_cep__.evalScript( script, callback );\n\t\t}\n\t\telse {\n\t\t\tcallback( null );\n\t\t}\n\t},\n\n\t/**\n\t * Evaluate an extend script after first building the string from a command name and zero or more parameters\n\t * The last argument must be a callback\n\t *\n\t * If a param is an object, it will use JSON.stringify\n\t * That JSON, and other string params, will be escaped properly\n\t *\n\t * example:\n\t * iaw.cepUtil.evalExtendScriptWithParams('CCXWelcomeXSHost_PHXS.createDocumentFromTemplate',\n\t *    tempObj, docName, showDialog, iaw.fnft.closeExtOnStatus)\n\t *\n\t * @param {string} commandName\n\t * @param {object|string|number=} param optional, zero or more\n\t * @param {function} callback final argument must be a callback\n\t */\n\tevalExtendScriptWithParams: function() {\n\t\tif (arguments.length < 2) {\n\t\t\tthrow new Error('evalExtendScriptWithParams needs at least two arguments: script and callback');\n\t\t}\n\n\t\tvar args = Array.prototype.slice.call(arguments),\n\t\t\tcallback = args.pop(),\n\t\t\tcommandName = args.shift(),\n\t\t\tparamsArray,\n\t\t\tscript;\n\n\t\tparamsArray = args.map(function(arg) {\n\t\t\tvar param = (typeof arg === 'object') ? JSON.stringify(arg) : arg;\n\n\t\t\tif (typeof param === 'string') {\n\t\t\t\treturn '\"' + param.replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"') + '\"';\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn param;\n\t\t\t}\n\t\t});\n\n\t\tscript = commandName + '(' + paramsArray.join(',') + ')';\n\n\t\t// call CEP ExtendScript processor\n\t\tif ( window.__adobe_cep__ ) {\n\t\t\twindow.__adobe_cep__.evalScript( script, callback );\n\t\t}\n\t\telse {\n\t\t\tcallback( null );\n\t\t}\n\t},\n\n\t/**\n\t * Send an event back to the hosting application.\n\t *\n\t * @param eventType         type of event, @see this.events\n\t * @param eventData         data to be sent along with the event\n\t * @param optExtensionID\toptional extension override ID\n\t */\n\tsendEvent: function(eventType, eventData, optExtensionID) {\n\n\t\tif ( window.__adobe_cep__ ) {\n\t\t\tvar event = new CSEvent();\n\n\t\t\tevent.scope         = 'APPLICATION';\n\t\t\tevent.appId         = this.applicationID;\n\t\t\tevent.extensionId   = optExtensionID || iaw.cepUtil.getExtensionID();\n\t\t\tevent.type          = eventType;\n\t\t\tevent.data          = eventData;\n\n\t\t\tthis.csInterface.dispatchEvent(event);\n\t\t}\n\t},\n\n\t/**\n\t * Retrieves the Hello CEP extension's ID from the manifest XML.\n\t *\n\t * @return A string containing the ID from the manifest.\n\t */\n\tgetExtensionID: function() {\n\n\t\treturn ( window.__adobe_cep__ && this.csInterface ) ? this.csInterface.getExtensionID() : '';\n\t},\n\n\t/**\n\t * Retrieves the Hello CEP extension's version from the manifest XML.\n\t *\n\t * @param useBundeledVersion    boolean to indicate which of two possible\n\t *                                  version numbers to use\n\t * @return A string containing the version from the manifest.\n\t */\n\tgetExtensionVersion: function( useBundleVersion ) {\n\n\t\tvar verInfo = { version : '0.0.0', sha : null };\n\n\t\tif ( window.__adobe_cep__ ) {\n\t\t\tvar csInterface     = this.csInterface;\n\t\t\tvar extensionDir    = csInterface.getSystemPath(SystemPath.EXTENSION);\n\n\t\t\t// since we are reading from a local file, it is OS specific so we\n\t\t\t// will need the proper path separator\n\t\t\tvar os              = csInterface.getOSInformation();\n\t\t\tvar pathSeparator   = os.indexOf('Win') >= 0 ? '\\\\' : '/';\n\t\t\tvar manifestPath    = extensionDir + pathSeparator + 'CSXS' + pathSeparator + 'manifest.xml';\n\t\t\tvar fileContents    = window.cep.fs.readFile( manifestPath );\n\n\t\t\tif ( window.DOMParser ) {\n\t\t\t\tvar parser              = new window.DOMParser();\n\t\t\t\tvar xmlDoc              = parser.parseFromString( fileContents.data, 'text/xml' );\n\t\t\t\tvar extManifestElement  = xmlDoc.getElementsByTagName( 'ExtensionManifest' )[0];\n\n\t\t\t\tif ( typeof extManifestElement !== 'undefined' && extManifestElement ) {\n\t\t\t\t\tverInfo.sha = extManifestElement.attributes.getNamedItem('SHA').nodeValue;\n\t\t\t\t\tverInfo.version = ( !useBundleVersion ) ?\n\t\t\t\t\t\textManifestElement.getElementsByTagName( 'ExtensionList' )[0].firstElementChild.attributes.getNamedItem('Version').nodeValue :\n\t\t\t\t\t\textManifestElement.attributes.getNamedItem('ExtensionBundleVersion').nodeValue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn verInfo;\n\t},\n\n\t/**\n\t * Async check if user signed in or not.\n\t * @param callback      callback method which takes the following parameters:\n\t *                          a boolean value to indicate user signed in or not\n\t *                          if true, the logged in Adobe GUID is passed in the\n\t *                          second parameter, if false, the second parameter\n\t *                          will be null\n\t */\n\tisUserSignedIn: function(callback) {\n\n\t\tvar imsInterface = this.imsInfo.imsInterface;\n\n\t\tif ( imsInterface ) {\n\t\t\timsInterface.imsGetCurrentUserIdHelper( function(adobeGUID) {\n\n\t\t\t\tif ( callback ) {\n\t\t\t\t\tif (adobeGUID && adobeGUID.length > 0) {\n\t\t\t\t\t\tcallback( true, adobeGUID );\n\t\t\t\t\t}\n\t\t\t\t\telse { callback( false, null ); }\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\t/**\n\t * Initialize IMS to either the stage or production (default) servers.\n\t *\n\t * @param mode          either 'stage' or 'prod'\n\t */\n\tsetEnvironment: function( mode ) {\n\n\t\tif ( this.imsInfo.imsInterface ) {\n\t\t\tthis.imsInfo.setEnvironment( mode );\n\t\t}\n\t},\n\n\t/**\n\t * Determine if we are using the stage IMS servers or the production.\n\t *\n\t * @return true if on the IMS stage authentication, false otherwise.\n\t */\n\tusingStageAuthentication: function() {\n\t\tif ( this.isStage === null ) {\n\t\t\tthis.isStage = this.imsInfo.isStagingRedirectInEffect();\n\t\t}\n\t\treturn this.isStage;\n\t},\n\n\t/**\n\t * Get the IMS authentication token for the current user. This is\n\t * an asynchronous call so requires a completion callback which\n\t * gets called when the process has been completed.\n\t *\n\t * @param callback          completion callback\n\t */\n\tgetIMSAccessToken: function( callback ) {\n\n\t\tif ( this.imsInfo.imsInterface ) {\n\t\t\tthis.imsInfo.getAccessToken( callback );\n\t\t}\n\t},\n\n\tgetPrimaryAccountType: function() {\n\t\t\n\t\tvar accountType = '';\n\t\tvar accounts = '';\n\n\t\ttry {\n\t\t\tif (this.imsInfo.imsInterface) {\n\t\t\t\taccounts = this.imsInfo.getIMSAccounts();\n\t\t\t}\n\t\t\tvar xmlDoc = new DOMParser().parseFromString(accounts, 'text/xml');\n\t\t\tvar accType\t= xmlDoc.getElementsByTagName('UserAccounts')[0].getElementsByTagName('UserData')[0].getElementsByTagName('AccountType')[0];\n\t\t\tif (accType) {\n\t\t\t\taccountType = accType.firstChild.nodeValue;\n\t\t\t}\n\t\t}\n\t\tcatch (e) {\n\t\t\tiaw.log.console('Exception in fetching account type');\n\t\t\tiaw.log.exception('Fetch account type exception: ' + e.message);\n\t\t}\n\t\treturn accountType;\n\t},\n\t\n\t/**\n\t * Clear access token.\n\t */\n\tclearAccessToken: function() {\n\t\tif ( this.imsInfo.imsInterface ) {\n\t\t\tthis.imsInfo.clearAccessToken();\n\t\t}\n\t},\n\n\t/**\n\t * Get the current UI theme color.\n\t *\n\t * @return A color object containing the current UI color setting.\n\t */\n\tgetUIThemeColor: function() {\n\n\t\treturn ( this.csInterface ) ? this.csInterface.getHostEnvironment().appSkinInfo.panelBackgroundColor.color : null;\n\t},\n\n\t/**\n\t * Attaches the theme change listener to detect the theme changes from\n\t * the host application.\n\t */\n\taddThemeChangeListener: function() {\n\n\t\tif ( this.csInterface ) {\n\t\t\tthis.csInterface.addEventListener( 'com.adobe.csxs.events.ThemeColorChanged', (function( event ) {\n\t\t\t\tiaw.util.setUIThemeMode();\n\t\t\t}).bind(this));\n\t\t}\n\t},\n\n\t/**\n\t * Create a authenticated jump URL based on client specification.\n\t *\n\t * @param clientID      SSO client ID\n\t * @param clientScope   SSO client scope\n\t * @param url           base url\n\t * @param callback      callback method which takes the following parameters:\n\t *                          the jump url to deal with\n\t */\n\tcreateJumpURL: function(clientID, clientScope, url, callback) {\n\t\tif ( this.imsValid ) {\n\t\t\tthis.imsInfo.jumpURL(clientID, clientScope, url, callback);\n\t\t}\n\t},\n\n\t/**\n\t * Return the path to the extensions root folder.\n\t *\n\t * @return A string containing the extensions root path or null if CEP is not being used.\n\t */\n\tgetExtensionPath: function() {\n\n\t\tvar path = null;\n\n\t\tif ( this.csInterface ) {\n\t\t\tvar os              = this.csInterface.getOSInformation();\n\t\t\tvar pathSeparator   = os.indexOf('Win') >= 0 ? '\\\\' : '/';\n\n\t\t\tpath = this.csInterface.getSystemPath(SystemPath.EXTENSION)+pathSeparator;\n\t\t}\n\t\treturn path;\n\t}\n};\n","/*************************************************************************\n * ADOBE CONFIDENTIAL\n * ___________________\n *\n *  Copyright 2016 Adobe Systems Incorporated\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by all applicable intellectual property\n * laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n **************************************************************************/\n\n// start loading in all the scripts\ntophat.path('./js/');\n\n// load head and iaw to start things off\ntophat(['fnft-head.js', 'fnft-iaw.js'], function() {\n\t// @ifdef DEBUG\n\tiaw.perf.markStart(window.loadTime); // set the beginning of performance marking\n\tiaw.perf.measure(iaw.perf.timers.CORELIBS, window.loadTime);\n\tiaw.perf.setHighBeamMode(true, iaw.analytics.pip.fnftCategory); // setup HighBeam for point products\n\t// @endif\n\n\tvar hostData = null;\n\n\t// create data store and attach listeners to it so we know when the data is ready to use\n\tiaw.store = new Baobab({}, {\n\t\timmutable:  false,\n\t\tpersistent: false\n\t});\n\n\t// @ifdef DEBUG\n\tiaw.perf.set(iaw.perf.timers.DataTime);\n\tiaw.perf.set(iaw.perf.timers.HostData);\n\t// @endif\n\n\t// get the host app personalization data immediately\n\tif (window.__adobe_cep__) {\n\t\tvar hostID = iaw.cepUtil.applicationID;\n\t\tvar hostIDlc = hostID.toLowerCase();\n\t\tvar loadAppScript = false;\n\n\t\t// disable right click menu\n\t\tdocument.oncontextmenu = function() { return false; };\n\t\t// set the title for the debugger so we know what we are using\n\t\tdocument.title = iaw.cepUtil.getExtensionID();\n\t\t// add theme change event listener\n\t\tiaw.cepUtil.addThemeChangeListener();\n\n\t\t// immediately set the theme so there's no flashing colors\n\t\tvar interfaceColor = iaw.cepUtil.csInterface ? iaw.cepUtil.getUIThemeColor() : null;\n\t\tif (interfaceColor && interfaceColor.red >= 184) {\n\t\t\tdocument.body.classList.remove('spc--dark');\n\t\t}\n\n\t\tswitch (hostIDlc) {\n\t\t\tcase 'phxs':\n\t\t\t\tloadAppScript = true;\n\t\t\t\tbreak;\n\t\t}\n\t\tiaw.log.console('CEP extension for '+hostID+' initializing - acquiring host data...');\n\n\t\t// this host needs special help with parsing data\n\t\tif (loadAppScript) {\n\t\t\ttophat('app-'+hostIDlc+'.js', function() {\n\t\t\t\tiaw.apps[hostIDlc].init(boot.receivedHostData, 'fnft');\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\t// this host loads the old way, so we call into XS from here\n\t\t\tiaw.cepUtil.evalExtendScript('CCXWelcomeXSHost_'+hostID+'.getUserJSONData(\"fnft\")', function(jsData) {\n\t\t\t\tif (!jsData) {\n\t\t\t\t\tiaw.log.console('Cmd-N extension host data ' + jsData + ' so return');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\ttry {\n\t\t\t\t\thostData = JSON.parse(jsData, iaw.json.fnftDataReceiver);\n\t\t\t\t}\n\t\t\t\tcatch (err) {\n\t\t\t\t\tiaw.log.console('Cmd-N extension host data in catch block: ' + jsData);\n\t\t\t\t\tiaw.log.exception(err);\n\t\t\t\t}\n\t\t\t\t// check if our parse went ok\n\t\t\t\tboot.receivedHostData(hostData);\n\t\t\t});\n\t\t}\n\t}\n\telse {\n\t\tboot.initHost(iaw.fnftFakeHostData);\n\t\tboot.initPresets(iaw.fnftPresetData);\n\t\tboot.initTemplates(iaw.fnftFakeStockData, iaw.fnftFakeLicensedTemplates);\n\t}\n\n\t// @ifdef DEBUG\n\tiaw.perf.set(iaw.perf.timers.UI);\n\t// @endif\n\n\t// register the status changed event for the AI/ID field calculation update from the host\n\tif (window.__adobe_cep__ && !iaw.cepUtil.oneTimeHandler) {\n\t\tiaw.cepUtil.oneTimeHandler = true;\n\t\tiaw.cepUtil.csInterface.addEventListener(iaw.cepUtil.events.UPDATEDATACALC, iaw.fnft.handleUpdateCalcData);\n\t}\n\n\t// now that the initial logic is done, start loading in the ui\n\ttophat(['fnft-uilib.js', 'spectre-ui.min.js'], function() {\n\t\t// console.log('----- ui lib ready');\n\t\t// riot now exists, so bring in the components\n\t\ttophat('fnft-ui.js', function() {\n\t\t\t// @ifdef DEBUG\n\t\t\tiaw.perf.measure(iaw.perf.timers.UI);\n\t\t\t// @endif\n\t\t\twindow.boot.riotReady = true;\n\t\t\twindow.boot.mountApp();\n\t\t});\n\t});\n});\n\n/*\n\tCallbacks\n*/\nwindow.boot = {\n\triotReady: false,\n\thostReady: false,\n\tappMounted: false,\n\n\t/**\n\t *\tCalled to load as soon as both riot lib and host data are ready\n\t */\n\tmountApp: function() {\n\t\tif (boot.appMounted || !boot.riotReady || !boot.hostReady) return;\n\t\tboot.appMounted = true;\n\n\t\tsetTimeout(function() {\n\t\t\tiaw.perf.set('riot.mount.app');\n\t\t\triot.mount('container-templates');\n\t\t\tiaw.perf.measure('riot.mount.app');\n\t\t}, 0);\n\t},\n\n\t/**\n\t *\tCallback for host data event in CEP only\n\t */\n\treceivedHostData: function(hostData) {\n\t\tif (hostData) {\n\t\t\thostData.radarVersion = iaw.cepUtil.getExtensionVersion(true).version;\n\t\t\thostData.radarSessionGUID = iaw.util.generateGUID();\n\n\t\t\tboot.initHost(hostData);\n\t\t}\n\t},\n\n\t/**\n\t * After host data is loaded, initialize the app\n\t */\n\tinitHost: function(hostData) {\n\t\tif (!hostData) return;\n\t\t// @ifdef DEBUG\n\t\tiaw.perf.measure(iaw.perf.timers.HostData);\n\t\t// @endif\n\n\t\t// configure authentication servers\n\t\thostData.ingestServer = 'prod';\n\n\t\tif (!iaw.cepUtil.usingStageAuthentication()) {\n\t\t\tiaw.log.console('Authentication environment to production');\n\t\t}\n\t\telse {\n\t\t\tiaw.cepUtil.setEnvironment('stage');\n\t\t\thostData.ingestServer = 'stage';\n\t\t\tiaw.log.console('Authentication environment to stage');\n\t\t}\n\n\t\t// @ifdef DEBUG\n\t\tiaw.perf.set(iaw.perf.timers.InitHost);\n\t\t// @endif\n\n\t\t// add filters & template data from host\n\t\thostData.filters = iaw.fnft.generateFilters(hostData.hostID);\n\t\tiaw.localstorage.userID = hostData.adobeGUID;\n\n\t\t// display count\n\t\thostData.displayCount = parseInt(iaw.localstorage.getUserItem('fnft.displayCount') || 0) + 1;\n\t\tiaw.localstorage.setUserItem('fnft.displayCount', hostData.displayCount);\n\n\t\tiaw.store.set('host', hostData);\n\n\t\tiaw.perf.set('i18n json');\n\t\t// add go URL localization maps\n\t\tiaw.i18n.addFromURLFile('goURL');\n\t\tiaw.i18n.addFromLocalLocaleFile(hostData.language, function(evt) {\n\t\t\tiaw.perf.measure('i18n json');\n\t\t\triotctrl.trigger('update-i18n-retro');\n\t\t});\n\n\t\t// log the finalize data\n\t\tif (window.__adobe_cep__) {\n\t\t\tiaw.log.logJSON('host.data: ', hostData);\n\t\t}\n\n\t\t// start our resize/RWD/DOM update tool\n\t\tiaw.motor.start();\n\t\tiaw.startup.run(iaw.startup.PHASES.Doc); // fnft doesn't have a doc load event, so this is good enough\n\t\tiaw.startup.run(iaw.startup.PHASES.Host);\n\n\t\t// @ifdef DEBUG\n\t\tiaw.perf.measure(iaw.perf.timers.InitHost);\n\t\t// @endif\n\n\t\tif (hostData.platform === 'mac') {\n\t\t\t// mac gets special treatment to allow \"cmd+period\" to close the dialog\n\t\t\tvar comboCmd = false;\n\t\t\tvar comboPer = false;\n\t\t\tdocument.addEventListener('keydown', function(evt) {\n\t\t\t\tif (evt.which === 91) comboCmd = true;\n\t\t\t\tif (evt.which === 190) comboPer = true;\n\t\t\t\tif (comboCmd && comboPer) {\n\t\t\t\t\twindow.__adobe_cep__.closeExtension();\n\t\t\t\t}\n\t\t\t}, false);\n\t\t\tdocument.addEventListener('keyup', function(evt) {\n\t\t\t\tif (evt.which === 91) comboCmd = false;\n\t\t\t\tif (evt.which === 190) comboPer = false;\n\t\t\t}, false);\n\t\t}\n\n\t\tif (!window.__adobe_cep__) return;\n\n\t\t// add host close listener\n\t\tiaw.cepUtil.csInterface.addEventListener(iaw.cepUtil.events.HOSTCLOSEFNFT, function() {\n\t\t\twindow.__adobe_cep__.closeExtension();\n\t\t});\n\n\t\t// get the preset data from host\n\t\tiaw.log.console('CEP extension for '+hostData.hostID+' initializing - acquiring preset data...');\n\n\t\t// @ifdef DEBUG\n\t\tiaw.perf.set(iaw.perf.timers.HostPresetData);\n\t\t// @endif\n\n\t\tvar hostIDlc = hostData.hostID.toLowerCase();\n\n\t\tif (iaw.apps && iaw.apps[hostIDlc]) {\n\t\t\tiaw.apps[hostIDlc].initPresets(window.boot.initPresets, 'fnft');\n\t\t}\n\t\telse {\n\t\t\tboot.initPresets(hostData.templates);\n\t\t}\n\t},\n\n\t// presets have been loaded\n\tinitPresets: function(presetData) {\n\t\tvar presetLUT = {};\n\n\t\tvar hostId = iaw.store.get(['host', 'hostID']);\n\t\tfor (var i = 0; i < presetData.length; i++) {\n\t\t\tvar uuid = iaw.util.generateGUID();\n\n\t\t\tpresetData[i].uuid = uuid;\n\t\t\t// Workaround to convert preset's lastUsedTime of AI to local time\n\t\t\tif (hostId === 'ILST' && presetData[i].lastUsedTime) {\n\t\t\t\tpresetData[i].lastUsedTime += (new Date().getTimezoneOffset() * 60000);\n\t\t\t}\n\t\t\tpresetLUT[uuid] = i;\n\t\t}\n\n\t\tiaw.store.set('presets', presetData);\n\t\tiaw.store.set('presetLUT', presetLUT);\n\n\t\tif (window.__adobe_cep__) {\n\t\t\tiaw.log.logJSON('presets.data', presetData);\n\t\t\tiaw.log.logJSON('presets.lut', presetLUT);\n\t\t}\n\n\t\t// @ifdef DEBUG\n\t\tiaw.perf.measure(iaw.perf.timers.HostPresetData);\n\t\tiaw.perf.measure(iaw.perf.timers.InteractiveTime, window.loadTime);\n\t\t// @endif\n\n\t\t// fill the grid with presets\n\t\triotctrl.trigger('update-host-retro');\n\n\t\twindow.boot.hostReady = true;\n\t\twindow.boot.mountApp();\n\n\t\tif (!window.__adobe_cep__) return;\n\n\t\tboot.getTemplates();\n\t},\n\n\t// initialize data fetch\n\tgetTemplates: function() {\n\t\tvar hostData = iaw.store.get('host');\n\t\t// console.log('-----------> getTemplates');\n\t\tiaw.perf.set(iaw.perf.timers.StockData);\n\t\tiaw.fnft.getStockData(hostData, function(stockData) {\n\t\t\t// @ifdef DEBUG\n\t\t\tiaw.perf.measure(iaw.perf.timers.StockData);\n\t\t\tiaw.perf.set(iaw.perf.timers.LicensedData);\n\t\t\t// @endif\n\n\t\t\tvar sd = stockData || iaw.fnft.generateDefaultStockData(hostData);\n\t\t\t// For the sake of getting best performance, the idea is to retrieve cached licensed template from CC library snapshot directly\n\t\t\t// rather than loading the cc library js file and init it. This probaly saves up more than 400ms.\n\t\t\tiaw.libraryManager.getCachedTemplates(hostData.hostID)\n\t\t\t.then(function(licensedTemplates) {\n\t\t\t\t// @ifdef DEBUG\n\t\t\t\tiaw.perf.measure(iaw.perf.timers.LicensedData);\n\t\t\t\tiaw.perf.measure(iaw.perf.timers.DataTime);\n\t\t\t\t// @endif\n\t\t\t\tboot.initTemplates(sd, licensedTemplates);\n\t\t\t});\n\n\t\t\tiaw.log.logJSON('stock.data: ', sd);\n\t\t});\n\t},\n\n\t// populate the UI with the templates after it's been loaded\n\tinitTemplates: function(stockData, licensedTemplates) {\n\t\tiaw.perf.set(iaw.perf.timers.TemplateFixup);\n\t\t// move all the licensed templates into the recent tab and update the\n\t\t// last used time so they sort correctly with the presets\n\t\tvar licensedTemplatesLUT = {};\n\t\tvar templateCount = licensedTemplates.length;\n\t\tvar tIndex = 0;\n\n\t\t// TODO: we should initializing an empty array only, after we split out the presets\n\t\tvar templates = [];\n\t\tlicensedTemplates = licensedTemplates || [];\n\n\t\tfor (tIndex; tIndex < templateCount; ++tIndex) {\n\t\t\tlicensedTemplatesLUT[licensedTemplates[tIndex].id] = tIndex;\n\t\t\t// licensedTemplates[tIndex].template_category = [\"recent\"]; // eslint-disable-line camelcase\n\t\t\t// licensedTemplates[tIndex].lastUsedTime = licensedTemplates[tIndex].modified;\n\t\t}\n\n\t\tif (window.__adobe_cep__) {\n\t\t\tiaw.log.logJSON('licensed.data: ', licensedTemplates);\n\t\t}\n\n\t\t// lastUsedTime priority: host > local cache > cc library\n\t\tvar presets = iaw.store.get('presets');\n\t\tif (presets) {\n\t\t\tpresets.forEach(function(preset) {\n\t\t\t\tif (preset && (!preset.isPreset)) {\n\t\t\t\t\tvar id = iaw.libraryManager.getIdByCachedElementRef(preset.elementRef) || iaw.libraryManager.getIdByElementRef(preset.elementRef);\n\t\t\t\t\tiaw.localstorage.setUserItem('templateLUT_' + id, preset.lastUsedTime);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// merge in stock data\n\t\tif (stockData && stockData.templates) {\n\t\t\ttemplateCount = stockData.templates.length;\n\t\t\tfor (tIndex = 0; tIndex < templateCount; ++tIndex) {\n\t\t\t\tvar stockTemplate = stockData.templates[tIndex];\n\t\t\t\tvar licensedDataIndex = licensedTemplatesLUT[stockTemplate.id];\n\n\t\t\t\tif (licensedDataIndex !== undefined) {\n\t\t\t\t\tvar licensedData = licensedTemplates[licensedDataIndex];\n\n\t\t\t\t\tstockTemplate.url = licensedData.url;\n\t\t\t\t\tstockTemplate.elementRef = licensedData.elementRef;\n\t\t\t\t\tstockTemplate.lastUsedTime = iaw.localstorage.getUserItem('templateLUT_' + stockTemplate.id) || licensedData.modified;\n\t\t\t\t\tstockTemplate.licensedTime = licensedData.modified;\n\t\t\t\t\tstockTemplate.thumbnail_url = licensedData.thumbnail_url; // eslint-disable-line camelcase\n\t\t\t\t\tstockTemplate.template_category.push('recent');\t// eslint-disable-line camelcase\n\t\t\t\t\tstockTemplate.template_category.push('saved'); // eslint-disable-line camelcase\n\t\t\t\t}\n\t\t\t\t// make sure all templates have a lastUsedTime parameter defined\n\t\t\t\tif (stockTemplate.lastUsedTime === undefined) {\n\t\t\t\t\tstockTemplate.lastUsedTime = 0;\n\t\t\t\t}\n\t\t\t\t// make sure all templates have a licensedTime parameter defined\n\t\t\t\tif (stockTemplate.licensedTime === undefined) {\n\t\t\t\t\tstockTemplate.licensedTime = 0;\n\t\t\t\t}\n\t\t\t\ttemplates.push(stockTemplate);\n\t\t\t}\n\t\t}\n\n\t\t// merge the licensed templates to the master list\n\t\tvar templateIds = {};\n\t\ttemplates = templates.concat(licensedTemplates);\n\t\ttemplates = templates.filter(function(template, pos) {\n\t\t\tif (!templateIds[template.id]) {\n\t\t\t\ttemplateIds[template.id] = true;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\n\t\t// add UUID's to all templates & presets, and build quick reference lookup table\n\t\tvar templateLUT = {};\n\t\ttemplateCount = templates.length;\n\n\t\tfor (tIndex = 0; tIndex < templateCount; ++tIndex) {\n\t\t\tvar uuid = iaw.util.generateGUID();\n\n\t\t\ttemplates[tIndex].uuid = uuid;\n\t\t\ttemplateLUT[uuid] = tIndex;\n\t\t}\n\n\t\tiaw.store.set('templates', templates);\n\t\tiaw.store.set('templateLUT', templateLUT);\n\n\t\tiaw.startup.run(iaw.startup.PHASES.Done);\n\n\t\t// make sure the active item still retains keyboard focus\n\t\tvar activeItem = document.querySelector('.preset-grid-item--active');\n\t\tif (!activeItem) {\n\t\t\t// maybe a template is active, not a preset\n\t\t\tactiveItem = document.querySelector('.template-grid-item--active');\n\t\t}\n\t\tif (activeItem) {\n\t\t\tactiveItem.focus();\n\t\t}\n\n\t\tif (window.__adobe_cep__) {\n\t\t\tiaw.log.logJSON('templates.data', templates);\n\t\t\tiaw.log.logJSON('templates.lut', templateLUT);\n\t\t}\n\t\tiaw.perf.measure(iaw.perf.timers.TemplateFixup);\n\n\t\t// last scripts that we need which aren't used until the user interacts with something\n\t\tiaw.perf.set(iaw.perf.timers.JSLibLateLoad);\n\t\tiaw.util.loadExternalScript('js/marked.min.js')\n\t\t\t.then(function(scriptTag) {\n\t\t\t\t// notify app\n\t\t\t\triotctrl.trigger('markdown-ready-retro');\n\t\t\t});\n\n\t\tiaw.util.loadExternalScript('js/fnft-lib.js')\n\t\t\t.then(function(scriptTag) {\n\t\t\t\t// configure Ingest\n\t\t\t\tif (typeof Ingest !== 'undefined') {\n\t\t\t\t\tiaw.perf.measure(iaw.perf.timers.JSLibLateLoad);\n\t\t\t\t\tiaw.perf.set(iaw.perf.timers.INGESTCONFIG);\n\n\t\t\t\t\tvar hostData = iaw.store.get('host');\n\n\t\t\t\t\tiaw.analytics.config('CCXInAppWelcome', hostData, null, hostData.ingestServer);\n\t\t\t\t\tiaw.perf.measure(iaw.perf.timers.INGESTCONFIG);\n\t\t\t\t\t\n\t\t\t\t\t//send an event to the host app with the end time\n\t\t\t\t\tvar fnftLoadingEndTime = iaw.util.getCurrentTime();\n\n\t\t\t\t\tiaw.log.console('Cmd-N loading ends at: ' + fnftLoadingEndTime);\n\t\t\t\t\tiaw.cepUtil.sendEvent(iaw.cepUtil.events.FNFTENDTIME, fnftLoadingEndTime.toString());\n\t\t\t\t\tiaw.perf.report(true);\n\t\t\t\t}\n\t\t\t});\n\n\t\t// Delay load & init cc Libraries.\n\t\tiaw.libraryManager.init(iaw.libraryManager.TEMPLATE_ELEMENT_TYPE);\n\n\t\t// log primary load time - we have kicked asynch requests but they havent returned (possibly) yet\n\t\tiaw.perf.measure(iaw.perf.timers.LoadTime, window.loadTime);\n\n\t\t// let the host know we are finished for the most part\n\t\tiaw.cepUtil.sendEvent(iaw.cepUtil.events.INTERACTIVEREADY, null);\n\t\t// @endif\n\t}\n};\n\n/**\n * Add event listeners for drag/drop for the dashboard/panel.\n */\nwindow.addEventListener('dragover', function(e) {\n\te = e || event;\n\t// prevent default to allow drop\n\te.preventDefault();\n}, false);\n\nwindow.addEventListener('drop', function(e) {\n\te = e || event;\n\te.preventDefault();\n}, false);\n\nwindow.addEventListener('dragstart', function(e) {\n\te = e || event;\n\t// Prevent browser-default drag behavior\n\te.preventDefault();\n}, true);\n\nwindow.addEventListener('hashchange', function(e) {\n\te = e || event;\n\te.preventDefault();\n\n\tvar h = iaw.util.parseQueryString(location.hash);\n\triotctrl.trigger('hashchange', h);\n}, false);\n","/*************************************************************************\n * ADOBE CONFIDENTIAL\n * ___________________\n *\n *  Copyright 2015 Adobe Systems Incorporated\n *  All Rights Reserved.\n *\n * NOTICE:  All information contained herein is, and remains\n * the property of Adobe Systems Incorporated and its suppliers,\n * if any.  The intellectual and technical concepts contained\n * herein are proprietary to Adobe Systems Incorporated and its\n * suppliers and are protected by all applicable intellectual property\n * laws, including trade secret and copyright laws.\n * Dissemination of this information or reproduction of this material\n * is strictly forbidden unless prior written permission is obtained\n * from Adobe Systems Incorporated.\n **************************************************************************/\n\nwindow.riotctrl = {\n\tevents: {},\n\t// events that have already been fired\n\tburnt: {},\n\t// if listener wants to know if it's already been fired, name the event with this string in it\n\tRETROACTIVE: '-retro',\n\n\ton: function(name, callback, ctx) {\n\t\t(this.events[name] || (this.events[name] = [])).push({\n\t\t\tfn: callback,\n\t\t\tctx: ctx\n\t\t});\n\n\t\tif (!!this.burnt[name] && name.indexOf(this.RETROACTIVE) !== -1) {\n\t\t\t// it already happened and this event is retro-active, so fire immediately with any data that was sent with it then\n\t\t\tcallback.apply(ctx, this.burnt[name]);\n\t\t}\n\n\t\treturn this;\n\t},\n\n\tonce: function(name, callback, ctx) {\n\t\tvar self = this;\n\t\t// disable esLint for the following line\n\t\t// since its calls back into itself and we dont want to change the scope\n\t\tvar fn = function() { //eslint-disable-line func-style\n\t\t\tself.off(name, fn);\n\t\t\tcallback.apply(ctx, arguments);\n\t\t};\n\n\t\treturn this.on(name, fn, ctx);\n\t},\n\n\ttrigger: function(name) {\n\t\tvar data = [].slice.call(arguments, 1); // convert args to array\n\t\tvar evtArr = (this.events[name] || []).slice(); // clone arr (probably not necessary, but safe)\n\t\tvar i = 0;\n\t\tvar evt = null;\n\n\t\tfor (i; evt = evtArr[i]; i++) {  //eslint-disable-line no-cond-assign\n\t\t\tevt.fn.apply(evt.ctx, data);\n\t\t}\n\n\t\tif (name.indexOf(this.RETROACTIVE) !== -1) {\n\t\t\t// record emission for future listeners\n\t\t\tthis.burnt[name] = data;\n\t\t}\n\n\t\treturn this;\n\t},\n\n\toff: function(name, callback) {\n\t\tvar evts = this.events[name];\n\t\tvar liveEvents = [];\n\n\t\tif (evts && callback) {\n\t\t\tfor (var i = 0, len = evts.length; i < len; i++) {\n\t\t\t\tif (evts[i].fn !== callback) liveEvents.push(evts[i]);\n\t\t\t}\n\t\t}\n\n\t\t// remove event from queue to prevent memory leak\n\t\tif (liveEvents.length) {\n\t\t\tthis.events[name] = liveEvents;\n\t\t}\n\t\telse {\n\t\t\tdelete this.events[name];\n\t\t}\n\n\t\treturn this;\n\t}\n};\n"]}