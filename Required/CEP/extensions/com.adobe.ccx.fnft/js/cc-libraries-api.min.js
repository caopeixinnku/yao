/************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
* Copyright 2015-2016 Adobe Systems Incorporated
* All Rights Reserved.
*
* NOTICE: All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any. The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
* @PreserveInCompilation
**************************************************************************/
!function(e,t){"function"==typeof define&&define.amd?define([],t):e.ccLibraries=t()}(this,function(){var e;e=window.nodeRequire?window.nodeRequire:function(){};var t,o,i;if(function(e){function n(e,t){return A.call(e,t)}function r(e,t){var o,i,n,r,a,s,c,l,d,p,u,h=t&&t.split("/"),_=g.map,f=_&&_["*"]||{};if(e&&"."===e.charAt(0))if(t){for(h=h.slice(0,h.length-1),e=e.split("/"),a=e.length-1,g.nodeIdCompat&&b.test(e[a])&&(e[a]=e[a].replace(b,"")),e=h.concat(e),d=0;d<e.length;d+=1)if(u=e[d],"."===u)e.splice(d,1),d-=1;else if(".."===u){if(1===d&&(".."===e[2]||".."===e[0]))break;d>0&&(e.splice(d-1,2),d-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((h||f)&&_){for(o=e.split("/"),d=o.length;d>0;d-=1){if(i=o.slice(0,d).join("/"),h)for(p=h.length;p>0;p-=1)if(n=_[h.slice(0,p).join("/")],n&&(n=n[i])){r=n,s=d;break}if(r)break;!c&&f&&f[i]&&(c=f[i],l=d)}!r&&c&&(r=c,s=l),r&&(o.splice(0,s,r),e=o.join("/"))}return e}function a(t,o){return function(){return h.apply(e,E.call(arguments,0).concat([t,o]))}}function s(e){return function(t){return r(t,e)}}function c(e){return function(t){m[e]=t}}function l(t){if(n(y,t)){var o=y[t];delete y[t],v[t]=!0,u.apply(e,o)}if(!n(m,t)&&!n(v,t))throw new Error("No "+t);return m[t]}function d(e){var t,o=e?e.indexOf("!"):-1;return o>-1&&(t=e.substring(0,o),e=e.substring(o+1,e.length)),[t,e]}function p(e){return function(){return g&&g.config&&g.config[e]||{}}}var u,h,_,f,m={},y={},g={},v={},A=Object.prototype.hasOwnProperty,E=[].slice,b=/\.js$/;_=function(e,t){var o,i=d(e),n=i[0];return e=i[1],n&&(n=r(n,t),o=l(n)),n?e=o&&o.normalize?o.normalize(e,s(t)):r(e,t):(e=r(e,t),i=d(e),n=i[0],e=i[1],n&&(o=l(n))),{f:n?n+"!"+e:e,n:e,pr:n,p:o}},f={require:function(e){return a(e)},exports:function(e){var t=m[e];return"undefined"!=typeof t?t:m[e]={}},module:function(e){return{id:e,uri:"",exports:m[e],config:p(e)}}},u=function(t,o,i,r){var s,d,p,u,h,g,A=[],E=typeof i;if(r=r||t,"undefined"===E||"function"===E){for(o=!o.length&&i.length?["require","exports","module"]:o,h=0;h<o.length;h+=1)if(u=_(o[h],r),d=u.f,"require"===d)A[h]=f.require(t);else if("exports"===d)A[h]=f.exports(t),g=!0;else if("module"===d)s=A[h]=f.module(t);else if(n(m,d)||n(y,d)||n(v,d))A[h]=l(d);else{if(!u.p)throw new Error(t+" missing "+d);u.p.load(u.n,a(r,!0),c(d),{}),A[h]=m[d]}p=i?i.apply(m[t],A):void 0,t&&(s&&s.exports!==e&&s.exports!==m[t]?m[t]=s.exports:p===e&&g||(m[t]=p))}else t&&(m[t]=i)},t=o=h=function(t,o,i,n,r){if("string"==typeof t)return f[t]?f[t](o):l(_(t,o).f);if(!t.splice){if(g=t,g.deps&&h(g.deps,g.callback),!o)return;o.splice?(t=o,o=i,i=null):t=e}return o=o||function(){},"function"==typeof i&&(i=n,n=r),n?u(e,t,o,i):setTimeout(function(){u(e,t,o,i)},4),h},h.config=function(e){return h(e)},t._defined=m,i=function(e,t,o){t.splice||(o=t,t=[]),n(m,e)||n(y,e)||(y[e]=[e,t,o])},i.amd={jQuery:!0}}(),i("components/almond/almond",function(){}),function(){function e(e,t,o){var i=t&&o||0,n=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){16>n&&(t[i+n++]=_[e])});16>n;)t[i+n++]=0;return t}function t(e,t){var o=t||0,i=h;return i[e[o++]]+i[e[o++]]+i[e[o++]]+i[e[o++]]+"-"+i[e[o++]]+i[e[o++]]+"-"+i[e[o++]]+i[e[o++]]+"-"+i[e[o++]]+i[e[o++]]+"-"+i[e[o++]]+i[e[o++]]+i[e[o++]]+i[e[o++]]+i[e[o++]]+i[e[o++]]}function n(e,o,i){var n=o&&i||0,r=o||[];e=e||{};var a=null!=e.clockseq?e.clockseq:g,s=null!=e.msecs?e.msecs:(new Date).getTime(),c=null!=e.nsecs?e.nsecs:A+1,l=s-v+(c-A)/1e4;if(0>l&&null==e.clockseq&&(a=a+1&16383),(0>l||s>v)&&null==e.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");v=s,A=c,g=a,s+=122192928e5;var d=(1e4*(268435455&s)+c)%4294967296;r[n++]=d>>>24&255,r[n++]=d>>>16&255,r[n++]=d>>>8&255,r[n++]=255&d;var p=s/4294967296*1e4&268435455;r[n++]=p>>>8&255,r[n++]=255&p,r[n++]=p>>>24&15|16,r[n++]=p>>>16&255,r[n++]=a>>>8|128,r[n++]=255&a;for(var u=e.node||y,h=0;6>h;h++)r[n+h]=u[h];return o?o:t(r)}function r(e,o,i){var n=o&&i||0;"string"==typeof e&&(o="binary"==e?new u(16):null,e=null),e=e||{};var r=e.random||(e.rng||a)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,o)for(var s=0;16>s;s++)o[n+s]=r[s];return o||t(r)}var a,s=this;if("function"==typeof o)try{var c=o("crypto").randomBytes;a=c&&function(){return c(16)}}catch(l){}if(!a&&s.crypto&&crypto.getRandomValues){var d=new Uint8Array(16);a=function(){return crypto.getRandomValues(d),d}}if(!a){var p=new Array(16);a=function(){for(var e,t=0;16>t;t++)0===(3&t)&&(e=4294967296*Math.random()),p[t]=e>>>((3&t)<<3)&255;return p}}for(var u="function"==typeof Buffer?Buffer:Array,h=[],_={},f=0;256>f;f++)h[f]=(f+256).toString(16).substr(1),_[h[f]]=f;var m=a(),y=[1|m[0],m[1],m[2],m[3],m[4],m[5]],g=16383&(m[6]<<8|m[7]),v=0,A=0,E=r;if(E.v1=n,E.v4=r,E.parse=e,E.unparse=t,E.BufferClass=u,"function"==typeof i&&i.amd)i("components/uuid/uuid",[],function(){return E});else if("undefined"!=typeof module&&module.exports)module.exports=E;else{var b=s.uuid;E.noConflict=function(){return s.uuid=b,E},s.uuid=E}}.call(this),i("components/dcx-js/src/AdobeDCXError",["require","exports","module"],function(e,t,o){"use strict";function i(e,t,o){Error.call(this),this.code=e,this.message="["+e+"] "+t,this.underlyingError=o}i.prototype=new Error,i.prototype.name="AdobeDCXError",delete i.prototype.stack,i.INVALID_JSON="INVALID_JSON",i.READ_ONLY="READ_ONLY",i.INVALID_PARAMS="",i.INVALID_DATA="INVALID_DATA",i.DUPLICATE_VALUE="DUPLICATE_VALUE",i.NO_LOCAL_STORAGE="NO_LOCAL_STORAGE",i.INVALID_STATE="INVALID_STATE",i.DELETED_COMPOSITE="DELETED_COMPOSITE",i.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",i.NETWORK_ERROR="NETWORK_ERROR",i.COMPONENT_DOWNLOAD_ERROR="COMPONENT_DOWNLOAD_ERROR",i.COMPONENT_UPLOAD_ERROR="COMPONENT_UPLOAD_ERROR",i.UPDATE_CONFLICT="UPDATE_CONFLICT",i.NO_COMPOSITE="NO_COMPOSITE",i.ALREADY_EXISTS="ALREADY_EXISTS",i.SERVICE_IS_INACTIVE="SERVICE_IS_INACTIVE",i.EXCEEDS_QUOTA="EXCEEDS_QUOTA",i.NOT_IMPLEMENTED="NOT_IMPLEMENTED",i.RETRYABLE_SERVER_ERROR="RETRYABLE_SERVER_ERROR",i.TIMED_OUT="TIMED_OUT",i.UNEXPECTED="UNEXPECTED",i.TERMINATED_INPUTSTREAM="TERMINATED_INPUTSTREAM",i.WRONG_ENDPOINT="WRONG_ENDPOINT",i.OUT_OF_SPACE="ENOSPC";var n={};return n[i.SERVICE_IS_INACTIVE]=1,n[i.NOT_IMPLEMENTED]=1,n[i.EXCEEDS_QUOTA]=1,n[i.RETRYABLE_SERVER_ERROR]=1,n[i.TIMED_OUT]=1,n[i.TERMINATED_INPUTSTREAM]=1,n[i.WRONG_ENDPOINT]=1,n[i.OUT_OF_SPACE]=1,i.wrapError=function(e,t,o,r){if(!o||!n[o.code]){if(r){var a=r.statusCode;a>=500&&600>a&&(501===a?(e=i.NOT_IMPLEMENTED,t="Unimplemented request"):507===a?(e=i.EXCEEDS_QUOTA,t="Quota exceeded"):(e=i.RETRYABLE_SERVER_ERROR,t="Server error"))}o=new i(e,t,o)}return r&&(o.response=r),o},i.networkError=function(e,t,o){return i.wrapError(i.NETWORK_ERROR,e,t,o)},i.unexpectedResponse=function(e,t,o){return i.wrapError(i.UNEXPECTED_RESPONSE,e,t,o)},i}),function(){function e(e,t,o){var i=t&&o||0,n=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){16>n&&(t[i+n++]=_[e])});16>n;)t[i+n++]=0;return t}function t(e,t){var o=t||0,i=h;return i[e[o++]]+i[e[o++]]+i[e[o++]]+i[e[o++]]+"-"+i[e[o++]]+i[e[o++]]+"-"+i[e[o++]]+i[e[o++]]+"-"+i[e[o++]]+i[e[o++]]+"-"+i[e[o++]]+i[e[o++]]+i[e[o++]]+i[e[o++]]+i[e[o++]]+i[e[o++]]}function n(e,o,i){var n=o&&i||0,r=o||[];e=e||{};var a=null!=e.clockseq?e.clockseq:g,s=null!=e.msecs?e.msecs:(new Date).getTime(),c=null!=e.nsecs?e.nsecs:A+1,l=s-v+(c-A)/1e4;if(0>l&&null==e.clockseq&&(a=a+1&16383),(0>l||s>v)&&null==e.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");v=s,A=c,g=a,s+=122192928e5;var d=(1e4*(268435455&s)+c)%4294967296;r[n++]=d>>>24&255,r[n++]=d>>>16&255,r[n++]=d>>>8&255,r[n++]=255&d;var p=s/4294967296*1e4&268435455;r[n++]=p>>>8&255,r[n++]=255&p,r[n++]=p>>>24&15|16,r[n++]=p>>>16&255,r[n++]=a>>>8|128,r[n++]=255&a;for(var u=e.node||y,h=0;6>h;h++)r[n+h]=u[h];return o?o:t(r)}function r(e,o,i){var n=o&&i||0;"string"==typeof e&&(o="binary"==e?new u(16):null,e=null),e=e||{};var r=e.random||(e.rng||a)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,o)for(var s=0;16>s;s++)o[n+s]=r[s];return o||t(r)}var a,s=this;if("function"==typeof o)try{var c=o("crypto").randomBytes;a=c&&function(){return c(16)}}catch(l){}if(!a&&s.crypto&&crypto.getRandomValues){var d=new Uint8Array(16);a=function(){return crypto.getRandomValues(d),d}}if(!a){var p=new Array(16);a=function(){for(var e,t=0;16>t;t++)0===(3&t)&&(e=4294967296*Math.random()),p[t]=e>>>((3&t)<<3)&255;return p}}for(var u="function"==typeof Buffer?Buffer:Array,h=[],_={},f=0;256>f;f++)h[f]=(f+256).toString(16).substr(1),_[h[f]]=f;var m=a(),y=[1|m[0],m[1],m[2],m[3],m[4],m[5]],g=16383&(m[6]<<8|m[7]),v=0,A=0,E=r;if(E.v1=n,E.v4=r,E.parse=e,E.unparse=t,E.BufferClass=u,"function"==typeof i&&i.amd)i("components/dcx-js/src/components/uuid/uuid",[],function(){return E});else if("undefined"!=typeof module&&module.exports)module.exports=E;else{var b=s.uuid;E.noConflict=function(){return s.uuid=b,E},s.uuid=E}}.call(this),"function"!=typeof e)var e=o;if(i("components/dcx-js/src/AdobeDCXUtil",["require","exports","module","./components/uuid/uuid"],function(t,o,i){"use strict";var n;try{n=t("./components/uuid/uuid")}catch(r){n=e("uuid")}var a;o._setLogCallback=function(e){a=e},o.merge=function(e){var t,o;for(t=1;t<arguments.length;++t){var i=arguments[t];if("object"==typeof i)for(o in i)i.hasOwnProperty(o)&&(e[o]=i[o])}return e},o.parentDirectory=function(e){var t=e.split("/");return t.pop(),t.join("/")},o.filePathComponents=function(e){var t=e.split("/"),o=t.pop(),i=o.split("."),n=i.length>1?i.pop():null;return{directory:t.join("/"),fileName:o,baseName:i.join("."),extension:n}},o.appendPathElements=function(){var e,t=[],o=arguments.length;for(e=0;o>e;e++){var i=arguments[e];"string"==typeof i&&""!==i&&((0!==e||1===i.length)&&"/"===i.charAt(0)&&(i=i.slice(1)),e!==o-1&&"/"===i.charAt(i.length-1)&&(i=i.slice(0,i.length-1)),t.push(i))}return t.join("/")};var s=/^[^\u0000-\u001F\u0022\u002A\u003A\u003C\u003E\u003F\u005C\u007F]*[^\u0000-\u001F\u0022\u002A\u002E\u003A\u003C\u003E\u003F\u005C\u007F]{1}$/;o.isValidPath=function(e,t){try{if(e.length>65535)return!1;var o=(t?e.slice(1):e).split("/");if(!o||0===o.length)return!1;var i,n=o.length;for(i=0;n>i;i++){var r=o[i];if(r.length>255||!s.test(o[i]))return!1}if(t&&o.length>0){var a=o[0];if("manifest"===a||"mimetype"===a)return!1}return!0}catch(c){return!1}},o.isValidAbsolutePath=function(e){return o.isValidPath(e,!0)};var c=o.noOp=function(){};o.consumeStream=function(e,t,o){e.on("data",o||c),e.on("end",t||c)},o.flatCopy=function(e){var t,o={},i=Object.keys(e),n=i.length;for(t=0;n>t;t++){var r=i[t];o[r]=e[r]}return o},o.deepCopy=function(e){return JSON.parse(JSON.stringify(e))},o.objectsEqual=function(e,t,i){var n,r,a={},s=Object.keys(e),c=s.length;for(r=0;c>r;r++){if(n=s[r],!i||!i[n]){var l=e[n],d=t[n],p=typeof l,u=typeof d;if(p!==u)return!1;if("object"===p){if(!o.objectsEqual(l,d,i))return!1}else if(l!==d)return!1}a[n]=!0}for(s=Object.keys(t),c=s.length,r=0;c>r;r++)if(n=s[r],!a[n])return!1;return!0};var l=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?");o.parseURI=function(e){var t=e.match(l);return{scheme:t[2],authority:t[4],path:t[5],query:t[7],fragment:t[9]}},o.endPointOf=function(e){var t,i=o.parseURI(e),n=i.scheme,r=i.authority,a="https"===n?443:"http"===n?80:-1;return n&&r&&(t=(n+"://"+r).toLowerCase(),a>=0&&r.indexOf(":")<0&&(t=t+":"+a)),t},o.ensureRelativeHrefStartsWithSlash=function(e){if(e){var t=o.parseURI(e),i=t.scheme,n=t.authority;i||n||"/"!==e.charAt(0)&&(e="/"+e)}return e};var d=/^([^:]+):(.*)$/,p=/^\s+|\s+$/g;return o.parseHeaders=function(e){var t,o,i,n={},r=e.split(/\r?\n/);for(t=0;t<r.length;++t){var a=r[t];if(a.length>0){var s=a.charCodeAt(0);if(!o||9!==s&&32!==s){var c=d.exec(a);c&&c.length>1&&(o=c[1].toLowerCase(),i=c[2]||"",i=i.replace(p,""),n[o]?n[o]=n[o]+","+i:n[o]=i)}else n[o]=n[o]+" "+a.replace(p,"")}}return n},o.timeStamp=function(e){var t=(new Date).getTime();return e&&(t-=t%1e3),t},o.generateUuid=n,o.log=function(e){if("function"==typeof a)try{a(e)}catch(t){}},o}),i("components/dcx-js/src/AdobeDCXNode",["require","exports","module","./AdobeDCXError","./AdobeDCXUtil"],function(e,t,o){"use strict";function i(e,t,o){e?this._setData(e):this._data={},this._readOnly=t,this._isRoot=o}var n=e("./AdobeDCXError"),r=e("./AdobeDCXUtil"),a="/";i.ROOT_PATH=a,Object.defineProperties(i.prototype,{id:{get:function(){return this._data.id},set:function(e){if(this._readOnly)throw new n(n.READ_ONLY,"This object is read-only.");if(this._owner)throw new n(n.READ_ONLY,"Cannot change the id of a node that is part of a branch or element.");if("string"!=typeof e||""===e)throw new n(n.INVALID_PARAMS,"Expecting a non-empty string.");this._data.id=e,this._setDirty()}},name:{get:function(){return this._data.name},set:function(e){if(this._readOnly)throw new n(n.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&"undefined"!=typeof e)throw new n(n.INVALID_PARAMS,"Expecting a string or undefined.");this._data.name=e,this._setDirty()}},type:{get:function(){return this._data.type},set:function(e){if(this._readOnly)throw new n(n.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&"undefined"!=typeof e)throw new n(n.INVALID_PARAMS,"Expecting a string or undefined.");this._data.type=e,this._setDirty()}},relationship:{get:function(){return this._data.rel},set:function(e){if(this._readOnly)throw new n(n.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&"undefined"!=typeof e)throw new n(n.INVALID_PARAMS,"Expecting a string or undefined.");this._data.rel=e,this._setDirty()}},path:{get:function(){return this._isRoot?a:this._data.path},set:function(e){if(e!==this.path){if(this._readOnly)throw new n(n.READ_ONLY,"This object is read-only.");if(this._isRoot)throw new n(n.READ_ONLY,"Cannot change the path of the root node.");if(e&&!r.isValidPath(e))throw new n(n.INVALID_PARAMS,"Expecting a valid path or undefined.");this._owner?this._owner._setPathOfNode(this,e||void 0):(this._data.path=e||void 0,this._parentPath=""),this._setDirty()}}},parentPath:{get:function(){return this._parentPath},set:function(e){throw new n(n.READ_ONLY,"parentPath is read-only.")}},absolutePath:{get:function(){var e=this.path;return this._isRoot?e:e&&this._owner?r.appendPathElements(this._parentPath,e):void 0},set:function(e){throw new n(n.READ_ONLY,"absolutePath is read-only.")}},isRoot:{get:function(){return this._isRoot},set:function(e){throw new n(n.READ_ONLY,"isRoot is read-only.")}}}),i.prototype.getLink=function(e){if("string"!=typeof e)throw new n(n.INVALID_PARAMS,'Param "relationship" must be a string');return this._data._links?this._data._links[e]:void 0},i.prototype.setLink=function(e,t){if(this._readOnly)throw new n(n.READ_ONLY,"This object is read-only.");if("object"!=typeof e)throw new n(n.INVALID_PARAMS,'Param "link" must be an object.');if("string"!=typeof t)throw new n(n.INVALID_PARAMS,'Param "relationship" must be a string');var o=this._data._links;o||(o=this._data._links={}),o[t]=e,this._setDirty()},i.prototype.removeLink=function(e){if(this._readOnly)throw new n(n.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new n(n.INVALID_PARAMS,'Param "relationship" must be a string');var t=this._data._links;t&&(delete t[e],Object.keys(t).length<1&&delete this._data._links,this._setDirty())};var s={components:!0,children:!0,"manifest-format-version":!0,id:!0,name:!0,type:!0,state:!0,local:!0},c={components:!0,children:!0,rel:!0,path:!0,id:!0,name:!0,type:!0};return i.prototype.getCustomKeys=function(){var e,t=[],o=Object.keys(this._data),i=o.length;for(e=0;i>e;e++){var n=o[e];(this._isRoot?s[n]:c[n])||t.push(n)}return t},i.prototype.getValue=function(e){if("string"!=typeof e)throw new n(n.INVALID_PARAMS,'Param "key" must be a string');if("children"===e||"components"===e)throw new n(n.INVALID_PARAMS,"Illegal key");return this._data[e]},i.prototype.setValue=function(e,t){if(this._readOnly)throw new n(n.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new n(n.INVALID_PARAMS,'Param "key" must be a string');if("children"===e||"components"===e)throw new n(n.INVALID_PARAMS,"Illegal key");this._data[e]=t,this._setDirty()},i.prototype.removeValue=function(e){if(this._readOnly)throw new n(n.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new n(n.INVALID_PARAMS,'Param "key" must be a string');if("children"===e||"components"===e)throw new n(n.INVALID_PARAMS,"Illegal key");delete this._data[e],this._setDirty()},i.prototype.copy=function(){var e=null,t=this._data.children,o=this._data.components;try{t&&delete this._data.children,o&&delete this._data.components;var n=JSON.parse(JSON.stringify(this._data));e=new i(n)}finally{t&&(this._data.children=t),o&&(this._data.components=o)}return e},i.prototype.isEqualTo=function(e,t,o){return this._isEqual(this._data,e._data,r.merge({children:!0,components:!0},t),o)},i.prototype._isEqual=function(e,t,o,i){var n,a,s,c,l;if(!r.objectsEqual(e,t,o))return!1;if(a=e.components,s=t.components,c=a?a.length:0,l=s?s.length:0,c!==l)return!1;if(c){var d,p,u;for(n=0;c>n;n++){for(d=a[n],p=null,u=0;c>u;u++)if(d.id===s[u].id){p=s[u];break}if(!p)return!1;if(!r.objectsEqual(d,p,i))return!1}}if(a=e.children,s=t.children,c=a?a.length:0,l=s?s.length:0,c!==l)return!1;if(c)for(n=0;c>n;n++)if(!this._isEqual(a[n],s[n],o,i))return!1;return!0},i.prototype._setData=function(e){var t=this._verify(e);if(null===t)return this._data=e,this;throw t},i.prototype._verify=function(e){return"string"!=typeof e.id?new n(n.INVALID_DATA,"Node is missing an id of type string"):null},i.prototype._setDirty=function(){this._owner&&this._owner._setDirty()},i}),i("components/dcx-js/src/AdobeDCXComponent",["require","exports","module","./AdobeDCXError","./AdobeDCXUtil"],function(e,t,o){"use strict";function i(e,t){e?this._setData(e):this._data={},this._readOnly=t}function n(e){this.compositeId=e,this.records={}}function r(e,t,o,i,n,r){this.id=e,this.etag=t,this.version=o,this.md5=i,this.length=n,this.type=r}var a=e("./AdobeDCXError"),s=e("./AdobeDCXUtil"),c={unmodified:"unmodified",modified:"modified",pendingDelete:"pendingDelete",committedDelete:"committedDelete"};i.STATES=c,i._UploadResults=n,i._UploadRecord=r,Object.defineProperties(i.prototype,{id:{get:function(){return this._data.id},set:function(e){if(this._readOnly)throw new a(a.READ_ONLY,"This object is read-only.");if(this._owner)throw new a(a.READ_ONLY,"Cannot change the id of a component that is part of a branch or element.");if("string"!=typeof e||""===e)throw new a(a.INVALID_PARAMS,"Expecting a non-empty string.");this._data.id=e,this._setDirty()}},name:{get:function(){return this._data.name},set:function(e){if(this._readOnly)throw new a(a.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&"undefined"!=typeof e)throw new a(a.INVALID_PARAMS,"Expecting a string or undefined.");this._data.name=e,this._setDirty()}},type:{get:function(){return this._data.type},set:function(e){if(this._readOnly)throw new a(a.READ_ONLY,"This object is read-only.");if("string"!=typeof e||""===e)throw new a(a.INVALID_PARAMS,"Expecting a non-empty string.");this._data.type=e,this._setDirty()}},path:{get:function(){return this._data.path},set:function(e){if(this._data.path!==e){if(this._readOnly)throw new a(a.READ_ONLY,"This object is read-only.");if(!s.isValidPath(e))throw new a(a.INVALID_PARAMS,"Expecting a valid path.");this._owner?this._owner._core._setPathOfComponent(this,e):(this._data.path=e,this._parentPath=""),this._setDirty()}}},parentPath:{get:function(){return this._parentPath},set:function(e){throw new a(a.READ_ONLY,"parentPath is read-only.")}},absolutePath:{get:function(){return this._data.path&&this._owner?s.appendPathElements(this._parentPath,this._data.path):void 0},set:function(e){throw new a(a.READ_ONLY,"absolutePath is read-only.")}},relationship:{get:function(){return this._data.rel},set:function(e){if(this._readOnly)throw new a(a.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&"undefined"!=typeof e)throw new a(a.INVALID_PARAMS,"Expecting a string or undefined.");this._data.rel=e,this._setDirty()}},state:{get:function(){return this._data.state},set:function(e){if(this._readOnly)throw new a(a.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new a(a.INVALID_PARAMS,"Expecting a string.");if(!c.hasOwnProperty(e))throw new a(a.INVALID_PARAMS,'State must be "modified", "unmodified", "pendingDelete", or "committedDelete".');this._data.state=e,this._setDirty()}},etag:{get:function(){return this._data.etag},set:function(e){if(this._readOnly)throw new a(a.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&"undefined"!=typeof e)throw new a(a.INVALID_PARAMS,"Expecting a string or undefined.");this._data.etag=e,this._setDirty()}},md5:{get:function(){return this._data.md5},set:function(e){if(this._readOnly)throw new a(a.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&"undefined"!=typeof e)throw new a(a.INVALID_PARAMS,"Expecting a string or undefined.");this._data.md5=e,this._setDirty()}},version:{get:function(){return this._data.version},set:function(e){if(this._readOnly)throw new a(a.READ_ONLY,"This object is read-only.");if("undefined"!=typeof e&&"string"!=typeof e)throw new a(a.INVALID_PARAMS,"Expecting a string or undefined.");this._data.version=e,this._setDirty()}},length:{get:function(){return this._data.length},set:function(e){if(this._readOnly)throw new a(a.READ_ONLY,"This object is read-only.");if("number"!=typeof e&&"undefined"!=typeof e)throw new a(a.INVALID_PARAMS,"Expecting a number or undefined.");this._data.length=e,this._setDirty()}},width:{get:function(){return this._data.width},set:function(e){if(this._readOnly)throw new a(a.READ_ONLY,"This object is read-only.");if("number"!=typeof e&&"undefined"!=typeof e)throw new a(a.INVALID_PARAMS,"Expecting a number or undefined.");this._data.width=e,this._setDirty()}},height:{get:function(){return this._data.height},set:function(e){if(this._readOnly)throw new a(a.READ_ONLY,"This object is read-only.");if("number"!=typeof e&&"undefined"!=typeof e)throw new a(a.INVALID_PARAMS,"Expecting a number or undefined.");this._data.height=e,this._setDirty()}}});var l={name:!0,id:!0,state:!0,path:!0,rel:!0,type:!0,etag:!0,length:!0,version:!0,md5:!0,width:!0,height:!0};return i.prototype.getCustomKeys=function(){var e,t=[],o=Object.keys(this._data),i=o.length;for(e=0;i>e;e++){var n=o[e];l[n]||t.push(n)}return t},i.prototype.getValue=function(e){if("string"!=typeof e)throw new a(a.INVALID_PARAMS,'Param "key" must be a string');return this._data[e]},i.prototype.setValue=function(e,t){if(this._readOnly)throw new a(a.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new a(a.INVALID_PARAMS,'Param "key" must be a string');this._data[e]=t,this._setDirty()},i.prototype.removeValue=function(e){if(this._readOnly)throw new a(a.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new a(a.INVALID_PARAMS,'Param "key" must be a string');delete this._data[e],this._setDirty()},i.prototype.getLink=function(e){if("string"!=typeof e)throw new a(a.INVALID_PARAMS,'Param "relationship" must be a string');return this._data._links?this._data._links[e]:void 0},i.prototype.setLink=function(e,t){if(this._readOnly)throw new a(a.READ_ONLY,"This object is read-only.");if("object"!=typeof e)throw new a(a.INVALID_PARAMS,'Param "link" must be an object.');if("string"!=typeof t)throw new a(a.INVALID_PARAMS,'Param "relationship" must be a string');var o=this._data._links;o||(o=this._data._links={}),o[t]=e,this._setDirty()},i.prototype.removeLink=function(e){if(this._readOnly)throw new a(a.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new a(a.INVALID_PARAMS,'Param "relationship" must be a string');var t=this._data._links;t&&(delete t[e],Object.keys(t).length<1&&delete this._data._links,this._setDirty())},i.prototype.isEqualTo=function(e,t){return s.objectsEqual(this._data,e._data,t)},i.prototype._setData=function(e){var t=this._verify(e);if(null===t)return this._data=e,this;throw t},i.prototype._setDirty=function(){this._owner&&this._owner._setDirty()},i.prototype._verify=function(e){return"string"!=typeof e.id?new a(a.INVALID_DATA,"Component is missing an id of type string"):null},i}),i("components/dcx-js/src/AdobeDCXFS",["require","exports","module","./AdobeDCXError","./AdobeDCXUtil"],function(e,t,o){"use strict";var i,n=(e("./AdobeDCXError"),e("./AdobeDCXUtil"));t.canUseFileSystem=!1,t._setFS=function(e){i=e,t.canUseFileSystem=e?!0:!1},t.ensureDirectoryExists=function(e,o){var r=function(e){e&&"EEXIST"===e.code?o():o(e)},a=function(a){if(a)o();else{var s=n.parentDirectory(e);s?t.ensureDirectoryExists(s,function(t){t?o(t):i.mkdir(e,r)}):i.mkdir(e,r)}};e?i.exists(e,a):a(!0)},t.getTempFilePathAt=function(e,o){var i=function(){var r=e+n.generateUuid();t.exists(r,function(e){e?i():o(r)})};i()},t.exists=function(e,t){i.exists(e,t)},t.deleteFile=function(e,t){i.unlink(e,function(e){e&&"ENOENT"!==e.code?t(e):t()})},t.readFile=function(e,t,o){i.readFile(e,t,o)},t.writeFile=function(e,o,r,a){var s=n.parentDirectory(e);t.ensureDirectoryExists(s,function(t){t?a(t):i.writeFile(e,o,r,a)})},t.writeFileAtomically=function(e,o,r,a){var s=n.parentDirectory(e);t.ensureDirectoryExists(s,function(n){n?a(n):t.getTempFilePathAt(s+"/",function(t){i.writeFile(t,o,r,function(o){o?a(o):i.rename(t,e,a)})})})},t.createWriteStream=function(e,t){return i.createWriteStream(e,t)},t.createReadStream=function(e,t){return i.createReadStream(e,t)},t.move=function(e,o,r,a){var s=n.parentDirectory(o);t.ensureDirectoryExists(s,function(t){if(t)a(t);else if(r){var n=(new Date).getTime()/1e3;i.utimes(e,n,n,function(t){t?a(t):i.rename(e,o,a)})}else i.rename(e,o,a)})},t.info=function(e,t){i.stat(e,t)},t.directoryListing=function(e,t){var o,n,r=[],a=function(a){i.stat(e+"/"+a,function(e,i){if(!e)try{r.push({name:a,info:i}),o--}catch(s){e=s}e?n||(n=e,t(e)):0===o&&t(void 0,r)})};i.readdir(e,function(e,i){if(!e)try{var n,r=i.length;for(o=r,n=0;r>n;n++)a(i[n])}catch(s){e=s}e?t(e):0===o&&t(void 0,[])})},t.deleteDirectory=function(e,o){var n,r,a=function(){try{i.rmdir(e,o)}catch(t){o(t)}},s=function(e){e&&!n&&(n=e),r--,1>r&&(n?o(n):a())},c=function(o){var n=e+"/"+o;i.unlink(n,function(e){try{e?t.deleteDirectory(n,function(e){s(e)}):s()}catch(o){s(o)}})};i.readdir(e,function(e,t){if(!e)try{var i=t.length;if(1>i)a();else{var n;for(r=i,n=0;i>n;n++)c(t[n])}}catch(s){e=s}e&&o(e)})};var r=function(e,t,o){try{var r=t+n.generateUuid(),a=i.createWriteStream(r),s=i.createReadStream(e);s.on("end",function(){i.rename(r,t,o)}),s.pipe(a)}catch(c){o(c)}};return t.copyFile=function(e,o,i){var a=n.parentDirectory(o);t.ensureDirectoryExists(a,function(t){t?i(t):r(e,o,i)})},t}),i("components/dcx-js/src/AdobeDCXBranchCore",["require","exports","module","./AdobeDCXError","./AdobeDCXNode","./AdobeDCXComponent","./AdobeDCXFS","./AdobeDCXUtil"],function(e,t,o){"use strict";function i(e,t,o){this._readOnly=o,this._owner=t,this._setData(e),this._localStorage=void 0}function n(e,t,o,i,n,a,s,c){var d=t._owner._core,p=e._owner._core,u=o&&e.id===t.id,h=p._getSourceHrefOfComponent(e),_=d.getComponentWithId(t.id),f=i&&(!_||!_.etag)&&"unmodified"===e.state,m=!u&&!h,y=m;if(n&&!_&&(h||m)&&e.id===t.id&&(t._data.id=l.generateUuid(),t.state="modified",t.etag=void 0,t.version=void 0,t.md5=void 0,t.length=void 0),a&&a._copyComponentMapping(e.id,c,t.id,s)&&(y=!1,u||(t.state="modified")),m){if(f){if(h=p._getHrefOfComponent(e),d._setSourceHrefOfComponent(h,t,s),!h&&y)throw new r(r.INVALID_STATE,"Failed to determine the source href of a component that does not have a local file.")}else if(y)throw new r(r.INVALID_STATE,"Could not use server-to-server copy for component "+e.id)}else d._setSourceHrefOfComponent(h,t,s);h&&(t.state="modified")}var r=e("./AdobeDCXError"),a=e("./AdobeDCXNode"),s=e("./AdobeDCXComponent"),c=e("./AdobeDCXFS"),l=e("./AdobeDCXUtil");return Object.defineProperties(i.prototype,{rootNode:{get:function(){return this.getChildWithAbsolutePath(a.ROOT_PATH)},set:function(e){throw new r(r.READ_ONLY,'Property "rootNode" is read-only.')}},hasLocalStorage:{get:function(){return this._localStorage},set:function(){throw new r(r.READ_ONLY,"Cannot set the property hasLocalStorage.")}},isDirty:{get:function(){return this._isDirty},set:function(){throw new r(r.READ_ONLY,"Cannot set the property isDirty.")}},changeCount:{get:function(){return this._data.local?this._data.local.change||0:0},set:function(){throw new r(r.READ_ONLY,"Cannot set the property changeCount.")}}}),i.prototype.getChildWithId=function(e){return this._allNodes[e]},i.prototype.getChildWithAbsolutePath=function(e){var t=this._absolutePaths[e.toLowerCase()];return t&&t instanceof a?t:void 0},i.prototype.getChildrenOf=function(e){if(e=e?this._allNodes[e.id]:this.rootNode,!e)throw new r(r.INVALID_PARAMS,"Unknown node");var t=[],o=e._data.children;if(Array.isArray(o)){var i;for(i=0;i<o.length;i++){var n=o[i],a=this._allNodes[n.id];if(!a)throw new r(r.INVALID_DATA,"Node not in cache");t[t.length]=a}}return t},i.prototype.addChild=function(e,t,o,i){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(t=t||l.generateUuid(),this._allNodes[t])throw new r(r.DUPLICATE_VALUE,"Node already exists in branch.");if(o&&("number"!=typeof o||o%1!==0))throw new r(r.INVALID_PARAMS,'Param "index" must be an integer.');var n=i?this._allNodes[i.id]:this.rootNode;if(!n)throw new r(r.INVALID_PARAMS,"Unknown parent node.");var s=new a;s.id=t,e&&(s.name=e),s._parentPath=n.absolutePath||n._parentPath;var c=n._data.children;return c?(o>=0&&o<=c.length||(o=c.length),o===c.length?c[o]=s._data:c.splice(o,0,s._data)):n._data.children=[s._data],this._allNodes[s.id]=s,s._owner=this._owner,this._setDirty(),s},i.prototype.removeChild=function(e){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(!e)throw new r(r.INVALID_PARAMS,'Expecting param "node".');if(e.isRoot)throw new r(r.INVALID_PARAMS,"Cannot remove the root node.");var t=e.id;if(!t)throw new r(r.INVALID_PARAMS,'Param "node" must have an id.');var o=this._nodeDataOfParentOfNode(e);if(!o)throw new r(r.INVALID_PARAMS,"Node not found in this branch.");return o.parentNodeData.children.splice(o.index,1),0===o.parentNodeData.children.length&&delete o.parentNodeData.children,e=this._allNodes[t],this._removeNodeFromCachesRecursively(e._data),this._setDirty(),e},i.prototype.moveChild=function(e,t,o){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(!e)throw new r(r.INVALID_PARAMS,'Expecting param "node".');if(e.isRoot)throw new r(r.INVALID_PARAMS,"Cannot move the root node.");if(t&&("number"!=typeof t||t%1!==0))throw new r(r.INVALID_PARAMS,'Param "index" must be an integer.');var i=e.id;if(!i)throw new r(r.INVALID_PARAMS,'Param "node" must have an id.');var n=this._nodeDataOfParentOfNode(e);if(e=this._allNodes[i],!n)throw new r(r.INVALID_PARAMS,"Node not found in this branch.");var a=o?this._allNodes[o.id]:this.rootNode;if(!a)throw new r(r.INVALID_PARAMS,"Unknown parent node.");if(this._nodeIdIsDescendantOf(a.id,e._data))throw new r(r.INVALID_PARAMS,"Must not create a cycle.");var s=n.parentNodeData.children.splice(n.index,1)[0];try{var c=a._data.children;c?(t>=0&&t<=c.length||(t=c.length),t===c.length?c[t]=s:c.splice(t,0,s)):a._data.children=[s]}catch(l){throw n.parentNodeData.children.splice(n.index,0,s),l}return 0===n.parentNodeData.children.length&&delete n.parentNodeData.children,this._setDirty(),this._allNodes[i]},i.prototype.copyChild=function(e,t,o,i,n,r){return this._copyChild(e,t,o,i,n,!1,r)},i.prototype.replaceChild=function(e,t,o,i){return this._copyChild(e,void 0,void 0,t,o||e.id,!0,i)},i.prototype.allComponents=function(){var e,t=[];for(e in this._allComponents)this._allComponents.hasOwnProperty(e)&&t.push(this._allComponents[e]);return t},i.prototype.getComponentWithId=function(e){return this._allComponents[e]},i.prototype.getComponentWithAbsolutePath=function(e){var t=this._absolutePaths[e.toLowerCase()];return t&&t instanceof s?t:void 0},i.prototype.getComponentsOf=function(e){if(e=e?this._allNodes[e.id]:this.rootNode,
!e)throw new r(r.INVALID_PARAMS,"Unknown node");var t=[],o=e._data.components;if(Array.isArray(o)){var i;for(i=0;i<o.length;i++){var n=o[i],a=this._allComponents[n.id];if(!a)throw new r(r.INVALID_DATA,"Component not in cache");t[t.length]=a}}return t},i.prototype.addComponent=function(e,t,o,i,n,a,c,d,p,u){var h=this._localStorage;if(!h)throw new r(r.NO_LOCAL_STORAGE,"No local storage. Use AdobeDCXCompositeXfer.uploadNewComponent() followed by addComponentWithUploadResults()");if("function"!=typeof u&&n)throw new r(r.INVALID_PARAMS,'Param "callback" must be a function.');if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(p&&"string"!=typeof p)throw new r(r.INVALID_PARAMS,'Param "id" must be of type string.');if(!n&&!c)throw new r(r.INVALID_PARAMS,"Must provide either source or sourceHref.");try{if(c){var _=this._getBranchOf(this).compositeHref;if(_){var f=l.endPointOf(_),m=l.endPointOf(c);if(f&&m&&f!==m)throw new r(r.WRONG_ENDPOINT,"Given source href has an invalid endpoint: "+m)}}var y=this._local();p=p||l.generateUuid();var g=new s;g.id=p,g.name=e,g.type=t,g.relationship=o,g.path=i,g.state="modified";var v=this,A=function(e){if(!e)try{if(p&&v._allComponents[p])throw new r(r.DUPLICATE_VALUE,'The "id" of a component must be unique.');var t=d?v._allNodes[d.id]:v.rootNode;if(!t)throw new r(r.INVALID_PARAMS,"Unknown parent node.");var o=v._normalizedAbsolutePathForItem(g,t);if(v._absolutePaths[o])throw new r(r.DUPLICATE_VALUE,"Duplicate absolute path: "+o);if(!l.isValidAbsolutePath(o))throw new r(r.INVALID_PARAMS,"Invalid absolute path: "+o);g._parentPath=t.absolutePath||t._parentPath;var i=t._data.components;i?i.push(g._data):t._data.components=[g._data],g._owner=v._owner,c&&v._setSourceHrefOfComponent(c,g),v._allComponents[g.id]=g,v._absolutePaths[o]=g,v._setDirty()}catch(n){h.removeComponentAsset(g,y),c&&v._setSourceHrefOfComponent(void 0,g),g=void 0,e=n}if(u)return u(e,g);if(e)throw e;return g};if(!n)return A();h.ingestComponentAsset(g,n,a,y,A)}catch(E){if(u)return u(E);throw E}},i.prototype.addComponentWithUploadResults=function(e,t,o,i,n){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(n.compositeId!==this._owner.compositeId)throw new r(r.INVALID_PARAMS,"Param uploadResults does not appear valid to be for this composite.");var a=Object.keys(n.records);if(1!==a.length)throw new r(r.INVALID_PARAMS,"Param uploadResults must contain records of exactly one component upload.");if(this._localStorage)throw new r(r.INVALID_PARAMS,"This method is for in-browser use only. Use addComponent() instead.");var c=n.records[a[0]],l=c.id;if(this._allComponents[l])throw new r(r.DUPLICATE_VALUE,"Duplicate component id: "+l);var d=i?this._allNodes[i.id]:this.rootNode;if(!d)throw new r(r.INVALID_PARAMS,"Unknown parent node.");var p=new s;p.id=l,p.name=e,p.type=c.type,p.relationship=t,p.path=o,p.state="unmodified",p.etag=c.etag,p.length=c.length,p.version=c.version,p.md5=c.md5;var u=this._normalizedAbsolutePathForItem(p,d);if(this._absolutePaths[u])throw new r(r.DUPLICATE_VALUE,"Duplicate absolute path: "+u);p._parentPath=d.absolutePath||d._parentPath;var h=d._data.components;return h?h.push(p._data):d._data.components=[p._data],p._owner=this._owner,this._allComponents[l]=p,this._absolutePaths[u]=p,this._setDirty(),p},i.prototype.updateComponent=function(e,t,o,i){var n=this._localStorage;if(!n)throw new r(r.NO_LOCAL_STORAGE,"No local storage. Use AdobeDCXCompositeXfer.uploadComponent() to upload a new component asset and then call updateComponentWithUploadResults()");if("function"!=typeof i)throw new r(r.INVALID_PARAMS,'Param "callback" must be a function.');if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(e=this._allComponents[e.id],!e)throw new r(r.INVALID_PARAMS,"Unknown component.");try{var a=this,s=function(t){if(!t)try{"modified"!==e.state?e.state="modified":a._setDirty(),a._setSourceHrefOfComponent(void 0,e)}catch(o){t=o,e=void 0}i(t,e)};n.ingestComponentAsset(e,t,o,this._local(),s)}catch(c){i(c)}},i.prototype.updateComponentWithUploadResults=function(e,t){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(e=this._allComponents[e.id],!e)throw new r(r.INVALID_PARAMS,"Unknown component.");if(this._localStorage)throw new r(r.INVALID_PARAMS,"This method is for in-browser use only. Use updateComponent() instead.");if(t.compositeId!==this._owner.compositeId)throw new r(r.INVALID_PARAMS,"Param uploadResults does not appear valid to be for this composite.");var o=t.records[e.id];if(!o)throw new r(r.INVALID_PARAMS,"Param uploadResults does not contain an upload record for the given component.");return e.etag=o.etag,e.version=o.version,e.md5=o.md5,e.length=o.length,e},i.prototype.removeComponent=function(e){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(!e)throw new r(r.INVALID_PARAMS,'Expecting param "component".');var t=e.id;if(!t)throw new r(r.INVALID_PARAMS,'Param "component" must have an id.');var o=this._nodeDataOfParentOfComponent(e);if(!o)throw new r(r.INVALID_PARAMS,"Component not found in this branch.");return o.parentNodeData.components.splice(o.index,1),0===o.parentNodeData.components.length&&delete o.parentNodeData.components,e=this._allComponents[t],delete this._allComponents[t],delete this._absolutePaths[this._normalizedAbsolutePathForItem(e)],this._localStorage&&(this._localStorage.removeComponentAsset(e,this._local()),this._setSourceHrefOfComponent(void 0,e)),e._owner=void 0,e._parentPath="",this._setDirty(),e},i.prototype.moveComponent=function(e,t){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(!e)throw new r(r.INVALID_PARAMS,'Expecting param "component".');var o=e.id;if(!o)throw new r(r.INVALID_PARAMS,'Param "component" must have an id.');var i=this._nodeDataOfParentOfComponent(e);if(!i)throw new r(r.INVALID_PARAMS,"Component not found in this branch.");var n=t?this._allNodes[t.id]:this.rootNode;if(!n)throw new r(r.INVALID_PARAMS,"Unknown parent node.");var a=this._normalizedAbsolutePathForItem(e,n);if(this._absolutePaths[a])throw new r(r.DUPLICATE_VALUE,"Duplicate absolute path: "+a);var s=i.parentNodeData.components.splice(i.index,1)[0],c=n._data.components;return c?c.push(s):n._data.components=[s],0===i.parentNodeData.components.length&&delete i.parentNodeData.components,e=this._allComponents[o],delete this._absolutePaths[this._normalizedAbsolutePathForItem(e)],e._parentPath=n.absolutePath||n._parentPath,this._absolutePaths[a]=e,this._setDirty(),e},i.prototype.copyComponent=function(e,t,o,i,n){return this._copyComponent(e,t,o,i,!1,n)},i.prototype.replaceComponent=function(e,t,o,i){return this._copyComponent(e,void 0,t,o||e.id,!0,i)},i.prototype.assetOfComponent=function(e,t){try{if(!this._localStorage)throw new r(r.NO_LOCAL_STORAGE,"No local storage.");if(!e)throw new r(r.INVALID_PARAMS,'Expecting param "component".');var o=e.id;if(!o)throw new r(r.INVALID_PARAMS,'Param "component" must have an id.');var i=this._localStorage.componentAssetPath(e,this._local());if(!t)return i;c.exists(i,function(e){t(void 0,e?i:null)})}catch(n){if(!t)throw n;t(n)}},i.prototype._getHrefOfComponent=function(e){var t,o=this._getBranchOf(e),i=o.compositeHref;return i&&"undefined"!=typeof e.version&&(t=l.appendPathElements(i,e.id),t+=";version="+e.version),t},i.prototype._setSourceHrefOfComponent=function(e,t,o){var i=t.id,n=this._componentSourceHrefLookup(!0,o);e?n[i]=e:n[i]&&delete n[i]},i.prototype._getSourceHrefOfComponent=function(e,t){var o=e.id,i=this._componentSourceHrefLookup(!1,t);return i?i[o]:void 0},i.prototype._copySourceHrefsFrom=function(e){var t=e._componentSourceHrefLookup(!1),o=this.allComponents(),i=o.length;if(i&&t){var n,r=this._componentSourceHrefLookup(!0);for(n=0;i>n;n++){var a=o[n].id;r[a]=t[a]}}},i.prototype._getBranchOf=function(e){return e._owner?this._getBranchOf(e._owner):e},i.prototype._isSameComposite=function(e){var t=this._getBranchOf(this),o=this._getBranchOf(e);return t._data.id!==o._data.id?!1:t.compositeHref!==o.compositeHref?!1:this._localStorage!==e._localStorage?!1:!0},i.prototype._stringify=function(e,t){if(e){var o=this._data.local,i=null;try{delete this._data.local,i=JSON.stringify(this._data,void 0,t?2:void 0)}catch(n){throw n}finally{o&&(this._data.local=o)}return i}return JSON.stringify(this._data,void 0,t?2:void 0)},i.prototype._setData=function(e){var t=new a(e,this._readOnly,!0);t._owner=this._owner,t._parentPath="";var o=t.id,i={},n={},c={};n[o]=t,c[a.ROOT_PATH]=t;var d=this,p=function(e,t,o,i,n){var c,u,h,_=e.components;if(Array.isArray(_))for(c=0;c<_.length;c++){var f=_[c],m=new s(f,d._readOnly);if(t[m.id])throw new r(r.INVALID_DATA,"Duplicate component id: "+m.id);if(m._owner=d._owner,m._parentPath=n,h=d._normalizedAbsolutePathForItem(m),i[h])throw new r(r.INVALID_DATA,"Duplicate absolute path: "+h);if(!l.isValidAbsolutePath(h))throw new r(r.INVALID_DATA,"Invalid absolute component path: "+h);t[m.id]=m,i[h]=m}var y=e.children;if(Array.isArray(y))for(c=0;c<y.length;c++){var g=y[c],v=new a(g,d._readOnly);if(o[v.id])throw new r(r.INVALID_DATA,"Duplicate node id: "+v.id);if(u=v.path,v._owner=d._owner,v._parentPath=n,u){if(h=d._normalizedAbsolutePathForItem(v),i[h])throw new r(r.INVALID_DATA,"Duplicate absolute path: "+h);if(!l.isValidAbsolutePath(h))throw new r(r.INVALID_DATA,"Invalid node absolute path: "+h);i[h]=v}o[v.id]=v,p(g,t,o,i,v.path?l.appendPathElements(n,v.path):n)}};return p(e,i,n,c,a.ROOT_PATH),this._data=e,this._allComponents=i,this._allNodes=n,this._absolutePaths=c,this._isDirty=!1,this},i.prototype._removeNodeFromCachesRecursively=function(e){var t,o=e.components;if(Array.isArray(o))for(t=0;t<o.length;t++){var i=o[t].id,n=this._allComponents[i];delete this._allComponents[i],delete this._absolutePaths[this._normalizedAbsolutePathForItem(n)],n._owner=void 0,this._localStorage&&(this._localStorage.removeComponentAsset(n,this._local()),this._setSourceHrefOfComponent(void 0,n))}var r=e.children;if(Array.isArray(r))for(t=0;t<r.length;t++)this._removeNodeFromCachesRecursively(r[t]);var a=e.id,s=this._allNodes[a];delete this._allNodes[a],s.path&&delete this._absolutePaths[this._normalizedAbsolutePathForItem(s)],s._owner=void 0},i.prototype._local=function(){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");return this._data.local||(this._data.local={version:2}),this._data.local},i.prototype._componentSourceHrefLookup=function(e,t){if(e&&this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(t||(t=e?this._local():this._data.local)){var o=t["componentS2SCopy#srcHref"];return!o&&e&&(o=t["componentS2SCopy#srcHref"]={}),o}},i.prototype._recursiveReset=function(e,t){var o,i=e.components;if(i)for(o=i.length-1;o>=0;o--){var n=i[o];"committedDelete"===n.state?(delete i[o],delete this._allComponents[n.id],delete n._owner,this._localStorage&&this._localStorage.removeComponentAsset(n,this._local()),this._setSourceHrefOfComponent(void 0,n,this._local())):(delete n.etag,delete n.version,delete n.length,delete n.md5,n.state="modified",t&&t(n))}var r=e.children;if(r)for(o=0;o<r.length;o++)this._recursiveReset(r[o],t)},i.prototype._nodeIdIsDescendantOf=function(e,t){var o,i=t.children;if(i)for(o=0;o<i.length;o++){var n=i[o];if(n.id===e||this._nodeIdIsDescendantOf(e,n))return!0}return!1},i.prototype._recursivelyGetAllComponentsOfChild=function(e,t){t=t||[];var o,i,n=e._data||e,r=n.components;if(r)for(i=r.length,o=0;i>o;o++)t[t.length]=this._allComponents[r[o].id];var a=n.children;if(a)for(i=a.length,o=0;i>o;o++)t=this._recursivelyGetAllComponentsOfChild(a[o],t);return t},i.prototype._nodeDataOfParentOfNode=function(e,t){t=t||this._data;var o,i=e._data.id,n=t.children;if(n)for(o=0;o<n.length;o++){var r=n[o];r.path;if(r.id===i)return{parentNodeData:t,index:o};var a=this._nodeDataOfParentOfNode(e,r);if(a)return a}return null},i.prototype._nodeDataOfParentOfComponent=function(e,t){t=t||this._data;var o,i=e._data.id,n=t.components;if(n)for(o=0;o<n.length;o++){var r=n[o];if(r.id===i)return{parentNodeData:t,index:o}}var a=t.children;if(a)for(o=0;o<a.length;o++){var s=a[o],c=this._nodeDataOfParentOfComponent(e,s);if(c)return c}return null},i.prototype._determineAbsolutePathChangesRecursively=function(e,t,o){var i,n=e.components;if(n)for(i=0;i<n.length;i++){var r=n[i],a=this._allComponents[r.id];o.push({item:a,parentPath:t,absPath:l.appendPathElements(t,r.path)})}var s=e.children;if(s)for(i=0;i<s.length;i++){var c=s[i],d=this._allNodes[c.id],p=c.path,u=p?l.appendPathElements(t,p):t;o.push({item:d,parentPath:t,absPath:p?u:void 0}),this._determineAbsolutePathChangesRecursively(c,u,o)}},i.prototype._setPathOfNode=function(e,t){var o=t?l.appendPathElements(e.parentPath,t):e.parentPath,i=[{item:e,absPath:t?o:void 0}];this._determineAbsolutePathChangesRecursively(e._data,o,i);var n,a,s=l.flatCopy(this._absolutePaths);for(n=0;n<i.length;n++){var c=i[n].item;c._data.path&&delete s[this._normalizedAbsolutePathForItem(c)]}for(n=0;n<i.length;n++)if(a=i[n],a.absPath){var d=a.absPath.toLowerCase();if(s[d])throw new r(r.DUPLICATE_VALUE,"Duplicate absolute path: "+d);if(!l.isValidAbsolutePath(d))throw new r(r.INVALID_PARAMS,"Invalid absolute path: "+d);s[d]=a.item}for(n=0;n<i.length;n++)a=i[n],a.parentPath&&(a.item._parentPath=a.parentPath);e._data.path=t,this._absolutePaths=s},i.prototype._setPathOfComponent=function(e,t){if(!this._allComponents[e.id])throw new r(r.INVALID_PARAMS,"Unknown component.");var o=l.appendPathElements(e.parentPath,t).toLowerCase();if(this._absolutePaths[o])throw new r(r.DUPLICATE_VALUE,"Duplicate absolute path for component: "+o);if(!l.isValidAbsolutePath(o))throw new r(r.INVALID_PARAMS,"Invalid absolute path: "+o);delete this._absolutePaths[this._normalizedAbsolutePathForItem(e)],this._absolutePaths[o]=e,e._data.path=t},i.prototype._setDirty=function(e){this._isDirty=!0,this._local().change=this.changeCount+1,e||"unmodified"!==this._data.state&&this._data.state||(this._data.state="modified")},i.prototype._normalizedAbsolutePathForItem=function(e,t){var o;return o=t?l.appendPathElements(t.absolutePath||t._parentPath,e.path):e.absolutePath,o.toLowerCase()},i.prototype._hasSameEndpoint=function(e){var t=this._getBranchOf(this).compositeHref,o=this._getBranchOf(e).compositeHref;if(t&&o){var i=l.endPointOf(t),n=l.endPointOf(o);if(i&&n&&i!==n)return!1}return!0},i.prototype._copyComponent=function(e,t,o,i,a,s){if(!e)throw new r(r.INVALID_PARAMS,'Expecting param "component".');if(s&&"function"!=typeof s)throw new r(r.INVALID_PARAMS,"Param callback must be a function.");var c=this,l=e._owner._core,d=this._isSameComposite(l),p=d||this._hasSameEndpoint(e),u=l._local(),h=this._localStorage,_=l._localStorage,f=h&&_;if(f&&!s&&!d)throw new r(r.INVALID_PARAMS,"Must pass a callback when copying between two different composites.");if(!f&&!p)throw new r(r.NO_LOCAL_STORAGE,"Cannot copy between two different endpoints without local storage.");var m=function(e,t,o){n(e,t,d,p,!i,f?h:void 0,o,u)},y=f?_.componentAssetPath(e,u):void 0;if(!s)return this._copyComponentModel(e,t,a,o,i,m);if(d||!y)try{s(void 0,this._copyComponentModel(e,t,a,o,i,m))}catch(g){s(g)}else{var v={};h.ingestComponentAsset(e,y,!0,v,function(n){if(n)s(n);else try{u=v,s(void 0,c._copyComponentModel(e,t,a,o,i,m))}catch(r){s(r)}})}},i.prototype._copyComponentModel=function(e,t,o,i,n,a){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(!e)throw new r(r.INVALID_PARAMS,'Expecting param "component".');var c=e._owner,d=new s(JSON.parse(JSON.stringify(e._data)));i?(d.path=i,d.id=n||l.generateUuid()):n&&(d.id=n),d._owner=this._owner,e.id===d.id&&this._isSameComposite(c._core)||(d.state="modified",d.etag=void 0,d.version=void 0,d.md5=void 0,d.length=void 0);var p=this._allComponents[d.id];if(p&&!o)throw new r(r.DUPLICATE_VALUE,"Component already exists.");if(o&&!p)throw new r(r.INVALID_PARAMS,"Could not find existing component.");var u,h;if(o){var _=this._nodeDataOfParentOfComponent(p);if(!_)throw new r(r.INVALID_PARAMS,"Parent node of existing component not found in this branch.");var f=_.parentNodeData.id;if(h=this._allNodes[f],!h)throw new r(r.INVALID_STATE,"Unknown parent node.");u=_.index}else if(h=t?this._allNodes[t.id]:this.rootNode,!h)throw new r(r.INVALID_PARAMS,"Unknown parent node.");d._parentPath=h.absolutePath||h._parentPath;var m=this._normalizedAbsolutePathForItem(d),y=this._absolutePaths[m];if(y&&y!==p)throw new r(r.DUPLICATE_VALUE,"Duplicate absolute path: "+m);if(!l.isValidAbsolutePath(m))throw new r(r.INVALID_PARAMS,"Component path must be a valid path for a component.");var g=this._local();a&&(g=l.deepCopy(g),a(e,d,g));var v=h._data.components;return o?v[u]=d._data:v?v.push(d._data):h._data.components=[d._data],this._data.local=g,this._allComponents[d.id]=d,this._absolutePaths[m]=d,this._setDirty(),d},i.prototype._copyChild=function(e,t,o,i,a,s,c){if(!e)throw new r(r.INVALID_PARAMS,'Expecting param "node".');var l=this,d=e._owner._core,p=this._isSameComposite(d),u=p||this._hasSameEndpoint(e),h=d._local(),_=this._localStorage,f=d._localStorage,m=_&&f,y=d._recursivelyGetAllComponentsOfChild(e);if(y.length>0){if(m&&!c&&!p)throw new r(r.INVALID_PARAMS,"Must pass a callback when copying between two different composites.");if(!m&&!u)throw new r(r.NO_LOCAL_STORAGE,"Cannot copy components between two different endpoints without local storage.")}var g=function(e,t,o){n(e,t,p,u,!0,m?_:void 0,o,h)};if(!c)return this._copyChildModel(e,t,o,s,i,a,g);var v=function(){c(void 0,l._copyChildModel(e,t,o,s,i,a,g))};if(0===y.length||p||!m)try{v()}catch(A){c(A)}else{var E,b,C={},L=y.length,S=0,D=function(e){if(e&&!b&&(b=e),S--,0===S)if(b)c(b);else try{h=C,v()}catch(t){c(t)}};for(E=0;L>E;E++){var R=y[E],w=f.componentAssetPath(R,h);w&&(S++,_.ingestComponentAsset(R,w,!0,C,D))}if(0===S)try{v()}catch(I){c(I)}}},i.prototype._copyChildModel=function(e,t,o,i,n,c,d){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");var p=e._owner,u=new a(JSON.parse(JSON.stringify(e._data)));n?(u.path=n,u.id=c||l.generateUuid()):c&&(u.id=c),u._owner=this._owner,e.isRoot&&(delete u._data.local,delete u._data["manifest-format-version"]);var h=this._allNodes[u.id];if(h&&!i)throw new r(r.DUPLICATE_VALUE,"Child node already exists.");if(i&&!h)throw new r(r.INVALID_PARAMS,"Could not find existing node to replace.");var _;if(i){var f=this._nodeDataOfParentOfNode(h);if(!f)throw new r(r.INVALID_PARAMS,"Parent of existing node not found in this branch.");var m=f.parentNodeData.id;if(_=this._allNodes[m],!_)throw new r(r.INVALID_STATE,"Unknown parent node.");o=f.index}else if(_=t?this._allNodes[t.id]:this.rootNode,!_)throw new r(r.INVALID_PARAMS,"Unknown parent node.");if(u._parentPath=_.absolutePath||_._parentPath,u.path){var y=this._normalizedAbsolutePathForItem(u),g=this._absolutePaths[y];if(g&&g!==h)throw new r(r.DUPLICATE_VALUE,"Duplicate absolute path: "+y);if(!l.isValidAbsolutePath(y))throw new r(r.INVALID_PARAMS,"Node path must be a valid path for a node.")}var v=l.flatCopy(this._allNodes),A=l.flatCopy(this._allComponents),E=l.flatCopy(this._absolutePaths),b=l.deepCopy(this._local()),C=function(e,t,o,i,n,r){delete o[e.id],e.path&&delete n[t._normalizedAbsolutePathForItem(e)];var a,s,c=e._data.children;if(c)for(s=c.length,a=0;s>a;a++)C(o[c[a].id],t,o,i,n,r);var l=e._data.components;if(l)for(s=l.length,a=0;s>a;a++){var d=i[l[a].id];delete i[d.id],delete n[t._normalizedAbsolutePathForItem(d)],t._localStorage&&(t._localStorage.removeComponentAsset(d,r),t._setSourceHrefOfComponent(void 0,d,r))}};h&&C(h,this,v,A,E,b);var L=this,S=function(e,t,o,i,n,c,p,u){if(i[e.id])throw new r(r.DUPLICATE_VALUE,"Duplicate node id: "+e.id);i[e.id]=e;var h;if(e.path){if(h=t._core._normalizedAbsolutePathForItem(e),c[h])throw new r(r.DUPLICATE_VALUE,"Duplicate absolute path: "+h);c[h]=e}var _,f,m=e._data.children;if(m)for(f=m.length,_=0;f>_;_++){var y=new a(m[_]);i[y.id]&&(y.id=l.generateUuid()),y._owner=t,y._parentPath=e.absolutePath||e._parentPath,S(y,t,o,i,n,c,p,u)}var g=e._data.components;if(g)for(f=g.length,_=0;f>_;_++){var v=new s(g[_]),A=v.id;if(n[A]&&(v.id=l.generateUuid(),v.state="modified",v.etag=void 0,v.version=void 0,v.md5=void 0,v.length=void 0),v._owner=t,v._parentPath=e.absolutePath||e._parentPath,d&&d(o.getComponentWithId(A),v,p),n[v.id])throw new r(r.DUPLICATE_VALUE,"Duplicate component id: "+v.id);if(n[v.id]=v,h=t._core._normalizedAbsolutePathForItem(v),c[h])throw new r(r.DUPLICATE_VALUE,"Duplicate absolute path: "+h);c[h]=v}};if(S(u,this._owner,p,v,A,E,b,p._local()),i)_._data.children[o]=u._data;else{var D=_._data.children;D?(o>=0&&o<=D.length||(o=D.length),o===D.length?D[o]=u._data:D.splice(o,0,u._data)):_._data.children=[u._data]}return L._allNodes=v,L._allComponents=A,L._absolutePaths=E,L._data.local=b,L._setDirty(),u},i.prototype._verifyIntegrity=function(e,t,o){var i,n=this,s=[],c=!1,d=function(e){return s.push(new r(r.INVALID_STATE,e)),t&&(c||(t("Branch for composite "+n.rootNode.id+" has the following errors:"),c=!0),t("   "+e)),!1},p=function(e,t){return e?!0:d(t)},u=[],h=function(e){(u.indexOf(e)<0||d("Item "+e.id+" encountered more than once"))&&u.push(e)},_=l.flatCopy(this._allComponents),f=l.flatCopy(this._allNodes),m=l.flatCopy(this._absolutePaths),y=Object.keys(m),g=y.length;for(i=0;g>i;i++){var v=y[i];p("/"===v.charAt(0),"Absolute path "+v+" does not start with a slash.")}var A=function(e,t){var o,i,r=e.children;if(r)for(o=0;o<r.length;o++){var a=r[o],s=f[a.id];(s||d("Node "+a.id+" is not in cache."))&&(h(s),p(s._data===a,"Node "+s.id+" _data property incorrect."),delete f[s.id],s.path&&s._owner&&(i=n._normalizedAbsolutePathForItem(s),(m[i]||d("Absolute path of node "+s.id+" ("+i+") is not in cache."))&&delete m[i]),p(s._parentPath===t,"Parent path of node "+s.id+" should be "+t+" but is "+s._parentPath),p(s._owner===n._owner,"Node "+s.id+" _owner property is not correct.")),A(a,a.path?l.appendPathElements(t,a.path):t)}var c=e.components;if(c)for(o=0;o<c.length;o++){var u=c[o],y=_[u.id];(y||d("Component "+u.id+" is not in cache."))&&(h(y),p(y._data===u,"Component "+y.id+" _data property incorrect."),delete _[y.id],y._owner&&(i=n._normalizedAbsolutePathForItem(y),(m[i]||d("Absolute path "+i+" is not in cache."))&&delete m[i]),p(y._parentPath===t,"Parent path of component "+y.id+" should be "+t+" but is "+y._parentPath),p(y._owner===n._owner,"Component "+y.id+" _owner property is not correct."))}},E=m[a.ROOT_PATH];p(E,"Cannot find root node via path")&&(p(E.id===this._data.id,"Root node has correct id"),p(E.path===a.ROOT_PATH,"Root node has correct path"),p(""===E._parentPath,"Root node has correct parent path"),p(E._owner===this._owner,"Root node has correct owner"),p(E._data===this._data,"Root node has correct data"),p(f[E.id]===E,"Cannot find root node via id")&&delete f[E.id],delete m[a.ROOT_PATH]),A(this._data,a.ROOT_PATH);var b=Object.keys(_);for(i=0;i<b.length;i++)d("Component "+b[i]+" is in cache but could not be found.");for(b=Object.keys(f),i=0;i<b.length;i++)d("Node "+b[i]+" is in cache but could not be found.");for(b=Object.keys(m),i=0;i<b.length;i++)d("Absolute path "+b[i]+" is in cache but could not be found.");if(this._localStorage){var C=this._localStorage.componentIds(this._local());for(i=0;i<C.length;i++)p(this._allComponents[C[i]],"Component "+C[i]+" is in local storage mapping but could not be found in the manifest.");if(e)for(C=Object.keys(this._allComponents),i=0;i<C.length;i++){var L=C[i],S=this._allComponents[L],D=this._localStorage.componentAssetPath(S,this._local());p(D,"Component "+L+" does not have an entry in local storage mapping.")&&o&&p(o.existsSync(D),"Asset "+D+" does not exist.")}var R=this._componentSourceHrefLookup();if(R)for(C=Object.keys(R),g=C.length,i=0;g>i;i++){var w=this._allComponents[C[i]];w?p("modified"===w.state,"Component "+C[i]+" is in local source href mapping but has a state of "+w.state):p(!1,"Component "+C[i]+" is in local source href mapping but could not be found in the manifest.")}}return s.length?s:null},i}),i("components/dcx-js/src/AdobeDCXElement",["require","exports","module","./AdobeDCXBranchCore","./AdobeDCXError","./AdobeDCXUtil"],function(e,t,o){"use strict";function i(e,t,o){if(this._owner=t,e)e=this._setData(e,o);else{var i=a.generateUuid();e={id:i},this._core=new n(e,this,o),this._data=e}}var n=e("./AdobeDCXBranchCore"),r=e("./AdobeDCXError"),a=e("./AdobeDCXUtil");return Object.defineProperties(i.prototype,{rootNode:{get:function(){return this._core.rootNode},set:function(e){this._core.rootNode=e}},name:{get:function(){return this._core.rootNode.name},set:function(e){var t=this._core;if(t._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&"undefined"!=typeof e)throw new r(r.INVALID_PARAMS,"Expecting a string or undefined.");t.rootNode.name=e}},type:{get:function(){return this._core.rootNode.type},set:function(e){var t=this._core;if(t._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if("string"!=typeof e||""===e)throw new r(r.INVALID_PARAMS,"Expecting a non-empty string.");t.rootNode.type=e}},compositeHref:{get:function(){return this._owner.compositeHref},set:function(e){throw new r(r.READ_ONLY,'Property "compositeHref" is read-only.')}},_localStorage:{get:function(){return this._core._localStorage},set:function(e){this._core._localStorage=e}},hasLocalStorage:{get:function(){return this._core.hasLocalStorage},set:function(e){this._core.hasLocalStorage=e}},_isDirty:{get:function(){return this._core._isDirty},set:function(e){this._core._isDirty=e}},isDirty:{get:function(){return this._isDirty},set:function(e){this._core.isDirty=e}},changeCount:{get:function(){return this._core.changeCount},set:function(e){this._core.changeCount=e}}}),i.prototype.getChildWithId=function(e){return this._core.getChildWithId(e)},i.prototype.getChildWithAbsolutePath=function(e){return this._core.getChildWithAbsolutePath(e)},i.prototype.getChildrenOf=function(e){return this._core.getChildrenOf(e)},i.prototype.addChild=function(e,t,o,i){return this._core.addChild(e,t,o,i)},i.prototype.removeChild=function(e){return this._core.removeChild(e)},i.prototype.moveChild=function(e,t,o){return this._core.moveChild(e,t,o)},i.prototype.copyChild=function(e,t,o,i,n,r){return this._core.copyChild(e,t,o,i,n,r)},i.prototype.allComponents=function(){return this._core.allComponents()},i.prototype.getComponentWithId=function(e){return this._core.getComponentWithId(e)},i.prototype.getComponentWithAbsolutePath=function(e){return this._core.getComponentWithAbsolutePath(e)},i.prototype.getComponentsOf=function(e){return this._core.getComponentsOf(e)},i.prototype.addComponent=function(e,t,o,i,n,r,a,s,c,l){return this._core.addComponent(e,t,o,i,n,r,a,s,c,l)},i.prototype.addComponentWithUploadResults=function(e,t,o,i,n){return this._core.addComponentWithUploadResults(e,t,o,i,n)},i.prototype.updateComponent=function(e,t,o,i){return this._core.updateComponent(e,t,o,i)},i.prototype.updateComponentWithUploadResults=function(e,t){return this._core.updateComponentWithUploadResults(e,t)},i.prototype.removeComponent=function(e){return this._core.removeComponent(e)},i.prototype.moveComponent=function(e,t){return this._core.moveComponent(e,t)},i.prototype.copyComponent=function(e,t,o,i,n){return this._core.copyComponent(e,t,o,i,n)},i.prototype.assetOfComponent=function(e,t){return this._core.assetOfComponent(e,t)},i.prototype.parse=function(e){if("string"!=typeof e)throw new r(r.INVALID_PARAMS,'Param "data" must be a string');var t=null;try{t=JSON.parse(e)}catch(o){throw new r(r.INVALID_JSON,"Manifest could not be parsed. Underlying error: "+o.message)}return this._setData(t,this._core._readOnly)},i.prototype.copy=function(){return new i(JSON.parse(JSON.stringify(this._data)),this._owner)},i.prototype._updateLocalDataFromBranch=function(e){if(this._readOnly)throw new r(r.READ_ONLY,"This object is read-only.");if(!this._localStorage)throw new r(r.NO_LOCAL_STORAGE,"No local storage.");if(!e._localStorage)throw new r(r.NO_LOCAL_STORAGE,"No local storage for source.");if(this._localStorage.compositePath!==e._localStorage.compositePath)throw new r(r.INVALID_PARAMS,"Branches must have same storage path.");this._core._localStorage.copyLocalStorageData(e,e._core._local(),this,this._core._local()),this._core._copySourceHrefsFrom(e._core)},i.prototype._verify=function(e){return"string"!=typeof e.id?new r(r.INVALID_DATA,"Element is missing an id of type string"):"string"!=typeof e.name?new r(r.INVALID_DATA,"Element is missing a name of type string"):"string"!=typeof e.type?new r(r.INVALID_DATA,"Element is missing a type of type string"):null},i.prototype._setData=function(e,t){var o=this._verify(e);if(null===o)return this._core=new n(e,this,t),this._data=e,this;throw o},i.prototype._local=function(){return this._core._local()},i.prototype._setDirty=function(e){this._core._setDirty(e)},i.prototype._setPathOfNode=function(e,t){this._core._setPathOfNode(e,t)},i.prototype._verifyIntegrity=function(e,t,o){return this._core._verifyIntegrity(e,t,o)},i}),i("components/dcx-js/src/AdobeDCXBranch",["require","exports","module","./AdobeDCXBranchCore","./AdobeDCXElement","./AdobeDCXError","./AdobeDCXUtil"],function(e,t,o){"use strict";function i(e,t){if(e)e=this._setData(e,t);else{var o=d.generateUuid();e={"manifest-format-version":p,id:o},this.originalManifestFormatVersion=p,this._core=new s(e,this,t),this._data=e}this._pendingElements=[]}function n(e){var t,o,i=e.components;if(i)for(o=i.length,t=0;o>t;t++){var r=i[t];delete r.localStorageAssetId}var a=e.children;if(a)for(o=a.length,t=0;o>t;t++)n(a[t])}function r(e,t){t&&e.path&&delete e.path;var o,i=e.components;if("object"==typeof i)for(o=0;o<i.length;o++){var n=i[o];"number"==typeof n.version&&(n.version=n.version.toString())}var a=e.children;if("object"==typeof a)for(o=0;o<a.length;o++){var s=a[o];r(s)}}function a(e){var t=e["manifest-format-version"];if(p>t){if(4>t)throw new l(l.INVALID_DATA,"Encountered manifest format version "+e["manifest-format-version"]+". Format version conversion not yet implemented for that version.");5>t&&n(e),6>t&&r(e,!0)}}var s=e("./AdobeDCXBranchCore"),c=e("./AdobeDCXElement"),l=e("./AdobeDCXError"),d=e("./AdobeDCXUtil"),p=6;return i._newBranchAsCopyOfCore=function(e,t){var o=JSON.parse(JSON.stringify(e._data)),n=new i(o),r=n._core;return n._localStorage=t,n._resetIdentity(function(o){var i=e.getComponentWithId(o.id);if(!i)throw new l(l.INVALID_STATE,"Could not find original component.");if("modified"===i.state||!i.etag)throw new l(l.INVALID_STATE,"Cannot create a new composite from a branch that contains modified or unbound components.");var n=e._getHrefOfComponent(i);if(!n)throw new l(l.INVALID_STATE,"Cannot determine the href of component id "+i.id);r._setSourceHrefOfComponent(n,o),t&&t.removeComponentAsset(o,r._local())}),n},Object.defineProperties(i.prototype,{compositeId:{get:function(){return this._core.rootNode.id},set:function(e){var t=this._core;if(t._readOnly)throw new l(l.READ_ONLY,"This object is read-only.");if("string"!=typeof e||""===e)throw new l(l.INVALID_PARAMS,"Expecting a non-empty string.");if(t._allNodes[e])throw new l(l.DUPLICATE_VALUE,"There is already a node with the same id.");delete t._allNodes[this._data.id],this._data.id=e,t._allNodes[e]=this._core.rootNode,t._setDirty()}},rootNode:{get:function(){return this._core.rootNode},set:function(e){this._core.rootNode=e}},name:{get:function(){return this._core.rootNode.name},set:function(e){var t=this._core;if(t._readOnly)throw new l(l.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&"undefined"!=typeof e)throw new l(l.INVALID_PARAMS,"Expecting a string or undefined.");t.rootNode.name=e}},type:{get:function(){return this._core.rootNode.type},set:function(e){var t=this._core;if(t._readOnly)throw new l(l.READ_ONLY,"This object is read-only.");if("string"!=typeof e||""===e)throw new l(l.INVALID_PARAMS,"Expecting a non-empty string.");t.rootNode.type=e}},compositeHref:{get:function(){return this._data.local?this._data.local.compositeHref:void 0;
},set:function(e){var t=this._core;if(t._readOnly)throw new l(l.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&"undefined"!=typeof e)throw new l(l.INVALID_PARAMS,"Expecting a string or undefined.");t._local().compositeHref=d.ensureRelativeHrefStartsWithSlash(e),t._setDirty()}},_collaborationType:{get:function(){return this._data.local?this._data.local.collaborationType:void 0},set:function(e){var t=this._core;if(t._readOnly)throw new l(l.READ_ONLY,"This object is read-only.");e?t._local().collaborationType=e:delete t._local().collaborationType,t._setDirty(!0)}},_clientDataString:{get:function(){return this._data.local?this._data.local.clientDataString:void 0},set:function(e){var t=this._core;if(t._readOnly)throw new l(l.READ_ONLY,"This object is read-only.");e?t._local().clientDataString=e:delete t._local().clientDataString,t._setDirty(!0)}},manifestEtag:{get:function(){return this._data.local?this._data.local.manifestEtag:void 0},set:function(e){var t=this._core;if(t._readOnly)throw new l(l.READ_ONLY,"This object is read-only.");if("string"!=typeof e&&"undefined"!=typeof e)throw new l(l.INVALID_PARAMS,"Expecting a string or undefined.");t._local().manifestEtag=e,t._setDirty()}},compositeState:{get:function(){return this._data.state||"unmodified"},set:function(e){var t=this._core;if(t._readOnly)throw new l(l.READ_ONLY,"This object is read-only.");if("string"!=typeof e)throw new l(l.INVALID_PARAMS,"Expecting a string.");if("unmodified"!==e&&"modified"!==e&&"pendingDelete"!==e&&"committedDelete"!==e)throw new l(l.INVALID_PARAMS,'State must be "modified", "unmodified", "pendingDelete", or "committedDelete".');this._data.state=e,t._setDirty(!0)}},isBound:{get:function(){return this.manifestEtag&&this.compositeHref},set:function(){throw new l(l.READ_ONLY,"Cannot set the property isBound. Use resetIdentity instead.")}},_localStorage:{get:function(){return this._core._localStorage},set:function(e){this._core._localStorage=e}},hasLocalStorage:{get:function(){return this._core.hasLocalStorage},set:function(e){this._core.hasLocalStorage=e}},_isDirty:{get:function(){return this._core._isDirty},set:function(e){this._core._isDirty=e}},isDirty:{get:function(){return this._core.isDirty},set:function(e){this._core.isDirty=e}},localData:{get:function(){return this._core._stringify(!1,!0)},set:function(){throw new l(l.READ_ONLY,"Cannot set the property localData.")}},remoteData:{get:function(){return this._core._stringify(!0)},set:function(){throw new l(l.READ_ONLY,"Cannot set the property remoteData.")}},pendingElements:{get:function(){return this._pendingElements},set:function(e){throw new l(l.READ_ONLY,"Cannot set the property pendingElements.")}},changeCount:{get:function(){return this._core.changeCount},set:function(e){this._core.changeCount=e}}}),i.prototype.parse=function(e){if("string"!=typeof e)throw new l(l.INVALID_PARAMS,'Param "data" must be a string');var t=null;try{t=JSON.parse(e)}catch(o){throw new l(l.INVALID_JSON,"Manifest could not be parsed. Underlying error: "+o.message)}return this._setData(t,this._core._readOnly)},i.prototype.getElementWithId=function(e){return this._createElement(this._core.getChildWithId(e))},i.prototype.getElementWithAbsolutePath=function(e){return this._createElement(this._core.getChildWithAbsolutePath(e))},i.prototype.addElement=function(e,t,o,i,n,r){if("string"!=typeof e)throw new l(l.INVALID_PARAMS,"Element must have a name of type string");if("string"!=typeof t)throw new l(l.INVALID_PARAMS,"Element must have a type of type string");if("string"!=typeof o)throw new l(l.INVALID_PARAMS,"Element must have a path of type string");var a=this._core.addChild(e,i,n,r);try{a.path=o}catch(s){throw this._core.removeChild(a),s}return a._data.type=t,this._createElement(a)},i.prototype.updateElement=function(e){var t=this.getChildWithId(e.rootNode.id);if(!t)throw new l(l.INVALID_PARAMS,"Element does not exist in branch.");var o=this._core.replaceChild(e.rootNode,t.path);return this._deleteElement(e),o},i.prototype.abandonElement=function(e){this._deleteElement(e)},i.prototype.getChildWithId=function(e){return this._core.getChildWithId(e)},i.prototype.getChildWithAbsolutePath=function(e){return this._core.getChildWithAbsolutePath(e)},i.prototype.getChildrenOf=function(e){return this._core.getChildrenOf(e)},i.prototype.addChild=function(e,t,o,i){return this._core.addChild(e,t,o,i)},i.prototype.removeChild=function(e){return this._core.removeChild(e)},i.prototype.moveChild=function(e,t,o){return this._core.moveChild(e,t,o)},i.prototype.copyChild=function(e,t,o,i,n,r){return this._core.copyChild(e,t,o,i,n,r)},i.prototype.replaceChild=function(e,t,o,i){return this._core.replaceChild(e,t,o,i)},i.prototype.allComponents=function(){return this._core.allComponents()},i.prototype.getComponentWithId=function(e){return this._core.getComponentWithId(e)},i.prototype.getComponentWithAbsolutePath=function(e){return this._core.getComponentWithAbsolutePath(e)},i.prototype.getComponentsOf=function(e){return this._core.getComponentsOf(e)},i.prototype.addComponent=function(e,t,o,i,n,r,a,s,c,l){return this._core.addComponent(e,t,o,i,n,r,a,s,c,l)},i.prototype.addComponentWithUploadResults=function(e,t,o,i,n){return this._core.addComponentWithUploadResults(e,t,o,i,n)},i.prototype.updateComponent=function(e,t,o,i){return this._core.updateComponent(e,t,o,i)},i.prototype.updateComponentWithUploadResults=function(e,t){return this._core.updateComponentWithUploadResults(e,t)},i.prototype.removeComponent=function(e){return this._core.removeComponent(e)},i.prototype.moveComponent=function(e,t){return this._core.moveComponent(e,t)},i.prototype.copyComponent=function(e,t,o,i,n){return this._core.copyComponent(e,t,o,i,n)},i.prototype.replaceComponent=function(e,t,o,i){return this._core.replaceComponent(e,t,o,i)},i.prototype.assetOfComponent=function(e,t){return this._core.assetOfComponent(e,t)},i.prototype.copy=function(){return new i(JSON.parse(JSON.stringify(this._data)))},i.prototype._createElement=function(e){var t;if(e){var o=JSON.parse(JSON.stringify(e._data));o["manifest-format-version"]=this._data["manifest-format-version"],delete o.path,t=new c(o,this,this._core._readOnly),t&&this._localStorage&&(t._localStorage=this._localStorage,t._updateLocalDataFromBranch(this),this._localStorage.registerInMemoryBranchOrElement(t))}return t&&this._pendingElements.push(t),t},i.prototype._deleteElement=function(e){var t=this._pendingElements.indexOf(e);if(0>t)throw new l(l.INVALID_PARAMS,"Unknown element.");this._pendingElements.splice(t,1),this._localStorage&&this._localStorage.unregisterInMemoryBranchOrElement(e)},i.prototype._updateLocalDataFromBranch=function(e){if(this._readOnly)throw new l(l.READ_ONLY,"This object is read-only.");if(!this._localStorage)throw new l(l.NO_LOCAL_STORAGE,"No local storage.");if(!e._localStorage)throw new l(l.NO_LOCAL_STORAGE,"No local storage for source.");if(this._localStorage.compositePath!==e._localStorage.compositePath)throw new l(l.INVALID_PARAMS,"Branches must have same storage path.");this._core._localStorage.copyLocalStorageData(e,e._core._local(),this,this._core._local()),this._core._copySourceHrefsFrom(e._core)},i.prototype._verify=function(e){return"string"!=typeof e.id?new l(l.INVALID_DATA,"Manifest is missing an id of type string"):"string"!=typeof e.name?new l(l.INVALID_DATA,"Manifest is missing a name of type string"):"string"!=typeof e.type?new l(l.INVALID_DATA,"Manifest is missing a type of type string"):"number"!=typeof e["manifest-format-version"]?new l(l.INVALID_DATA,"Manifest is missing a manifest-format-version of type number"):null},i.prototype._setData=function(e,t){this.originalManifestFormatVersion=e["manifest-format-version"],a(e),e.local&&(e.local.version=2);var o=this._verify(e);if(null===o)return e["manifest-format-version"]=p,this._core=new s(e,this,t),this._data=e,this;throw o},i.prototype._reset=function(e,t){if(this._readOnly)throw new l(l.READ_ONLY,"This object is read-only.");this._data.local&&(delete this._data.local.manifestEtag,delete this._data.local.compositeHref),e||(this._data.id=d.generateUuid()),this._data.state="modified",this._core._recursiveReset(this._data,t),this._core._setDirty()},i.prototype._resetBinding=function(e){this._reset(!0,e)},i.prototype._resetIdentity=function(e){this._reset(!1,e)},i.prototype._local=function(){return this._core._local()},i.prototype._setDirty=function(e){this._core._setDirty(e)},i.prototype._setPathOfNode=function(e,t){this._core._setPathOfNode(e,t)},i.prototype._verifyIntegrity=function(e,t,o){return this._core._verifyIntegrity(e,t,o)},i}),i("components/dcx-js/src/AdobeDCXPushJournal",["require","exports","module","./AdobeDCXError","./AdobeDCXFS","./AdobeDCXUtil"],function(e,t,o){"use strict";function i(e,t,o){o?this._setData(o,e.href):this._data={"push-journal-format-version":a,"composite-href":e.href,"uploaded-components":{}},this._filePath=t,this._waitingCallbacks=[],this._commitInProgress=!1,this._needAnotherCommit=!1}var n=e("./AdobeDCXError"),r=e("./AdobeDCXFS"),a=(e("./AdobeDCXUtil"),3);return i.readJournal=function(e,t,o,n){r.readFile(e,"utf8",function(r,a){var s;if(r&&r.code&&o&&(r=void 0),!r)try{a=JSON.parse(a),s=new i(t,e,a)}catch(c){o?s=new i(t,e):r=c}n(r,r?void 0:s)})},Object.defineProperties(i.prototype,{compositeHref:{get:function(){return this._data["composite-href"]},set:function(e){throw new n(n.READ_ONLY,"This property is read-only.")}},manifestEtag:{get:function(){return this._data.etag},set:function(e){e?this._data.etag=e:delete this._data.etag}},currentBranchEtag:{get:function(){return this._data["current-branch-etag"]},set:function(e){e?this._data["current-branch-etag"]=e:delete this._data["current-branch-etag"]}},changeCount:{get:function(){return this._data.change},set:function(e){e?this._data.change=e:delete this._data.change}},compositeHasBeenCreated:{get:function(){return this._data["composite-created"]?!0:!1},set:function(e){e?this._data["composite-created"]=!0:delete this._data["composite-created"]}},compositeHasBeenDeleted:{get:function(){return this._data["composite-deleted"]?!0:!1},set:function(e){e?this._data["composite-deleted"]=!0:delete this._data["composite-deleted"]}},isEmpty:{get:function(){return 0===Object.keys(this._data["uploaded-components"]).length&&!this.compositeHasBeenDeleted&&!this.manifestEtag},set:function(e){throw new n(n.READ_ONLY,"This property is read-only.")}},isComplete:{get:function(){return this._data.etag&&this._data.change||this._data["composite-deleted"]?!0:!1},set:function(e){throw new n(n.READ_ONLY,"This property is read-only.")}}}),i.prototype.recordUploadedComponent=function(e,t,o,i,n,r,a){var s={etag:t,length:n,version:o,md5:i};r&&(s["storage-name"]=r),a&&(s["source-href"]=a),this._data["uploaded-components"][e]=s},i.prototype.idsOfAllUploadedComponents=function(){return Object.keys(this._data["uploaded-components"])},i.prototype.getRecordForUploadedComponent=function(e){return this._data["uploaded-components"][e]},i.prototype.removeRecordForUploadedComponent=function(e){delete this._data["uploaded-components"][e]},i.prototype.applyToBranch=function(e,t){if(!this.isComplete)throw new n(n.INVALID_STATE,"Journal is not complete.");var o=e.isDirty;if(this.compositeHasBeenDeleted)e._data.state="committedDelete",e.manifestEtag=this.manifestEtag;else{var i,r="unmodified"!==e.compositeState&&this.changeCount!==e.changeCount,a=this.idsOfAllUploadedComponents(),s=a.length;for(i=0;s>i;i++){var c=a[i],l=e.getComponentWithId(c);if(l){var d=this.getRecordForUploadedComponent(l.id);l._data.etag=d.etag,l._data.length=d.length,l._data.version=d.version,l._data.md5=d.md5,d["source-href"]?e._core._getSourceHrefOfComponent(l)===d["source-href"]&&(l._data.state="unmodified",e._core._setSourceHrefOfComponent(void 0,l)):e.hasLocalStorage&&e._localStorage.componentAssetName(l,e._local())===d["storage-name"]?(l._data.state="unmodified",e._core._setSourceHrefOfComponent(void 0,l)):e.hasLocalStorage||(l._data.state="unmodified")}}e.manifestEtag=this.manifestEtag,r||(e._data.state="unmodified")}t&&(e._isDirty=o)},i.prototype.commitChanges=function(e){if(!this._filePath)return void(e&&e());var t=this,o=function(e){t._needAnotherCommit=!1,t._commitInProgress=!0,t._waitingCallbacks=[],r.writeFileAtomically(t._filePath,JSON.stringify(t._data),"utf8",function(i){var n,r=e.length;for(n=0;r>n;n++)try{e[n](i)}catch(a){}t._needAnotherCommit?o(t._waitingCallbacks):t._commitInProgress=!1})};t._commitInProgress?(this._needAnotherCommit=!0,e&&this._waitingCallbacks.push(e)):o(e?[e]:[])},i.prototype._setData=function(e,t){if(e["push-journal-format-version"]<=2){var o=e["uploaded-components"];if(o){var i,n=Object.keys(o),r=n.length;for(i=0;r>i;i++){var s=n[i],c=o[s];"number"==typeof c.version&&(c.version=String(c.version))}}e["push-journal-format-version"]=a}var l=this._verify(e,t);if(null===l)return this._data=e,this;throw l},i.prototype._verify=function(e,t){return e["push-journal-format-version"]!==a?new n(n.INVALID_DATA,"Wrong push journal format version."):e["composite-href"]!==t?new n(n.INVALID_DATA,"Composite and journal hrefs mismatch."):e["uploaded-components"]?null:new n(n.INVALID_DATA,"Missing component list.")},i}),i("components/dcx-js/src/AdobeDCXLocalStorage",["require","exports","module","./AdobeDCXError","./AdobeDCXUtil","./AdobeDCXFS"],function(e,t,o){"use strict";function i(e,t){if("string"!=typeof e||""===e)throw new n(n.INVALID_PARAMS,'Param "compositePath" must be a non-empty string.');this._compositePath=e,this._preserveFileExtensions=t,this._inMemoryBranchesAndElements=[],this._inflightComponents=[]}var n=e("./AdobeDCXError"),r=e("./AdobeDCXUtil"),a=e("./AdobeDCXFS");Object.defineProperties(i.prototype,{compositePath:{get:function(){return this._compositePath},set:function(e){if("string"!=typeof e||""===e)throw new n(n.INVALID_PARAMS,'Param "compositePath" must be a non-empty string.');this._compositePath=e}}}),i.prototype.currentManifestPath=function(){return this._compositePath+"/manifest"},i.prototype.currentBaseManifestPath=function(){return this._compositePath+"/manifest.base"},i.prototype.pulledManifestPath=function(){return this._compositePath+"/pull.manifest"},i.prototype.pushedManifestPath=function(){return this._compositePath+"/push.manifest"},i.prototype.resolvePulledBranch=function(e,t){var o=this;a.writeFileAtomically(this.currentManifestPath(),e.localData,"utf8",function(e){e?(e.code!==n.OUT_OF_SPACE&&(e=new n(n.INVALID_STATE,"Could not write current manifest.",e)),t(e)):a.move(o.pulledManifestPath(),o.currentBaseManifestPath(),!1,function(e){e?t(new n(n.INVALID_STATE,"Could not move pull manifest.",e)):t()})})},i.prototype.acceptPushedBranch=function(e,t){var o=this;a.writeFileAtomically(this.currentManifestPath(),e.localData,"utf8",function(e){e?(e.code!==n.OUT_OF_SPACE&&(e=new n(n.INVALID_STATE,"Could not write current manifest.",e)),t(new n(n.INVALID_STATE,"Could not write current manifest.",e))):a.move(o.pushedManifestPath(),o.currentBaseManifestPath(),!1,function(e){e?t(new n(n.INVALID_STATE,"Could not move push manifest.",e)):o._deleteJournal(t)})})},i.prototype.discardPulledBranch=function(e){a.deleteFile(this.pulledManifestPath(),e)},i.prototype.discardPushedBranch=function(e){var t=this;a.deleteFile(this.pushedManifestPath(),function(o){o?e(o):t._deleteJournal(e)})},i.prototype.discardBaseBranch=function(e){a.deleteFile(this.currentBaseManifestPath(),e)},i.prototype.registerInMemoryBranchOrElement=function(e){if(this._inMemoryBranchesAndElements.indexOf(e)>=0)throw new n(n.INVALID_STATE,"Branch or element is already registered.");this._inMemoryBranchesAndElements.push(e)},i.prototype.unregisterInMemoryBranchOrElement=function(e){var t=this._inMemoryBranchesAndElements.indexOf(e);if(0>t)throw new n(n.INVALID_STATE,"Unknown branch or element.");this._inMemoryBranchesAndElements.splice(t,1)},i.prototype._deleteJournal=function(e){a.deleteFile(this.pushJournalPath(),e)};var s=/(\/)|(\.$)/;return i.prototype.componentAssetName=function(e,t){var o=t["copyOnWrite#storageIds"],i=o?o[e.id]:null;return i&&s.test(i)&&(i=null),i},i.prototype.componentAssetPath=function(e,t){var o=this.componentAssetName(e,t);return o?this._componentPathFromName(o):null},i.prototype.ingestComponentAsset=function(e,t,o,i,r){var s=this,c=this._newFileNameForComponent(e),l=this._componentPathFromName(c);this._inflightComponents.push(c);var d=function(t){if(!t)try{s._setComponentName(e,i,c)}catch(o){t=o}var a=s._inflightComponents.indexOf(c);0>a&&!t&&(t=new n(n.INVALID_STATE,"Could not find inflight component.")),s._inflightComponents.splice(a,1),r(t)};o?a.copyFile(t,l,d):a.move(t,l,!0,d)},i.prototype.removeComponentAsset=function(e,t){var o=t["copyOnWrite#storageIds"];o&&delete o[e.id]},i.prototype.componentIds=function(e){var t=e["copyOnWrite#storageIds"];return t?Object.keys(t):[]},i.prototype.copyLocalStorageData=function(e,t,o,i){var n,r=o.allComponents(),a=r.length,s=t["copyOnWrite#storageIds"];if(s){var c=i["copyOnWrite#storageIds"];for(c||(c=i["copyOnWrite#storageIds"]={}),n=0;a>n;n++){var l=r[n],d=l.id,p=e.getComponentWithId(d);if(p&&p.etag===l.etag){var u=s[d];u&&(c[d]=u)}}}},i.prototype.removeUnusedLocalFiles=function(e,t){var o,i,r,s,c,l=this,d=function(e){l._deleteComponentAsset(e,function(e){e&&!o&&(o=e),c--,0===c&&t(o)})},p=function(){try{var e,o=s.length,n=[];for(e=0;o>e;e++){var a=s[e].name,p=s[e].info;!i[a]&&p.mtime.getTime()<r&&l._inflightComponents.indexOf(a)<0&&n.push(a)}if(c=o=n.length,c>0)for(e=0;o>e;e++)d(n[e])}catch(u){return void t(u)}0===c&&t()};this._gatherComponentAssetNames([this.currentManifestPath(),this.currentBaseManifestPath(),this.pulledManifestPath(),this.pushedManifestPath()],e,function(e,a,c,l){if(o)return void t(o);if(!e)try{if(1>a||!l)throw new n(n.INVALID_STATE,1>a?"No manifest found.":"Invalid time stamp");i=c,r=l}catch(d){e=d}e&&(o=e),s&&(o?t(o):p())}),a.directoryListing(this._compositePath+"/components",function(e,n){if(o)return void t(o);if(!e)try{s=n}catch(r){e=r}e&&(o=e),i&&(o?t(o):p())})},i.prototype.tempPathForComponent=function(){return this._compositePath+"/tmp/"+r.generateUuid()},i.prototype.deleteTempFiles=function(e){a.deleteDirectory(this._compositePath+"/tmp",e)},i.prototype.clientDataPath=function(){return this._compositePath+"/clientdata"},i.prototype.pushJournalPath=function(){return this._compositePath+"/push.journal"},i.prototype._copyComponentMapping=function(e,t,o,i){var n=t["copyOnWrite#storageIds"];if(n){var r=i["copyOnWrite#storageIds"];r||(r=i["copyOnWrite#storageIds"]={});var a=n[e];return a&&(r[o]=a),a}},i.prototype._componentPathFromName=function(e){return this._compositePath+"/components/"+e},i.prototype._newFileNameForComponent=function(e){var t=r.generateUuid();if(this._preserveFileExtensions){var o=e.path?r.filePathComponents(e.path).extension:null;o&&(t=t+"."+o)}return t},i.prototype._setComponentName=function(e,t,o){var i=t["copyOnWrite#storageIds"];i||(i=t["copyOnWrite#storageIds"]={}),i[e.id]=o},i.prototype._gatherComponentAssetNames=function(e,t,o){try{var i,n,s={},c=t||r.timeStamp(!0),l=e.length,d=l,p=0,u=function(e){if(e){e=e["copyOnWrite#storageIds"];var t,o=Object.keys(e);for(t=0;t<o.length;t++){var i=e[o[t]];s[i]=!0}}},h=function(e){a.exists(e,function(t){t?(p++,a.info(e,function(t,i){if(!t)try{var r=i.mtime.getTime();c>r&&(c=r),a.readFile(e,"utf8",function(e,t){if(d--,!e)try{t=JSON.parse(t),u(t.local)}catch(i){e=i}e&&!n&&(n=e),0===d&&o(n,p,s,c)})}catch(l){t=l}t&&(d--,n||(n=t),0===d&&o(n))})):(d--,0===d&&o(n,p,s,c))})};for(i=0;l>i;i++)h(e[i]);for(l=this._inMemoryBranchesAndElements.length,i=0;l>i;i++)u(this._inMemoryBranchesAndElements[i]._local())}catch(_){o(_)}},i.prototype._deleteComponentAsset=function(e,t){a.deleteFile(this._componentPathFromName(e),t)},i}),i("components/dcx-js/src/AdobeDCXComposite",["require","exports","module","./AdobeDCXError","./AdobeDCXBranch","./AdobeDCXPushJournal","./AdobeDCXLocalStorage","./AdobeDCXFS","./AdobeDCXUtil"],function(e,t,o){"use strict";function i(e,t,o,i,n,a){n=l.ensureRelativeHrefStartsWithSlash(n),this._options=a||{},o?this._setPath(o):n?(this._href=n,e&&(this._name=e),t&&(this._type=t),i&&(this._id=i)):t&&(this._current=new r,e&&(this._current._data.name=e),this._current._data.type=t,i&&(this._current.compositeId=i)),this._autoRemoveUnusedLocalFiles=!0,this._options.xhrBaseBranchSupport&&(this._baseBranchData=void 0,this._pushedBranchData=void 0,this._pulledBranchData=void 0),this._collaborationType=p.PRIVATE}var n=e("./AdobeDCXError"),r=e("./AdobeDCXBranch"),a=e("./AdobeDCXPushJournal"),s=e("./AdobeDCXLocalStorage"),c=e("./AdobeDCXFS"),l=e("./AdobeDCXUtil"),d=1024,p={PRIVATE:void 0,SHARED_BY_USER:"sharedByUser",SHARED_WITH_USER:"sharedWithUser"};return i.newCompositeAsCopyOf=function(e,t,o,a,s,c,d){var p=e._core;if(p||e.current&&(p=e.current._core),!p)throw new n(n.INVALID_PARAMS,"compositeBranchOrElement must be a branch, an element or a composite with a current branch.");var u=new i(void 0,void 0,void 0,void 0,void 0,d);return a&&(u.path=a),u._current=r._newBranchAsCopyOfCore(p,this._localStorage),u.id=s||l.generateUuid(),t&&(u.name=t),o&&(u.type=o),c&&(u.href=c),u},i.COLLABORATION=p,Object.defineProperties(i.prototype,{id:{get:function(){return this._current?this._current.compositeId:this._id},set:function(e){if("string"!=typeof e)throw new n(n.INVALID_PARAMS,"Expecting a string.");this._current&&(this._current.compositeId=e),this._id=e}},name:{get:function(){return this._current?this._current.name:this._name},set:function(e){if("string"!=typeof e)throw new n(n.INVALID_PARAMS,"Expecting a string.");this._current&&(this._current.name=e),this._name=e}},type:{get:function(){return this._current?this._current.type:this._type},set:function(e){if("string"!=typeof e)throw new n(n.INVALID_PARAMS,"Expecting a string.");this._current&&(this._current.type=e),this._type=e}},href:{get:function(){return this._current?this._current.compositeHref:this._href},set:function(e){if("string"!=typeof e)throw new n(n.INVALID_PARAMS,"Expecting a string.");e=l.ensureRelativeHrefStartsWithSlash(e),this._current&&(this._current.compositeHref=e),this._href=e}},collaborationType:{get:function(){return this._current?this._current._collaborationType:this._collaborationType},set:function(e){if(e!==p.PRIVATE&&e!==p.SHARED_BY_USER&&e!==p.SHARED_WITH_USER)throw new n(n.INVALID_PARAMS,"Invalid value: ."+e);this._current&&(this._current._collaborationType=e),this._collaborationType=e}},clientDataString:{get:function(){return this._current?this._current._clientDataString:this._clientDataString},set:function(e){if("string"!=typeof e&&void 0!==e)throw new n(n.INVALID_PARAMS,"Invalid clientDataString: must be a string or undefined.");var t=this._options.maxClientDataLength||d;if(e&&e.length>t)throw new n(n.INVALID_PARAMS,"Invalid clientDataString: cannot be greater than 1KB");this._current&&(this._current._clientDataString=e),this._clientDataString=e}},path:{get:function(){return this._path},set:function(e){if("string"!=typeof e)throw new n(n.INVALID_PARAMS,"Expecting a string.");this._setPath(e)}},isBound:{get:function(){return this._current&&this._current.isBound||!this._current&&this._href},set:function(){throw new n(n.READ_ONLY,"Cannot set the property isBound. Use resetIdentity or resetBinding instead.")}},hasLocalStorage:{get:function(){return this._localStorage},set:function(){throw new n(n.READ_ONLY,"Cannot set the property hasLocalStorage.")}},autoRemoveUnusedLocalFiles:{get:function(){if(!this._localStorage)throw new n(n.NO_LOCAL_STORAGE,"No local storage.");return this._autoRemoveUnusedLocalFiles},set:function(e){if(!this._localStorage)throw new n(n.NO_LOCAL_STORAGE,"No local storage.");this._autoRemoveUnusedLocalFiles=e}},clientDataStoragePath:{get:function(){if(!this._localStorage)throw new n(n.NO_LOCAL_STORAGE,"No local storage.");return this._localStorage.clientDataPath()},set:function(e){throw new n(n.READ_ONLY,'Property "clientDataStoragePath" is read-only.')}},current:{get:function(){return this._current},set:function(e){throw new n(n.READ_ONLY,'Property "current" is read-only.')}}}),i.prototype.loadCurrentFromLocalStorage=function(e){if(!this._localStorage)throw new n(n.NO_LOCAL_STORAGE,"No local storage.");var t=this;this._loadBranch(this._localStorage.currentManifestPath(),!1,function(o,i){if(!o&&i)try{t._current=i,t._currentBranchCommittedAtDate=l.timeStamp(!0)}catch(n){o=n}e(o,o?void 0:i)})},i.prototype.commitChanges=function(e){if(!this._localStorage)throw new n(n.NO_LOCAL_STORAGE,"No local storage.");if(!this._current)return e(new n(n.INVALID_STATE,"Current branch is not in memory."));var t=this;c.writeFileAtomically(this._localStorage.currentManifestPath(),this._current.localData,"utf8",function(o){if(!o)try{t._currentBranchCommittedAtDate=l.timeStamp(!0),t._current._isDirty=!1}catch(i){o=i}e(o)})},i.prototype.tempAssetPath=function(){if(!this._localStorage)throw new n(n.NO_LOCAL_STORAGE,"No local storage.");return this._localStorage.tempPathForComponent()},i.prototype.deleteTempFiles=function(e){if(!this._localStorage)throw new n(n.NO_LOCAL_STORAGE,"No local storage.");this._localStorage.deleteTempFiles(function(t){e&&e(t)})},i.prototype.removeUnusedLocalFiles=function(e){if(!this._localStorage)throw new n(n.NO_LOCAL_STORAGE,"No local storage.");this._localStorage.removeUnusedLocalFiles(this._currentBranchCommittedAtDate,e)},i.prototype.removeLocalStorage=function(e){if(!this._localStorage)throw new n(n.NO_LOCAL_STORAGE,"No local storage.");return this._path?void c.deleteDirectory(this._path,e):e(new n(n.INVALID_STATE,"No path set."))},i.prototype.loadBaseBranch=function(e){if(!this._localStorage&&!this._baseBranchData)throw new n(n.NO_LOCAL_STORAGE,"No local storage.");if(this._localStorage)this._loadBranch(this._localStorage.currentBaseManifestPath(),!0,e);else{var t,o;try{o=new r(void 0,!0).parse(this._baseBranchData)}catch(i){t=i}e(t,o)}},i.prototype.loadPulledBranch=function(e){if(!this._localStorage)throw new n(n.NO_LOCAL_STORAGE,"No local storage.");this._loadBranch(this._localStorage.pulledManifestPath(),!1,e)},i.prototype.loadPushedBranch=function(e){if(!this._localStorage)throw new n(n.NO_LOCAL_STORAGE,"No local storage.");this._loadBranch(this._localStorage.pushedManifestPath(),!1,e)},i.prototype.resolvePullWithBranch=function(e,t){if(!e)throw new n(n.INVALID_PARAMS,"Need a branch.");if(e===this._current)throw new n(n.INVALID_PARAMS,"Cannot resolve current.");if(this._localStorage&&!t)throw new n(n.INVALID_PARAMS,"Need a callback function.");var o=this,i=function(){e._collaborationType=o.collaborationType,e._clientDataString=o.clientDataString,o._current=e};if(this._localStorage)o._localStorage.resolvePulledBranch(e,function(e){if(!e)try{i(),o._autoRemoveUnusedLocalFiles&&o._localStorage.removeUnusedLocalFiles(o._currentBranchCommittedAtDate,function(e){})}catch(n){e=n}t(e,e?void 0:o._current)});else{if(this._options.xhrBaseBranchSupport&&(this._baseBranchData=this._pulledBranchData,this._pulledBranchData=void 0),i(),!t)return this._current;t(void 0,this._current)}},i.prototype.acceptPush=function(e){if(this._localStorage&&!e)throw new n(n.INVALID_PARAMS,"Need a callback function.");var t,o,i=this,r=function(n){if(!n)if(t)try{i._localStorage?(t.applyToBranch(o),i._localStorage.acceptPushedBranch(o,function(o){if(!o)try{t.applyToBranch(i._current,!0),i._autoRemoveUnusedLocalFiles&&i._localStorage.removeUnusedLocalFiles(i._currentBranchCommittedAtDate,function(e){})}catch(n){o=n}e(o)})):(t.applyToBranch(i._current,!0),i._options.xhrBaseBranchSupport&&(i._baseBranchData=i._pushedBranchData,i._pushedBranchData=void 0),i._pushJournal=void 0,e&&e())}catch(r){n=r}else e&&e();if(n){if(!e)throw n;e(n)}};if(!this._localStorage)return t=this._pushJournal,r();var s,c=2;a.readJournal(i._localStorage.pushJournalPath(),i,!1,function(e,o){c--,s?r():(e?"ENOENT"!==e.code&&(s=new n(n.INVALID_STATE,"Failed to load push journal.",e)):t=o,c||r())}),this._loadBranch(this._localStorage.currentManifestPath(),!1,function(e,t){c--,s?r():(e?s=new n(n.INVALID_STATE,"Failed to load current manifest.",e):o=t,c||r())})},i.prototype.discardPulledBranch=function(e){if(!this._localStorage)throw new n(n.NO_LOCAL_STORAGE,"No local storage.");var t=this;this._localStorage.discardPulledBranch(function(o){if(!o){try{t._autoRemoveUnusedLocalFiles&&t._localStorage.removeUnusedLocalFiles(t._currentBranchCommittedAtDate,function(e){})}catch(i){o=i}e(o)}o&&e(o)})},i.prototype.discardPushedBranch=function(e){if(!this._localStorage)throw new n(n.NO_LOCAL_STORAGE,"No local storage.");var t=this;this._localStorage.discardPushedBranch(function(o){if(!o){try{t._autoRemoveUnusedLocalFiles&&t._localStorage.removeUnusedLocalFiles(t._currentBranchCommittedAtDate,function(e){})}catch(i){o=i}e(o)}o&&e(o)})},i.prototype.resetBinding=function(e){delete this._href,this._current&&this._current._resetBinding(),this._localStorage?this._discardEveryBranchButCurrent(e):(this._baseBranchData=void 0,this._pushedBranchData=void 0,this._pulledBranchData=void 0,e&&e())},i.prototype.resetIdentity=function(e){delete this._href,this._current?(this._current._resetIdentity(),this._id=this._current.compositeId):this._id=l.generateUuid(),this._localStorage?this._discardEveryBranchButCurrent(e):(this._baseBranchData=void 0,this._pushedBranchData=void 0,this._pulledBranchData=void 0,e&&e())},i.prototype._loadBranch=function(e,t,o){if("function"!=typeof o)throw new n(n.INVALID_PARAMS,'Param "callback" must be a function.');var i=this;c.exists(e,function(n){n?c.readFile(e,"utf8",function(e,n){var a;if(!e)try{a=new r(void 0,t).parse(n),a._localStorage=i._localStorage}catch(s){e=s}o(e,a)}):o()})},i.prototype._discardEveryBranchButCurrent=function(e){if(!this._localStorage)throw new n(n.NO_LOCAL_STORAGE,"No local storage.");var t,o=this,i=3,r=function(n){n&&!t&&(t=n),i--,0===i&&(!t&&o._autoRemoveUnusedLocalFiles&&o._localStorage.removeUnusedLocalFiles(o._currentBranchCommittedAtDate,function(e){}),e(t))};this._localStorage.discardPushedBranch(r),this._localStorage.discardPulledBranch(r),this._localStorage.discardBaseBranch(r)},i.prototype._setPath=function(e){this._localStorage?this._localStorage.compositePath=e:c.canUseFileSystem&&(this._localStorage=new s(e,this._options.preserveFileExtensions),this._current&&(this._current._localStorage=this._localStorage)),this._path=e},i}),"function"!=typeof e)var e=o;return i("components/dcx-js/src/AdobeNetworkHTTPService",["require","exports","module","./AdobeDCXUtil","./AdobeDCXError","./AdobeDCXFS"],function(t,o,i){"use strict";function n(e){this.filename=e}function r(){}function a(e){this._requestQueue=[],this._requestsOutstanding=[],this._rejectedAuths=[],this._authCallback=e,this._isActive=!0,this._waitingForAuthentication=!1,this._currentAuthId=d.generateUuid(),this._https=c,this._XMLHttpRequest=s,this._handlesRedirects=void 0!==s,this._maxOutstanding=5}var s,c,l,d=t("./AdobeDCXUtil"),p=t("./AdobeDCXError"),u=t("./AdobeDCXFS");"undefined"!=typeof global&&global.Buffer?(c=e("https"),l=e("url")):s=window.XMLHttpRequest;var h=d.merge,_=3e5;return Object.defineProperties(a.prototype,{isActive:{get:function(){return this._isActive},set:function(e){var t=this._isActive;t!==e&&(this._isActive=e,e||(this._authValue=void 0,this._checkQueue()))}},crossOriginCredentials:{get:function(){return this._withCredentials},set:function(e){this._withCredentials=e}},maxOutstanding:{get:function(){return this._maxOutstanding},set:function(e){this._maxOutstanding=e,this._checkQueue()}},handlesRedirects:{get:function(){return this._handlesRedirects}}}),a.prototype._forceXhr=function(t,o){this._https=void 0,this._XMLHttpRequest=t||s||e("xhr2"),this._handlesRedirects=!o},a.FileContent=n,a.StreamProvider=r,a.prototype.setAdditionalHeaders=function(e){this._additionalHeaders=e||{}},a.prototype.setAdditionalNodeOptions=function(e){this._additionalNodeOptions=e},a.prototype.setApiKey=function(e){this._apiKey=e},a.prototype.setTimeout=function(e){this._timeout=e},a.prototype.setAuthToken=function(e){
e?(this._authValue="Bearer "+e,this.resume()):(this._authValue=void 0,this._currentAuthId=d.generateUuid())},a.prototype.resume=function(){this._currentAuthId=d.generateUuid(),this._waitingForAuthentication=!1,this._checkQueue()},a.prototype.setRequestHooks=function(e,t){this._beforeHook=e,this._afterHook=t},a.prototype.invoke=function(e,t,o,i,r,a){r=r||{};var s=r.responseType;if(s instanceof n){if(!u.canUseFileSystem)throw new p(p.INVALID_PARAMS,"No filesystem access")}else if("buffer"===s){if("function"!=typeof Buffer)throw new p(p.INVALID_PARAMS,"No Buffer class")}else if("blob"===s){if("function"!=typeof Blob)throw new p(p.INVALID_PARAMS,"No Blob class")}else if(s&&"text"!==s&&"json"!==s&&"arraybuffer"!==s)throw new p(p.INVALID_PARAMS,"Unsupported response type");o=h({},o,this._additionalHeaders),this._apiKey&&(o["x-api-key"]=this._apiKey);var c={method:e,href:t,headers:o,callback:a,body:i,options:r},l=r.reuseRequestDesc;if(l){if(this._requestQueue.indexOf(l)>=0||this._requestsOutstanding.indexOf(l)>=0)throw new p(p.INVALID_PARAMS,"Request descriptor still in use.");c=d.merge(l,c)}return this._doRequest(c),c},a.prototype._doRequest=function(e){function t(t,o){t&&d.log("["+e.id+"] error: "+t),c&&c.end();var i=f._requestsOutstanding.indexOf(e);i>=0&&f._requestsOutstanding.splice(i,1);var n=e.callback;n&&(e.callback=void 0,t&&(t.clientRequest=e.clientRequest,t.xhr=e.xhr),t&&t.code!==p.SERVICE_IS_INACTIVE&&!f._isActive?t=new p(p.SERVICE_IS_INACTIVE,"Service is now inactive",t):e.timedOut&&(t=new p(p.TIMED_OUT,"timed out request",t)),n(t,o)),f._isActive&&f._checkQueue()}function o(o){function i(){return a?void 0:(a=!0,c=void 0,t(void 0,o))}var r=!1,a=!1,s=!1,l=f._requestsOutstanding.indexOf(e);if(0>l)return void f._checkQueue();e.response=o;var h=(new Date).valueOf()-e.startTime;if(d.log("["+e.id+"] "+o.statusCode+" ("+h+"ms)"),401===o.statusCode&&f._authCallback)f._requestsOutstanding.splice(l,1),f._requestQueue.unshift(e),f._authFail(e),d.consumeStream(o);else{var _=e.progress;200===o.statusCode||201===o.statusCode||202===o.statusCode?(o.on("data",function(e){e.length&&_&&_(e.length),!c&&e&&y.push(e)}),f._https&&v instanceof n&&(c=u.createWriteStream(v.filename),o.pipe(c),r=!0)):d.consumeStream(o),o.once("end",function(){s=!0;var i=f._requestsOutstanding.indexOf(e);if(!(0>i||(f._requestsOutstanding.splice(i,1),f._checkQueue(),r||a)))return a=!0,o.response=Buffer.concat(y),"arraybuffer"===v?o.response=new ArrayBuffer(o.response):"text"===v&&(o.response=o.response.toString()),t(void 0,o)}),o.once("close",function(){return s||a?void 0:(a=!0,t(new p(p.NETWORK_ERROR,"incomplete response")))}),r&&(c.once("finish",i),c.once("close",i))}}function i(){var o=e.progress;if(o&&s.response){var i=s.response.length;o(i-m),m=i}if(4===s.readyState){if(0===s.status)return t(new p(p.UNEXPECTED,"XHR failure"));var r=f._requestsOutstanding.indexOf(e);if(0>r)return void f._checkQueue();var a=(new Date).valueOf()-e.startTime;if(d.log("["+e.id+"] "+s.status+" ("+a+"ms)"),f._requestsOutstanding.splice(r,1),401!==s.status||!f._authCallback){if(e.xhr=s,e.response=s,s.statusCode=s.status,s.headers=d.parseHeaders(s.getAllResponseHeaders()),v instanceof n){var c=s.response.response;return void u.writeFileAtomically(v.filename,c,void 0,function(e){return e?t(new p(p.UNEXPECTED,"Can't create file",e,s)):t(void 0,s)})}return o&&g&&o(g.length||g.size),t(void 0,s)}f._requestQueue.unshift(e),f._authFail(e),f._checkQueue()}}function a(o){o.pipe(_),o.on("error",function(o){return f.abort(e),t(new p(p.TERMINATED_INPUTSTREAM,"Input stream terminated abnormally",o))})}var s,c,_,f=this,m=0,y=[],g=e.body,v=e.options.responseType;if(!this._isActive)return t(new p(p.SERVICE_IS_INACTIVE,"Network request in inactive state"));if(this._waitingForAuthentication||this._requestsOutstanding.length>=this._maxOutstanding||e.options.noSoonerThen)this._requestQueue.push(e),this._waitingForAuthentication||this._checkQueue();else{var A=e.headers;if(null===A.Authorization)delete A.Authorization;else{if(!this._allowAuthTokenToBeSentInsecurely_DONT_USE_THIS_IN_PRODUCTION&&0!==e.href.indexOf("https:"))return t(new p(p.INVALID_PARAMS,"Must not send auth token over unsecured connection"));this._authValue&&(A.Authorization=this._authValue)}if(this._currentAuthId&&(e.authId=this._currentAuthId),this._beforeHook&&this._beforeHook(e),e.id=d.generateUuid(),e.startTime=(new Date).valueOf(),A["X-Request-Id"]=e.id,this._https){this._requestsOutstanding.push(e);var E=l.parse(e.href),b=h({},this._additionalNodeOptions,E);b.method=e.method||"GET",b.headers=A,d.log("["+e.id+"] "+b.method+" "+e.href),_=this._https.request(b,o),e.clientRequest=_,_.once("error",t),f._timeout&&_.setTimeout(f._timeout,function(){e.timedOut=!0,_.abort()}),e.bytesSent=0,e.bytesReported=0,_.once("end",function(){if(e.progress){var t=e.bytesSent-e.bytesReported;t>0&&(e.progress(t),e.bytesReported+=t)}});var C=_.write;if(_.write=function(t){var o=t&&t.length;return o&&(e.bytesSent+=o),C.call(_,t,function(){e.progress&&t&&(e.progress(o),e.bytesReported+=o)})},g instanceof n){var L=u.createReadStream(g.filename);a(L)}else if(g instanceof r)if(g.getStream){var S=g.getStream();a(S)}else g.getStreamAsync&&g.getStreamAsync(function(o,i){return o?(f.abort(e),t(new p(p.TERMINATED_INPUTSTREAM,"Error creating input stream",o))):void a(i)});else if(g instanceof Buffer)_.write(g),_.end();else if(g instanceof ArrayBuffer)_.write(new Buffer(new Int8Array(g))),_.end();else if("string"==typeof g)_.write(new Buffer(g,"utf8")),_.end();else{if(g)return t(new p(p.INVALID_PARAMS,"Invalid data type"));_.end()}this._afterHook&&this._afterHook(e,_)}else{if(g instanceof n)return u.canUseFileSystem?void u.readFile(g.filename,{},function(o,i){return o?t(o):(e.body=i,void f._doRequest(e))}):t(new p(p.INVALID_PARAMS,"Can't use FileContent without filesystem support"));"function"==typeof Buffer&&g instanceof Buffer&&(e.body=g=new Int8Array(g)),this._requestsOutstanding.push(e),d.log("["+e.id+"] "+e.method+" "+e.href),s=new this._XMLHttpRequest,s.open(e.method,e.href,!0),this._withCredentials&&(s.withCredentials=!0),v&&(v instanceof n?s.responseType="buffer":s.responseType=v),s.onreadystatechange=i;var D;for(D in A)A.hasOwnProperty(D)&&s.setRequestHeader(D,A[D]);e.xhr=s,f._timeout&&(s.timeout=f._timeout,s.ontimeout=function(){e.timedOut=!0,s.abort()}),g?s.send(g):s.send(),this._afterHook&&this._afterHook(e,s)}}},a.prototype._authFail=function(e){if(this._authCallback){var t=e.authId;if(-1!==this._rejectedAuths.indexOf(t))return;this._authValue=null,this._waitingForAuthentication=!0,this._rejectedAuths.unshift(t)>this._maxOutstanding&&(this._rejectedAuths.length=this._maxOutstanding),this._authCallback(this)}},a.prototype._checkQueue=function(){if(!this._isActive){var e=this._requestsOutstanding;this._requestsOutstanding=[],e.forEach(function(e){e.xhr&&e.xhr.abort(),e.clientRequest&&e.clientRequest.abort();var t=e.callback;if(t){e.callback=void 0;var o=new p(p.SERVICE_IS_INACTIVE,"Network request in inactive state");t(o)}});var t=this._requestQueue;return this._requestQueue=[],t.forEach(function(e){var t=new p(p.SERVICE_IS_INACTIVE,"Network request in inactive state"),o=e.callback;o&&(e.callback=void 0,o(t))}),void(this._checkQueueTimerId&&(clearTimeout(this._checkQueueTimerId),this._checkQueueTimerId=void 0,this._checkQueueTimerWhen=void 0))}for(var o,i=Date.now(),n=i+_,r=0;;){if(this._waitingForAuthentication||this._requestsOutstanding.length>=this._maxOutstanding||r>=this._requestQueue.length)break;var a=this._requestQueue[r];o=a.options.noSoonerThen||i,o&&o>n&&(o=a.options.noSoonerThen=n),i>=o?(this._requestQueue.splice(r,1),a.options.noSoonerThen=void 0,this._doRequest(a)):r++}if(!this._waitingForAuthentication&&this._requestsOutstanding.length<this._maxOutstanding&&this._requestQueue.length>0){var s,c,l=this._requestQueue.length;for(c=0;l>c;c++)o=this._requestQueue[c].options.noSoonerThen,o&&o>n&&(o=this._requestQueue[c].options.noSoonerThen=n),o&&(s=s&&o>s?s:o);if(s&&(!this._checkQueueTimerWhen||this._checkQueueTimerWhen>s)){this._checkQueueTimerId&&clearTimeout(this._checkQueueTimerId),this._checkQueueTimerWhen=s;var d=this;this._checkQueueTimerId=setTimeout(function(){d._checkQueueTimerWhen=void 0,d._checkQueueTimerId=void 0,d._checkQueue()},s-i)}}},a.prototype.abort=function(e){var t=this._requestQueue.indexOf(e);return t>=0?void this._requestQueue.splice(t,1):(t=this._requestsOutstanding.indexOf(e),void(t>=0&&(this._requestsOutstanding.splice(t,1),e.xhr&&e.xhr.abort(),e.clientRequest&&e.clientRequest.abort(),this._checkQueue())))},a.prototype.abortAllWithToken=function(e){if(e){var t;for(t=0;t<this._requestQueue.length;++t)this._requestQueue[t].token===e&&(this._requestQueue.splice(t,1),--t);for(t=0;t<this._requestsOutstanding.length;++t)if(this._requestsOutstanding[t].token===e){var o=this._requestsOutstanding[t];this._requestsOutstanding.splice(t,1),--t,o.xhr&&o.xhr.abort(),o.clientRequest&&o.clientRequest.abort()}this._checkQueue()}},a}),i("components/dcx-js/src/AdobeSessionBase",["require","exports","module","./AdobeDCXError","./AdobeDCXUtil","./AdobeNetworkHTTPService"],function(e,t,o){"use strict";function i(e,t){this._service=e,this._server=t,t&&(this._endPoint=s.endPointOf(t)),this.SYNC_ASYNC_DEFAULT_DELAY=5,this.ASYNC_DEFAULT_DELAY=1,this.DEFAULT_POLL_DELAY=10,this._maxRedirects=5,this._authenticationWhitelist=[]}var n=e("./AdobeDCXError"),r=n.networkError,a=n.unexpectedResponse,s=e("./AdobeDCXUtil"),c=s.merge,l=e("./AdobeNetworkHTTPService"),d=s.appendPathElements,p="If-None-Match";return i.FileContent=l.FileContent,i.StreamProvider=l.StreamProvider,Object.defineProperties(i.prototype,{maxRedirects:{get:function(){return this._maxRedirects},set:function(e){if("number"!=typeof e)throw new n(n.INVALID_PARAMS,"Expecting a number.");this._maxRedirects=Math.floor(e)}},authenticationWhitelist:{get:function(){return this._authenticationWhitelist},set:function(e){if(!Array.isArray(e))throw new n(n.INVALID_PARAMS,"Expecting an array.");this._authenticationWhitelist=e}}}),i.prototype.isValidHref=function(e){var t=s.endPointOf(e);return!t||t===this._endPoint},i.prototype.isDomainOnWhitelist=function(e){var t=s.parseURI(e).authority;if(!t||0===t.length)return!0;var o,i=t.length,n=this._authenticationWhitelist.length;for(o=0;n>o;o++){var r,a=this._authenticationWhitelist[o],c=a.length;if(r=i>c?t.slice(-c):t,r===a)return!0}return!1},i.prototype.getAsset=function(e,t,o,i){function l(e,t){if(e)return i(r("Error downloading an asset",e,t));var o=t.statusCode;if(200===o)i(void 0,t);else if(304===o)i(void 0,t);else if(301===o||302===o||303===o||307===o)if(!_._service.handlesRedirects&&_.maxRedirects)if(f<_.maxRedirects){var n=t.headers.location;n?h(n):i(a("Missing location header in redirect response",e,t))}else i(a("Too many redirects",e,t));else i(a("Unexpected response getting an asset",e,t));else i(a("Unexpected response getting an asset",e,t))}if(e=this._resolveUrl(e),!e)return i(new n(n.WRONG_ENDPOINT,"Wrong endpoint: "+e));var d,u={};"string"==typeof t?u[p]=t:c(u,t);var h,_=this,f=0;return h=function(t){var i={responseType:o};return t&&(f++,i.reuseRequestDesc=d,_.isDomainOnWhitelist(t)||(u.Authorization=null)),_._service.invoke("GET",t||e,u,void 0,i,l)},d=h(),d.progress=s.noOp,d},i.prototype.getAssetAsType=function(e,t,o,i){function n(e,t){if(e)return i(e);if(200===t.statusCode){var o=t.response||t.responseText;i(void 0,o,t.headers.etag,t)}else 304===t.statusCode?i(void 0,null,t.headers.etag,t):i(a("Unexpected response getting asset",e,t))}return this.getAsset(e,o,t,n)},i.prototype._resolveUrl=function(e){var t=s.endPointOf(e);if(t){if(t!==this._endPoint)return;return e}return d(this._server,e)},i.prototype._makeRelativeUrl=function(e){var t=s.endPointOf(e);if(t){if(t!==this._endPoint)return;var o=s.parseURI(e);(o.scheme||o.authority)&&(e=o.path,o.query&&(e+="?"+o.query),o.fragment&&(e+="#"+o.fragment))}return e},i.prototype._parseAsyncResponse=function(e){var t=e.responseText||e.response;if(!t)throw new n(n.INVALID_DATA,"No body data.");var o={},i=t.indexOf("\n");if(-1===i)throw new n(n.INVALID_DATA,"Could not find status line.");var r=t.slice(0,13===t.charCodeAt(i-1)?i-1:i),a=r.split(" ");if(o.statusCode=parseInt(a[1],10),!o.statusCode)throw new n(n.INVALID_DATA,"Could not find status code.");a.length>2&&(o.statusText=a[2]);var c=t.search(/\r?\n\r?\n/);-1===c&&(c=t.length);var l=t.slice(i+1,c);o.headers=s.parseHeaders(l);var d="\r"===t.charAt(c)?c+2:c+1;return o.response=t.slice(d),o},i.prototype._pollForAsyncResponse=function(e,t,o,i){var n=this,s=Date.now()+1e3*t,c={responseType:"text",reuseRequestDesc:o,noSoonerThen:s};o=this._service.invoke("GET",e,void 0,void 0,c,function(t,s){if(t)return i(r("Error polling for an asynchronous reponse",t,s));var c=s.statusCode;if(202===c){var l=s.headers["retry-after"];l&&(l=parseInt(l,10)),n._pollForAsyncResponse(e,l||n.DEFAULT_POLL_DELAY,o,i)}else if(200===c){try{s=n._parseAsyncResponse(s)}catch(d){return i(a("Error parsing response body.",d,s))}c=s.statusCode,200===c||201===c||204===c?i(void 0,s):i(a("Unexpected response copying a component asset",t,s))}else i(a("Unexpected response polling for an asynchronous response",t,s))})},i.prototype._handle202Response=function(e,t,o,i){var n,r=e.responseText||e.response;try{n=JSON.parse(r)}catch(s){return i(a("Error parsing 202 response body.",s,e))}var c=n.href;if(!c)return i(a("202 response missing an href.",void 0,e));var l=e.headers["retry-after"];l=l?parseInt(l,10):o,this._pollForAsyncResponse(this._resolveUrl(c),l,t,i)},i}),i("components/dcx-js/src/AdobeStorageSession",["require","exports","module","./AdobeSessionBase","./AdobeDCXError","./AdobeDCXComposite","./AdobeDCXUtil"],function(e,t,o){"use strict";function i(e,t,o,i){var n=[],r="";return t&&n.push("order="+t),e&&n.push("orderBy="+e),o&&n.push("start="+o),i&&n.push("limit="+i),n.length>0&&(r="?"+n.join("&")),r}function n(e,t){if(r.call(this,e,t),!this._endPoint)throw new a(a.INVALID_PARAMS,"Could not determine endpoint from: "+t);this.authenticationWhitelist=["adobe.com","adobe.io","fotolia.net"]}var r=e("./AdobeSessionBase"),a=e("./AdobeDCXError"),s=a.networkError,c=a.unexpectedResponse,l=e("./AdobeDCXComposite"),d=e("./AdobeDCXUtil"),p=d.appendPathElements,u="If-Match",h="If-None-Match",_="application/vnd.adobe.dcx-manifest+json";return n.prototype=Object.create(r.prototype),n.prototype.name="AdobeStorageSession",n.FileContent=r.FileContent,n.StreamProvider=r.StreamProvider,n.prototype.getCollection=function(e,t,o){function i(t,a){if(t)return o(s("Error retrieving a collection",t,a));if(200===a.statusCode){var d=a.responseText||a.response,p=JSON.parse(d);n?n.children=n.children.concat(p.children):n=p;var u=a.headers["x-children-next-start"];if(u){var h=e+"&start="+u;l._service.invoke("GET",h,r,void 0,{responseType:"text"},i)}else o(void 0,n,a.headers.etag,a.headers)}else 304===a.statusCode?o(void 0,null,a.headers.etag,a.headers):o(c("Unexpected status code while getting a collection",void 0,a))}if(e=this._resolveUrl(e),!e)return o(new a(a.WRONG_ENDPOINT,"Wrong endpoint: "+e));e+="?order=asc&orderby=name";var n,r={};t&&(r[h]=t);var l=this,d=this._service.invoke("GET",e,r,void 0,{responseType:"text"},i);return d},n.prototype.pagedGetCollection=function(e,t,o,n,r,l,d,p){function u(e,t){if(e)return p(s("Error retrieving a collection",e,t));if(200===t.statusCode){var o=t.responseText||t.response,i=JSON.parse(o);d?d.children=d.children.concat(i.children):d=i,p(void 0,d,t.headers.etag,t.headers)}else 304===t.statusCode?p(void 0,null,t.headers.etag,t.headers):p(c("Unexpected status code while getting a collection",void 0,t))}if(e=this._resolveUrl(e),!e)return p(new a(a.WRONG_ENDPOINT,"Wrong endpoint: "+e));e+=i(o,n,r,l);var _={};t&&(_[h]=t);var f=this._service.invoke("GET",e,_,void 0,{responseType:"text"},u);return f},n.prototype.getComponent=function(e,t,o){var i=this.getComponentHref(e,e.version);return this.getAsset(i,void 0,t,o)},n.prototype.getSyncGroups=function(e,t){var o=p(this._server,"assets");return this.getCollection(o,e,t)},n.prototype.getSyncGroup=function(e,t,o){var i=p(this._server,"assets",e);return this.getCollection(i,t,o)},n.prototype.getCompositeManifest=function(e,t,o){var i=e.href;return i&&(i=this._resolveUrl(i)),i?(i=p(i,"manifest"),this.getAssetAsType(i,"text",t,o)):o(new a(a.WRONG_ENDPOINT,"Wrong endpoint: "+i))},n.prototype.headRequest=function(e,t){return this._service.invoke("HEAD",e,{},void 0,void 0,function(e,o){return e?t(e):void t(e,o)})},n.prototype.createCompositeDirectory=function(e,t,o){function i(e,t,o){var i={"Content-Type":"application/vnd.adobe.directory+json","X-Update":"content"};t&&(i[u]="*"),n._service.invoke("PUT",r,i,void 0,void 0,function(e,t){return e?o(s("Error Creating composite directory",e,t)):409===t.statusCode?(e=new a(a.ALREADY_EXISTS,e),e.response=t,o(e)):void o(void 0,t)})}var n=this,r=this._resolveUrl(e.href);return r?void i(e,t,function(a,l){if(a)return o(a);var p=l.statusCode;if(200===p||201===p)o(void 0,l);else if(404===p){var u=d.parentDirectory(r);n._service.invoke("PUT",u,{},void 0,void 0,function(n,r){if(n)return o(s("Error creating composite directory",n,r));var a=r.statusCode;200===a||201===a||409===a?i(e,t,function(e,t){if(e)return o(e);var i=t.statusCode;200===i||201===i?o(void 0,t):o(s("Error creating composite directory",e,t))}):o(c("Unexpected response creating composite directory",n,r))})}else o(c("Unexpected response creating composite directory",a,l))}):o(new a(a.WRONG_ENDPOINT,"Wrong endpoint: "+r))},n.prototype.deleteCompositeDirectory=function(e,t){var o=this,i=this._resolveUrl(e.href);if(!i)return t(new a(a.WRONG_ENDPOINT,"Wrong endpoint: "+i));var n={"If-Match":"*"};i+="?recursive=true&invocation_mode=sync,async";var r=this._service.invoke("DELETE",i,n,void 0,void 0,function(e,i){if(e)return t(s("Error deleting composite directory",e,i));var n=i.statusCode;return 200===n||204===n||404===n?t(void 0,i):202===n?o._handle202Response(i,r,o.SYNC_ASYNC_DEFAULT_DELAY,t):void t(c("Unexpected response deleting composite directory",e,i))})},n.prototype.leaveSharedComposite=function(e,t){if(e.collaborationType!==l.COLLABORATION.SHARED_WITH_USER)throw new a(a.INVALID_STATE,"Composite's collaboration type must be sharedWithUser.");return this.deleteCompositeDirectory(e,t)},n.prototype.uploadComponent=function(e,t,o,i,n,r){if(!e._owner||!e._owner.compositeHref)throw new a(a.INVALID_STATE,"Component must be part of a branch of a bound composite.");return this.uploadAssetForComponentId(e.id,e.type,e._owner.compositeHref,t,o,i,n,r)},n.prototype.uploadAssetForComponentId=function(e,t,o,i,n,r,l,d){function p(e,t){e?delete f[u]:f[u]="*";var o=h._service.invoke("PUT",_,f,l,void 0,function(e,o){if(e)return t(s("Error uploading component",e,o));var i=o.statusCode;if(200===i||201===i||204===i){var n;try{n=JSON.parse(o.responseText||o.response)}catch(r){return e=new a(a.INVALID_DATA,"Invalid JSON returned by server",r),e.response=o,t(e,o,n)}t(void 0,o,n)}else 507===i?(e=new a(a.EXCEEDS_QUOTA,"Exceeds quota",e),e.response=o,t(e)):(e=c("Unexpected response uploading component",e),e.response=o,t(e))});return o.token=r,o}var h=this,_=this._constructComponentHref(o,e);n&&(_+="?intermediates=false");var f={};t&&(f["Content-Type"]=t);var m=p(i,function(e,t,o){if(e){if(t=e.response,!t)return d(e);var n=t.statusCode;return void(404===n||409===n||412===n?p(!i,d):d(e))}d(void 0,t,o)});return m},n.prototype.copyAssetToComponentId=function(e,t,o,i,n,r,l,d){function p(e,t,o){e?delete m[u]:m[u]="*";var i=_._service.invoke("PUT",f,m,void 0,{responseType:"text"},function(e,n){if(e)return o(s("Error uploading component",e,n));var r=n.statusCode;200===r||201===r||204===r?o(void 0,n,t):202===r?_._handle202Response(n,i,_.SYNC_ASYNC_DEFAULT_DELAY,function(e,i){o(e,i,t)}):o(c("Unexpected response copying a component asset",e,n),n,t)});return i.token=r,i}var h=this._makeRelativeUrl(l);if(!h)return d(new a(a.WRONG_ENDPOINT,"Cannot copy asset: "+l));var _=this,f=this._constructComponentHref(o,e);f+="?invocation_mode=sync,async",n&&(f+="&intermediates=false");var m={};t&&(m["Content-Type"]=t),m.Link="<"+h+">;rel=source";var y=function(e,t,o){var n;if(e){if(t=e.response,!t)return d(e);var r=t.statusCode;return void(o||404!==r&&409!==r&&412!==r?507===r?(e=new a(a.EXCEEDS_QUOTA,"Exceeds quota",e),e.response=t,d(e)):d(e):p(!i,!0,y))}try{n=JSON.parse(t.responseText||t.response)}catch(s){return e=new a(a.INVALID_DATA,"Invalid JSON returned by server",s),e.response=t,d(e)}d(void 0,t,n)},g=p(i,!0,y);return g},n.prototype.updateManifest=function(e,t,o,i){var n=this.getBranchManifestHref(e),r={"Content-Type":_},l=e.manifestEtag;o?r["If-Match"]="*":l&&(r["If-Match"]=l);var d=this._service.invoke("PUT",n,r,t,void 0,function(e,t){if(e)return i(s("Error updating manifest",e,t));var o=t.statusCode;!t.headers.etag||200!==o&&201!==o&&204!==o?412===o?(e=new a(a.UPDATE_CONFLICT,"Manifest has been changed"),e.response=t,i(e)):i(c("Unexpected response updating manifest",e,t)):i(void 0,t)});return d},n.prototype.getHrefForComposite=function(e,t){var o=e.type;if(!o)throw new a(a.INVALID_STATE,"Composite needs a type");if(!e.id)throw new a(a.INVALID_STATE,"Composite needs an id");if(e.href)return e.href;var i=this._resolveUrl(p("assets",t,e.id));return i},n.prototype.getCompositeManifestHref=function(e){var t=this._resolveUrl(e.href);if(!t)throw new a(a.WRONG_ENDPOINT,"Wrong endpoint: "+t);return p(t,"manifest")},n.prototype.getBranchManifestHref=function(e){var t=this._resolveUrl(e.compositeHref);if(!t)throw new a(a.WRONG_ENDPOINT,"Wrong endpoint: "+t);return p(t,"manifest")},n.prototype.getComponentHref=function(e,t){var o=e._owner;if(!o||!o.compositeHref)throw new a(a.INVALID_STATE,"Component must be part of a branch of a bound composite.");var i;return o._core&&(i=o._core._getSourceHrefOfComponent(e)),i||this._constructComponentHref(o.compositeHref,e.id,t)},n.prototype._constructComponentHref=function(e,t,o){var i=p(this._resolveUrl(e),t);return i&&"undefined"!=typeof o&&(i+=";version="+o),i},n}),i("components/dcx-js/src/AdobeCommunitySession",["require","exports","module","./AdobeSessionBase","./AdobeDCXError","./AdobeDCXUtil"],function(e,t,o){"use strict";function i(e,t){if(n.call(this,e,t),!this._endPoint)throw new r(r.INVALID_PARAMS,"Could not determine endpoint from: "+t);this.authenticationWhitelist=["adobe.com","adobe.io","fotolia.net"]}var n=e("./AdobeSessionBase"),r=e("./AdobeDCXError"),a=e("./AdobeDCXUtil"),s=a.appendPathElements;i.prototype=Object.create(n.prototype),i.prototype.name="AdobeCommunitySession",i.FileContent=n.FileContent,i.StreamProvider=n.StreamProvider,i.prototype.getCompositeManifestHref=function(e){var t=this._resolveUrl(e.href);if(!t)throw new r(r.WRONG_ENDPOINT,"Wrong endpoint: "+t);return s(t,"manifest")},i.prototype.getComponent=function(e,t,o){var i=this.getComponentHref(e,e.version);return this.getAsset(i,void 0,t,o)},i.prototype.getRenditionOfComponent=function(e,t,o,i,n,r){var a=this.getComponentRenditionHref(e,e.version,t,o,i);return this.getAsset(a,{accept:t},n,r)},i.prototype.getCompositeManifest=function(e,t,o){var i=e.href;return i&&(i=this._resolveUrl(i)),i?(i=s(i,"manifest"),this.getAssetAsType(i,"text",t,o)):o(new r(r.WRONG_ENDPOINT,"Wrong endpoint: "+i))},i.prototype.headRequest=function(e,t){return this._service.invoke("HEAD",e,{},void 0,void 0,function(e,o){return e?t(e):void t(e,o)})},i.prototype.getComponentHref=function(e,t){var o=e._owner;if(!o||!o.compositeHref)throw new r(r.INVALID_STATE,"Component must be part of a branch of a bound composite.");var i;return o._core&&(i=o._core._getSourceHrefOfComponent(e)),i||this._constructComponentHref(o.compositeHref,e,t)},i.prototype.getComponentRenditionHref=function(e,t,o,i,n){var a=e._owner;if(!a||!a.compositeHref)throw new r(r.INVALID_STATE,"Component must be part of a branch of a bound composite.");if(a._core&&a._core._getSourceHrefOfComponent(e))throw new r(r.INVALID_STATE,"Getting a rendition of a source href not implemented.");return this._constructComponentRenditionHref(a.compositeHref,e,t,o,i,n)},i.prototype._constructComponentHref=function(e,t,o){var i=t.absolutePath.slice(1),n=s(this._resolveUrl(e),i);return n&&"undefined"!=typeof o&&(n+=this._hrefUsesContentApis(e)?"/version/"+o:"?version="+o),n};var c="/content/2/",l=/^\/?content\/2\/[^\/]+\/[^\/]+/,d=/^\/?api\/v2\/[^\/]+\/assets\/[^\/]+/,p={"image/jpeg":"jpg","image/png":"png"};return i.prototype._constructComponentRenditionHref=function(e,t,o,i,n,s){var u,h,_=t.absolutePath.slice(1),f=a.parseURI(e).path;if(f.slice(0,c.length)===c){var m=p[i];if(!m)throw new r(r.INVALID_PARAMS,"Unsupported rendition media type: "+i);if(u=l.exec(f),!(u&&u.length>0))throw new r(r.INVALID_PARAMS,"Failed to parse composite href: "+e);h=this._resolveUrl(a.appendPathElements(u[0],"rendition",_,"version",o,"format",m,"dimension",n,"size",String(s)))}else{if(u=d.exec(f),!(u&&u.length>0))throw new r(r.INVALID_PARAMS,"Failed to parse composite href: "+e);h=this._resolveUrl(a.appendPathElements(u[0],"rendition",n,String(s),_)+"?version="+o)}return h},i.prototype._hrefUsesContentApis=function(e){var t=a.parseURI(e).path;return t.slice(0,c.length)===c},i}),i("components/dcx-js/src/AdobeDCXCompositeXfer",["require","exports","module","./AdobeDCXComposite","./AdobeDCXComponent","./AdobeDCXBranch","./AdobeDCXError","./AdobeDCXPushJournal","./AdobeSessionBase","./AdobeDCXUtil","./AdobeDCXFS"],function(e,t,o){"use strict";function i(e,t,o){return h.wrapError(h.UNEXPECTED_RESPONSE,e,t,o)}function n(e,t,o){this._session=e,this._callback=t,this._cleanup=o,this._componentsPending=0,this.bytesTransfered=0,this.bytesTotal=0,this.onProgress=m.noOp;var i=this;this._reportProgress=function(e){if(e>0){i.bytesTransfered+=e;var t=i.onProgress;t&&t(i.bytesTransfered,i.bytesTotal)}}}function r(e,t,o,n,r){function a(e){e||(t.compositeHasBeenCreated=!0);var o,i=t._compositeCreationCallbacks,n=i.length;for(o=0;n>o;o++)try{i[o](e)}catch(r){}t._compositeCreationCallbacks=void 0}e.isBound||t.compositeHasBeenCreated?r():t._compositeCreationCallbacks?t._compositeCreationCallbacks.push(r):(t._compositeCreationCallbacks=[r],n.createCompositeDirectory(e,o,function(t,r){if(t){if(t.code!==h.ALREADY_EXISTS)return a(i("Unexpected response creating a composite directory",t,r));if(o)a();else{var s=n.getCompositeManifestHref(e);n.headRequest(s,function(e,t){return e?a(e):404!==t.statusCode?(e=new h(h.INVALID_STATE,"Composite already exists and overwriteExisting not specified"),a(e)):void a()})}}else a()}))}function a(e,t,o,i,n){if("number"!=typeof t)throw new h(h.UNEXPECTED_RESPONSE,"No length");var r=i.headers.etag,a=i.headers["x-latest-version"],s=n.md5;if(!r)throw new h(h.UNEXPECTED_RESPONSE,"No etag");if(!a)throw new h(h.UNEXPECTED_RESPONSE,"No version");if(!s)throw new h(h.UNEXPECTED_RESPONSE,"No md5");return new p._UploadRecord(e,r,a,s,t,o)}function s(e,t,o,i){var n=i.headers.etag,r=i.headers["x-latest-version"],a=t.md5,s=t.size;if("number"!=typeof s)throw new h(h.UNEXPECTED_RESPONSE,"No length");if(!n)throw new h(h.UNEXPECTED_RESPONSE,"No etag");if(!r)throw new h(h.UNEXPECTED_RESPONSE,"No version");if(!a)throw new h(h.UNEXPECTED_RESPONSE,"No md5");return new p._UploadRecord(e,n,r,a,s,o)}var c,l,d=e("./AdobeDCXComposite"),p=e("./AdobeDCXComponent"),u=e("./AdobeDCXBranch"),h=e("./AdobeDCXError"),_=e("./AdobeDCXPushJournal"),f=e("./AdobeSessionBase"),m=e("./AdobeDCXUtil"),y=e("./AdobeDCXFS"),g=f.FileContent,v=p.STATES,A="all",E="min",b="none";return n.prototype._callCallback=function(e,t){var o=this._callback;o&&(this._callback=void 0,o(e,t))},n.prototype._xferComplete=function(e,t){var o=this._cleanup;o?(this._cleanup=void 0,o(e,t)):this._callCallback(e,t)},n.prototype.abort=function(e){this._aborted||(this._aborted=!0,this._session._service.abortAllWithToken(this)),e||(this._callback=void 0,e=new Error("Aborted")),this._xferComplete(e)},t.pullComposite=function(e,t,o){if(!e.hasLocalStorage)throw new h(h.INVALID_PARAMS,"No local storage. Use AdobeDCXCompositeXfer.pullCompositeManifestOnly() to pull down the composite without local storage.");return this._pullComposite(e,t,A,o)},t.pullMinimumComposite=function(e,t,o){if(!e.hasLocalStorage)throw new h(h.INVALID_PARAMS,"No local storage. Use AdobeDCXCompositeXfer.pullCompositeManifestOnly() to pull down the composite without local storage.");return this._pullComposite(e,t,E,o)},t.pullCompositeManifestOnly=function(e,t,o){return this._pullComposite(e,t,b,o)},t.downloadComponents=function(e,o,i,r){function a(e){return e._owner?a(e._owner):e}var s=a(o),c=new n(i,r);return c._referenceBranch=s,t._pullComponents(c,s,e||o.allComponents()),c},t.pushComposite=function(e,o,i,r){var a,s=e._localStorage,c=function(t,o){if(a._owner&&e.hasLocalStorage&&s.unregisterInMemoryBranchOrElement(a._owner),!e.hasLocalStorage){var i=a._journal;e._pushJournal=i.isEmpty?void 0:i}a._callCallback(t,o)};a=new n(i,r,c),a._composite=e,a._overwriteExisting=o;var l=!e.isBound;if(a._compositeIsNew=l,e.hasLocalStorage)e._loadBranch(s.currentManifestPath(),!1,function(o,i){return o?a._xferComplete(o):(a._owner=i,e._localStorage.registerInMemoryBranchOrElement(i),void _.readJournal(s.pushJournalPath(),e,!0,function(o,i){return o?a._xferComplete(o):(a._journal=i,void t._pushComposite(e,a))}))});else{var d=e.href;if(!d)return a._xferComplete(new h(h.INVALID_STATE,"New composite has no href"));a._owner=e.current.copy(),a._journal=e._pushJournal||new _(e),t._pushComposite(e,a)}return a},t.uploadNewComponent=function(e,t,o,i,n,r){if(o._localStorage)throw new h(h.INVALID_PARAMS,"For in-browser use only. Use composite.current.addComponent() to add a new component asset");return c(i||m.generateUuid(),t,!0,o.collaborationType===d.COLLABORATION.SHARED_WITH_USER,e,o.id,o.href,n,r)},t.uploadComponent=function(e,t,o,i,n){if(o._localStorage)throw new h(h.INVALID_PARAMS,"For in-browser use only. Use composite.current.updateComponent() to update a component asset");return c(e.id,e.type,!1,o.collaborationType===d.COLLABORATION.SHARED_WITH_USER,t,o.id,o.href,i,n)},t.copyAssetForNewComponent=function(e,t,o,i,n,r){if(o._localStorage)throw new h(h.INVALID_PARAMS,"For in-browser use only. Use composite.current.addComponent() to add a new component asset");return l(i||m.generateUuid(),t,!0,o.collaborationType===d.COLLABORATION.SHARED_WITH_USER,e,o.id,o.href,n,r)},t.getURLForComponent=function(e,t){if(e._owner._localStorage)throw new h(h.INVALID_PARAMS,"For in-browser use only.");return t.getComponentHref(e,e.version)},t._pullComposite=function(e,o,i,r){function a(t,o){if(t){var i=t.pulledBranch;return void(i?(i.compositeState=v.unmodified,i.hasLocalStorage?y.writeFileAtomically(e._localStorage.pulledManifestPath(),t.pulledBranch.localData,"utf8",function(e){s._callCallback(t)}):s._callCallback(t)):s._callCallback(t))}return null===o?s._callCallback(void 0,null):(o.compositeState=v.unmodified,void(o.hasLocalStorage?y.writeFileAtomically(e._localStorage.pulledManifestPath(),o.localData,"utf8",function(e){return e?s._callCallback(e):(o._isDirty=!1,void s._callCallback(void 0,o))}):(e._options.xhrBaseBranchSupport&&(e._pulledBranchData=o.localData),s._callCallback(void 0,o))))}if("string"!=typeof e.href)throw new h(h.INVALID_STATE,"Composite must have an href");var s,c=function(n,r){if(n)return s._xferComplete(n);var a;r?(a=r.manifestEtag,s._referenceBranch=r):e.current&&(a=e.current.manifestEtag,s._referenceBranch=e.current);var c=o.getCompositeManifest(e,a,function(o,n,a){if(o)return o.response&&404===o.response.statusCode?s._xferComplete(new h(h.NO_COMPOSITE,"Composite missing or deleted",o.underlyingError||o)):s._xferComplete(o);if(null===n&&!r)return s._xferComplete(void 0,null);var c;if(null!==n)try{if(c=(new u).parse(n),c._localStorage=e._localStorage,c.compositeHref=e.href,c._collaborationType=e.collaborationType,c._clientDataString=e.clientDataString,c.manifestEtag=a,c.compositeState===v.committedDelete||c.compositeState===v.pendingDelete)return void s._session.deleteCompositeDirectory(e,function(e){
return e?s._xferComplete(new h(h.DELETED_COMPOSITE,"Error deleting composite directory",e)):s._xferComplete(new h(h.DELETED_COMPOSITE,"Composite is deleted"))});s._referenceBranch&&c.hasLocalStorage&&c._updateLocalDataFromBranch(s._referenceBranch)}catch(l){return s._xferComplete(new h(h.INVALID_JSON,"Corrupted manifest",l))}else c=r;var d,p,_=c.allComponents();for(d=0;d<_.length;++d)p=_[d],p.state===v.pendingDelete||p.state===v.committedDelete?c.removeComponent(p):p.state=v.unmodified;_=void 0,i===A?_=c.allComponents():i===E&&(p=c.getComponentWithAbsolutePath("/META-INF/metadata.xml"),p&&(_=[p])),_?t._pullComponents(s,c,_):s._xferComplete(void 0,c)});c&&(c.token=s,c.progress=s._reportProgress)};return s=new n(o,r,a),s._composite=e,e.hasLocalStorage?e.loadPulledBranch(c):c(),s},t._pullComponents=function(e,o,i){function n(t,i){if(e._componentsPending-=1,t&&(e.failedComponents=e.failedComponents||[],e.failedComponents.push({component:i,error:t})),0===e._componentsPending&&!e._aborted){var n=e.failedComponents;if(n){t=new h(h.COMPONENT_DOWNLOAD_ERROR,"Failed to download all components");var r,a=n.length;for(r=0;a>r;r++){var s=n[r].error;if(s.code===h.OUT_OF_SPACE){t=new h(s.code,s.message);break}}return t.pulledBranch=o,t.failedComponents=n,e._xferComplete(t)}e._xferComplete(void 0,o)}}function r(o){if(!e._aborted){e.bytesTotal+=o.length||0;var i=o._owner._localStorage,r=i.tempPathForComponent(o),a=m.parentDirectory(r);y.ensureDirectoryExists(a,function(i){if(i)return e.abort(i);var a=t._pullComponent(o,r,c,n);a.progress=e._reportProgress,a.token=e})}}function a(e){o.assetOfComponent(e,function(t,o){"string"!=typeof o?r(e):n(void 0,e)})}if(!o.hasLocalStorage)throw new h(h.INVALID_PARAMS,"No local storage.");var s,c=e._session;for(e._componentsPending=i.length,s=0;s<i.length;++s){var l,d=i[s];if(e._referenceBranch){var p=e._referenceBranch.getComponentWithId(d.id);p&&(l=p.etag)}d.etag!==l?r(d):a(d)}0===e._componentsPending&&e._xferComplete(void 0,o)},t._pullComponent=function(e,t,o,n){var r=e._owner;if(!e._owner.hasLocalStorage)throw new h(h.INVALID_PARAMS,"No local storage. Use AdobeDCXCompositeXfer.pullCompositeManifestOnly() to pull down the composite without local storage.");var a=o.getComponent(e,new g(t),function(o,a){if(o)n(o,e);else if(200===a.statusCode){var s=Number(a.headers["content-length"]);void 0===e.length||null===e.length||isNaN(s)||s===e.length?r._localStorage.ingestComponentAsset(e,t,!1,r._local(),function(t){n(t,e,a.headers.etag)}):n(new h(h.UNEXPECTED_RESPONSE,"Incorrect content length",o,a))}else 304===a.statusCode?n(void 0,e,a.headers.etag):n(i("Unexpected response getting a component",o,a),e)});return a},t._pushComposite=function(e,o){function i(t){if(c)return o._xferComplete(t);var i=p.getCompositeManifestHref(e);p.headRequest(i,function(e,i){return e?o._xferComplete(e):404===i.statusCode?(t=new h(h.NO_COMPOSITE,"Composite does not exist; may have been deleted"),o._xferComplete(t)):o._xferComplete(t)})}var n=e.href;if(!n)return o._xferComplete(new h(h.INVALID_STATE,"New composite has no href"));var a=o._owner,s=o._journal,c=o._compositeIsNew,l=o._overwriteExisting,p=o._session,u=a.changeCount,_=a.remoteData.length+50;return o.bytesTotal=_,a.compositeState===v.committedDelete?o._xferComplete(new h(h.DELETED_COMPOSITE,"Attempt to push a deleted composite")):c||a.compositeState!==v.unmodified?a.compositeState===v.pendingDelete?c&&!l?o._xferComplete(new h(h.DELETED_COMPOSITE,"Attempt to delete unbound composite")):e.collaborationType===d.COLLABORATION.SHARED_WITH_USER?o._xferComplete(new h(h.INVALID_STATE,"Attempt to delete composite that is shared with this user.")):t._deleteComposite(o,l,function(e,t){o._xferComplete(e,t)}):void r(e,s,l,p,function(n){return n?o._xferComplete(n):void t._pushComponents(o,a,function(){var t=o.failedComponents;if(t){n=new h(h.COMPONENT_UPLOAD_ERROR,"One or more components failed to upload.");var r,c=t.length;for(r=0;c>r;r++){var d=t[r].error;if(d.code===h.EXCEEDS_QUOTA){n=new h(d.code,d.message);break}}return n.failedComponents=t,i(n)}a.compositeState=v.unmodified,s.manifestEtag&&s.currentBranchEtag===a.manifestEtag&&(a.manifestEtag=s.manifestEtag);var f=a.remoteData;o.bytesTotal+=f.length,o.bytesTotal-=_;var m=p.updateManifest(a,f,l,function(t,n){if(t)return i(t);var r=n.headers.etag;s.manifestEtag=r,s.currentBranchEtag=a.manifestEtag,s.changeCount=u,s.commitChanges(function(t){return t?o._xferComplete(t):(s.applyToBranch(a),a.compositeState=v.unmodified,void(e.hasLocalStorage?y.writeFileAtomically(e._localStorage.pushedManifestPath(),a.localData,"utf8",function(e){return e?o._xferComplete(e):(a._isDirty=!1,void o._xferComplete(void 0,a))}):(e._options.xhrBaseBranchSupport&&(e._pushedBranchData=a.localData),o._xferComplete(void 0,a))))})});m&&(m.progress=o._reportProgress,m.token=o)})}):o._xferComplete()},t._deleteComposite=function(e,t,o){var i=e._composite,n=e._owner,r=e._session;n.compositeState=v.committedDelete;var a=n.remoteData;e.bytesTotal=a.length,e._journal.manifestEtag&&e._journal.currentBranchEtag===n.manifestEtag&&(n.manifestEtag=e._journal.manifestEtag),r.updateManifest(n,a,t,function(t,a){return t?o(t):void r.deleteCompositeDirectory(i,function(t,r){return t?o(t):(e._journal.compositeHasBeenDeleted=!0,void e._journal.commitChanges(function(e){return e?o(e):void(i.hasLocalStorage?y.writeFileAtomically(i._localStorage.pushedManifestPath(),n.localData,"utf8",function(e){return e?o(e):void o(void 0,n)}):o(void 0,n))}))})})},t._pushComponents=function(e,t,o){function i(t,i,n){i?p[t.id]=i:delete p[t.id],n&&(e.failedComponents=e.failedComponents||[],e.failedComponents.push({component:t,error:n})),0===Object.keys(p).length&&u.commitChanges(o)}function n(t,o,n){i(t,"uploading"),y.info(o,function(r,a){if(r)return r=new h(h.INVALID_STATE,"Component asset missing",r),void i(t,null,r);var s=a.size,l=m.filePathComponents(o).fileName,p=u.getRecordForUploadedComponent(t.id);if(p&&p.length===s&&p["storage-name"]===l)return t.etag=p.etag,t.version=p.version,t.md5=p.md5,t.length=p.length,t.state=v.unmodified,void i(t,null);e.bytesTotal+=s;var _=e._session.uploadComponent(t,n,c.collaborationType===d.COLLABORATION.SHARED_WITH_USER,e,new g(o),function(e,o,n){if(!e){var r=o.headers.etag,a=o.headers["x-latest-version"],c=n.md5;r||(e=new h(h.UNEXPECTED_RESPONSE,"No etag")),a||(e=new h(h.UNEXPECTED_RESPONSE,"No version")),c||(e=new h(h.UNEXPECTED_RESPONSE,"No md5")),e||(t.etag=r,t.version=a,t.md5=c,t.length=s,t.state=v.unmodified,u.recordUploadedComponent(t.id,r,a,c,s,l),u.commitChanges())}i(t,null,e)});_&&(_.progress=e._reportProgress,_.token=e)})}function r(o,r,a){var s=u.getRecordForUploadedComponent(o.id);if(s&&s["source-href"]===r)return o.etag=s.etag,o.version=s.version,o.md5=s.md5,o.length=s.length,void(o.state=v.unmodified);i(o,"copying");var p=e._session.copyAssetToComponentId(o.id,o.type,e._composite.href,a,c.collaborationType===d.COLLABORATION.SHARED_WITH_USER,e,r,function(e,s,c){if(e){if(l){var d=l.componentAssetPath(o,t._local());if(d)return n(o,d,a)}}else{var p=s.headers.etag,_=s.headers["x-latest-version"],f=c.md5,m=c.size;p||(e=new h(h.UNEXPECTED_RESPONSE,"No etag")),_||(e=new h(h.UNEXPECTED_RESPONSE,"No version")),f||(e=new h(h.UNEXPECTED_RESPONSE,"No md5")),m||(e=new h(h.UNEXPECTED_RESPONSE,"No length")),e||(o.etag=p,o.version=_,o.md5=f,o.length=m,o.state=v.unmodified,u.recordUploadedComponent(o.id,p,_,f,m,void 0,r),u.commitChanges())}i(o,null,e)});p&&(p.progress=e._reportProgress,p.token=e)}var a,s=t.allComponents(),c=e._composite,l=c._localStorage,p={},u=e._journal;for(a=0;a<s.length;++a){var _=s[a],f=_.state,A=_.etag,E=!A;if(f||(f=v.unmodified),E||f===v.modified){var b=t._core._getSourceHrefOfComponent(_);if(t.hasLocalStorage||b){var C=E||e._compositeIsNew;b?r(_,b,C):n(_,l.componentAssetPath(_,t._local()),C)}else{var L=new h(h.INVALID_STATE,"Component should not be modified or new without local storage");e.failedComponents=e.failedComponents||[],e.failedComponents.push({component:_,error:L})}}else f===v.unmodified?u.removeRecordForUploadedComponent(_.id):(f===v.committedDelete||f===v.pendingDelete)&&t.removeComponent(_)}0===Object.keys(p).length&&o()},c=function(e,t,o,i,r,s,c,l,d){if("function"!=typeof d)throw new h(h.INVALID_PARAMS,'Param "callback" must be a function.');var u=r.length||r.byteLength||r.size,_=new n(l,d);_.bytesTotal=u;var f=l.uploadAssetForComponentId(e,t,c,o,i,_,r,function(o,i,n){var r;if(!o)try{r=new p._UploadResults(s),u=u||f.bytesSent,r.records[e]=a(e,u,t,i,n)}catch(c){o=c,r=void 0}_._xferComplete(o,r)});return f&&(f.progress=_._reportProgress,f.token=_),_},l=function(e,t,o,i,r,a,c,l,d){if("function"!=typeof d)throw new h(h.INVALID_PARAMS,'Param "callback" must be a function.');var u=new n(l,d),_=l.copyAssetToComponentId(e,t,c,o,i,u,r,function(o,i,n){if(!u._aborted){var r;if(!o)try{r=new p._UploadResults(a),r.records[e]=s(e,n,t,i)}catch(c){o=c,r=void 0}d(o,r)}});return _&&(_.progress=u._reportProgress,_.token=u),u},t}),i("components/dcx-js/src/AdobeDCX",["require","exports","module","./AdobeDCXComposite","./AdobeDCXLocalStorage","./AdobeNetworkHTTPService","./AdobeStorageSession","./AdobeCommunitySession","./AdobeDCXCompositeXfer","./AdobeDCXUtil","./AdobeDCXError","./AdobeDCXFS"],function(e,t,o){"use strict";function i(e,t){e&&p._setFS(e),this._compositeOptions=l.merge({},t),t&&t.logCallback&&l._setLogCallback(t.logCallback)}var n=e("./AdobeDCXComposite"),r=(e("./AdobeDCXLocalStorage"),e("./AdobeNetworkHTTPService")),a=e("./AdobeStorageSession"),s=e("./AdobeCommunitySession"),c=e("./AdobeDCXCompositeXfer"),l=e("./AdobeDCXUtil"),d=e("./AdobeDCXError"),p=e("./AdobeDCXFS");return i.COLLABORATION={PRIVATE:n.COLLABORATION.PRIVATE,SHARED_BY_USER:n.COLLABORATION.SHARED_BY_USER,SHARED_WITH_USER:n.COLLABORATION.SHARED_WITH_USER},i.AdobeDCXError=d,i.FileContent=r.FileContent,i.StreamProvider=r.StreamProvider,i.prototype.newEmptyComposite=function(e,t,o,i){var r=new n(e,t,null,i,null,this._compositeOptions);return o&&(r.path=o),r},i.prototype.newCompositeFromLocalStorage=function(e,t){try{if("string"!=typeof e)throw new d(d.INVALID_PARAMS,"");var o=new n(null,null,e,null,null,this._compositeOptions);o.loadCurrentFromLocalStorage(function(e,i){t(e,e?void 0:o)}),o.deleteTempFiles()}catch(i){t(i)}},i.prototype.newCompositeWithHref=function(e,t,o,i,r){var a=new n(o,r,null,i,e,this._compositeOptions);return t&&(a.path=t),a},i.prototype.newCompositeAsCopyOf=function(e,t,o,i,r,a){return n.newCompositeAsCopyOf(e,t,o,i,r,a,this._compositeOptions)},i.prototype.createHTTPService=function(e){return new r(e)},i.prototype.createStorageSession=function(e,t){return new a(e,t)},i.prototype.createCommunitySession=function(e,t){return new s(e,t)},i.prototype.compositeXfer=c,i}),i("AdobeLibraryServices",["require","exports","module","./components/uuid/uuid","./components/dcx-js/src/AdobeDCX"],function(t,o,i){"use strict";function n(){var t=typeof e;"undefined"!==t&&(this.fs=e("fs"),this.path=e("path")),this._initDCX()}var r=t("./components/uuid/uuid"),a=t("./components/dcx-js/src/AdobeDCX");return n.prototype._initDCX=function(){var e=this;this.dcx=new a(this.fs,{preserveFileExtensions:!0,logCallback:function(t){e._log&&e._log("DCX: "+t)}})},n.prototype.uuid=function(){return r()},n.prototype.log=function(e){this._log&&this._log("CC Libraries: "+e)},n.prototype.getDisplayName=function(e){return this._getDisplayName?this._getDisplayName(e):e.name},n.prototype.hasFileSystem=function(){return void 0!==this.fs},n.prototype.setFileSystem=function(e){this.fs=e,this._initDCX()},n.prototype.getVulcanInterface=function(){var e=typeof VulcanInterface;return"undefined"!==e?VulcanInterface:void 0},n.prototype.getVulcanMessage=function(){var e=typeof VulcanMessage;return"undefined"!==e?VulcanMessage:void 0},n.prototype.hasCEPVulcan=function(){return void 0!==this.getVulcanInterface()&&void 0!==this.getVulcanMessage()},n.prototype.getNodeTunnelOptions=function(e){return this._getNodeTunnelOptions?this._getNodeTunnelOptions(e):{}},n.prototype.getPathSeparator=function(){return"/"},n.prototype.getFileNameFromPath=function(e){return-1===e.indexOf("/")&&-1!==e.indexOf("\\")&&(e=e.replace(/\\/g,"/")),e.split("/").pop()},new n}),i("AdobeLibraryError",["require","exports","module"],function(e,t,o){"use strict";function i(e,t,o,i){Error.call(this),this.code=e,this._message=t,this.message="["+e+"] "+t,this.libraryId=o,this.underlyingError=i}return i.prototype=new Error,i.prototype.name="AdobeLibraryError",delete i.prototype.stack,i.INVALID_PARAMETER="INVALID_PARAMETER",i.READ_ONLY="READ_ONLY",i.NOT_IMPLEMENTED="NOT_IMPLEMENTED",i.NOT_SUPPORTED="NOT_SUPPORTED",i.REQUIRES_FILESYSTEM="REQUIRES_FILESYSTEM",i.DELETED_LOCALLY="DELETED_LOCALLY",i.NOT_ALLOWED="NOT_ALLOWED",i.FILE_TOO_LARGE="FILE_TOO_LARGE",i.EXCEEDS_MAX_LIBRARY_SIZE="EXCEEDS_MAX_LIBRARY_SIZE",i.CORRUPTED_LIBRARY="CORRUPTED_LIBRARY",i.THUMBNAIL_NOT_AVAILABLE="THUMBNAIL_NOT_AVAILABLE",i.BROKEN_LINK="BROKEN_LINK",i.FS_ERROR="FS_ERROR",i.OUT_OF_SPACE="OUT_OF_SPACE",i.LOGGED_OUT="LOGGED_OUT",i.EXCEEDS_QUOTA="EXCEEDS_QUOTA",i.RETRYABLE_SERVER_ERROR="RETRYABLE_SERVER_ERROR",i.TRANSFER_ERROR="TRANSFER_ERROR",i.TRANSFER_ABORTED="TRANSFER_ABORTED",i.NETWORK_ERROR="NETWORK_ERROR",i.ACCESS_DENIED="ACCESS_DENIED",i.URL_VALIDATION_FAILED="URL_VALIDATION_FAILED",i}),i("AdobeLibraryConfig",["require","exports","module","./AdobeLibraryError"],function(e,t,o){"use strict";function i(){this.name="config"}var n=e("./AdobeLibraryError"),r=["ROOT_DIR","POLL_INTERVAL","RENDITION_SIZES","FULL_RENDITION_CONFIG","EXTERNAL_LINK_PREFETCH","DEFAULT_LIBRARY_NAME","STORAGE_API_KEY","USER_AGENT_HEADER","SYNC_POLICY","ELEMENT_TYPE_FILTERS","AUTO_START_POLLING","SHARED_LOCAL_STORAGE","SHARED_LOCAL_STORAGE_ANALYTICS","WHITELISTED_DOMAINS","CLIENT_DESCRIPTION"];return i.prototype.VERSION=1,i.prototype.MAX_ELEMENTS=1e3,i.prototype.MAX_COMPONENT_SIZE=1073741824,i.prototype.VALID_RELATIONS=["rendition","primary","alternate"],i.prototype.VALID_LIBRARY_RENDITION_TYPES=["banner","cover"],i.prototype.VALID_SYNC_POLICIES=["manifestAndAssets","manifestOnly"],i.prototype.ELEMENT_TYPE_FILTERS=[],i.prototype.DL_NAMESPACE="library",i.prototype.DL_PREFIX=i.prototype.DL_NAMESPACE+"#",i.prototype.VERSION_KEY=i.prototype.DL_PREFIX+"version",i.prototype.RELATIONSHIP_KEY=i.prototype.DL_PREFIX+"rel",i.prototype.WIDTH_KEY=i.prototype.DL_PREFIX+"width",i.prototype.HEIGHT_KEY=i.prototype.DL_PREFIX+"height",i.prototype.LENGTH_KEY=i.prototype.DL_PREFIX+"length",i.prototype.IS_FULL_SIZE_KEY=i.prototype.DL_PREFIX+"isFullSize",i.prototype.MODIFIED_KEY=i.prototype.DL_PREFIX+"modified",i.prototype.CREATED_KEY=i.prototype.DL_PREFIX+"created",i.prototype.LINK_TYPE_KEY=i.prototype.DL_PREFIX+"linktype",i.prototype.LINK_URL_KEY=i.prototype.DL_PREFIX+"linkurl",i.prototype.REPRESENTATION_ORDER_KEY=i.prototype.DL_PREFIX+"representationOrder",i.prototype.RENDITION_TYPE_KEY=i.prototype.DL_PREFIX+"renditiontype",i.prototype.COMPOSITE_TYPE="application/vnd.adobe.library+dcx",i.prototype.LINK_REPRESENTATION_TYPE="application/vnd.adobe.library.link+dcx",i.prototype.ELEMENTS_NAME="elements",i.prototype.DATA_COLLABORATION_ROLE="collaborationRole",i.prototype.ANALYTICS_ELEMENT_UPDATE_THRESHOLD=500,i.prototype.BOOKMARKS_FILENAME="bookmarks.json",i.prototype.BOOKMARKS_PATH="/sync/adobe-libraries/"+i.prototype.BOOKMARKS_FILENAME,i.prototype.PUBLIC_USER_ID="public",i.prototype.DEFAULT_CLOUD_ID="creative_cloud",i.prototype.DEFAULT_CORESYNC_CLOUD_ID="00000000-0000-0000-0000-000000000000",i.prototype.STORAGE_ASSETS_PATH="/assets/",i.prototype.LIBRARY_SYNC_GROUP="adobe-libraries",i.prototype.PUBLIC_STORAGE_ASSETS_PATH="/public/",i.prototype.PUBLIC_LIBRARY_SYNC_GROUP="libraries",i.prototype.CP_CLOUD_ID="community-platform",i.prototype.CP_STORAGE_ASSETS_PATH="/content/2/",i.prototype.STORAGE_API_KEY="",i.prototype.USER_AGENT_HEADER=void 0,i.prototype.SYNCING_ENABLED=!0,i.prototype.DEFAULT_MAX_SYNC_INTERVAL=1e4,i.prototype.RETRY_FAIL_MAX_SYNC_INTERVAL=6e4,i.prototype.MAX_SYNC_INTERVAL=i.prototype.DEFAULT_MAX_SYNC_INTERVAL,i.prototype.POLL_INTERVAL=1,i.prototype.AUTO_START_POLLING=!1,i.prototype.RENDITION_SIZES={},i.prototype.FULL_RENDITION_CONFIG={},i.prototype.BACKOFF_INTERVALS=[1,1,2,3,5,8,13,21,34,55],i.prototype.ERROR_RETRY_INTERVALS=[30,60,120],i.prototype.NETWORK_TIMEOUT=6e5,i.prototype.RETRY_RANDOM_SECONDS=30,i.prototype.RENDITION_MAX_RETRIES=2,i.prototype.DEFAULT_RENDITION_RETRY_INTERVAL=1e3,i.prototype.RENDITION_RETRY_INTERVAL=i.prototype.DEFAULT_RENDITION_RETRY_INTERVAL,i.prototype.DEFAULT_RENDITION_404_BACKOFF=3e5,i.prototype.RENDITION_404_BACKOFF=i.prototype.DEFAULT_RENDITION_404_BACKOFF,i.prototype.LOCAL_RENDITION_MAX_RETRIES=5,i.prototype.LOCAL_RENDITION_RETRY_INTERVAL=200,i.prototype.MAX_UPDATE_CONFLICTS=5,i.prototype.WHITELISTED_DOMAINS=[],i.prototype.ADOBE_AUTHENTICATED_DOMAINS=["adobe.com","adobe.io","fotolia.net"],i.prototype.SYNC_POLICY="manifestAndAssets",i.prototype.RENDITION_CACHE_FILE="cache.json",i.prototype.RENDITION_CACHE_PLACEHOLDER="<placeholder>",i.prototype.SHARED_LOCAL_STORAGE=!0,i.prototype.SHARED_LOCAL_STORAGE_VERSION=7,i.prototype.SHARED_LOCAL_STORAGE_MIN_CLIENT_VERSION=5,i.prototype.SHARED_LOCAL_STORAGE_MAX_CLIENT_VERSION=7,i.prototype.VULCAN_PREFIX="vulcan.SuiteMessage.",i.prototype.VULCAN_STARTUP_MESSAGE="cclibraries.service.Initialized",i.prototype.VULCAN_SHUTDOWN_REQUEST="cclibraries.service.TerminateServiceRequest",i.prototype.VULCAN_QUERY_REQUEST="cclibraries.service.QueryRequest",i.prototype.VULCAN_QUERY_RESPONSE="cclibraries.service.QueryResponse",i.prototype.VULCAN_LIBRARY_CHANGED_LOCAL_TYPE="cclibraries.service.LibraryChangedLocal",i.prototype.VULCAN_LIBRARY_CHANGED_REMOTE_TYPE="cclibraries.service.LibraryChangedRemote",i.prototype.VULCAN_LIBRARY_DELETED_TYPE="cclibraries.service.LibraryDeleted",i.prototype.VULCAN_COLLECTIONS_LOADED_TYPE="cclibraries.service.LibrariesLoaded",i.prototype.VULCAN_COLLECTIONS_UNLOADED_TYPE="cclibraries.service.LibrariesUnloaded",i.prototype.VULCAN_PROXY_QUERY_REQUEST="cclibraries.service.QueryProxySettingsRequest",i.prototype.VULCAN_PROXY_QUERY_RESPONSE="cclibraries.service.QueryProxySettingsResponse",i.prototype.VULCAN_PROXY_CHANGE_MESSAGE="cclibraries.service.ProxySettingsChanged",i.prototype.VULCAN_APP_READY_MESSAGE="cclibraries.accessor.AppReady",i.prototype.VULCAN_APP_SEND_ACTION_MESSAGE="cclibraries.accessor.EditElementRequest",i.prototype.VULCAN_APP_ACTION_ACCEPTED_MESSAGE="cclibraries.accessor.EditAcceptedMessage",i.prototype.STOCK_NAMESPACE="adobestock",i.prototype.STOCK_DATA_KEY="trackingdata",i.prototype.STOCK_STATE_PURCHASED="purchased",i.prototype.setParameter=function(e,t){if(-1===r.indexOf(e))throw new n(n.INVALID_PARAMETER,"Parameter not configurable");if("SYNC_POLICY"===e&&-1===this.VALID_SYNC_POLICIES.indexOf(t))throw new n(n.INVALID_PARAMETER,"Invalid value for SYNC_POLICY");"POLL_INTERVAL"===e&&(t=Math.max(1,t)),this[e]=t},new i}),i("utils/AdobeLibraryMimeTypeUtils",["require","exports","module"],function(e,t,o){"use strict";function i(e){var t=e.match(/application\/x-adobe-libraries-(.+)/);return t?[t[1]]:[]}function n(e){return["application/x-adobe-libraries-"+e]}var r={},a={"application/andrew-inset":["ez"],"application/applixware":["aw"],"application/atom+xml":["atom"],"application/atomcat+xml":["atomcat"],"application/atomsvc+xml":["atomsvc"],"application/ccxml+xml":["ccxml"],"application/cdmi-capability":["cdmia"],"application/cdmi-container":["cdmic"],"application/cdmi-domain":["cdmid"],"application/cdmi-object":["cdmio"],"application/cdmi-queue":["cdmiq"],"application/cu-seeme":["cu"],"application/davmount+xml":["davmount"],"application/docbook+xml":["dbk"],"application/dssc+der":["dssc"],"application/dssc+xml":["xdssc"],"application/ecmascript":["ecma"],"application/emma+xml":["emma"],"application/epub+zip":["epub"],"application/exi":["exi"],"application/font-tdpfr":["pfr"],"application/gml+xml":["gml"],"application/gpx+xml":["gpx"],"application/gxf":["gxf"],"application/hyperstudio":["stk"],"application/illustrator":["ai"],"application/illustrator.template":["ait"],"application/inkml+xml":["ink","inkml"],"application/ipfix":["ipfix"],"application/java-archive":["jar"],"application/java-serialized-object":["ser"],"application/java-vm":["class"],"application/javascript":["js"],"application/json":["json"],"application/jsonml+json":["jsonml"],"application/lost+xml":["lostxml"],"application/mac-binhex40":["hqx"],"application/mac-compactpro":["cpt"],"application/mads+xml":["mads"],"application/marc":["mrc"],"application/marcxml+xml":["mrcx"],"application/mathematica":["ma","nb","mb"],"application/mathml+xml":["mathml"],"application/mbox":["mbox"],"application/mediaservercontrol+xml":["mscml"],"application/metalink+xml":["metalink"],"application/metalink4+xml":["meta4"],"application/mets+xml":["mets"],"application/mods+xml":["mods"],"application/mp21":["m21","mp21"],"application/mp4":["mp4s"],"application/msword":["doc","dot"],"application/mxf":["mxf"],"application/octet-stream":["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy"],"application/oda":["oda"],"application/oebps-package+xml":["opf"],"application/ogg":["ogx"],"application/omdoc+xml":["omdoc"],"application/onenote":["onetoc","onetoc2","onetmp","onepkg"],"application/oxps":["oxps"],"application/patch-ops-error+xml":["xer"],"application/pdf":["pdf"],"application/pgp-encrypted":["pgp"],"application/pgp-signature":["asc","sig"],"application/photoshop":["psd"],"application/photoshop.large":["psb"],"application/pics-rules":["prf"],"application/pkcs10":["p10"],"application/pkcs7-mime":["p7m","p7c"],"application/pkcs7-signature":["p7s"],"application/pkcs8":["p8"],"application/pkix-attr-cert":["ac"],"application/pkix-cert":["cer"],"application/pkix-crl":["crl"],"application/pkix-pkipath":["pkipath"],"application/pkixcmp":["pki"],"application/pls+xml":["pls"],"application/postscript":["ai","eps","ps"],"application/prs.cww":["cww"],"application/pskc+xml":["pskcxml"],"application/rdf+xml":["rdf"],"application/reginfo+xml":["rif"],"application/relax-ng-compact-syntax":["rnc"],"application/resource-lists+xml":["rl"],"application/resource-lists-diff+xml":["rld"],"application/rls-services+xml":["rs"],"application/rpki-ghostbusters":["gbr"],"application/rpki-manifest":["mft"],"application/rpki-roa":["roa"],"application/rsd+xml":["rsd"],"application/rss+xml":["rss"],"application/rtf":["rtf"],"application/sbml+xml":["sbml"],"application/scvp-cv-request":["scq"],"application/scvp-cv-response":["scs"],"application/scvp-vp-request":["spq"],"application/scvp-vp-response":["spp"],"application/sdp":["sdp"],"application/set-payment-initiation":["setpay"],"application/set-registration-initiation":["setreg"],"application/shf+xml":["shf"],"application/smil+xml":["smi","smil"],"application/sparql-query":["rq"],"application/sparql-results+xml":["srx"],"application/srgs":["gram"],"application/srgs+xml":["grxml"],"application/sru+xml":["sru"],"application/ssdl+xml":["ssdl"],"application/ssml+xml":["ssml"],"application/tei+xml":["tei","teicorpus"],"application/thraud+xml":["tfi"],"application/timestamped-data":["tsd"],"application/vnd.3gpp.pic-bw-large":["plb"],"application/vnd.3gpp.pic-bw-small":["psb"],"application/vnd.3gpp.pic-bw-var":["pvb"],"application/vnd.3gpp2.tcap":["tcap"],"application/vnd.3m.post-it-notes":["pwn"],"application/vnd.accpac.simply.aso":["aso"],"application/vnd.accpac.simply.imp":["imp"],"application/vnd.acucobol":["acu"],"application/vnd.acucorp":["atc","acutc"],"application/vnd.adobe.air-application-installer-package+zip":["air"],"application/vnd.adobe.animate-xfl+zip":["fla","xfl"],"application/vnd.adobe.characterstyle+json":["style"],"application/vnd.adobe.characterstyle+snippet":["idms"],"application/vnd.adobe.charts+zip":["zip"],"application/vnd.adobe.color+json":["ase"],"application/vnd.adobe.colortheme+json":["ase"],"application/vnd.adobe.cube+txt":["cube"],"application/vnd.adobe.formscentral.fcdt":["fcdt"],"application/vnd.adobe.fxp":["fxp","fxpl"],"application/vnd.adobe.indesign-idms":["idms"],"application/vnd.adobe.indesign.template":["indt"],"application/vnd.adobe.layerstyle":["asl"],"application/vnd.adobe.look+xml":["look"],"application/vnd.adobe.muse-collection":["muse"],"application/vnd.adobe.paragraphstyle+json":["style"],"application/vnd.adobe.paragraphstyle+snippet":["idms"],"application/vnd.adobe.ribbon.brush+zip":["brush"],"application/vnd.adobe.scatter.brush+zip":["brush"],"application/vnd.adobe.vector.brush+zip":["brush"],"application/vnd.adobe.xdp+xml":["xdp"],"application/vnd.adobe.xfdf":["xfdf"],"application/vnd.ahead.space":["ahead"],"application/vnd.airzip.filesecure.azf":["azf"],"application/vnd.airzip.filesecure.azs":["azs"],"application/vnd.amazon.ebook":["azw"],"application/vnd.americandynamics.acc":["acc"],"application/vnd.amiga.ami":["ami"],"application/vnd.android.package-archive":["apk"],"application/vnd.anser-web-certificate-issue-initiation":["cii"],"application/vnd.anser-web-funds-transfer-initiation":["fti"],"application/vnd.antix.game-component":["atx"],"application/vnd.apple.installer+xml":["mpkg"],"application/vnd.apple.mpegurl":["m3u8"],"application/vnd.aristanetworks.swi":["swi"],"application/vnd.astraea-software.iota":["iota"],"application/vnd.audiograph":["aep"],"application/vnd.blueice.multipass":["mpm"],"application/vnd.bmi":["bmi"],"application/vnd.businessobjects":["rep"],"application/vnd.chemdraw+xml":["cdxml"],"application/vnd.chipnuts.karaoke-mmd":["mmd"],"application/vnd.cinderella":["cdy"],"application/vnd.claymore":["cla"],"application/vnd.cloanto.rp9":["rp9"],"application/vnd.clonk.c4group":["c4g","c4d","c4f","c4p","c4u"],"application/vnd.cluetrust.cartomobile-config":["c11amc"],"application/vnd.cluetrust.cartomobile-config-pkg":["c11amz"],"application/vnd.commonspace":["csp"],"application/vnd.contact.cmsg":["cdbcmsg"],"application/vnd.cosmocaller":["cmc"],"application/vnd.crick.clicker":["clkx"],"application/vnd.crick.clicker.keyboard":["clkk"],"application/vnd.crick.clicker.palette":["clkp"],"application/vnd.crick.clicker.template":["clkt"],"application/vnd.crick.clicker.wordbank":["clkw"],"application/vnd.criticaltools.wbs+xml":["wbs"],"application/vnd.ctc-posml":["pml"],"application/vnd.cups-ppd":["ppd"],"application/vnd.curl.car":["car"],"application/vnd.curl.pcurl":["pcurl"],"application/vnd.dart":["dart"],"application/vnd.data-vision.rdz":["rdz"],"application/vnd.dece.data":["uvf","uvvf","uvd","uvvd"],"application/vnd.dece.ttml+xml":["uvt","uvvt"],"application/vnd.dece.unspecified":["uvx","uvvx"],"application/vnd.dece.zip":["uvz","uvvz"],"application/vnd.denovo.fcselayout-link":["fe_launch"],"application/vnd.dna":["dna"],"application/vnd.dolby.mlp":["mlp"],"application/vnd.dpgraph":["dpg"],"application/vnd.dreamfactory":["dfac"],"application/vnd.ds-keypoint":["kpxx"],"application/vnd.dvb.ait":["ait"],"application/vnd.dvb.service":["svc"],"application/vnd.dynageo":["geo"],"application/vnd.ecowin.chart":["mag"],"application/vnd.enliven":["nml"],"application/vnd.epson.esf":["esf"],"application/vnd.epson.msf":["msf"],"application/vnd.epson.quickanime":["qam"],"application/vnd.epson.salt":["slt"],"application/vnd.epson.ssf":["ssf"],"application/vnd.eszigno3+xml":["es3","et3"],"application/vnd.ezpix-album":["ez2"],"application/vnd.ezpix-package":["ez3"],"application/vnd.fdf":["fdf"],"application/vnd.fdsn.mseed":["mseed"],"application/vnd.fdsn.seed":["seed","dataless"],"application/vnd.flographit":["gph"],"application/vnd.fluxtime.clip":["ftc"],"application/vnd.framemaker":["fm","frame","maker","book"],"application/vnd.frogans.fnc":["fnc"],"application/vnd.frogans.ltf":["ltf"],"application/vnd.fsc.weblaunch":["fsc"],"application/vnd.fujitsu.oasys":["oas"],"application/vnd.fujitsu.oasys2":["oa2"],"application/vnd.fujitsu.oasys3":["oa3"],"application/vnd.fujitsu.oasysgp":["fg5"],"application/vnd.fujitsu.oasysprs":["bh2"],"application/vnd.fujixerox.ddd":["ddd"],"application/vnd.fujixerox.docuworks":["xdw"],"application/vnd.fujixerox.docuworks.binder":["xbd"],"application/vnd.fuzzysheet":["fzs"],"application/vnd.genomatix.tuxedo":["txd"],"application/vnd.geogebra.file":["ggb"],"application/vnd.geogebra.tool":["ggt"],"application/vnd.geometry-explorer":["gex","gre"],"application/vnd.geonext":["gxt"],"application/vnd.geoplan":["g2w"],"application/vnd.geospace":["g3w"],"application/vnd.gmx":["gmx"],"application/vnd.google-earth.kml+xml":["kml"],"application/vnd.google-earth.kmz":["kmz"],"application/vnd.grafeq":["gqf","gqs"],"application/vnd.groove-account":["gac"],"application/vnd.groove-help":["ghf"],"application/vnd.groove-identity-message":["gim"],"application/vnd.groove-injector":["grv"],"application/vnd.groove-tool-message":["gtm"],"application/vnd.groove-tool-template":["tpl"],"application/vnd.groove-vcard":["vcg"],"application/vnd.hal+xml":["hal"],"application/vnd.handheld-entertainment+xml":["zmm"],"application/vnd.hbci":["hbci"],"application/vnd.hhe.lesson-player":["les"],"application/vnd.hp-hpgl":["hpgl"],"application/vnd.hp-hpid":["hpid"],"application/vnd.hp-hps":["hps"],"application/vnd.hp-jlyt":["jlt"],"application/vnd.hp-pcl":["pcl"],"application/vnd.hp-pclxl":["pclxl"],"application/vnd.ibm.minipay":["mpy"],"application/vnd.ibm.modcap":["afp","listafp","list3820"],"application/vnd.ibm.rights-management":["irm"],"application/vnd.ibm.secure-container":["sc"],"application/vnd.iccprofile":["icc","icm"],"application/vnd.igloader":["igl"],"application/vnd.immervision-ivp":["ivp"],"application/vnd.immervision-ivu":["ivu"],"application/vnd.insors.igm":["igm"],"application/vnd.intercon.formnet":["xpw","xpx"],"application/vnd.intergeo":["i2g"],"application/vnd.intu.qbo":["qbo"],"application/vnd.intu.qfx":["qfx"],"application/vnd.ipunplugged.rcprofile":["rcprofile"],"application/vnd.irepository.package+xml":["irp"],"application/vnd.is-xpr":["xpr"],"application/vnd.isac.fcs":["fcs"],"application/vnd.jam":["jam"],"application/vnd.jcp.javame.midlet-rms":["rms"],"application/vnd.jisp":["jisp"],"application/vnd.joost.joda-archive":["joda"],"application/vnd.kahootz":["ktz","ktr"],"application/vnd.kde.karbon":["karbon"],"application/vnd.kde.kchart":["chrt"],"application/vnd.kde.kformula":["kfo"],"application/vnd.kde.kivio":["flw"],"application/vnd.kde.kontour":["kon"],"application/vnd.kde.kpresenter":["kpr","kpt"],"application/vnd.kde.kspread":["ksp"],"application/vnd.kde.kword":["kwd","kwt"],"application/vnd.kenameaapp":["htke"],"application/vnd.kidspiration":["kia"],"application/vnd.kinar":["kne","knp"],"application/vnd.koan":["skp","skd","skt","skm"],"application/vnd.kodak-descriptor":["sse"],"application/vnd.las.las+xml":["lasxml"],"application/vnd.llamagraphics.life-balance.desktop":["lbd"],"application/vnd.llamagraphics.life-balance.exchange+xml":["lbe"],"application/vnd.lotus-1-2-3":["123"],"application/vnd.lotus-approach":["apr"],"application/vnd.lotus-freelance":["pre"],"application/vnd.lotus-notes":["nsf"],"application/vnd.lotus-organizer":["org"],"application/vnd.lotus-screencam":["scm"],"application/vnd.lotus-wordpro":["lwp"],"application/vnd.macports.portpkg":["portpkg"],"application/vnd.mcd":["mcd"],"application/vnd.medcalcdata":["mc1"],"application/vnd.mediastation.cdkey":["cdkey"],"application/vnd.mfer":["mwf"],"application/vnd.mfmp":["mfm"],"application/vnd.micrografx.flo":["flo"],"application/vnd.micrografx.igx":["igx"],"application/vnd.mif":["mif"],"application/vnd.mobius.daf":["daf"],"application/vnd.mobius.dis":["dis"],"application/vnd.mobius.mbk":["mbk"],"application/vnd.mobius.mqy":["mqy"],"application/vnd.mobius.msl":["msl"],"application/vnd.mobius.plc":["plc"],"application/vnd.mobius.txf":["txf"],"application/vnd.mophun.application":["mpn"],"application/vnd.mophun.certificate":["mpc"],"application/vnd.mozilla.xul+xml":["xul"],"application/vnd.ms-artgalry":["cil"],"application/vnd.ms-cab-compressed":["cab"],"application/vnd.ms-excel":["xls","xlm","xla","xlc","xlt","xlw"],"application/vnd.ms-excel.addin.macroenabled.12":["xlam"],"application/vnd.ms-excel.sheet.binary.macroenabled.12":["xlsb"],
"application/vnd.ms-excel.sheet.macroenabled.12":["xlsm"],"application/vnd.ms-excel.template.macroenabled.12":["xltm"],"application/vnd.ms-fontobject":["eot"],"application/vnd.ms-htmlhelp":["chm"],"application/vnd.ms-ims":["ims"],"application/vnd.ms-lrm":["lrm"],"application/vnd.ms-officetheme":["thmx"],"application/vnd.ms-pki.seccat":["cat"],"application/vnd.ms-pki.stl":["stl"],"application/vnd.ms-powerpoint":["ppt","pps","pot"],"application/vnd.ms-powerpoint.addin.macroenabled.12":["ppam"],"application/vnd.ms-powerpoint.presentation.macroenabled.12":["pptm"],"application/vnd.ms-powerpoint.slide.macroenabled.12":["sldm"],"application/vnd.ms-powerpoint.slideshow.macroenabled.12":["ppsm"],"application/vnd.ms-powerpoint.template.macroenabled.12":["potm"],"application/vnd.ms-project":["mpp","mpt"],"application/vnd.ms-word.document.macroenabled.12":["docm"],"application/vnd.ms-word.template.macroenabled.12":["dotm"],"application/vnd.ms-works":["wps","wks","wcm","wdb"],"application/vnd.ms-wpl":["wpl"],"application/vnd.ms-xpsdocument":["xps"],"application/vnd.mseq":["mseq"],"application/vnd.musician":["mus"],"application/vnd.muvee.style":["msty"],"application/vnd.mynfc":["taglet"],"application/vnd.neurolanguage.nlu":["nlu"],"application/vnd.nitf":["ntf","nitf"],"application/vnd.noblenet-directory":["nnd"],"application/vnd.noblenet-sealer":["nns"],"application/vnd.noblenet-web":["nnw"],"application/vnd.nokia.n-gage.data":["ngdat"],"application/vnd.nokia.radio-preset":["rpst"],"application/vnd.nokia.radio-presets":["rpss"],"application/vnd.novadigm.edm":["edm"],"application/vnd.novadigm.edx":["edx"],"application/vnd.novadigm.ext":["ext"],"application/vnd.oasis.opendocument.chart":["odc"],"application/vnd.oasis.opendocument.chart-template":["otc"],"application/vnd.oasis.opendocument.database":["odb"],"application/vnd.oasis.opendocument.formula":["odf"],"application/vnd.oasis.opendocument.formula-template":["odft"],"application/vnd.oasis.opendocument.graphics":["odg"],"application/vnd.oasis.opendocument.graphics-template":["otg"],"application/vnd.oasis.opendocument.image":["odi"],"application/vnd.oasis.opendocument.image-template":["oti"],"application/vnd.oasis.opendocument.presentation":["odp"],"application/vnd.oasis.opendocument.presentation-template":["otp"],"application/vnd.oasis.opendocument.spreadsheet":["ods"],"application/vnd.oasis.opendocument.spreadsheet-template":["ots"],"application/vnd.oasis.opendocument.text":["odt"],"application/vnd.oasis.opendocument.text-master":["odm"],"application/vnd.oasis.opendocument.text-template":["ott"],"application/vnd.oasis.opendocument.text-web":["oth"],"application/vnd.olpc-sugar":["xo"],"application/vnd.oma.dd2+xml":["dd2"],"application/vnd.openofficeorg.extension":["oxt"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":["pptx"],"application/vnd.openxmlformats-officedocument.presentationml.slide":["sldx"],"application/vnd.openxmlformats-officedocument.presentationml.slideshow":["ppsx"],"application/vnd.openxmlformats-officedocument.presentationml.template":["potx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":["xlsx"],"application/vnd.openxmlformats-officedocument.spreadsheetml.template":["xltx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":["docx"],"application/vnd.openxmlformats-officedocument.wordprocessingml.template":["dotx"],"application/vnd.osgeo.mapguide.package":["mgp"],"application/vnd.osgi.dp":["dp"],"application/vnd.osgi.subsystem":["esa"],"application/vnd.palm":["pdb","pqa","oprc"],"application/vnd.pawaafile":["paw"],"application/vnd.pg.format":["str"],"application/vnd.pg.osasli":["ei6"],"application/vnd.picsel":["efif"],"application/vnd.pmi.widget":["wg"],"application/vnd.pocketlearn":["plf"],"application/vnd.powerbuilder6":["pbd"],"application/vnd.previewsystems.box":["box"],"application/vnd.proteus.magazine":["mgz"],"application/vnd.publishare-delta-tree":["qps"],"application/vnd.pvi.ptid1":["ptid"],"application/vnd.quark.quarkxpress":["qxd","qxt","qwd","qwt","qxl","qxb"],"application/vnd.realvnc.bed":["bed"],"application/vnd.recordare.musicxml":["mxl"],"application/vnd.recordare.musicxml+xml":["musicxml"],"application/vnd.rig.cryptonote":["cryptonote"],"application/vnd.rim.cod":["cod"],"application/vnd.rn-realmedia":["rm"],"application/vnd.rn-realmedia-vbr":["rmvb"],"application/vnd.route66.link66+xml":["link66"],"application/vnd.sailingtracker.track":["st"],"application/vnd.seemail":["see"],"application/vnd.sema":["sema"],"application/vnd.semd":["semd"],"application/vnd.semf":["semf"],"application/vnd.shana.informed.formdata":["ifm"],"application/vnd.shana.informed.formtemplate":["itp"],"application/vnd.shana.informed.interchange":["iif"],"application/vnd.shana.informed.package":["ipk"],"application/vnd.simtech-mindmapper":["twd","twds"],"application/vnd.smaf":["mmf"],"application/vnd.smart.teacher":["teacher"],"application/vnd.solent.sdkm+xml":["sdkm","sdkd"],"application/vnd.spotfire.dxp":["dxp"],"application/vnd.spotfire.sfs":["sfs"],"application/vnd.stardivision.calc":["sdc"],"application/vnd.stardivision.draw":["sda"],"application/vnd.stardivision.impress":["sdd"],"application/vnd.stardivision.math":["smf"],"application/vnd.stardivision.writer":["sdw","vor"],"application/vnd.stardivision.writer-global":["sgl"],"application/vnd.stepmania.package":["smzip"],"application/vnd.stepmania.stepchart":["sm"],"application/vnd.sun.xml.calc":["sxc"],"application/vnd.sun.xml.calc.template":["stc"],"application/vnd.sun.xml.draw":["sxd"],"application/vnd.sun.xml.draw.template":["std"],"application/vnd.sun.xml.impress":["sxi"],"application/vnd.sun.xml.impress.template":["sti"],"application/vnd.sun.xml.math":["sxm"],"application/vnd.sun.xml.writer":["sxw"],"application/vnd.sun.xml.writer.global":["sxg"],"application/vnd.sun.xml.writer.template":["stw"],"application/vnd.sus-calendar":["sus","susp"],"application/vnd.svd":["svd"],"application/vnd.symbian.install":["sis","sisx"],"application/vnd.syncml+xml":["xsm"],"application/vnd.syncml.dm+wbxml":["bdm"],"application/vnd.syncml.dm+xml":["xdm"],"application/vnd.tao.intent-module-archive":["tao"],"application/vnd.tcpdump.pcap":["pcap","cap","dmp"],"application/vnd.tmobile-livetv":["tmo"],"application/vnd.trid.tpt":["tpt"],"application/vnd.triscape.mxs":["mxs"],"application/vnd.trueapp":["tra"],"application/vnd.ufdl":["ufd","ufdl"],"application/vnd.uiq.theme":["utz"],"application/vnd.umajin":["umj"],"application/vnd.unity":["unityweb"],"application/vnd.uoml+xml":["uoml"],"application/vnd.vcx":["vcx"],"application/vnd.visio":["vsd","vst","vss","vsw"],"application/vnd.visionary":["vis"],"application/vnd.vsf":["vsf"],"application/vnd.wap.wbxml":["wbxml"],"application/vnd.wap.wmlc":["wmlc"],"application/vnd.wap.wmlscriptc":["wmlsc"],"application/vnd.webturbo":["wtb"],"application/vnd.wolfram.player":["nbp"],"application/vnd.wordperfect":["wpd"],"application/vnd.wqd":["wqd"],"application/vnd.wt.stf":["stf"],"application/vnd.xara":["xar"],"application/vnd.xfdl":["xfdl"],"application/vnd.yamaha.hv-dic":["hvd"],"application/vnd.yamaha.hv-script":["hvs"],"application/vnd.yamaha.hv-voice":["hvp"],"application/vnd.yamaha.openscoreformat":["osf"],"application/vnd.yamaha.openscoreformat.osfpvg+xml":["osfpvg"],"application/vnd.yamaha.smaf-audio":["saf"],"application/vnd.yamaha.smaf-phrase":["spf"],"application/vnd.yellowriver-custom-menu":["cmp"],"application/vnd.zul":["zir","zirz"],"application/vnd.zzazz.deck+xml":["zaz"],"application/voicexml+xml":["vxml"],"application/widget":["wgt"],"application/winhlp":["hlp"],"application/wsdl+xml":["wsdl"],"application/wspolicy+xml":["wspolicy"],"application/x-7z-compressed":["7z"],"application/x-abiword":["abw"],"application/x-ace-compressed":["ace"],"application/x-apple-diskimage":["dmg"],"application/x-authorware-bin":["aab","x32","u32","vox"],"application/x-authorware-map":["aam"],"application/x-authorware-seg":["aas"],"application/x-bcpio":["bcpio"],"application/x-bittorrent":["torrent"],"application/x-blorb":["blb","blorb"],"application/x-bzip":["bz"],"application/x-bzip2":["bz2","boz"],"application/x-cbr":["cbr","cba","cbt","cbz","cb7"],"application/x-cdlink":["vcd"],"application/x-cfs-compressed":["cfs"],"application/x-chat":["chat"],"application/x-chess-pgn":["pgn"],"application/x-conference":["nsc"],"application/x-cpio":["cpio"],"application/x-csh":["csh"],"application/x-debian-package":["deb","udeb"],"application/x-dgc-compressed":["dgc"],"application/x-director":["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"],"application/x-doom":["wad"],"application/x-dtbncx+xml":["ncx"],"application/x-dtbook+xml":["dtb"],"application/x-dtbresource+xml":["res"],"application/x-dvi":["dvi"],"application/x-envoy":["evy"],"application/x-eva":["eva"],"application/x-font-bdf":["bdf"],"application/x-font-ghostscript":["gsf"],"application/x-font-linux-psf":["psf"],"application/x-font-otf":["otf"],"application/x-font-pcf":["pcf"],"application/x-font-snf":["snf"],"application/x-font-ttf":["ttf","ttc"],"application/x-font-type1":["pfa","pfb","pfm","afm"],"application/font-woff":["woff"],"application/x-freearc":["arc"],"application/x-futuresplash":["spl"],"application/x-gca-compressed":["gca"],"application/x-glulx":["ulx"],"application/x-gnumeric":["gnumeric"],"application/x-gramps-xml":["gramps"],"application/x-gtar":["gtar"],"application/x-hdf":["hdf"],"application/x-install-instructions":["install"],"application/x-iso9660-image":["iso"],"application/x-java-jnlp-file":["jnlp"],"application/x-latex":["latex"],"application/x-lzh-compressed":["lzh","lha"],"application/x-mie":["mie"],"application/x-mobipocket-ebook":["prc","mobi"],"application/x-ms-application":["application"],"application/x-ms-shortcut":["lnk"],"application/x-ms-wmd":["wmd"],"application/x-ms-wmz":["wmz"],"application/x-ms-xbap":["xbap"],"application/x-msaccess":["mdb"],"application/x-msbinder":["obd"],"application/x-mscardfile":["crd"],"application/x-msclip":["clp"],"application/x-msdownload":["exe","dll","com","bat","msi"],"application/x-msmediaview":["mvb","m13","m14"],"application/x-msmetafile":["wmf","wmz","emf","emz"],"application/x-msmoney":["mny"],"application/x-mspublisher":["pub"],"application/x-msschedule":["scd"],"application/x-msterminal":["trm"],"application/x-mswrite":["wri"],"application/x-netcdf":["nc","cdf"],"application/x-nzb":["nzb"],"application/x-pkcs12":["p12","pfx"],"application/x-pkcs7-certificates":["p7b","spc"],"application/x-pkcs7-certreqresp":["p7r"],"application/x-rar-compressed":["rar"],"application/x-research-info-systems":["ris"],"application/x-sh":["sh"],"application/x-shar":["shar"],"application/x-shockwave-flash":["swf"],"application/x-silverlight-app":["xap"],"application/x-sql":["sql"],"application/x-stuffit":["sit"],"application/x-stuffitx":["sitx"],"application/x-subrip":["srt"],"application/x-sv4cpio":["sv4cpio"],"application/x-sv4crc":["sv4crc"],"application/x-t3vm-image":["t3"],"application/x-tads":["gam"],"application/x-tar":["tar"],"application/x-tcl":["tcl"],"application/x-tex":["tex"],"application/x-tex-tfm":["tfm"],"application/x-texinfo":["texinfo","texi"],"application/x-tgif":["obj"],"application/x-ustar":["ustar"],"application/x-wais-source":["src"],"application/x-x509-ca-cert":["der","crt"],"application/x-xfig":["fig"],"application/x-xliff+xml":["xlf"],"application/x-xpinstall":["xpi"],"application/x-xz":["xz"],"application/x-zmachine":["z1","z2","z3","z4","z5","z6","z7","z8"],"application/xaml+xml":["xaml"],"application/xcap-diff+xml":["xdf"],"application/xenc+xml":["xenc"],"application/xhtml+xml":["xhtml","xht"],"application/xml":["xml","xsl"],"application/xml-dtd":["dtd"],"application/xop+xml":["xop"],"application/xproc+xml":["xpl"],"application/xslt+xml":["xslt"],"application/xspf+xml":["xspf"],"application/xv+xml":["mxml","xhvml","xvml","xvm"],"application/yang":["yang"],"application/yin+xml":["yin"],"application/zip":["zip"],"audio/adpcm":["adp"],"audio/basic":["au","snd"],"audio/midi":["mid","midi","kar","rmi"],"audio/mp4":["mp4a"],"audio/mpeg":["mpga","mp2","mp2a","mp3","m2a","m3a"],"audio/ogg":["oga","ogg","spx"],"audio/s3m":["s3m"],"audio/silk":["sil"],"audio/vnd.dece.audio":["uva","uvva"],"audio/vnd.digital-winds":["eol"],"audio/vnd.dra":["dra"],"audio/vnd.dts":["dts"],"audio/vnd.dts.hd":["dtshd"],"audio/vnd.lucent.voice":["lvp"],"audio/vnd.ms-playready.media.pya":["pya"],"audio/vnd.nuera.ecelp4800":["ecelp4800"],"audio/vnd.nuera.ecelp7470":["ecelp7470"],"audio/vnd.nuera.ecelp9600":["ecelp9600"],"audio/vnd.rip":["rip"],"audio/webm":["weba"],"audio/x-aac":["aac"],"audio/x-aiff":["aif","aiff","aifc"],"audio/x-caf":["caf"],"audio/x-flac":["flac"],"audio/x-matroska":["mka"],"audio/x-mpegurl":["m3u"],"audio/x-ms-wax":["wax"],"audio/x-ms-wma":["wma"],"audio/x-pn-realaudio":["ram","ra"],"audio/x-pn-realaudio-plugin":["rmp"],"audio/x-wav":["wav"],"audio/xm":["xm"],"chemical/x-cdx":["cdx"],"chemical/x-cif":["cif"],"chemical/x-cmdf":["cmdf"],"chemical/x-cml":["cml"],"chemical/x-csml":["csml"],"chemical/x-xyz":["xyz"],"image/bmp":["bmp"],"image/cgm":["cgm"],"image/g3fax":["g3"],"image/gif":["gif"],"image/ief":["ief"],"image/jpeg":["jpeg","jpg","jpe"],"image/jpg":["jpg"],"image/ktx":["ktx"],"image/png":["png"],"image/prs.btif":["btif"],"image/sgi":["sgi"],"image/svg+xml":["svg","svgz"],"image/tiff":["tiff","tif"],"image/vnd.adobe.photoshop":["psd"],"image/vnd.adobe.photoshop.template":["psdt"],"image/vnd.adobe.pattern+png":["png"],"image/vnd.adobe.shape+svg":["shape"],"image/vnd.dece.graphic":["uvi","uvvi","uvg","uvvg"],"image/vnd.dvb.subtitle":["sub"],"image/vnd.djvu":["djvu","djv"],"image/vnd.dwg":["dwg"],"image/vnd.dxf":["dxf"],"image/vnd.fastbidsheet":["fbs"],"image/vnd.fpx":["fpx"],"image/vnd.fst":["fst"],"image/vnd.fujixerox.edmics-mmr":["mmr"],"image/vnd.fujixerox.edmics-rlc":["rlc"],"image/vnd.ms-modi":["mdi"],"image/vnd.ms-photo":["wdp"],"image/vnd.net-fpx":["npx"],"image/vnd.wap.wbmp":["wbmp"],"image/vnd.xiff":["xif"],"image/webp":["webp"],"image/x-3ds":["3ds"],"image/x-adobe-photoshop-brush":["abr"],"image/x-cmu-raster":["ras"],"image/x-cmx":["cmx"],"image/x-freehand":["fh","fhc","fh4","fh5","fh7"],"image/x-icon":["ico"],"image/x-mrsid-image":["sid"],"image/x-pcx":["pcx"],"image/x-pict":["pic","pct"],"image/x-portable-anymap":["pnm"],"image/x-portable-bitmap":["pbm"],"image/x-portable-graymap":["pgm"],"image/x-portable-pixmap":["ppm"],"image/x-rgb":["rgb"],"image/x-tga":["tga"],"image/x-xbitmap":["xbm"],"image/x-xpixmap":["xpm"],"image/x-xwindowdump":["xwd"],"message/rfc822":["eml","mime"],"model/iges":["igs","iges"],"model/mesh":["msh","mesh","silo"],"model/vnd.collada+xml":["dae"],"model/vnd.dwf":["dwf"],"model/vnd.gdl":["gdl"],"model/vnd.gtw":["gtw"],"model/vnd.mts":["mts"],"model/vnd.vtu":["vtu"],"model/vrml":["wrl","vrml"],"model/x3d+binary":["x3db","x3dbz"],"model/x3d+vrml":["x3dv","x3dvz"],"model/x3d+xml":["x3d","x3dz"],"text/cache-manifest":["appcache"],"text/calendar":["ics","ifb"],"text/css":["css"],"text/csv":["csv"],"text/html":["html","htm"],"text/n3":["n3"],"text/plain":["txt","text","conf","def","list","log","in"],"text/prs.lines.tag":["dsc"],"text/richtext":["rtx"],"text/sgml":["sgml","sgm"],"text/tab-separated-values":["tsv"],"text/troff":["t","tr","roff","man","me","ms"],"text/turtle":["ttl"],"text/uri-list":["uri","uris","urls"],"text/vcard":["vcard"],"text/vnd.curl":["curl"],"text/vnd.curl.dcurl":["dcurl"],"text/vnd.curl.scurl":["scurl"],"text/vnd.curl.mcurl":["mcurl"],"text/vnd.dvb.subtitle":["sub"],"text/vnd.fly":["fly"],"text/vnd.fmi.flexstor":["flx"],"text/vnd.graphviz":["gv"],"text/vnd.in3d.3dml":["3dml"],"text/vnd.in3d.spot":["spot"],"text/vnd.sun.j2me.app-descriptor":["jad"],"text/vnd.wap.wml":["wml"],"text/vnd.wap.wmlscript":["wmls"],"text/x-asm":["s","asm"],"text/x-c":["c","cc","cxx","cpp","h","hh","dic"],"text/x-fortran":["f","for","f77","f90"],"text/x-java-source":["java"],"text/x-opml":["opml"],"text/x-pascal":["p","pas"],"text/x-nfo":["nfo"],"text/x-setext":["etx"],"text/x-sfv":["sfv"],"text/x-uuencode":["uu"],"text/x-vcalendar":["vcs"],"text/x-vcard":["vcf"],"video/3gpp":["3gp"],"video/3gpp2":["3g2"],"video/h261":["h261"],"video/h263":["h263"],"video/h264":["h264"],"video/jpeg":["jpgv"],"video/jpm":["jpm","jpgm"],"video/mj2":["mj2","mjp2"],"video/mp4":["mp4","mp4v","mpg4"],"video/mpeg":["mpeg","mpg","mpe","m1v","m2v"],"video/ogg":["ogv"],"video/quicktime":["qt","mov"],"video/vnd.dece.hd":["uvh","uvvh"],"video/vnd.dece.mobile":["uvm","uvvm"],"video/vnd.dece.pd":["uvp","uvvp"],"video/vnd.dece.sd":["uvs","uvvs"],"video/vnd.dece.video":["uvv","uvvv"],"video/vnd.dvb.file":["dvb"],"video/vnd.fvt":["fvt"],"video/vnd.mpegurl":["mxu","m4u"],"video/vnd.ms-playready.media.pyv":["pyv"],"video/vnd.uvvu.mp4":["uvu","uvvu"],"video/vnd.vivo":["viv"],"video/webm":["webm"],"video/x-f4v":["f4v"],"video/x-fli":["fli"],"video/x-flv":["flv"],"video/x-m4v":["m4v"],"video/x-matroska":["mkv","mk3d","mks"],"video/x-mng":["mng"],"video/x-ms-asf":["asf","asx"],"video/x-ms-vob":["vob"],"video/x-ms-wm":["wm"],"video/x-ms-wmv":["wmv"],"video/x-ms-wmx":["wmx"],"video/x-ms-wvx":["wvx"],"video/x-msvideo":["avi"],"video/x-sgi-movie":["movie"],"video/x-smv":["smv"],"x-conference/x-cooltalk":["ice"]},s={};return Object.keys(a).forEach(function(e){var t=a[e];t.forEach(function(t){s[t]=s[t]||[],s[t].push(e)})}),r.getExtensions=function(e){return e?a[e.toLowerCase()]||i(e.toLowerCase()):[]},r.getMimeTypes=function(e){return e?s[e.toLowerCase()]||n(e.toLowerCase()):[]},r}),i("utils/AdobeLibraryManifestUtils",["require","exports","module","../components/dcx-js/src/AdobeDCX","../components/dcx-js/src/AdobeDCXError","../AdobeLibraryConfig","../AdobeLibraryServices","../AdobeLibraryError"],function(e,t,o){"use strict";var i=e("../components/dcx-js/src/AdobeDCX"),n=e("../components/dcx-js/src/AdobeDCXError"),r=e("../AdobeLibraryConfig"),a=e("../AdobeLibraryServices"),s=e("../AdobeLibraryError"),c={},l={};c.isCompatibleType=function(e,t){return e===t||e===l[t]},c.validateLibraryId=function(e,t){if(t){if(e&&e.length>=30&&e.match(/^[0-9A-Z\-]+$/i))return!0}else if(e&&e.match(/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i))return!0;return!1},c.validateLibrary=function(e){var t=e.current&&e.current.rootNode.getValue(r.VERSION_KEY);return t!==r.VERSION?!1:!0},c.areManifestsEqual=function(e,t){try{var o=JSON.parse(e),i=JSON.parse(t);if(delete o["manifest-format-version"],delete i["manifest-format-version"],JSON.stringify(o)===JSON.stringify(i))return!0}catch(n){}return!1},c.getDCXKey=function(e,t){if(!e||!("string"==typeof e||e instanceof String)||""===e)throw new s(s.INVALID_PARAMETER,"Invalid namespace");if(!t||!("string"==typeof t||t instanceof String)||""===t)throw new s(s.INVALID_PARAMETER,"Invalid key");return e+"#"+t},c.getCustomDCXData=function(e){var t=e.getCustomKeys(),o=[];return t.forEach(function(t){var i=t.split("#"),n=i.length>=2;n&&i.forEach(function(e){""===e&&(n=!1)});var a=0===t.indexOf(r.DL_PREFIX);n&&!a&&o.push({namespace:i.shift(),key:i.join("#"),value:e.getValue(t)})}),o},c.copyCustomDCXData=function(e,t){var o=c.getCustomDCXData(e);o.forEach(function(e){t.setValue(c.getDCXKey(e.namespace,e.key),e.value)});var i=e.getValue(r.REPRESENTATION_ORDER_KEY);i&&t.setValue(r.REPRESENTATION_ORDER_KEY,i)},c.checkDeletedState=function(e,t){if(e.isDeletedLocally){if(t)return t(new s(s.DELETED_LOCALLY,"deleted/orphan object")),!0;throw new s(s.DELETED_LOCALLY,"deleted/orphan object")}return!1},c.checkEncoding=function(e,t,o){if(-1===t.indexOf(e)){var i=t.join(", ");return o(new s(s.INVALID_PARAMETER,"Unsupported encoding. Supported encodings are: "+i)),!1}return!0},c.sortRepresentations=function(e){if(!(e.length<2))for(var t,o,i,n;;){for(t=!1,o=1;o<e.length;o++)i=e[o-1],n=e[o],n._getOrder()<i._getOrder()&&(e[o-1]=n,e[o]=i,t=!0);if(!t)break}},c.removeMissingComponents=function(e,t){if(e&&t){var o=0;return t.forEach(function(t){var i=t.component,n=t.error;i&&n&&n.response&&404===n.response.statusCode&&(e.removeComponent(i),o++,a.log("Removed missing component: "+i.id+" from library "+e.compositeId))}),a.log("Fixed "+o+" of "+t.length+" components that failed to download"),t.length===o?e:void 0}};var d=function(e,t){var o;return e.elements.some(function(e){return e.representations.some(function(e){return e.id===t?(o=e,!0):void 0})}),o};return c.removeMissingLocalComponents=function(e,t){if(e&&t){var o=0,i=[];t.forEach(function(t){var r=t.component,s=t.error;if(r&&s&&s.code===n.INVALID_STATE){var c=d(e,r.id);c?i.push(c):e._dcxBranch.removeComponent(r),o++,a.log("Removed missing local component: "+r.id+" from library "+e.id)}}),o>0&&(e._beginOperation(),i.forEach(function(e){e.element.removeRepresentation(e)}),e._endOperation()),a.log("Fixed "+o+" of "+t.length+" components that failed to upload")}},c.collaborationStateToDCX=function(e){return"incoming"===e?i.COLLABORATION.SHARED_WITH_USER:"outgoing"===e?i.COLLABORATION.SHARED_BY_USER:i.COLLABORATION.PRIVATE},c.collaborationStateFromDCX=function(e){return e===i.COLLABORATION.SHARED_WITH_USER?"incoming":e===i.COLLABORATION.SHARED_BY_USER?"outgoing":void 0},c.getCompositeRenditionMap=function(e){var t=e.getComponentsOf(),o={};return t&&t.forEach(function(e){if("rendition"===e.relationship){var t=e.getValue(r.RENDITION_TYPE_KEY);t&&(o[t]=e)}}),o},c}),i("utils/AdobeLibraryFileUtils",["require","exports","module","../AdobeLibraryServices"],function(e,t,o){"use strict";var i=e("../AdobeLibraryServices"),n={},r=function(e){return e+".TEMP_"+i.uuid()},a=function(e){var t=e.match(/(.*)\.TEMP_[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i);return t&&t[1]?t[1]:e};return n.ensurePathExists=function(e,t){function o(e,t,i){var a=t.slice(0,e).join(n),s=function(n){e<t.length?o(e+1,t,i):i(null)};r.exists(a,function(e){e?s():r.mkdir(a,s)})}var n=i.getPathSeparator(),r=i.fs,a=e.split(n);o(2,a,t)},n.copyFile=function(e,t,o){var n=i.fs;try{var a=r(t),s=n.createWriteStream(a),c=n.createReadStream(e),l=!1;c.on("end",function(){l||n.rename(a,t,o)}),c.on("error",function(e){l=!0,o(e)}),c.pipe(s)}catch(d){o(d)}},n.normaliseTempFileName=function(e){return a(e)},n.getFileExtension=function(e){var t=e&&e.replace(/^.*[\\\/]/,""),o=t?t.lastIndexOf("."):-1;return-1!==o?t.substr(o+1).toLowerCase():void 0},n.recursiveDeleteDirectory=function(e,t){var o=i.getPathSeparator(),r=i.fs,a=function(e){e&&"ENOENT"===e.code&&(e=null),t&&t(e)};r.exists(e,function(t){t?r.readdir(e,function(t,i){function s(t){t&&"ENOENT"===t.code&&(t=null),c=c||t,l++,l===i.length&&(c?a(c):r.rmdir(e,a))}if(t)return void a(t);if(!i||0===i.length)return void r.rmdir(e,a);var c=null,l=0;i.forEach(function(t){var i=e+o+t;r.stat(i,function(e,t){c=c||e,t&&t.isDirectory()?n.recursiveDeleteDirectory(i,s):r.unlink(i,s)})})}):a(null)})},n.moveLibrary=function(e,t,o){var n=i.fs;if(t===e.id)return void o(null);var r=e._collection._getCompositeDir(t),a=e._getCompositeDir(),s=e._collection._getRenditionCacheDir(t),c=e._getRenditionCacheDir();n.rename(r,a,function(t){return t?void o(t):(e._dcxComposite.path=a,void n.rename(s,c,o))})},n.readLibraryDirectory=function(e,t){var o=i.fs,r=e._getTempDir();n.recursiveDeleteDirectory(r,function(){var i=e._getCompositeDir();o.readdir(i,t)})},n.doesRootDirExist=function(e,t){var o=i.fs,n=e._getCompositeDir();o.exists(n,function(e){t(null,e)})},n.deleteLibraryFromDisk=function(e,t,o){if(i.hasFileSystem()){var r=e._getCompositeDir(t),a=e._getRenditionCacheDir(t);n.recursiveDeleteDirectory(r,function(){n.recursiveDeleteDirectory(a,o)})}else o&&o(null)},n.writeJSONData=function(e,t,o,r){var a=i.fs;n.ensurePathExists(e,function(n){if(n)return void r(n);var s=e+i.getPathSeparator()+t,c=s+".TEMP_"+i.uuid();a.writeFile(c,JSON.stringify(o,void 0,2),"utf8",function(e){return e?void r(e):void a.rename(c,s,r)})})},n.readJSONData=function(e,t){var o=i.fs;o.readFile(e,"utf8",function(e,o){if(e){if("ENOENT"===e.code)return t(null)}else try{o=o&&JSON.parse(o)}catch(i){o=void 0,e=i}t(e,o)})},n}),i("utils/AdobeLibraryErrorUtils",["require","exports","module","../components/dcx-js/src/AdobeDCXError","../AdobeLibraryError"],function(e,t,o){"use strict";var i=e("../components/dcx-js/src/AdobeDCXError"),n=e("../AdobeLibraryError"),r={};return r.getErrorStatusCode=function(e){if(e){var t=e.code===i.UNEXPECTED_RESPONSE&&e.response&&e.response.statusCode;return t?t:e.underlyingError?r.getErrorStatusCode(e.underlyingError):void 0}},r.getSyncError=function(e,t,o){if(e){var a,s=r.getErrorStatusCode(e);return a=e.code===i.SERVICE_IS_INACTIVE?new n(n.LOGGED_OUT,"no access token: call updateAccessToken() and try again",t,e):e.code===i.NETWORK_ERROR?new n(n.NETWORK_ERROR,"error connecting to server",t,e):e.code===i.EXCEEDS_QUOTA?new n(n.EXCEEDS_QUOTA,"push failed due to insufficient remaining quota",t,e):e.code===i.OUT_OF_SPACE?new n(n.OUT_OF_SPACE,"not enough disk space",t,e):e.code===i.NOT_IMPLEMENTED?new n(n.NOT_IMPLEMENTED,"tried to call an API not implemented on the server",t,e):e.code===i.RETRYABLE_SERVER_ERROR?new n(n.RETRYABLE_SERVER_ERROR,"intermittent server failure - can retry later",t,e):e.code===i.INVALID_DATA||e.code===i.INVALID_JSON?new n(n.CORRUPTED_LIBRARY,"unable to read manifest",t,e):s&&o&&o[s]?new n(o[s],"server returned "+s+"response",t,e):new n(n.TRANSFER_ERROR,"something went wrong during a push/pull operation",t,e)}},r.getCommitError=function(e,t,o){if(e){var r,a=o?" - "+o:"";return r=e.code===i.INVALID_DATA||e.code===i.INVALID_JSON?new n(n.CORRUPTED_LIBRARY,"unable to read manifest"+a,t,e):e.code===i.OUT_OF_SPACE?new n(n.OUT_OF_SPACE,"not enough disk space"+a,t,e):new n(n.FS_ERROR,"filesystem error"+a,t,e)}},r.getErrorPriority=function(e){var t=[n.EXCEEDS_MAX_LIBRARY_SIZE,n.THUMBNAIL_NOT_AVAILABLE,n.BROKEN_LINK,n.URL_VALIDATION_FAILED,n.CORRUPTED_LIBRARY,n.TRANSFER_ABORTED,n.TRANSFER_ERROR,n.NETWORK_ERROR,n.EXCEEDS_QUOTA,n.RETRYABLE_SERVER_ERROR,n.LOGGED_OUT,n.FILE_TOO_LARGE,n.FS_ERROR,n.OUT_OF_SPACE,n.ACCESS_DENIED,n.NOT_ALLOWED,n.DELETED_LOCALLY,n.REQUIRES_FILESYSTEM,n.NOT_SUPPORTED,n.NOT_IMPLEMENTED,n.INVALID_PARAMETER,n.READ_ONLY],o=e&&e.code&&t.indexOf(e.code);return void 0!==o?o:-1},r.errorToString=function(e){var t="";return e&&(e.message&&(t+=e.message),e.libraryId&&(t+=" library: "+e.libraryId),e.underlyingError?t+="\n<- "+r.errorToString(e.underlyingError):e.response&&e.response.statusCode&&(t+=": "+e.response.statusCode),e.failedComponents&&(t+="\n<- Failed Components:",e.failedComponents.forEach(function(e){var o=e.component&&e.component.id,i=e.error,n=i&&i.message,r=i&&i.response&&i.response.statusCode;t+="\n    ["+o+"] "+n+(r?": "+r:"")}))),t},r.isErrorCode=function(e){return e?n.hasOwnProperty(e)&&n[e]===e:!1},r}),i("utils/AdobeLibrarySyncUtils",["require","exports","module","../AdobeLibraryConfig","../AdobeLibraryError","../components/dcx-js/src/AdobeDCXUtil"],function(e,t,o){"use strict";var i=e("../AdobeLibraryConfig"),n=e("../AdobeLibraryError"),r=e("../components/dcx-js/src/AdobeDCXUtil"),a={};a.getBackoffTicks=function(e){var t=i.BACKOFF_INTERVALS,o=Math.max(0,Math.min(e,t.length-1));return t[o]-1},a.getRetryAfterHeader=function(e){if(e){var t=e["retry-after"]||e["Retry-After"];if(t)try{var o=parseInt(t,10);if(o)return Math.max(0,o);var n=Date.parse(t);if(n){var r=(new Date).valueOf(),a=Math.max(0,n-r)/1e3,s=Math.floor(Math.random()*i.RETRY_RANDOM_SECONDS);return a+s}}catch(c){}}return 0},a.getLocationHeader=function(e){if(e){var t=e.location||e.Location;if(t)return t}},a.getContentTypeHeader=function(e){if(e){var t=e["content-type"]||e["Content-Type"];if(t){var o=t.indexOf(";");return o>0&&(t=t.substring(0,o)),t}}},a.getContentLengthHeader=function(e){if(e){var t=e["content-length"]||e["Content-Length"];return Number(t)||void 0}},a.isUnrecoverableClientError=function(e,t){return e?e>=400&&500>e&&(401!==e||!!t)&&407!==e&&408!==e:!1};var s=function(e,t){return t.some(function(t){if(e===t)return!0;var o=e.indexOf("."+t);return-1!==o&&o===e.length-t.length-1})};return a.isAdobeDomain=function(e){return e?s(e,i.ADOBE_AUTHENTICATED_DOMAINS):!1},a.validateURL=function(e){if(!e)return new n(n.URL_VALIDATION_FAILED,"URL not specified");var t=r.parseURI(e);if("https"!==t.scheme)return new n(n.URL_VALIDATION_FAILED,"URL must be https://");var o=a.isAdobeDomain(t.authority),c=o||s(t.authority,i.WHITELISTED_DOMAINS);return c?null:new n(n.URL_VALIDATION_FAILED,"URL domain not in whitelist")},a}),i("AdobeLibraryRepresentation",["require","exports","module","./AdobeLibraryServices","./AdobeLibraryConfig","./AdobeLibraryError","./utils/AdobeLibraryMimeTypeUtils","./utils/AdobeLibraryManifestUtils","./utils/AdobeLibraryFileUtils","./utils/AdobeLibraryErrorUtils","./utils/AdobeLibrarySyncUtils"],function(e,t,o){"use strict";function i(e,t,o){this._element=e,this._dcxNode=t,this._dcxComponent=o,this._deletedLocally=!1,this._pendingDownloadCallbacks=[]}var n=e("./AdobeLibraryServices"),r=e("./AdobeLibraryConfig"),a=e("./AdobeLibraryError"),s=e("./utils/AdobeLibraryMimeTypeUtils"),c=e("./utils/AdobeLibraryManifestUtils"),l=e("./utils/AdobeLibraryFileUtils"),d=e("./utils/AdobeLibraryErrorUtils"),p=e("./utils/AdobeLibrarySyncUtils");return i.prototype._markDeletedLocally=function(e){this._deletedLocally=e},i.prototype._toJSON=function(){var e={id:this.id,type:this.type,relationship:this.relationship};return n.hasFileSystem()&&(e._componentPath=this._getComponentPath()),e},i.prototype._getOrder=function(){return this._getDCXElement().getValue(r.REPRESENTATION_ORDER_KEY)||0},i.prototype._setComponentInBrowser=function(e,t,o){var i=this,n=this._element._library._collection._syncManager;n.uploadNewComponentForRepresentation(e,t,this,function(e,t){if(c.checkDeletedState(i,o))return void o(e);if(e)return void o(e);c.copyCustomDCXData(i._dcxNode,t);var n=i._element._library._dcxBranch;n.removeChild(i._dcxNode),i._dcxComponent=t,delete i._dcxNode,i._commit(),o(null)})},i.prototype._setComponentFromPath=function(e,t,o){var i=n.fs,s=this,d=e&&n.getFileNameFromPath(e),p=l.getFileExtension(d),u=this.id+"."+p;i.stat(e,function(i,l){return l&&l.size>r.MAX_COMPONENT_SIZE?void o(new a(a.FILE_TOO_LARGE,"File exceeds maximum size for a representation")):void n.storageInterface.notifyStartWrite(s._element._library,[],function(){var i=s._element._library._dcxBranch;i.addComponent(d,s.type,s.relationship,u,e,t,void 0,s._element._dcxNode,s.id,function(e,t){if(!c.checkDeletedState(s,o)){if(e)return void o(e);c.copyCustomDCXData(s._dcxNode,t),i.removeChild(s._dcxNode),s._dcxComponent=t,delete s._dcxNode,s._commit(),o(null)}})})})},i.prototype._setComponent=function(e,t,o,i){function r(e){return c.checkDeletedState(h,i)?void 0:e?void i(d.getCommitError(e,h._element._library.id,"error writing representation contents")):void h._setComponentFromPath(p,!1,i)}function a(){"buffer"===t?u.writeFile(p,e,r):u.writeFile(p,e,t,r)}var p,u=n.fs,h=this,_=this.element.library.collection._getTempDir();l.ensurePathExists(_,function(e){if(!c.checkDeletedState(h,i)){if(e)return void i(d.getCommitError(e,h._element._library.id,"error creating temp directory"));if(!o){var t=s.getExtensions(h.type)[0];o=h.id+"."+t}p=_+n.getPathSeparator()+o,a()}})},i.prototype._getCurrentComponentPath=function(){return this._dcxComponent?this._element._library._dcxBranch.assetOfComponent(this._dcxComponent):void 0},i.prototype._getComponentPath=function(e,t){if(!e)return this._getCurrentComponentPath();if(this.isExternalLink)this._getExternalLinkPath(e);else if(this._dcxComponent){var o=this._getCurrentComponentPath();if(o||t)e(null,o);else{var i=this,n=this._element._library;n._networkLock.obtain(function(t){if(t)return void e(t);if(c.checkDeletedState(i,e))return void n._networkLock.release();n._setSyncState("downloading");var o=n._collection._syncManager;o.downloadRepresentation(i,function(t){if(n._networkLock.release(),n._setSyncState(),!c.checkDeletedState(i,e)){if(t)return void e(d.getSyncError(t,i._element._library.id));n._commit(!0,!0),i._getComponentPath(e,!0)}})})}}else e(null)},i.prototype._setRenditionCache=function(e,t,o,i){
var n=this.element;n._lock.obtain(function(){n._setRenditionCache(e,t,o),n._lock.release(),i()})},i.prototype._getCachedExternalLinkPath=function(e){var t=null,o=this.element._lookupRenditionPath(this.id);if(e||o!==r.RENDITION_CACHE_PLACEHOLDER||(o=void 0),"RENDITION_NOT_AVAILABLE"===o&&(o=a.BROKEN_LINK),d.isErrorCode(o)&&(t=new a(o,"Broken link, or access denied",this.element.library.id),o=void 0),!t&&!o){var i=this._dcxNode.getValue(r.LINK_URL_KEY);t=p.validateURL(i)}return{err:t,path:o}},i.prototype._getExternalLinkPath=function(e){var t=this,o=this.element.library,i=o.collection,l=i._getTempDir(),u=this._getCachedExternalLinkPath();if(u.err||u.path)return void e(u.err,u.path);if(r.SHARED_LOCAL_STORAGE)return void n.storageInterface.downloadExternalLink(t,e);if(this._pendingDownloadCallbacks.push(e),!(this._pendingDownloadCallbacks.length>1)){var h=function(e,o){var i=t._pendingDownloadCallbacks;t._pendingDownloadCallbacks=[],i.forEach(function(t){t(e,o)})},_=function(e,o,n){i._updateExternalLinkDownloadProgress(t,e,o,n)},f=function(e,i){var r=function(t,o){_(void 0,void 0,e),h(t,o)};return e?void r(e):d.isErrorCode(i)?void t._setRenditionCache(t.id,i,!0,function(){r(new a(i,"Broken link, or access denied",o.id))}):void t.element.setThumbnailCache(t.id,i,function(e,o){n.storageInterface.notifyDownloadRendition(t.element),r(e,o)})},m=this._dcxNode.getValue(r.LINK_URL_KEY),y=(new Date).valueOf();n.log("Downloading from external URL: "+m),i._syncManager.getAssetFromURL(m,{},l,_,function(e,o,r,l){if(n.log("Finished downloading from external URL: "+((new Date).valueOf()-y)+"ms"),!c.checkDeletedState(t,f)){var u=e&&e.response&&e.response.statusCode;if(p.isUnrecoverableClientError(u,i.isPublic))return void f(null,a.BROKEN_LINK);if(e)return void f(d.getSyncError(e));var h=p.getContentTypeHeader(l&&l.headers)||t.type,_=s.getExtensions(h)[0]||"data",m=o+"."+_;n.fs.rename(o,m,function(e){return e?void f(d.getCommitError(e)):void f(null,m)})}})}},i.prototype._testExternalLink=function(e){var t=this,o=this._getCachedExternalLinkPath(!0);if(o.err)return void e(null,!1);if(o.path)return void e(null,!0);var i=this.element.library.collection,s=this._dcxNode.getValue(r.LINK_URL_KEY);i._updateExternalLinkDownloadProgress(this,0,1);var c=function(o,n){i._updateExternalLinkDownloadProgress(t),e(o,n)},l=(new Date).valueOf();n.log("HEAD request of external URL: "+s),n.storageInterface.doHeadRequestOfURL(i,s,function(e,o){if(n.log("Finished HEAD request of external URL: "+((new Date).valueOf()-l)+"ms"),e)return void c(null,!0);var s=o&&o.statusCode;p.isUnrecoverableClientError(s,i.isPublic)?t._setRenditionCache(t.id,a.BROKEN_LINK,!0,function(){c(null,!1)}):s&&s>=200&&400>s?t._setRenditionCache(t.id,r.RENDITION_CACHE_PLACEHOLDER,!1,function(){c(null,!0)}):c(null,!0)})},i.prototype._getDCXElement=function(){return this._dcxComponent||this._dcxNode},i.prototype._commit=function(){this._element._commit()},i.prototype.jasmineToString=function(){return this.toString()},Object.defineProperties(i.prototype,{id:{get:function(){return this._getDCXElement().id},set:function(e){throw new a(a.READ_ONLY,"Cannot change the id of an existing representation",this._element._library.id)}},element:{get:function(){return this._element},set:function(e){throw new a(a.READ_ONLY,"element is a read-only property",this._element._library.id)}},isWritable:{get:function(){return this._element.isWritable},set:function(){throw new a(a.READ_ONLY,"isWritable is a read-only property",this._element._library.id)}},type:{get:function(){var e=this._getDCXElement().type;return e===r.LINK_REPRESENTATION_TYPE&&(e=this._getDCXElement().getValue(r.LINK_TYPE_KEY)),e},set:function(e){throw new a(a.READ_ONLY,"Cannot change the content type of an existing representation",this._element._library.id)}},relationship:{get:function(){return this._dcxComponent?this._dcxComponent.relationship:this._dcxNode.getValue(r.RELATIONSHIP_KEY)||this._dcxNode.getValue("relationship")},set:function(e){this._element._validateRelationship(e,this),this._dcxComponent?this._dcxComponent.relationship=e:this._dcxNode.setValue(r.RELATIONSHIP_KEY,e)}},width:{get:function(){return this._dcxComponent?this._dcxComponent.getValue("width"):this._dcxNode.getValue(r.WIDTH_KEY)},set:function(e){if(c.checkDeletedState(this),!this.isWritable)throw new a(a.NOT_ALLOWED,"you do not have write access to this library",this._element._library.id);if(!this._dcxComponent&&!this.isExternalLink)throw new a(a.INVALID_PARAMETER,"Cannot set width on a representation without contents",this._element._library.id);if("number"!=typeof e||0>e)throw new a(a.INVALID_PARAMETER,"Invalid width",this._element._library.id);this._dcxComponent?this._dcxComponent.setValue("width",e):this._dcxNode.setValue(r.WIDTH_KEY,e),this._commit()}},height:{get:function(){return this._dcxComponent?this._dcxComponent.getValue("height"):this._dcxNode.getValue(r.HEIGHT_KEY)},set:function(e){if(c.checkDeletedState(this),!this.isWritable)throw new a(a.NOT_ALLOWED,"you do not have write access to this library",this._element._library.id);if(!this._dcxComponent&&!this.isExternalLink)throw new a(a.INVALID_PARAMETER,"Cannot set height on a representation without contents",this._element._library.id);if("number"!=typeof e||0>e)throw new a(a.INVALID_PARAMETER,"Invalid height",this._element._library.id);this._dcxComponent?this._dcxComponent.setValue("height",e):this._dcxNode.setValue(r.HEIGHT_KEY,e),this._commit()}},isFullSize:{get:function(){return this._getDCXElement().getValue(r.IS_FULL_SIZE_KEY)},set:function(e){if(c.checkDeletedState(this),!this.isWritable)throw new a(a.NOT_ALLOWED,"you do not have write access to this library",this._element._library.id);if(!this._dcxComponent&&!this.isExternalLink)throw new a(a.INVALID_PARAMETER,"Cannot set isFullSize on a representation without contents",this._element._library.id);if("boolean"!=typeof e)throw new a(a.INVALID_PARAMETER,"Invalid isFullSize",this._element._library.id);this._getDCXElement().setValue(r.IS_FULL_SIZE_KEY,e),this._commit()}},contentLength:{get:function(){if(this.isExternalLink)return this._dcxNode.getValue(r.LENGTH_KEY);if(this._dcxComponent){if(void 0===this._dcxComponent.length&&n.hasFileSystem()){var e=this._getCurrentComponentPath(),t="statSync";try{var o=n.fs[t](e);return o&&o.size}catch(i){}}return this._dcxComponent.length}},set:function(e){if(!this.isExternalLink)throw new a(a.READ_ONLY,"setContentLength can only be used for an externally-linked representation",this._element._library.id);if("number"!=typeof e||0>e)throw new a(a.INVALID_PARAMETER,"Invalid content length",this._element._library.id);this._dcxNode.setValue(r.LENGTH_KEY,e),this._commit()}},isDeletedLocally:{get:function(){return this._deletedLocally},set:function(e){throw new a(a.READ_ONLY,"isDeletedLocally is a read-only property",this._element._library.id)}},isExternalLink:{get:function(){return void 0!==this._dcxNode&&this._dcxNode.type===r.LINK_REPRESENTATION_TYPE},set:function(e){throw new a(a.READ_ONLY,"isExternalLink is a read-only property",this._element._library.id)}}}),i.prototype.isCompatibleType=function(e){if(this._dcxComponent){var t=l.getFileExtension(this._dcxComponent.path),o=s.getExtensions(e);if(-1===o.indexOf(t))return!1}return c.isCompatibleType(e,this.type)},i.prototype.toString=function(){return JSON.stringify(this._toJSON())},i.prototype.getValue=function(e,t){if(e===r.DL_NAMESPACE)throw new a(a.INVALID_PARAMETER,"Reserved namespace",this._element._library.id);var o=c.getDCXKey(e,t);return this._getDCXElement().getValue(o)},i.prototype.getValues=function(){return c.getCustomDCXData(this._getDCXElement())},i.prototype.setValue=function(e,t,o){if(c.checkDeletedState(this),!this.isWritable)throw new a(a.NOT_ALLOWED,"you do not have write access to this library",this._element._library.id);if(e===r.DL_NAMESPACE)throw new a(a.INVALID_PARAMETER,"Reserved namespace",this._element._library.id);var i,n=c.getDCXKey(e,t);try{i=JSON.parse(JSON.stringify(o))}catch(s){throw new a(a.INVALID_PARAMETER,"Value cannot be serialized to JSON",this._element._library.id)}this._getDCXElement().setValue(n,i),this._commit()},i.prototype.setContent=function(e,t,o,i){if(!c.checkDeletedState(this,i)){if(!this.isWritable)return void i(new a(a.NOT_ALLOWED,"you do not have write access to this library",this._element._library.id));if(this._dcxComponent||this.isExternalLink)return void i(new a(a.INVALID_PARAMETER,"Cannot modify representation content once set",this._element._library.id));if(n.hasFileSystem()){if(!c.checkEncoding(t,["utf8","ascii","base64","buffer"],i))return;this._setComponent(e,t,o,i)}else{if(void 0!==t)return void i(new a(a.INVALID_PARAMETER,"Encoding parameter not supported in-browser"));this._setComponentInBrowser(e,o,i)}}},i.prototype.setContentFromPath=function(e,t,o){return"function"==typeof t&&(o=t,t=!1),n.hasFileSystem()?c.checkDeletedState(this,o)?void 0:this.isWritable?this._dcxComponent||this.isExternalLink?void o(new a(a.INVALID_PARAMETER,"Cannot modify representation content once set",this._element._library.id)):void this._setComponentFromPath(e,!t,o):void o(new a(a.NOT_ALLOWED,"you do not have write access to this library",this._element._library.id)):void o(new a(a.REQUIRES_FILESYSTEM,"path-based APIs require a filesystem",this._element._library.id))},i.prototype.setContentFromURL=function(e,t,o,i){if(!n.hasFileSystem()&&!e)return void i(new a(a.NOT_IMPLEMENTED,"not yet implemented setContentFromURL without a filesystem",this._element._library.id));if(!c.checkDeletedState(this,i)){if(!this.isWritable)return void i(new a(a.NOT_ALLOWED,"you do not have write access to this library",this._element._library.id));if("boolean"!=typeof e)return void i(new a(a.INVALID_PARAMETER,"Invalid createLink parameter: must be Boolean",this._element._library.id));if(this._dcxComponent||this.isExternalLink)return void i(new a(a.INVALID_PARAMETER,"Cannot modify representation content once set",this._element._library.id));if(e)return this._dcxNode.setValue(r.LINK_TYPE_KEY,this._dcxNode.type),this._dcxNode.type=r.LINK_REPRESENTATION_TYPE,this._dcxNode.setValue(r.LINK_URL_KEY,t),this._commit(),void i(null);var l=this,u=this.element.library.collection,h=u._getTempDir();n.storageInterface.getAssetFromURL(u,t,o,h,function(e,t,o,r){if(e)return void i(d.getSyncError(e));if(!c.checkDeletedState(l,i)){var a=p.getContentTypeHeader(r&&r.headers);if(a){var u=s.getExtensions(a)[0],h=t+"."+u;n.fs.rename(t,h,function(e){return e?void i(d.getCommitError(e)):void l._setComponentFromPath(h,!1,i)})}else l._setComponentFromPath(t,!1,i)}})}},i.prototype.getContentPath=function(e){return n.hasFileSystem()?void(c.checkDeletedState(this,e)||this._getComponentPath(e)):void e(new a(a.REQUIRES_FILESYSTEM,"path-based APIs require a filesystem",this._element._library.id))},i.prototype.getCachedContentPath=function(){if(n.hasFileSystem()){if(this.isExternalLink){var e=this._getCachedExternalLinkPath();return e.path}return this._dcxComponent?this._getCurrentComponentPath()||void 0:void 0}},i.prototype.getContent=function(e,t){var o=n.fs,i=this;if(!c.checkDeletedState(this,t))if(n.hasFileSystem()){if(!c.checkEncoding(e,["utf8","ascii","base64","buffer"],t))return;this._getComponentPath(function(n,r){if(n||!r)return void t(n);if(!c.checkDeletedState(i,t)){var a=function(e,o){e&&d.getCommitError(e,i._element._library.id,"error reading content from disk"),t(e,o)};"buffer"===e?o.readFile(r,a):o.readFile(r,e,a)}})}else{if(!c.checkEncoding(e,["text","blob","arraybuffer"],t))return;if(!this._dcxComponent)return void t(null);var r=this._element._library._collection._syncManager;r.getSharedCloudContent(this,e,t)}},i.prototype.getContentURL=function(){if(this.isExternalLink)return this._dcxNode.getValue(r.LINK_URL_KEY);if(this._dcxComponent){var e=this._element._library._collection._syncManager;return e.getSharedCloudContentURL(this._dcxComponent)}},i.prototype.getAuthenticatedContentURL=function(e){var t=this.getContentURL(),o=this._element._library._collection._syncManager;o.appendAccessTokenToURL(t,e)},i.prototype.testExternalLink=function(e){return this.isExternalLink&&this.getContentURL()?void this._testExternalLink(e):void e(new a(a.INVALID_PARAMETER,"Not an external link",this._element._library.id))},i.prototype.getCachedExternalLinkError=function(){if(!this.isExternalLink||!this.getContentURL())return new a(a.INVALID_PARAMETER,"Not an external link",this._element._library.id);var e=this._getCachedExternalLinkPath();return e.err},i.prototype.getExternalLinkDownloadProgress=function(){return this.isExternalLink?this.element.library.collection._getExternalLinkDownloadProgress(this):void 0},i}),i("AdobeLibraryAnalytics",["require","exports","module","./AdobeLibraryServices","./AdobeLibraryConfig"],function(e,t,o){"use strict";function i(e){if(e.type){var t=e.type.match(/application\/vnd\.adobe\.element\.(.*)\+dcx/);return t&&2===t.length?t[1]:e.type}return null}function n(e){if(!e)return{};var t={libraryID:e.id,libraryElementCount:e._elements.length};return e.collaboration&&(t.libraryShared=e.collaboration),t}function r(e){var t=null;return e&&e.getValues().forEach(function(e){"trackingdata"===e.key&&(t||(t={}),t[e.namespace]=e.value)}),t}function a(e){if(!e)return{};var t=n(e._library);t.elementID=e.id,t.elementType=i(e);var o=e.getPrimaryRepresentation();if(o){var a=r(o);a&&(t.trackingData=JSON.stringify(a)),t.elementPrimaryType=o.type}return t}function s(e){if(!e)return{};var t=a(e._element);return t.representationType=e.type,t}function c(){return null!==u.analytics&&void 0!==u.analytics}function l(e){c()&&e&&u.analytics.reportError(e.code+(e.underlyingError?":"+e.underlyingError.code:""))}var d,p,u=e("./AdobeLibraryServices"),h=e("./AdobeLibraryConfig"),_=function(e){c()&&u.analytics.reportEvent("createLibrary",{libraryID:e.id})},f=function(e){c()&&u.analytics.reportEvent("deleteLibrary",n(e))},m=function(e){c()&&(d=e,p=Date.now(),u.analytics.reportEvent("createElement",a(e)))},y=function(e,t){if(c()){if(e===d&&Date.now()-p<h.ANALYTICS_ELEMENT_UPDATE_THRESHOLD)return;d=e,p=Date.now();var o=a(e);o.updateType=t?"info":"representation",u.analytics.reportEvent("updateElement",o)}},g=function(e,t,o){if(c()){var i=s(e);i.opType=t,i.details=o,u.analytics.reportEvent("useElement",i)}},v=function(e,t,o){if(c()){var i=a(e);i.opType=t,i.details=o,u.analytics.reportEvent("checkoutElement",i)}},A=function(e){c()&&u.analytics.reportEvent("deleteElement",a(e))},E=function(e,t){if(c()){d=e,p=Date.now();var o=a(e);o.oldLibraryID=t._library.id,o.oldElementID=t.id,u.analytics.reportEvent("copyElement",o)}},b=function(e,t){if(c()){d=e,p=Date.now();var o=a(e);o.oldLibraryID=t._library.id,o.oldElementID=t.id,u.analytics.reportEvent("moveElement",o)}},C=function(e){c()&&u.analytics.reportEvent("collisionLibrary",a(e))},L=function(e,t){if(c()){var o=a(e);o.opType=t,u.analytics.reportEvent("createLink",o)}},S=function(e){c()&&u.analytics.reportEvent("shareElementLink",a(e))},D=function(e){c()&&u.analytics.reportEvent("shareLibraryLink",n(e))},R=function(e,t){if(c()){var o=n(e);o.details=t,o.logs=!0,u.analytics.reportEvent("unexpectedState",o)}};return{reportCreateLibrary:_,reportDeleteLibrary:f,reportCreateElement:m,reportUpdateElement:y,reportCopyElement:E,reportMoveElement:b,reportUseElement:g,reportCheckoutElement:v,reportDeleteElement:A,reportCollisionElement:C,reportCreateLink:L,reportShareElementLink:S,reportShareLibraryLink:D,reportError:l,reportUnexpectedState:R}}),i("utils/AdobeLibraryLock",["require","exports","module"],function(e,t,o){"use strict";function i(){this._isLocked=!1,this._pendingContinuations=[]}return i.prototype.obtain=function(e,t){this._isLocked?this._pendingContinuations.push({continuation:e,thisObject:t}):(this._isLocked=!0,e.apply(t,[null]))},i.prototype.release=function(){if(this._pendingContinuations.length>0){var e=this._pendingContinuations.shift();setTimeout(function(){e.continuation.apply(e.thisObject,[null])})}else this._isLocked=!1},i.prototype.abortPendingOperations=function(e){var t=this._pendingContinuations;this._pendingContinuations=[],t.forEach(function(t){t.continuation.apply(t.thisObject,[e])})},i.prototype.isLocked=function(){return this._isLocked},i.prototype.hasPendingRequest=function(){return this._pendingContinuations.length>0},i}),i("utils/AdobeLibraryAsyncJoin",["require","exports","module","../AdobeLibraryError"],function(e,t,o){"use strict";function i(){this._operations=[],this._isRunning=!1}var n=e("../AdobeLibraryError");return i.prototype.addOperation=function(e,t,o){if(this._isRunning)throw new n(n.INVALID_PARAMETER,"Cannot add operations after calling run()");this._operations.push({operation:e,argsArray:t||[],thisObject:o})},i.prototype.run=function(e,t){function o(t,o,i){e&&e(t,o,i)}function i(e,i,p){if(e&&t&&t(e),!c){if(a=a||e,l[p])return c=!0,void o(new n(n.INVALID_PARAMETER,"Operation not valid: calls callback multiple times"));if(s++,d[p]=i,l[p]=!0,s===r){c=!0;var u=d.reduce(function(e,t){return e||t},!1)?!0:!1;o(a||null,u,d)}}}if(this._isRunning)throw new n(n.INVALID_PARAMETER,"Cannot call run() more than once");this._isRunning=!0;var r=this._operations.length;0===r&&o(null,!1,[]);var a,s=0,c=!1,l=[],d=[];this._operations.forEach(function(e,t){e.argsArray.push(function(e,o){i(e,o,t)}),e.operation.apply(e.thisObject,e.argsArray)})},i}),i("utils/AdobeLibraryRenditionUtils",["require","exports","module","../AdobeLibraryConfig","../AdobeLibraryServices","./AdobeLibraryAsyncJoin","./AdobeLibraryFileUtils","./AdobeLibraryErrorUtils"],function(e,t,o){"use strict";var i=e("../AdobeLibraryConfig"),n=e("../AdobeLibraryServices"),r=e("./AdobeLibraryAsyncJoin"),a=e("./AdobeLibraryFileUtils"),s=e("./AdobeLibraryErrorUtils"),c={},l={"application/x-indesign":!0,"application/postscript":!0,"application/illustrator":!0,"application/pdf":!0,"application/vnd.adobe.psremix":!0,"application/vnd.adobe.pstouch":!0,"application/vnd.adobe.ideas":!0,"application/vnd.adobe.ase":!0,"image/jpeg":!0,"image/jpg":!0,"image/pjpeg":!0,"image/tiff":!0,"image/gif":!0,"image/bmp":!0,"image/x-ms-bmp":!0,"image/svg+xml":!0,"image/png":!0,"image/x-png":!0,"image/jp2":!0,"image/psd":!0,"image/vnd.adobe.photoshop":!0,"application/photoshop":!0,"application/x-photoshop":!0,"image/raw":!0,"image/dng":!0,"image/x-adobe-dng":!0,"video/mp4":!0,"video/mpeg":!0,"video/x-ms-wmv":!0,"video/3gpp":!0,"video/3gpp2":!0,"video/quicktime":!0,"video/x-msvideo":!0,"video/x-flv":!0,"video/x-ms-asf":!0,"video/x-m4v":!0,"video/mp2t":!0,"application/mxf":!0,"application/x-shockwave-flash":!0,"application/vnd.adobe.brushes.brush+ucf":!0,"application/vnd.adobe.collage":!0,"application/vnd.adobe.proto":!0,"application/msword":!0,"application/msexcel":!0,"application/mspowerpoint":!0,"application/vnd.ms-publisher":!0,"application/vnd.openxmlformats-officedocument.wordprocessingml.document":!0,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":!0,"application/vnd.openxmlformats-officedocument.presentationml.presentation":!0,"application/vnd.adobe.charts+zip":!0,"text/plain":!0,"text/rtf":!0},d=function(e,t){var o=n.fs;o.stat(e,function(i,n){return i?void t(i):void(n&&n.isDirectory()?a.recursiveDeleteDirectory(e,t):o.unlink(e,t))})},p=function(e,t,o){var s=n.getPathSeparator(),c=n.fs;if(!e._dcxComposite.autoRemoveUnusedLocalFiles)return void o(null);var l={};Object.keys(t.renditions).forEach(function(o){var i=t.renditions[o];Object.keys(i).forEach(function(t){var o=i[t];l[o]=!0,delete e._pendingRenditionCacheItems[o]})});var p=e._getRenditionCacheDir();c.readdir(p,function(t,n){if(t)return void o(t);var c=new r;n.forEach(function(t){var o=a.normaliseTempFileName(t);t===i.RENDITION_CACHE_FILE||l[t]||e._pendingRenditionCacheItems[o]||c.addOperation(d,[p+s+t])}),c.run(o)})};return c.readRenditionCacheData=function(e,t){var o=n.getPathSeparator(),r=e._getRenditionCacheDir();a.readJSONData(r+o+i.RENDITION_CACHE_FILE,function(e,o){var i=o||{};i.renditions=i.renditions||{},t(null,i)})},c.writeRenditionCacheData=function(e,t,o){var n=e._getRenditionCacheDir();a.writeJSONData(n,i.RENDITION_CACHE_FILE,t,function(i){return i?void o(i):void p(e,t,o)})},c.copyRenditionCache=function(e,t,o,a){var c=t._library._getRenditionCacheDir()+n.getPathSeparator(),l=new r,d=o||{};Object.keys(d).forEach(function(t){var o=d[t];o===i.RENDITION_CACHE_PLACEHOLDER||s.isErrorCode(o)?e._renditionCache[t]=o:l.addOperation(e.setThumbnailCache,[t,c+o],e)}),i.SHARED_LOCAL_STORAGE?(l.run(),a(null)):l.run(a)},c.canComputeRenditionFromMimeType=function(e){return l[e]?!0:!1},c.canComputeRendition=function(e){var t=void 0!==e._dcxComponent;return t&&c.canComputeRenditionFromMimeType(e.type)?!0:!1},c.shouldPrefetchFullRendition=function(e){var t=i.FULL_RENDITION_CONFIG||{},o=t[e.type];if(!o)return!1;var n=!1;return Object.keys(o).forEach(function(t){var i=o[t];if("IF_NO_MATCHING_REPRESENTATION"===i.condition&&i.types){var r=e.representations.every(function(e){return-1===i.types.indexOf(e.type)});n=n||r}}),n},c.shouldPrefetchExternalLink=function(e){if(!e.isExternalLink)return!1;var t=i.EXTERNAL_LINK_PREFETCH||{};return t[e.element.type]?!0:!1},c.prefetchRenditionsForElement=function(e,t){if(!n.hasFileSystem())return void(t&&t(null));var o=new r,a=i.RENDITION_SIZES||{},s=a[e.type]||a["*"]||[];s.forEach(function(t){o.addOperation(e.getThumbnailPath,[t],e)}),c.shouldPrefetchFullRendition(e)&&o.addOperation(e.getThumbnailPath,[void 0],e),e.representations.forEach(function(e){c.shouldPrefetchExternalLink(e)?o.addOperation(e.getContentPath,[],e):e.isExternalLink&&o.addOperation(e.testExternalLink,[],e)}),o.run(function(e){t&&t(e)})},c.prefetchRenditions=function(e,t){if(!n.hasFileSystem())return void(t&&t(null));var o=new r;e.elements.forEach(function(e){o.addOperation(c.prefetchRenditionsForElement,[e],c)}),o.run(function(e){t&&t(e)})},c.addToRenditionSizeConfig=function(e){var t=i.RENDITION_SIZES,o=t["*"]||[];o=JSON.parse(JSON.stringify(o));var n=e["*"]||[];Object.keys(t).forEach(function(o){if(!e[o]){var i=t[o];n.forEach(function(e){-1===i.indexOf(e)&&i.push(e)}),t[o]=i}}),Object.keys(e).forEach(function(i){var n=t[i]||JSON.parse(JSON.stringify(o)),r=e[i];r.forEach(function(e){-1===n.indexOf(e)&&n.push(e)}),t[i]=n}),i.setParameter("RENDITION_SIZES",t)},c.addToFullRenditionConfig=function(e){var t=i.FULL_RENDITION_CONFIG;Object.keys(e).forEach(function(o){var i=t[o]||{},n=e[o];n.forEach(function(e){e.id&&(i[e.id]=e)}),t[o]=i}),i.setParameter("FULL_RENDITION_CONFIG",t)},c.addToPendingSetRenditionCache=function(e,t,o,i,n){e=e||{data:[],callbacks:[]};var r=[];return e.data.forEach(function(i,n){e.callbacks[n]||i.element!==t.id||i.size!==o||"CLEAR"!==i.path||r.unshift(n)}),r.forEach(function(t){e.data.splice(t,1),e.callbacks.splice(t,1)}),e.data.push({element:t.id,size:o,path:i}),e.callbacks.push(n),e},c}),i("utils/AdobeLibraryFeatureUtils",["require","exports","module","../AdobeLibraryServices"],function(e,t,o){"use strict";var i=e("../AdobeLibraryServices"),n={};return n.supportsClearRenditionCache=function(){var e=i.storageInterface.getServiceInfo(),t=e?e.apiVersion:0;return t>=7},n}),i("utils/AdobeLibraryListenerManager",["require","exports","module","../AdobeLibraryServices","../AdobeLibraryError"],function(e,t,o){"use strict";function i(e){this._restrictedTypes=e,this._listeners={}}var n=e("../AdobeLibraryServices"),r=e("../AdobeLibraryError");return i.prototype._checkType=function(e){if(this._restrictedTypes&&-1===this._restrictedTypes.indexOf(e)){var t="["+this._restrictedTypes.join(", ")+"]";throw new r(r.INVALID_PARAMETER,e+" is not allowed. Should be one of: "+t)}},i.prototype.add=function(e,t){this._checkType(e),this._listeners[e]=this._listeners[e]||[],this._listeners[e].push(t)},i.prototype.remove=function(e,t){this._checkType(e);var o=this._listeners[e];if(o){var i=o.indexOf(t);-1!==i&&o.splice(i,1)}},i.prototype.removeAll=function(e){e?(this._checkType(e),delete this._listeners[e]):this._listeners={}},i.prototype.notify=function(e,t){this._checkType(e);var o=this._listeners[e];o&&o.slice(0).forEach(function(e){try{e.apply(void 0,t||[])}catch(o){n.log("Error in listener callback: "+(o?o.toString():"")),o&&o.stack&&n.log(o.stack)}})},i.prototype.hasListeners=function(e){this._checkType(e);var t=this._listeners[e];return t&&t.length>0?!0:!1},i.prototype.forEach=function(e){var t=this._listeners;Object.keys(t).forEach(function(o){t[o].forEach(function(t){e(o,t)})})},i}),i("AdobeLibraryElement",["require","exports","module","./AdobeLibraryServices","./AdobeLibraryConfig","./AdobeLibraryRepresentation","./AdobeLibraryAnalytics","./AdobeLibraryError","./utils/AdobeLibraryLock","./utils/AdobeLibraryManifestUtils","./utils/AdobeLibraryFileUtils","./utils/AdobeLibraryRenditionUtils","./utils/AdobeLibraryErrorUtils","./utils/AdobeLibraryFeatureUtils","./utils/AdobeLibraryListenerManager"],function(e,t,o){"use strict";function i(e,t){this._library=e,this._renditionCache={},this._lock=new l,this._listenerManager=new f(["change"]),this._transactionCount=0,this._setDCXNode(t)}var n=e("./AdobeLibraryServices"),r=e("./AdobeLibraryConfig"),a=e("./AdobeLibraryRepresentation"),s=e("./AdobeLibraryAnalytics"),c=e("./AdobeLibraryError"),l=e("./utils/AdobeLibraryLock"),d=e("./utils/AdobeLibraryManifestUtils"),p=e("./utils/AdobeLibraryFileUtils"),u=e("./utils/AdobeLibraryRenditionUtils"),h=e("./utils/AdobeLibraryErrorUtils"),_=e("./utils/AdobeLibraryFeatureUtils"),f=e("./utils/AdobeLibraryListenerManager");return i.prototype._setDCXNode=function(e,t,o){var i=this;this._dcxNode=e,this._representations=[],this._deletedLocally=!1;var n=this._library._dcxBranch.getChildrenOf(e);n.forEach(function(e){var t=new a(i,e);i._representations.push(t)});var r=this._library._dcxBranch.getComponentsOf(e);r.forEach(function(e){var t=new a(i,void 0,e);i._representations.push(t)}),d.sortRepresentations(this._representations),o||this._clearRenditionCache(t,!1),this._displayName=void 0},i.prototype._markDeletedLocally=function(e){this._deletedLocally=e,this._representations.forEach(function(t){t._markDeletedLocally(e)}),e&&this._listenerManager.removeAll()},i.prototype._removeAllListeners=function(){this._listenerManager.removeAll()},i.prototype._toJSON=function(){var e={id:this.id,name:this.name,type:this.type,representations:[]};return this._representations.forEach(function(t){e.representations.push(t._toJSON())}),e.representations.sort(function(e,t){return e.type>t.type?1:e.type<t.type?-1:0}),e},i.prototype._addRepresentation=function(e,t){void 0!==t?this._representations.splice(t,0,e):this._representations.push(e)},i.prototype._removeRepresentation=function(e){var t=this._representations.indexOf(e);-1!==t&&this._representations.splice(t,1)},i.prototype._validateRelationship=function(e,t){if(-1===r.VALID_RELATIONS.indexOf(e))throw new c(c.INVALID_PARAMETER,"Unsupported relationship",this._library.id);if(this._representations.length>0&&"primary"===e){var o=this;this._representations.forEach(function(t){if(t!==e&&"primary"===t.relationship)throw new c(c.INVALID_PARAMETER,"Cannot have more than one primary representation",o._library.id)})}},i.prototype._doCreateRepresentation=function(e,t,o){var i=this._library._dcxBranch.addChild(void 0,void 0,void 0,this._dcxNode);if(i.type=e,i.setValue(r.RELATIONSHIP_KEY,t),void 0===o){var n=this.representations[this.representations.length-1],s=Math.max(this.representations.length,n?n._getOrder()+1:0);i.setValue(r.REPRESENTATION_ORDER_KEY,s)}else i.setValue(r.REPRESENTATION_ORDER_KEY,o),this._representations.forEach(function(e,t){if(t>=o){var i=e._getDCXElement(),n=i.getValue(r.REPRESENTATION_ORDER_KEY);void 0!==n&&i.setValue(r.REPRESENTATION_ORDER_KEY,n+1)}});var c=new a(this,i);return this._addRepresentation(c,o),c},i.prototype._lookupRenditionPath=function(e){var t="existsSync",o=n.getPathSeparator(),i=this._renditionCache[e];if(i&&i!==r.RENDITION_CACHE_PLACEHOLDER&&i){if(i===r.RENDITION_CACHE_PLACEHOLDER||h.isErrorCode(i))return i;var a=this._library._getRenditionCacheDir()+o+i;if(r.SHARED_LOCAL_STORAGE||n.fs[t](a))return a}},i.prototype._getNewRenditionPath=function(e,t){var o=this,i=n.getPathSeparator(),r=this._library._getRenditionCacheDir();p.ensurePathExists(r,function(a){if(!d.checkDeletedState(o,t)){var s=n.uuid()+"."+(e||"png"),c=r+i+s;t(a,c,s)}})},i.prototype._updateModifiedTime=function(){var e=(new Date).valueOf();this._dcxNode.setValue(r.MODIFIED_KEY,e)},i.prototype._updateCreatedTime=function(){var e=(new Date).valueOf();this._dcxNode.setValue(r.CREATED_KEY,e),this._dcxNode.setValue(r.MODIFIED_KEY,e)},i.prototype._clearRenditionCache=function(e,t){var o=this,i=this._renditionCache;this._renditionCache={};var a=t&&r.SHARED_LOCAL_STORAGE&&_.supportsClearRenditionCache();Object.keys(i).forEach(function(t){!e&&!o.getRepresentationById(t)||h.isErrorCode(i[t])?a&&n.storageInterface.setRenditionCache(o,t,"CLEAR"):o._renditionCache[t]=i[t]})},i.prototype._commit=function(e){this._displayName=void 0,this._updateModifiedTime(),this._clearRenditionCache(!0,!0),this._library._commit(),this._listenerManager.notify("change"),s.reportUpdateElement(this,e)},i.prototype._commitRenditionCache=function(){this._library._commit(!0,!0),this._listenerManager.notify("change")},i.prototype._setRenditionCache=function(e,t,o){this._renditionCache[e]=t,this._commitRenditionCache(),o&&(n.storageInterface.notifyDownloadRendition(this),this._listenerManager.notify("change"))},i.prototype._wrapOperation=function(e,t){var o=this._library._wrapOperation(function(){var o=this._library._wrapOperation(e,t);return this._updateModifiedTime(),o},this);return this._listenerManager.notify("change"),o},i.prototype.jasmineToString=function(){return this.toString()},Object.defineProperties(i.prototype,{id:{get:function(){return this._dcxNode.id},set:function(e){throw new c(c.READ_ONLY,"Cannot change the id of an existing element",this._library.id)}},library:{get:function(){return this._library},set:function(e){throw new c(c.READ_ONLY,"library is a read-only property",this._library.id)}},isWritable:{get:function(){return this._library.isWritable},set:function(){throw new c(c.READ_ONLY,"isWritable is a read-only property",this.id)}},name:{get:function(){return this._dcxNode.name||""},set:function(e){if(d.checkDeletedState(this),!this.isWritable)throw new c(c.NOT_ALLOWED,"you do not have write access to this library",this._library.id);this._dcxNode.name=e,this._commit(!0)}},displayName:{get:function(){return void 0===this._displayName&&(this._displayName=n.getDisplayName(this)||""),this._displayName},set:function(e){throw new c(c.READ_ONLY,"displayName is a read-only property",this._library.id)}},type:{get:function(){return this._dcxNode.type},set:function(e){throw new c(c.READ_ONLY,"Cannot change the type of an existing element",this._library.id)}},tags:{get:function(){return this._dcxNode.getValue("tags")||[]},set:function(e){if(d.checkDeletedState(this),!this.isWritable)throw new c(c.NOT_ALLOWED,"you do not have write access to this library",this._library.id);if(!e||e.constructor!==Array)throw new c(c.INVALID_PARAMETER,"tags must be an array",this._library.id);var t=e.every(function(e){return"string"==typeof e});if(!t)throw new c(c.INVALID_PARAMETER,"tags must be an array of strings",this._library.id);this._dcxNode.setValue("tags",e),this._commit()}},modified:{get:function(){return this._dcxNode.getValue(r.MODIFIED_KEY)},set:function(e){throw new c(c.READ_ONLY,"Cannot change the modified timestamp of an element directly",this._library.id)}},created:{get:function(){return this._dcxNode.getValue(r.CREATED_KEY)},set:function(e){throw new c(c.READ_ONLY,"Cannot change the created timestamp of an element directly",this._library.id)}},representations:{get:function(){return this._representations},set:function(){throw new c(c.READ_ONLY,"Cannot modify representation list directly",this._library.id)}},isDeletedLocally:{get:function(){return this._deletedLocally},set:function(e){throw new c(c.READ_ONLY,"isDeletedLocally is a read-only property",this._library.id);
}}}),i.prototype.toString=function(){return JSON.stringify(this._toJSON())},i.prototype.addChangeListener=function(e){d.checkDeletedState(this),this._listenerManager.add("change",e)},i.prototype.removeChangeListener=function(e){this._listenerManager.remove("change",e)},i.prototype.beginOperation=function(){if(d.checkDeletedState(this),!this.isWritable)throw new c(c.NOT_ALLOWED,"you do not have write access to this library",this.id);this._transactionCount++,this._library._beginOperation()},i.prototype.endOperation=function(){if(d.checkDeletedState(this),!this.isWritable)throw new c(c.NOT_ALLOWED,"you do not have write access to this library",this.id);this._transactionCount>0&&(this._transactionCount--,this._library._endOperation())},i.prototype.createRepresentation=function(e,t,o,i){if(d.checkDeletedState(this),!this.isWritable)throw new c(c.NOT_ALLOWED,"you do not have write access to this library",this._library.id);return this._wrapOperation(function(){if(e===r.LINK_REPRESENTATION_TYPE)throw new c(c.INVALID_PARAMETER,"Cannot create external link representation directly - use setContentFromURL instead",this._library.id);if(void 0!==o&&(0>o||o>this._representations.length))throw new c(c.INVALID_PARAMETER,"Invalid index",this._library.id);this._validateRelationship(t);var n=this._doCreateRepresentation(e,t,o);return i||this._clearRenditionCache(!1,!0),n},this)},i.prototype.removeRepresentation=function(e){if(d.checkDeletedState(this),!this.isWritable)throw new c(c.NOT_ALLOWED,"you do not have write access to this library",this._library.id);return this._wrapOperation(function(){this._removeRepresentation(e),e._dcxComponent?this._library._dcxBranch.removeComponent(e._dcxComponent):this._library._dcxBranch.removeChild(e._dcxNode),this._clearRenditionCache(!1,!0),e._markDeletedLocally(!0)},this)},i.prototype.removeAllRepresentations=function(){if(d.checkDeletedState(this),!this.isWritable)throw new c(c.NOT_ALLOWED,"you do not have write access to this library",this._library.id);return this._wrapOperation(function(){for(;this._representations[0];)this.removeRepresentation(this._representations[0])},this)},i.prototype.getPrimaryRepresentation=function(){var e;return this._representations.forEach(function(t){e||"primary"!==t.relationship||(e=t)}),e},i.prototype._getRenditionCandidate=function(e){var t,o,i,n,r,a,s,c,l=0;for(o=0;o<this._representations.length&&(i=this._representations[o],n=Math.max(i.width||0,i.height||0),r=i.isFullSize?Number.POSITIVE_INFINITY:n,a="primary"===i.relationship,s="rendition"===i.relationship,c=!t||a&&"primary"!==t.relationship||s&&"primary"!==t.relationship&&"rendition"!==t.relationship||s&&"rendition"===t.relationship&&r>l,c&&u.canComputeRendition(i)&&(t=i,l=r),!s||"image/png"!==i.type||!e||n!==e);o++);return t},i.prototype.getThumbnailURL=function(e,t){var o=this;d.checkDeletedState(this,t)||this._library._waitForCommit(function(){if(!d.checkDeletedState(o,t)){var i=o._getRenditionCandidate(e);if(i){var n=o._library._collection._syncManager;return void n.getSharedCloudRenditionUrl(i,e,t)}t(new c(c.THUMBNAIL_NOT_AVAILABLE,"no representation that can be converted into a thumbnail",o._library.id))}})},i.prototype.getThumbnailPath=function(e,t){var o=this;return n.hasFileSystem()?void(d.checkDeletedState(this,t)||this._library._waitForCommit(function(){if(!d.checkDeletedState(o,t)){if(r.SHARED_LOCAL_STORAGE)return void n.storageInterface.getRenditionPath(o,e,t);var i=function(e,i){o._lock.release(),t(e,i)};o._lock.obtain(function(){if(!d.checkDeletedState(o,i)){var t=this._lookupRenditionPath(e||"full");if(t)return void i(null,t);var r=this._getRenditionCandidate(e);if(r){if("rendition"===r.relationship&&"image/png"===r.type&&e&&Math.max(r.width||0,r.height||0)===e)return void r.getContentPath(i);var a=this._library._collection._syncManager;return void a.getSharedCloudRendition(r,e,function(t,r){return d.checkDeletedState(o,i)?void 0:t?void i(new c(c.THUMBNAIL_NOT_AVAILABLE,"error generating thumbnail from shared cloud",o._library.id,t)):void o._getNewRenditionPath(void 0,function(t,a,s){if(!d.checkDeletedState(o,i)){if(t)return void i(h.getCommitError(t,o._library.id,"unable to create thumbnail cache directory"));o._library._pendingRenditionCacheItems[s]=!0,n.fs.rename(r,a,function(t){if(!d.checkDeletedState(o,i)){if(t)return void i(h.getCommitError(t,o._library.id,"unable to write thumbnail to cache"));o._setRenditionCache(e||"full",s,!0),i(null,a)}})}})})}i(new c(c.THUMBNAIL_NOT_AVAILABLE,"no representation that can be converted into a thumbnail",o._library.id))}},o)}})):void t(new c(c.REQUIRES_FILESYSTEM,"path-based APIs require a filesystem",this._library.id))},i.prototype.setThumbnailCache=function(e,t,o){if("string"!=typeof t)return void o(new c(c.INVALID_PARAMETER,"path must be a string",this._library.id));if(!n.hasFileSystem())return void o(new c(c.REQUIRES_FILESYSTEM,"path-based APIs require a filesystem",this._library.id));if(!d.checkDeletedState(this,o)){if(r.SHARED_LOCAL_STORAGE)return void n.storageInterface.setRenditionCache(this,e,t,o);var i=this,a=function(e,t){i._lock.release(),o(e,t)};this._lock.obtain(function(){d.checkDeletedState(i,a)||this._getNewRenditionPath(p.getFileExtension(t),function(o,n,r){if(!d.checkDeletedState(i,a)){if(o)return void a(h.getCommitError(o,i._library.id,"unable to create thumbnail cache directory"));i._library._pendingRenditionCacheItems[r]=!0,p.copyFile(t,n,function(t){if(!d.checkDeletedState(i,a)){if(t)return void a(h.getCommitError(t,i._library.id,"unable to write thumbnail to cache"));i._setRenditionCache(e||"full",r,!1),a(null,n)}})}})},this)}},i.prototype.getReference=function(){return"cloud-asset://"+this._library._collection._syncManager.getElementRefDomain()+this._library._collection._syncManager.getElementRefPath()+"/"+this._library.id+";node="+this.id},i.prototype.getRepresentationById=function(e){var t;return this.representations.forEach(function(o){o.id===e&&(t=o)}),t},i}),i("AdobeLibraryFolder",["require","exports","module","./components/dcx-js/src/AdobeDCXError","./AdobeLibraryElement","./AdobeLibraryConfig","./AdobeLibraryAnalytics","./AdobeLibraryError","./AdobeLibraryServices","./utils/AdobeLibraryAsyncJoin","./utils/AdobeLibraryLock","./utils/AdobeLibraryRenditionUtils","./utils/AdobeLibraryManifestUtils","./utils/AdobeLibraryErrorUtils","./utils/AdobeLibraryFileUtils","./utils/AdobeLibraryMimeTypeUtils","./utils/AdobeLibraryListenerManager"],function(e,t,o){"use strict";function i(e,t){this._collection=e,this._dcxComposite=t,this._dcxBranch=t.current,this._listenerManager=new y(["change"]),this._writable=!0,this._filterCache={},this._transactionCount=0,this._commitInProgress=!1,this._pendingCommit=!1,this._onCommitCallbacks=[],this._dcxLock=new p,this._renditionCacheLock=new p,this._pendingRenditionCacheItems={},this._networkLock=new p,this._syncState=void 0,this._deletedLocally=!1,this._deletedFromServer=!1,this._waitForSyncToFinishCallbacks=[],this._errors=[],this._pushFailedDueToQuota=!1,this._numUpdateConflicts=0;var o=this._dcxBranch.getChildrenOf();o.forEach(function(e){e.name===a.ELEMENTS_NAME&&(this._dcxElementsNode=e)},this),this._dcxElementsNode||(this._dcxElementsNode=this._dcxBranch.addChild(a.ELEMENTS_NAME)),this._dcxCompositeRenditionMap=h.getCompositeRenditionMap(this._dcxBranch),this._elements=[];var i=this._dcxBranch.getChildrenOf(this._dcxElementsNode);i.forEach(function(e){var t=new r(this,e);this._addElementToFilter(t),this._elements.push(t)},this),l.hasFileSystem()||(this._dcxBaseBranch=this._dcxBranch.copy())}var n=e("./components/dcx-js/src/AdobeDCXError"),r=e("./AdobeLibraryElement"),a=e("./AdobeLibraryConfig"),s=e("./AdobeLibraryAnalytics"),c=e("./AdobeLibraryError"),l=e("./AdobeLibraryServices"),d=e("./utils/AdobeLibraryAsyncJoin"),p=e("./utils/AdobeLibraryLock"),u=e("./utils/AdobeLibraryRenditionUtils"),h=e("./utils/AdobeLibraryManifestUtils"),_=e("./utils/AdobeLibraryErrorUtils"),f=e("./utils/AdobeLibraryFileUtils"),m=e("./utils/AdobeLibraryMimeTypeUtils"),y=e("./utils/AdobeLibraryListenerManager");return i.prototype._markDeletedLocally=function(e){this._deletedLocally=e,this._elements.forEach(function(t){t._markDeletedLocally(e)}),e&&this._listenerManager.removeAll()},i.prototype._removeAllListeners=function(){this._listenerManager.removeAll(),this._elements.forEach(function(e){e._removeAllListeners()})},i.prototype._toJSON=function(){var e={id:this.id,name:this.name,elements:[],renditionCache:{}};return this._elements.forEach(function(t){e.elements.push(t._toJSON()),e.renditionCache[t.id]=JSON.parse(JSON.stringify(t._renditionCache))}),e},i.prototype._getRenditionCache=function(){var e={};return this._elements.forEach(function(t){e[t.id]=JSON.parse(JSON.stringify(t._renditionCache))}),e},i.prototype._setRenditionCache=function(e){this._elements.forEach(function(t){e[t.id]&&(t._renditionCache=e[t.id])})},i.prototype._loadRenditionCache=function(e){var t=this;u.readRenditionCacheData(this,function(o,i){!o&&i&&t._setRenditionCache(i.renditions),e(null)})},i.prototype._saveRenditionCache=function(e){var t=this;if(!l.hasFileSystem()||a.SHARED_LOCAL_STORAGE)return void(e&&e(null));var o=function(o){t._renditionCacheLock.release(),e&&e(o)};this._renditionCacheLock.obtain(function(){var e={};e.renditions=this._getRenditionCache(),u.writeRenditionCacheData(this,e,o)},this)},i.prototype._doCommit=function(e){function t(){if(e&&!a.SHARED_LOCAL_STORAGE){if(n._deletedLocally)return;n._collection._clearSyncErrors(),n._push(),n._collection._resetPollBackoff()}}function o(){var e=n._onCommitCallbacks;n._onCommitCallbacks=[],e.forEach(function(e){n._waitForCommit(e)}),t()}function i(e,t){e&&(e=_.getCommitError(e,n.id,t)),n._collection._reportCommitError(e)}var n=this;return l.hasFileSystem()?this._commitInProgress?void(this._pendingCommit=!0):(this._commitInProgress=!0,void l.storageInterface.commitManifest(this,function(t){i(t,"Failed to write composite to disk"),n._saveRenditionCache(function(t){i(t,"Failed to write rendition cache to disk"),n._commitInProgress=!1,n._pendingCommit?(n._pendingCommit=!1,0===n._transactionCount&&n._doCommit(e)):o()})})):void o()},i.prototype._waitForCommit=function(e){this._commitInProgress||this._transactionCount>0?this._onCommitCallbacks.push(e):e()},i.prototype._notifyChange=function(){this._listenerManager.notify("change"),this._collection._notifyChange()},i.prototype._commit=function(e,t){0===this._transactionCount&&(t||(this._updateModifiedTime(),this._notifyChange()),this._doCommit(!e))},i.prototype._wrapOperation=function(e,t){this._beginOperation();var o;try{o=e.call(t)}catch(i){throw this._transactionCount--,i}return this._endOperation(),o},i.prototype._beginOperation=function(){this._transactionCount++},i.prototype._endOperation=function(){this._transactionCount--,this._commit()},i.prototype._updateModifiedTime=function(){var e=(new Date).valueOf();this._dcxBranch.rootNode.setValue(a.MODIFIED_KEY,e)},i.prototype._updateCreatedTime=function(){var e=(new Date).valueOf();this._dcxBranch.rootNode.setValue(a.CREATED_KEY,e),this._dcxBranch.rootNode.setValue(a.MODIFIED_KEY,e)},i.prototype._checkRenditionType=function(e,t){if(!e||-1===a.VALID_LIBRARY_RENDITION_TYPES.indexOf(e)){if(t)return t(new c(c.INVALID_PARAMETER,"composite rendition type not supported: "+e)),!1;throw new c(c.INVALID_PARAMETER,"composite rendition type not supported: "+e)}return!0},i.prototype._setRenditionFromPath=function(e,t,o,i){if(!h.checkDeletedState(this,i)){var n=this._dcxCompositeRenditionMap[e],r=l.fs,s=this,d=t&&l.getFileNameFromPath(t),p=f.getFileExtension(d),u=l.uuid()+"."+p;r.stat(t,function(r,p){return r?void i(r):p&&p.size>a.MAX_COMPONENT_SIZE?void i(new c(c.FILE_TOO_LARGE,"File exceeds maximum size for a thumbnail")):void l.storageInterface.notifyStartWrite(s,[],function(){s._dcxBranch.addComponent(d,o,"rendition",u,t,!0,void 0,s._dcxBranch.rootNode,void 0,function(t,o){return t?void i(t):void(h.checkDeletedState(s,i)||(o.setValue(a.MODIFIED_KEY,(new Date).valueOf()),o.setValue(a.RENDITION_TYPE_KEY,e),n&&s._dcxBranch.removeComponent(n),s._dcxCompositeRenditionMap=h.getCompositeRenditionMap(s._dcxBranch),s._commit(),i(null)))})})})}},i.prototype._setRendition=function(e,t,o,i,n){function r(t){return t?void n(_.getCommitError(t,d.id,"error writing library rendition")):void(h.checkDeletedState(d,n)||d._setRenditionFromPath(e,s,i,n))}function a(){"buffer"===o?c.writeFile(s,t,r):c.writeFile(s,t,o,r)}var s,c=l.fs,d=this,p=this.collection._getTempDir();f.ensurePathExists(p,function(e){if(e)return void n(_.getCommitError(e,d.id,"error creating temp directory"));if(!h.checkDeletedState(d,n)){var t=m.getExtensions(i)[0],o=l.uuid()+"."+t;s=p+l.getPathSeparator()+o,a()}})},i.prototype._setRenditionInBrowser=function(e,t,o,i){var n=this,r=this._dcxCompositeRenditionMap[e],s=this._collection._syncManager,c=l.uuid();s.uploadNewComponentForLibrary(t,c,o,"rendition",this,function(t,o){return t?void i(t):void(h.checkDeletedState(n,i)||(o.setValue(a.MODIFIED_KEY,(new Date).valueOf()),o.setValue(a.RENDITION_TYPE_KEY,e),r&&n._dcxBranch.removeComponent(r),n._dcxCompositeRenditionMap=h.getCompositeRenditionMap(n._dcxBranch),n._commit(),i(null)))})},i.prototype._getFilterKey=function(e){var t=e&&-1!==a.ELEMENT_TYPE_FILTERS.indexOf(e);return t?e:"*"},i.prototype._removeElementFromFilter=function(e){var t=this._getFilterKey(e.type);if(this._filterCache[t]){var o=this._filterCache[t].indexOf(e);-1!==o&&this._filterCache[t].splice(o,1)}},i.prototype._addElementToFilter=function(e){var t=this._getFilterKey(e.type);this._filterCache[t]=this._filterCache[t]||[],this._filterCache[t].push(e)},i.prototype._doCreateElement=function(e,t){var o=this._dcxBranch.addChild(e,void 0,void 0,this._dcxElementsNode);o.path=o.id,o.type=t;var i=new r(this,o);return i._updateCreatedTime(),this._elements.push(i),this._addElementToFilter(i),i},i.prototype._doRemoveElement=function(e,t){var o=this._elements.indexOf(e);-1!==o&&this._elements.splice(o,1),this._removeElementFromFilter(e),t&&this._dcxBranch.removeChild(e._dcxNode),e._markDeletedLocally(!0)},i.prototype._doCopyDCXElement=function(e,t,o,i,n){var a=this;t._beginOperation(),l.storageInterface.notifyStartWrite(t,[this],function(){t._dcxBranch.copyChild(e._dcxNode,t._dcxElementsNode,void 0,i,i,function(i,s){if(!h.checkDeletedState(a,n)){if(i)return t._endOperation(),void n(i);var c=new r(t,s);t._addElementToFilter(c),t._elements.push(c);var d=function(){h.checkDeletedState(a,n)||(t._endOperation(),o&&a._wrapOperation(function(){a._doRemoveElement(e,!0)}),n(null,c))};l.hasFileSystem()?u.copyRenditionCache(c,e,e._renditionCache,d):d()}})})},i.prototype._doCopyElement=function(e,t,o,i){if(e._library!==this||-1===this._elements.indexOf(e))return void i(new c(c.INVALID_PARAMETER,"element doesn't exist in library",this.id));if(t._elements.length>=a.MAX_ELEMENTS)return void i(new c(c.EXCEEDS_MAX_LIBRARY_SIZE,"Library cannot have more than "+a.MAX_ELEMENTS+" elements",this.id));var n=e.id,r=t._elements.every(function(e){return e.id!==n});r||(n=l.uuid()),this._doCopyDCXElement(e,t,o,n,i)},i.prototype.jasmineToString=function(){return this.toString()},i.prototype._setSyncState=function(e){this._syncState!==e&&(this._syncState=e,this._collection._updateSyncState(),this._checkSyncFinishedAndNotify())},i.prototype._isSyncing=function(){return void 0!==this._syncState},i.prototype._checkSyncFinishedAndNotify=function(){if(!this._isSyncing()){var e=this._waitForSyncToFinishCallbacks;this._waitForSyncToFinishCallbacks=[],e.forEach(function(e){e()})}},i.prototype._waitForSyncToFinish=function(e){this._waitForSyncToFinishCallbacks.push(e),this._checkSyncFinishedAndNotify()},i.prototype._getClientData=function(){var e={};if(this._dcxComposite.clientDataString)try{e=JSON.parse(this._dcxComposite.clientDataString)}catch(t){}return e},i.prototype._getClientDataValue=function(e){var t=this._getClientData();return t[e]},i.prototype._setClientDataValue=function(e,t){var o=this._getClientData();o[e]=t,this._dcxComposite.clientDataString=JSON.stringify(o)},i.prototype._setCollaboration=function(e){var t=e&&e.collaboration&&e.collaboration.toLowerCase(),o=e&&e.collaboration_role&&e.collaboration_role.toLowerCase(),i=this._getClientDataValue(a.DATA_COLLABORATION_ROLE);if(this.collaboration!==t||i!==o){var n=h.collaborationStateToDCX(t);this._dcxComposite.collaborationType=n,this._setClientDataValue(a.DATA_COLLABORATION_ROLE,o),this._commit(!0,!0),this._notifyChange()}},i.prototype._isDeletedError=function(e){var t=e&&(e.code===n.NO_COMPOSITE||e.code===n.DELETED_COMPOSITE),o=e&&e.code===n.UNEXPECTED_RESPONSE&&e.response&&401===e.response.statusCode;return t||this.collection.isPublic&&o},i.prototype._isReadOnlyError=function(e){if("incoming"!==this.collaboration)return!1;var t=!1;return!e||e.code!==n.COMPONENT_UPLOAD_ERROR&&e.code!==n.UNEXPECTED_RESPONSE||(e.code===n.UNEXPECTED_RESPONSE&&e.response&&403===e.response.statusCode&&(t=!0),e.code===n.COMPONENT_UPLOAD_ERROR&&Array.isArray(e.failedComponents)&&e.failedComponents.length>0&&(t=!0,e.failedComponents.forEach(function(e){e.error&&e.error.code===n.UNEXPECTED_RESPONSE&&e.error.response&&403===e.error.response.statusCode||(t=!1)}))),t},i.prototype._mergeAndSwitchToBranch=function(e,t,o){function i(t,i){if(!h.checkDeletedState(n,o)){if(t)return void o(_.getCommitError(t,n.id));l.log("Starting merge "+(c?"(local)":"(remote)")),i.name!==n.name&&(e.name=n.name);var f=e.rootNode.getValue(a.MODIFIED_KEY),m=Math.max(f||0,n.modified||0);i!==n._dcxBranch&&m&&f!==m&&e.rootNode.setValue(a.MODIFIED_KEY,m);var y=h.getCompositeRenditionMap(e),g=h.getCompositeRenditionMap(i);Object.keys(n._dcxCompositeRenditionMap).forEach(function(t){var o=n._dcxCompositeRenditionMap[t],i=g[t],r=y[t];if(!i||o.id!==i.id)if(r){var s=o.getValue(a.MODIFIED_KEY)||0,c=r.getValue(a.MODIFIED_KEY)||0;s>c&&(e.removeComponent(r),e.copyComponent(o,e.rootNode))}else e.copyComponent(o,e.rootNode)}),Object.keys(g).forEach(function(t){var o=n._dcxCompositeRenditionMap[t],i=g[t],r=y[t];!o&&r&&r.id===i.id&&e.removeComponent(r)});var v,A=e.getChildrenOf();A.forEach(function(e){e.name===a.ELEMENTS_NAME&&(v=e)}),v||(v=e.addChild(a.ELEMENTS_NAME));var E={},b=[],C=[],L=new d;n._elements.forEach(function(t){var o=t.id,d=t._dcxNode,p=t.modified,h=e.getChildWithId(o),_=h&&h.getValue(a.MODIFIED_KEY),f=i&&i.getChildWithId(o),m=f&&f.getValue(a.MODIFIED_KEY);if(p&&_&&!m&&(m=0),n._dcxBranch=e,!m&&!_||m&&!_&&p!==m){l.log("1: created locally");var y=e.copyChild(d,v,void 0,void 0,void 0);t._setDCXNode(y,!0)}else if(m&&!_&&p===m)l.log("2: deleted on server"),C.push(t);else if(m===p&&m===_)l.log("3: no changes"),t._setDCXNode(h,!0,!0);else if(m===p&&m!==_)l.log("4: updated on server"),t._setDCXNode(h,c),b.push(t);else if(m!==p&&m===_){l.log("5: updated locally");var g=e.replaceChild(d,void 0,void 0);t._setDCXNode(g,!0)}else if(m!==p&&m!==_){l.log("6: updated locally and on server (conflict)");var A=t._renditionCache;t._setDCXNode(h),b.push(t);var S=l.uuid(),D=e.copyChild(d,v,void 0,S,S),R=new r(n,D);n._addElementToFilter(R),n._elements.push(R),E[R.id]=!0,l.hasFileSystem()&&L.addOperation(u.copyRenditionCache,[R,t,A]),s.reportCollisionElement(t)}else l.log("ERROR: unexpected merge case: base="+m+", current="+p+", pulled="+_);n._dcxBranch=n._dcxComposite.current,E[o]=!0}),C.forEach(function(e){n._doRemoveElement(e,!1)}),n._dcxBranch=e,n._dcxElementsNode=v,n._dcxCompositeRenditionMap=h.getCompositeRenditionMap(e);var S=n._dcxBranch.getChildrenOf(n._dcxElementsNode);S.forEach(function(t){if(!E[t.id]){var o=t.getValue(a.MODIFIED_KEY),s=i&&i.getChildWithId(t.id),c=s&&s.getValue(a.MODIFIED_KEY);if(c&&o&&c===o)l.log("7: deleted locally"),e.removeChild(t);else{l.log("8: created on server");var d=new r(n,t);n._addElementToFilter(d),n._elements.push(d)}}}),n._transactionCount++,L.run(function(){h.checkDeletedState(n,o)||(n._transactionCount--,l.storageInterface.resolvePullWithBranch(n,e,p,c,function(t){if(!h.checkDeletedState(n,o)){if(t)return void o(_.getCommitError(t,n.id));l.hasFileSystem()||(n._dcxBaseBranch=e.copy()),a.SHARED_LOCAL_STORAGE||c||u.prefetchRenditions(n),b.forEach(function(e){e._listenerManager.notify("change")}),n._notifyChange(),o(null)}}))})}}var n=this,c=void 0!==t,p=e.localData;this._waitForCommit(function(){h.checkDeletedState(n,o)||(t?i(null,t):"unmodified"===n._dcxBranch.compositeState?i(null,n._dcxBranch):n._loadBaseBranch(i))})},i.prototype._pull=function(e){var t=this;if(!this._dcxComposite.href||!this._dcxBranch.isBound)return void e(null,!1);if(this._deletedFromServer)return void e(null,!1);var o=function(o,i){h.checkDeletedState(t,e)||(o&&t._collection._reportSyncError(o),t._setSyncState(),t._networkLock.release(),e(o,i))};this._networkLock.obtain(function(i){return i?void e(null):void(h.checkDeletedState(t,e)||(this._setSyncState("downloading"),this._collection._syncManager.pullComposite(this._dcxComposite,this._collection,function(i,n){return h.checkDeletedState(t,e)?void 0:t._isDeletedError(i)?void(l.hasFileSystem()&&"modified"===t._dcxBranch.compositeState&&"incoming"!==t.collaboration?(t._doRebindToServer(e),t._networkLock.release()):(t._deletedFromServer=!0,t._notifyChange(),o(null,!0))):i?void o(_.getSyncError(i,t.id)):n?void t._mergeAndSwitchToBranch(n,void 0,function(i){h.checkDeletedState(t,e)||o(i,!0)}):void o(null,!1)})))},this)},i.prototype._pushWithParameters=function(e,t){var o=this,i=function(e,o){t&&t(null,o)};if(!a.SYNCING_ENABLED)return void i(null,!1);if(this._collection._retryTimeoutId)return void i(null,!1);if(this._dcxBranch.isBound&&"modified"!==this._dcxBranch.compositeState)return void i(null,!1);if(this._deletedFromServer)return void i(null,!1);if(!this.isWritable)return void i(null,!1);if(this._pushPending)return void i(null,!1);var r=function(e,t){h.checkDeletedState(o,i)||(o._pushFailedDueToQuota=!1,e&&(o._collection._reportSyncError(e),e.code===c.EXCEEDS_QUOTA&&(o._pushFailedDueToQuota=!0)),o._setSyncState(),o._networkLock.release(),i(null,t))};this._pushPending=!0,this._networkLock.obtain(function(t){return t?void i(null,!1):void this._waitForCommit(function(){if(!h.checkDeletedState(o,i)){o._pushPending=!1;var t;l.hasFileSystem()||(t=o._dcxBranch.copy()),o._setSyncState("uploading"),o._collection._syncManager.pushComposite(o._dcxComposite,o._collection,e,function(e){if(!h.checkDeletedState(o,i)){if(o._isDeletedError(e))return void(l.hasFileSystem()&&"modified"===o._dcxBranch.compositeState&&"incoming"!==o.collaboration?(o._doRebindToServer(i),o._networkLock.release()):(o._deletedFromServer=!0,o._notifyChange(),r(null,!0)));if(o._isReadOnlyError(e))return l.log("Push failed due to read only. Reverting: "+o.id),void o._revert(function(e){e?(l.log("Error Reverting: "+o.id),r(e)):(o._setClientDataValue(a.DATA_COLLABORATION_ROLE,"viewer"),o._commit(!0,!0),o._waitForCommit(function(){o._notifyChange(),r(null,!1)}))});if(e&&e.code===c.TRANSFER_ABORTED)return void r(null,!0);if(e&&e.code===n.UPDATE_CONFLICT){if(l.log("Push failed due to conflict: "+o.id),o._numUpdateConflicts++,o._numUpdateConflicts<=a.MAX_UPDATE_CONFLICTS)return o._sync(!1,i),void o._networkLock.release();s.reportUnexpectedState(o,"updateConflict"),l.log("Reached maximum number of update-conflict retries: "+o.id)}return o._numUpdateConflicts=0,e&&e.code===n.COMPONENT_UPLOAD_ERROR&&(l.log("Push failed due to component upload failure: "+o.id),h.removeMissingLocalComponents(o,e.failedComponents)),e?void r(_.getSyncError(e,o.id)):void l.storageInterface.acceptPush(o,function(e){if(!h.checkDeletedState(o,i)){if(e)return void r(_.getCommitError(e,o.id),!0);l.hasFileSystem()||(o._dcxBaseBranch=t),r(null,!0)}})}})}})},this)},i.prototype._loadBaseBranch=function(e){var t=this;l.hasFileSystem()?t._dcxComposite.loadBaseBranch(function(o,i){t._waitForCommit(function(){e(o,i)})}):e(null,t._dcxBaseBranch)},i.prototype._revert=function(e){var t=this,o=t.collaboration,i=this._getClientDataValue(a.DATA_COLLABORATION_ROLE);t._loadBaseBranch(function(n,r){var s=r.copy();r.hasLocalStorage&&(s._localStorage=r._localStorage),t._mergeAndSwitchToBranch(s,t._dcxBranch,function(n){if(!n){var r=h.collaborationStateToDCX(o);t._dcxComposite.collaborationType=r,t._setClientDataValue(a.DATA_COLLABORATION_ROLE,i)}e(n)})})},i.prototype._push=function(e){this._pushWithParameters(!1,e)},i.prototype._abortPushOrPull=function(){this._networkLock.abortPendingOperations(new c(c.TRANSFER_ABORTED)),this._collection._syncManager.abortPushOrPull(this.id)},i.prototype._deleteFromServer=function(e,t){var o=this;if(!this._dcxComposite.href||!this._dcxBranch.isBound)return void t(null);if(this._deletedFromServer)return void t(null);this._deletingFromServerInProgress||this._abortPushOrPull(),this._deletingFromServerInProgress=!0;var i=function(e){o._deletingFromServerInProgress=!1,o._networkLock.release(),t(e)};this._networkLock.obtain(function(r){return r?void t(null):this._deletedFromDisk?void i(null):(this._setSyncState("uploading"),this._dcxBranch.compositeState="pendingDelete",this._commit(!0,!0),void this._waitForCommit(function(){return o._deletedFromDisk?void i(null):void o._collection._syncManager.pushDeletedComposite(o._dcxComposite,o._collection,o.collaboration,e,function(t){t?o._isDeletedError(t)?t=null:(e||t.code!==n.UPDATE_CONFLICT)&&(t=_.getSyncError(t,o.id),o._collection._reportSyncError(t)):o._deletedFromServer=!0,o._setSyncState(),i(t)})}))},this)},i.prototype._doRebindToServer=function(e){var t=this;this._deletedFromServer=!1;var o="incoming"===this.collaboration?"resetIdentity":"resetBinding",i=this.id;this._dcxComposite[o](function(o){if(!h.checkDeletedState(t,e)){if(o)return void e(o);t._transactionCount++,t.id!==i&&(t._collection._libraryIdMap[t.id]=t,delete t._collection._libraryIdMap[i]),f.moveLibrary(t,i,function(o){if(!h.checkDeletedState(t,e)){if(t._transactionCount--,o)return void e(o);t._collection._syncManager.prepareCompositeForPush(t._dcxComposite),t._setCollaboration(),t._commit(!1,!0),t._pushWithParameters(!0,e)}})}})},i.prototype._sync=function(e,t){function o(e,o){t&&n._waitForSyncToFinish(function(){t(e,o)})}function i(e,t){return h.checkDeletedState(n,o)?void 0:e?void o(e,t):void n._push(function(e,i){h.checkDeletedState(n,o)||o(e,t||i)})}var n=this;return a.SHARED_LOCAL_STORAGE||!a.SYNCING_ENABLED?void o(null,!1):this._collection._retryTimeoutId?void o(null,!1):(this._collection._clearSyncErrors(this.id),void(e?i(null,!1):this._pull(i)))},i.prototype._getCompositeDir=function(){return this._collection._getCompositeDir(this.id)},i.prototype._getRenditionCacheDir=function(){return this._collection._getRenditionCacheDir(this.id)},Object.defineProperties(i.prototype,{id:{get:function(){return this._publicId||this._dcxComposite.id},set:function(e){throw new c(c.READ_ONLY,"Cannot change the id of an existing library",this.id)}},collection:{get:function(){return this._collection},set:function(e){throw new c(c.READ_ONLY,"collection is a read-only property",this.id)}},isWritable:{get:function(){var e=this._getClientDataValue(a.DATA_COLLABORATION_ROLE);return this._writable&&"viewer"!==e},set:function(e){throw new c(c.READ_ONLY,"isWritable is a read-only property",this.id)}},name:{get:function(){return this._dcxComposite.name||""},set:function(e){if(h.checkDeletedState(this),!this.isWritable)throw new c(c.NOT_ALLOWED,"you do not have write access to this library",this.id);this._dcxComposite.name=e,this._commit()}},modified:{get:function(){return this._dcxBranch.rootNode.getValue(a.MODIFIED_KEY)},set:function(e){throw new c(c.READ_ONLY,"Cannot change the modified timestamp of a library directly",this.id)}},created:{get:function(){return this._dcxBranch.rootNode.getValue(a.CREATED_KEY)},set:function(e){throw new c(c.READ_ONLY,"Cannot change the created timestamp of a library directly",this.id)}},elements:{get:function(){return this._elements},set:function(){throw new c(c.READ_ONLY,"Cannot modify elements list directly",this.id)}},isDeletedFromServer:{get:function(){return this._deletedFromServer},set:function(){throw new c(c.READ_ONLY,"isDeletedFromServer is a read-only property",this.id)}},isDeletedLocally:{get:function(){return this._deletedLocally},set:function(e){throw new c(c.READ_ONLY,"isDeletedLocally is a read-only property",this.id)}},isQuotaExceeded:{get:function(){return this._pushFailedDueToQuota},set:function(){throw new c(c.READ_ONLY,"isQuotaExceeded is a read-only property",this.id)}},collaboration:{get:function(){var e=this._dcxComposite.collaborationType;return h.collaborationStateFromDCX(e)},set:function(){throw new c(c.READ_ONLY,"collaboration is a read-only property",this.id)}},syncState:{get:function(){return this._syncState},set:function(){throw new c(c.READ_ONLY,"syncState is a read-only property")}},syncProgress:{get:function(){var e=this._collection._syncProgressMap[this.id];return e&&e.progress},set:function(){throw new c(c.READ_ONLY,"syncProgress is a read-only property")}}}),i.prototype.toString=function(){return JSON.stringify(this._toJSON())},i.prototype.addChangeListener=function(e){h.checkDeletedState(this),this._listenerManager.add("change",e)},i.prototype.removeChangeListener=function(e){this._listenerManager.remove("change",e)},i.prototype.createElement=function(e,t){if(h.checkDeletedState(this),!this.isWritable)throw new c(c.NOT_ALLOWED,"you do not have write access to this library",this.id);if(this._elements.length>=a.MAX_ELEMENTS)throw new c(c.EXCEEDS_MAX_LIBRARY_SIZE,"Library cannot have more than "+a.MAX_ELEMENTS+" elements",this.id);return this._wrapOperation(function(){var o=this._doCreateElement(e,t);return s.reportCreateElement(o),o.beginOperation(),o},this)},i.prototype.removeElement=function(e){if(h.checkDeletedState(this),!this.isWritable)throw new c(c.NOT_ALLOWED,"you do not have write access to this library",this.id);return this._wrapOperation(function(){for(;e._transactionCount>0;)e.endOperation();this._doRemoveElement(e,!0),s.reportDeleteElement(e)},this)},i.prototype.copyElement=function(e,t,o){return h.checkDeletedState(this,o)?void 0:e?t?t.isWritable?this._doCopyElement(e,t,!1,function(t,i){return t?void o(t):(s.reportCopyElement(i,e),void o(null,i))}):void o(new c(c.NOT_ALLOWED,"you do not have write access to this library",t.id)):void o(new c(c.INVALID_PARAMETER,"No destination library specified",this.id)):void o(new c(c.INVALID_PARAMETER,"No element specified",this.id))},i.prototype.moveElement=function(e,t,o){return h.checkDeletedState(this,o)?void 0:this.isWritable?e?t?this===t?void o(new c(c.INVALID_PARAMETER,"Move must have a different destination library",this.id)):this._doCopyElement(e,t,!0,function(t,i){return t?void o(t):(s.reportMoveElement(i,e),void o(null,i))}):void o(new c(c.INVALID_PARAMETER,"No destination library specified",this.id)):void o(new c(c.INVALID_PARAMETER,"No element specified",this.id)):void o(new c(c.NOT_ALLOWED,"you do not have write access to this library",this.id))},i.prototype.getRenditionPath=function(e,t){if(!l.hasFileSystem())return void t(new c(c.REQUIRES_FILESYSTEM,"path-based APIs require a filesystem",this.id));if(!h.checkDeletedState(this,t)&&this._checkRenditionType(e,t)){var o=this._dcxCompositeRenditionMap[e];if(!o)return t(null);var i=this._dcxBranch.assetOfComponent(o);if(i)return t(null,i);var n=this;this._networkLock.obtain(function(e){if(e)return void t(e);if(h.checkDeletedState(n,t))return void n._networkLock.release();n._setSyncState("downloading");var i=n._collection._syncManager;i.downloadComponent(n._dcxBranch,o,function(e){return n._networkLock.release(),n._setSyncState(),e?void t(_.getSyncError(e,n.id)):void(h.checkDeletedState(n,t)||(n._commit(!0,!0),t(null,n._dcxBranch.assetOfComponent(o))))})})}},i.prototype.getRenditionURL=function(e){h.checkDeletedState(this),this._checkRenditionType(e);var t=this._dcxCompositeRenditionMap[e];if(t){var o=this._collection._syncManager;return o.getSharedCloudContentURL(t)}},i.prototype.getAuthenticatedRenditionURL=function(e,t){if(!h.checkDeletedState(this,t)&&this._checkRenditionType(e,t)){
var o=this.getRenditionURL(e);if(!o)return t(null);var i=this._collection._syncManager;i.appendAccessTokenToURL(o,t)}},i.prototype.setRendition=function(e,t,o,i,n){if(!h.checkDeletedState(this,n)&&this._checkRenditionType(e,n)){if(!t)return void n(new c(c.INVALID_PARAMETER,"content must exist",this.id));if(!this.isWritable)return void n(new c(c.NOT_ALLOWED,"you do not have write access to this library",this.id));if(l.hasFileSystem()){if(!h.checkEncoding(o,["utf8","ascii","base64","buffer"],n))return;this._setRendition(e,t,o,i,n)}else{if(void 0!==o)return void n(new c(c.INVALID_PARAMETER,"Encoding parameter not supported in-browser"));this._setRenditionInBrowser(e,t,i,n)}}},i.prototype.setRenditionFromPath=function(e,t,o,i){return!h.checkDeletedState(this,i)&&this._checkRenditionType(e,i)?"string"!=typeof t?void i(new c(c.INVALID_PARAMETER,"path must be a string",this.id)):l.hasFileSystem()?this.isWritable?void this._setRenditionFromPath(e,t,o,i):void i(new c(c.NOT_ALLOWED,"you do not have write access to this library",this.id)):void i(new c(c.REQUIRES_FILESYSTEM,"path-based APIs require a filesystem",this.id)):void 0},i.prototype.removeRendition=function(e){if(h.checkDeletedState(this),this._checkRenditionType(e),!this.isWritable)throw new c(c.NOT_ALLOWED,"you do not have write access to this library",this.id);var t=this._dcxCompositeRenditionMap[e];return t?this._wrapOperation(function(){this._dcxBranch.removeComponent(t),this._dcxCompositeRenditionMap=h.getCompositeRenditionMap(this._dcxBranch),this._commit()},this):void 0},i.prototype.getFilteredElements=function(e){if(!e)throw new c(c.INVALID_PARAMETER,"must specify element type to filter",this.id);if("*"!==e&&-1===a.ELEMENT_TYPE_FILTERS.indexOf(e))throw new c(c.INVALID_PARAMETER,"must specify '*', or an element type in config.ELEMENT_TYPE_FILTERS",this.id);var t=this._getFilterKey(e);return this._filterCache[t]=this._filterCache[t]||[],this._filterCache[t]},i.prototype.sync=function(e){h.checkDeletedState(this,e)||this._sync(!1,e)},i.prototype.rebindToServer=function(e){if(!l.hasFileSystem())return void e(new c(c.REQUIRES_FILESYSTEM,"rebindToServer requires a filesystem",this.id));if(!h.checkDeletedState(this,e))return this.isWritable?this._deletedFromServer?void this._doRebindToServer(e):void e(null):void e(new c(c.NOT_ALLOWED,"you do not have write access to this library",this.id))},i.prototype.getElementById=function(e){var t;return this.elements.forEach(function(o){o.id===e&&(t=o)}),t},i}),i("AdobeLibrarySyncManager",["require","exports","module","./components/dcx-js/src/AdobeStorageSession","./components/dcx-js/src/AdobeDCXCompositeXfer","./components/dcx-js/src/AdobeDCXUtil","./components/dcx-js/src/AdobeDCXError","./AdobeLibraryConfig","./AdobeLibraryError","./AdobeLibraryServices","./utils/AdobeLibrarySyncUtils","./utils/AdobeLibraryErrorUtils","./utils/AdobeLibraryFileUtils","./utils/AdobeLibraryManifestUtils","./utils/AdobeLibraryMimeTypeUtils"],function(e,t,o){"use strict";function i(e,t){this._collection=e,this._isPublic=t.IS_PUBLIC,this._storageHost=t.STORAGE_HOSTNAME,this._storageAssetsPath=this._isPublic?t.STORAGE_ASSETS_PATH:c.STORAGE_ASSETS_PATH,this._apiKey=c.STORAGE_API_KEY,this._syncGroup=this._isPublic?t.SYNC_GROUP:c.LIBRARY_SYNC_GROUP,this._XHR=t.XHR,this._requiresCommunitySession=t.REQUIRES_COMMUNITY_SESSION,this._getAccessToken=t.getAccessToken,this._httpServices=[],this._storageService=this._createStorageSession(),this._renditionStorageService=this._createStorageSession(),this._temporaryStorageServices={},this._lastSyncGroupState={},this._hasSetAuthToken=!1,this._authToken=void 0,this._inProgressSyncMap={},c.SHARED_LOCAL_STORAGE||this._isPublic||this._updateAuthToken()}var n=e("./components/dcx-js/src/AdobeStorageSession"),r=e("./components/dcx-js/src/AdobeDCXCompositeXfer"),a=e("./components/dcx-js/src/AdobeDCXUtil"),s=e("./components/dcx-js/src/AdobeDCXError"),c=e("./AdobeLibraryConfig"),l=e("./AdobeLibraryError"),d=e("./AdobeLibraryServices"),p=e("./utils/AdobeLibrarySyncUtils"),u=e("./utils/AdobeLibraryErrorUtils"),h=e("./utils/AdobeLibraryFileUtils"),_=e("./utils/AdobeLibraryManifestUtils"),f=e("./utils/AdobeLibraryMimeTypeUtils");return i.prototype._getCommonRequestHeaders=function(){var e={};return c.USER_AGENT_HEADER&&(e["User-Agent"]=c.USER_AGENT_HEADER),e},i.prototype._setAuthToken=function(e){this._hasSetAuthToken=!0,this._authToken=e,this._httpServices.forEach(function(t){e?(t.isActive=!0,t.setAuthToken(e)):t.isActive=!1})},i.prototype._updateAuthToken=function(e){var t=this;this._getAccessToken(this._authToken,function(o,i){!o&&i?t._setAuthToken(i):(o&&o.code===l.ACCESS_DENIED&&(t._collection._reportSyncError(o),t._collection._updateSyncState()),t._setAuthToken()),e&&e(null,i)})},i.prototype._getAuthToken=function(e){this._isPublic?e(null,void 0):this._hasSetAuthToken?e(null,this._authToken):this._updateAuthToken(e)},i.prototype._authHandler=function(){this._updateAuthToken()},i.prototype._createStorageSession=function(){var e;return this._isPublic?e=d.dcx.createHTTPService():(e=d.dcx.createHTTPService(this._authHandler.bind(this)),this._httpServices.push(e)),e.setApiKey(this._apiKey),e.setTimeout(c.NETWORK_TIMEOUT),e.setAdditionalNodeOptions(d.getNodeTunnelOptions(this.getStorageHost())),e.setAdditionalHeaders(this._getCommonRequestHeaders()),this._XHR&&e._forceXhr(this._XHR),this._requiresCommunitySession?d.dcx.createCommunitySession(e,this.getStorageHost()):d.dcx.createStorageSession(e,this.getStorageHost())},i.prototype._createTemporaryStorageSession=function(e,t){var o;return t&&this._getAccessToken?(o=d.dcx.createHTTPService(this._authHandler.bind(this)),o.setApiKey(this._apiKey),o.setAdditionalHeaders(this._getCommonRequestHeaders()),o.setAuthToken(this._authToken),this._httpServices.push(o)):o=d.dcx.createHTTPService(),o.setTimeout(c.NETWORK_TIMEOUT),o.setAdditionalNodeOptions(d.getNodeTunnelOptions(e)),d.dcx.createStorageSession(o,e)},i.prototype._getTemporaryStorageSession=function(e){var t=a.parseURI(e),o=t.scheme+"://"+t.authority,i=p.isAdobeDomain(t.authority);return this._temporaryStorageServices[o]||(this._temporaryStorageServices[o]=this._createTemporaryStorageSession(o,i)),this._temporaryStorageServices[o]},i.prototype.getServerComposites=function(e){var t=this,o=this._lastSyncGroupState.etag;this._storageService.getCollection(this.getSyncGroupPath(),o,function(o,i,n,r){if(o)return void(o.response&&404===o.response.statusCode?e(null,[]):e(o));if(!i){var a=Math.max(c.DEFAULT_MAX_SYNC_INTERVAL,1e3*p.getRetryAfterHeader(r));return c.MAX_SYNC_INTERVAL=a,void e(null,[])}c.MAX_SYNC_INTERVAL=c.DEFAULT_MAX_SYNC_INTERVAL;var s=t._lastSyncGroupState.compositeEtags||{},l={},d=[],u={},h=i.children||[];h.forEach(function(e){e&&_.validateLibraryId(e.name,!1)&&(e.isUnmodified=e.etag&&s[e.name]===e.etag,d.push(e),u[e.name]=e,l[e.name]=e.etag)}),t._lastSyncGroupState={etag:n,compositeEtags:l},e(null,d,u)})},i.prototype.clearSyncGroupCache=function(){this._lastSyncGroupState={}},i.prototype.doHeadRequest=function(e,t){var o;try{o=this._storageService.getCompositeManifestHref(e)}catch(i){return void t(i)}this._storageService.headRequest(o,t)},i.prototype.hasCompositeChangedOnServer=function(e,t){this.doHeadRequest(e,function(o,i){if(o)return void t(!0);var n=i&&i.headers&&i.headers.etag,r=e.current&&e.current.manifestEtag;t(n!==r)})},i.prototype.downloadComponent=function(e,t,o){r.downloadComponents([t],e,this._storageService,o)},i.prototype.downloadRepresentation=function(e,t){var o=e._dcxComponent,i=e.element.library._dcxBranch;this.downloadComponent(i,o,t)},i.prototype.abortPushOrPull=function(e){this._inProgressSyncMap[e]&&(this._inProgressSyncMap[e].abort(new l(l.TRANSFER_ABORTED,"abort push or pull operation")),delete this._inProgressSyncMap[e])},i.prototype.pullComposite=function(e,t,o){var i=this,n=e.id;if(!n&&e.href){var a=e.href.split("/");n=a&&a[a.length-1]}var p="manifestOnly"===c.SYNC_POLICY||!d.hasFileSystem(),u=p?"pullCompositeManifestOnly":"pullComposite";d.log("Started pulling: "+n+(p?" (manifest only)":""));var h=(new Date).valueOf();t._updateProgress(n),this._inProgressSyncMap[n]=r[u](e,this._storageService,function(r,a){var c=(new Date).valueOf()-h;return d.log("Finished pulling: "+n+(r?" ["+r.code+"]":"")+" duration="+c),delete i._inProgressSyncMap[n],t._updateProgress(n),r&&r.code===s.COMPONENT_DOWNLOAD_ERROR?void i.doHeadRequest(e,function(e,t){var i=!e&&t&&200===t.statusCode;if(i){var n=_.removeMissingComponents(r.pulledBranch,r.failedComponents);if(n)return void o(null,n)}o(r,a)}):r&&r.code===l.TRANSFER_ABORTED?void o(null,void 0):void o(r,a)});var f=this._inProgressSyncMap[n];f.onProgress=function(e,o){0!==o&&t._updateProgress(n,e,o)}},i.prototype.pushComposite=function(e,t,o,i){var n=this,a=e.id;d.log("Started pushing: "+a);var s=(new Date).valueOf();t._updateProgress(a),this._inProgressSyncMap[a]=r.pushComposite(e,o,this._storageService,function(e){var o=(new Date).valueOf()-s;d.log("Finished pushing: "+a+(e?" ["+e.code+"]":"")+" duration="+o),delete n._inProgressSyncMap[a],t._updateProgress(a),i(e)});var c=this._inProgressSyncMap[a];c.onProgress=function(e,o){0!==o&&t._updateProgress(a,e,o)}},i.prototype.pushDeletedComposite=function(e,t,o,i,n){var r=this;"incoming"===o?(d.log("Deleting incoming collaboration without pushing: "+e.id),this._storageService.deleteCompositeDirectory(e,n)):(d.log("Pushing deleted composite: "+e.id),this.pushComposite(e,t,i,function(o){if(o){if(o.code===s.UNEXPECTED_RESPONSE&&o.response&&404===o.response.statusCode)return void r._storageService.deleteCompositeDirectory(e,n);if(o.code===s.UPDATE_CONFLICT){var i=o;return void r.pullComposite(e,t,function(t){return t&&t.code===s.NO_COMPOSITE?void r._storageService.deleteCompositeDirectory(e,n):t&&t.code===s.DELETED_COMPOSITE?void n(null):t?void n(t):void n(i)})}}n(o)}))},i.prototype.getStorageHost=function(){return"https://"+this._storageHost},i.prototype.getSyncGroupPath=function(){var e=this.getStorageHost()+(this._storageAssetsPath||"");return this._syncGroup?a.appendPathElements(e,this._syncGroup):e},i.prototype.getCompositePath=function(e){return a.appendPathElements(this.getSyncGroupPath(),e)},i.prototype.getComponentPath=function(e,t){return a.appendPathElements(this.getSyncGroupPath(),e,t)},i.prototype.getElementRefDomain=function(){return this._requiresCommunitySession?c.CP_CLOUD_ID:this._storageHost},i.prototype.getElementRefPath=function(){return c.STORAGE_ASSETS_PATH+c.LIBRARY_SYNC_GROUP},i.prototype._getSharedCloudRenditionUrl=function(e,t,o,i){if(!e._dcxComponent)return void i("representation must be a component to generate a rendition");var n;if(this._requiresCommunitySession)try{n=this._storageService.getComponentRenditionHref(e._dcxComponent,e._dcxComponent.version,"image/png","width",t||"full")}catch(r){return void i(r)}else if(n=this.getComponentPath(e._element._library.id,e.id)+"/:rendition",n+=";size="+(t||"full"),void 0!==e._dcxComponent.version&&(n+=";version="+e._dcxComponent.version),o){var a=this._apiKey;return void this._getAuthToken(function(e,t){n+="?accept=image/png&api_key="+a+(t?"&user_token="+t:""),i(null,n)})}i(null,n)},i.prototype._getAssetAsType=function(e,t,o,i,r,a){var s=this;a=a||0;var l=function(){s._getAssetAsType(e,t,o,i,r,a)};if(a>0&&"uploading"===e.element.library.syncState)return void setTimeout(l,c.RENDITION_RETRY_INTERVAL);var h=o+d.getPathSeparator()+d.uuid()+".png",_=new n.FileContent(h);this._renditionStorageService.getAssetAsType(t,_,i,function(t){var o=t&&t.response&&t.response.headers,i=1e3*p.getRetryAfterHeader(o);if(c.RENDITION_RETRY_INTERVAL=Math.max(c.DEFAULT_RENDITION_RETRY_INTERVAL,i),c.RENDITION_404_BACKOFF=Math.max(c.DEFAULT_RENDITION_404_BACKOFF,i),404===u.getErrorStatusCode(t)){if(a<c.RENDITION_MAX_RETRIES)return d.log("404 fetching rendition: retrying"),a++,void setTimeout(l,c.RENDITION_RETRY_INTERVAL);d.log("404 fetching rendition: reached maximum retries"),d.log("Backing off rendition fetch of "+e.id+" for "+c.RENDITION_404_BACKOFF+"ms"),e._lastRendition404=(new Date).valueOf()}r(t,h)})},i.prototype.getSharedCloudRenditionUrl=function(e,t,o){var i=c.SHARED_LOCAL_STORAGE?!1:!0;this._getSharedCloudRenditionUrl(e,t,i,o)},i.prototype.getSharedCloudRendition=function(e,t,o){var i=this;if(e.element.library.isDeletedFromServer)return d.log("Error: Trying to fetch rendition from deleted library."),void o("Error: library deleted");var n=(new Date).valueOf(),r=n-(e._lastRendition404||0);return r<c.RENDITION_404_BACKOFF?void o("Error: got 404 on last rendition attempt - backing off"):void this._getSharedCloudRenditionUrl(e,t,!1,function(t,n){if(t)return void o(t);var r={Accept:"image/png"},a=e.element.library.collection._getTempDir();h.ensurePathExists(a,function(t){return t?void o(t):void i._getAssetAsType(e,n,a,r,o)})})},i.prototype.getSharedCloudContentURL=function(e){return this._storageService.getComponentHref(e,e.version)},i.prototype.appendAccessTokenToURL=function(e,t){if(!e)return void t(null,void 0);var o=this._apiKey;this._getAuthToken(function(i,n){e+="?api_key="+o+(n?"&user_token="+n:""),t(null,e)})},i.prototype.getSharedCloudContent=function(e,t,o){var i=this._storageService.getComponentHref(e._dcxComponent,e._dcxComponent.version),n={};this._storageService.getAssetAsType(i,t,n,function(e,t){return e?void o(e):void o(null,t)})},i.prototype.getAssetFromURL=function(e,t,o,i,r,a){var c=this;d.log("getAssetFromURL: "+e);var l=this._getTemporaryStorageSession(e),u=o+d.getPathSeparator()+d.uuid(),_=new n.FileContent(u);a=a||0,t=t||{},h.ensurePathExists(o,function(n){if(n)return void r(n);var h=l.getAssetAsType(e,_,t,function(n,l,_,f){if(delete h.progress,n&&n.code===s.UNEXPECTED_RESPONSE){var m=n.response&&n.response.statusCode;if(d.log("getAssetFromURL: Unexpected Response "+m+" from "+e),301===m||302===m||303===m||307===m){var y=p.getLocationHeader(n.response.headers);if(y&&5>a)return void c.getAssetFromURL(y,t,o,i,r,a+1)}}r(n,u,_,f)});if(i){var f,m=0;h.progress=function(e){m+=e,!f&&h.response&&h.response.headers&&(f=p.getContentLengthHeader(h.response.headers)),i(m,f||1)},i(0,1)}})},i.prototype.doHeadRequestOfURL=function(e,t){var o=this._getTemporaryStorageSession(e);o.headRequest(e,function(o,i){var n=i&&i.statusCode;d.log("doHeadRequestOfURL: "+e+" -> "+n),t(o,i)})},i.prototype.prepareCompositeForPush=function(e){e.href=this.getCompositePath(e.id)},i.prototype.updateAccessToken=function(e){this._setAuthToken(e)},i.prototype.isLoggedIn=function(){return this._isPublic||this._httpServices[0].isActive},i.prototype.uploadNewComponentForRepresentation=function(e,t,o,i){var n=o._element._library._dcxComposite;r.uploadNewComponent(e,o.type,n,o.id,this._storageService,function(e,r){if(e)return void i(e);var a=t?t.lastIndexOf("."):-1,s=-1!==a&&t.substr(a+1).toLowerCase(),c=o.id+"."+s,l=n.current.addComponentWithUploadResults(t,o.relationship,c,o._element._dcxNode,r);i(null,l)})},i.prototype.uploadNewComponentForLibrary=function(e,t,o,i,n,a){var s=n._dcxComposite;r.uploadNewComponent(e,o,s,t,this._storageService,function(e,n){if(e)return void a(e);var r=f.getExtensions(o)[0],c=t+"."+r,l=s.current.addComponentWithUploadResults(c,i,c,s,n);a(null,l)})},i}),i("AdobeLibraryBookmark",["require","exports","module","./AdobeLibraryError"],function(e,t,o){"use strict";function i(e,t){this._id=e,this._url=t}var n=e("./AdobeLibraryError");return Object.defineProperties(i.prototype,{id:{get:function(){return this._id},set:function(e){throw new n(n.READ_ONLY,"Cannot change the id of an existing bookmark")}},url:{get:function(){return this._url},set:function(e){throw new n(n.READ_ONLY,"Cannot change the url of an existing bookmark")}}}),i}),i("AdobeLibraryBookmarkManager",["require","exports","module","./AdobeLibraryBookmark","./AdobeLibraryServices","./AdobeLibraryConfig","./utils/AdobeLibraryLock","./utils/AdobeLibraryFileUtils","./utils/AdobeLibraryErrorUtils"],function(e,t,o){"use strict";function i(e){this._collection=e,this._bookmarks=[],this._bookmarksEtag=void 0,this._bookmarksBase=void 0,this._syncModified=!1,this._lock=new d,this._service=e._syncManager._storageService._service,this._bookmarksURL=e._syncManager.getStorageHost()+l.BOOKMARKS_PATH}function n(e,t){var o;return e.some(function(e){return e.id===t?(o=e,!0):void 0}),o}function r(e){var t=[];return e.forEach(function(e){t.push({id:e.id,url:e.url})}),t}function a(e){var t=[];return e&&e.forEach(function(e){t.push(new s(e.id,e.url))}),t}var s=e("./AdobeLibraryBookmark"),c=e("./AdobeLibraryServices"),l=e("./AdobeLibraryConfig"),d=e("./utils/AdobeLibraryLock"),p=e("./utils/AdobeLibraryFileUtils"),u=e("./utils/AdobeLibraryErrorUtils");return i.prototype._getBookmarksDir=function(){return this._collection._getBaseDir()},i.prototype._saveBookmarks=function(e){if(c.hasFileSystem()){var t={bookmarks:r(this._bookmarks),etag:this._bookmarksEtag};this._bookmarksBase&&(t.bookmarks_base=this._bookmarksBase),p.writeJSONData(this._getBookmarksDir(),l.BOOKMARKS_FILENAME,t,function(t){t&&(t=u.getCommitError(t,null,"bookmarks could not be saved")),e(t)})}else e(null)},i.prototype._loadBookmarks=function(e){if(c.hasFileSystem()){var t=this,o=this._getBookmarksDir()+c.getPathSeparator()+l.BOOKMARKS_FILENAME;p.readJSONData(o,function(o,i){return o?(o=u.getCommitError(o,null,"bookmarks could not be loaded"),e(o)):(i&&(t._bookmarks=a(i.bookmarks),t._bookmarksEtag=i.etag,t._bookmarksBase=i.bookmarks_base&&a(i.bookmarks_base)),void e(null))})}else e(null)},i.prototype._pullBookmarks=function(e){function t(t,o){if(t)return e(t);if(200===o.statusCode)try{var n=JSON.parse(o.response);i._syncModified=!0,e(null,a(n.bookmarks),o.headers.etag)}catch(r){e("Cannot parse data: "+o.response)}else 304===o.statusCode||404===o.statusCode?e(null,void 0,o.headers.etag):e("Unexpected response getting bookmarks: "+o.statusCode)}c.log("Pulling bookmarks");var o={},i=this;this._bookmarksEtag&&(o["If-None-Match"]=this._bookmarksEtag),this._service.invoke("GET",this._bookmarksURL,void 0,void 0,{responseType:"text"},t)},i.prototype._mergeBookmarks=function(e,t){if(c.log("Merging bookmarks"),e){if(this._bookmarksBase){var o=this;e.forEach(function(t){var i=n(o._bookmarks,t.id),r=n(o._bookmarksBase,t.id);!i&&r&&e.splice(e.indexOf(t),1)}),this._bookmarks.forEach(function(t){var i=n(e,t.id),r=n(o._bookmarksBase,t.id);i||r||e.push(t)})}this._bookmarks=e}this._bookmarksEtag=t},i.prototype._pushBookmarks=function(e){c.log("Pushing bookmarks");var t={"Content-Type":"application/json"};this._bookmarksEtag&&(t["If-Match"]=this._bookmarksEtag);var o=this,i=JSON.stringify({bookmarks:r(this._bookmarks)});this._service.invoke("PUT",this._bookmarksURL,t,i,void 0,function(t,i){if(t)return e(t);var n=i.statusCode;!i.headers.etag||200!==n&&201!==n&&204!==n?409===n||412===n?o._pullBookmarks(function(t,i,n){return t?e(t):(o._mergeBookmarks(i,n),void o._pushBookmarks(e))}):e("Unexpected response updating bookmarks: "+n):e(null,i.headers.etag)})},i.prototype._commit=function(e){c.log("Commiting bookmarks");var t=this;this._lock.obtain(function(){t._saveBookmarks(function(o){return t._lock.release(),o?void t._collection._reportCommitError(o):void(e&&t.sync(function(e){e&&t._collection._reportSyncError(e)}))})})},i.prototype._sync=function(e){var t=this;this._bookmarksBase?t._pushBookmarks(function(o,i){return o?e(o):(t._bookmarksEtag=i,t._bookmarksBase=void 0,t._commit(),void e(null))}):t._pullBookmarks(function(o,i,n){return o?e(o):(i&&(t._bookmarks=i,t._bookmarksEtag=n,t._bookmarksBase=void 0,t._commit()),void e(null))})},i.prototype._createBase=function(){this._bookmarksBase||(this._bookmarksBase=this._bookmarks.slice())},i.prototype.load=function(e){c.log("Loading bookmarks");var t=this;this._lock.obtain(function(){t._loadBookmarks(function(o){t._lock.release(),e(o)})})},i.prototype.sync=function(e){c.log("Syncing bookmarks");var t=this;this._lock.obtain(function(){t._syncModified=!1,t._sync(function(o){return t._lock.release(),o?(o=u.getSyncError(o,null),e(o)):(e(null),void(t._syncModified&&t._collection._notifyChange(!0)))})})},i.prototype.createBookmark=function(e,t,o){if(l.SHARED_LOCAL_STORAGE)return void c.storageInterface.createBookmark(this._collection,e,t,o);c.log("Creating bookmark: "+e+" url: "+t);var i=this;this._lock.obtain(function(){var r=n(i._bookmarks,e),a=!1;r||(i._createBase(),r=new s(e,t),i._bookmarks.push(r),a=!0),i._lock.release(),o(null,r,a),a&&(i._commit(l.SYNCING_ENABLED),i._collection._notifyChange(!0))})},i.prototype.removeBookmark=function(e,t){if(l.SHARED_LOCAL_STORAGE)return void c.storageInterface.removeBookmark(this._collection,e,t);c.log("Removing bookmark: "+e.id+" url: "+e.id);var o=this;this._lock.obtain(function(){e=n(o._bookmarks,e.id),e&&(o._createBase(),o._bookmarks.splice(o._bookmarks.indexOf(e),1)),o._lock.release(),t(null),e&&(o._commit(l.SYNCING_ENABLED),o._collection._notifyChange(!0))})},i.prototype.getBookmarks=function(){return this._bookmarks.slice()},i}),i("AdobeLibraryCollection",["require","exports","module","./components/dcx-js/src/AdobeDCXError","./AdobeLibraryFolder","./AdobeLibraryServices","./AdobeLibraryConfig","./AdobeLibrarySyncManager","./AdobeLibraryBookmarkManager","./AdobeLibraryAnalytics","./AdobeLibraryError","./utils/AdobeLibraryAsyncJoin","./utils/AdobeLibraryFileUtils","./utils/AdobeLibraryManifestUtils","./utils/AdobeLibraryErrorUtils","./utils/AdobeLibrarySyncUtils","./utils/AdobeLibraryRenditionUtils","./utils/AdobeLibraryListenerManager"],function(e,t,o){"use strict";function i(e){this._rootDir=s.ROOT_DIR,this._userId=e.USER_ID,this._cloudId=e.CLOUD_ID,this._cloudInfo=e.CLOUD_INFO||{},this._syncManager=new c(this,e),this._libraries=[],this._syncState="syncing",this._syncProgressMap={},this._externalLinkDownloadProgressMap={},this._initialSyncInProgress=!1,this._syncErrors=[],this._listenerManager=new g(["change","deepchange","sync","commitError"]),this._libraryIdMap={},this._pendingDeletes=[],this._loaded=!1,this._syncing=!1,this._lastSyncTime=0,this._pendingSyncs=[],this._backoffTicks=0,this._numBackoffs=0,this._numRetries=0,this.isPublic||(this._bookmarkManager=new l(this))}var n=e("./components/dcx-js/src/AdobeDCXError"),r=e("./AdobeLibraryFolder"),a=e("./AdobeLibraryServices"),s=e("./AdobeLibraryConfig"),c=e("./AdobeLibrarySyncManager"),l=e("./AdobeLibraryBookmarkManager"),d=e("./AdobeLibraryAnalytics"),p=e("./AdobeLibraryError"),u=e("./utils/AdobeLibraryAsyncJoin"),h=e("./utils/AdobeLibraryFileUtils"),_=e("./utils/AdobeLibraryManifestUtils"),f=e("./utils/AdobeLibraryErrorUtils"),m=e("./utils/AdobeLibrarySyncUtils"),y=e("./utils/AdobeLibraryRenditionUtils"),g=e("./utils/AdobeLibraryListenerManager");return i.prototype._removeAllListeners=function(){this._listenerManager.removeAll(),this._libraries.forEach(function(e){e._removeAllListeners()})},i.prototype._notifyChange=function(e){this._listenerManager.notify("deepchange"),e&&this._listenerManager.notify("change")},i.prototype._load=function(e){if(this._loaded)return void e(null);this._loaded=!0;var t=this;h.readLibraryDirectory(this,function(o,i){function n(e,o){if(_.validateLibraryId(e,t.isPublic)){var i=t._getCompositeDir(e);a.dcx.newCompositeFromLocalStorage(i,function(i,n){if(i)return a.log("Load error: DCX error loading composite for "+e),void o(f.getCommitError(i,e));if(!n||!n.current)return a.log("Load error: composite/branch not loaded for "+e),h.deleteLibraryFromDisk(t,e),void o(null);if(!_.validateLibrary(n))return a.log("Load error: failed validation for "+e),void o(null);if(!t.isPublic&&n.id!==e)return a.log("Load error: library id "+n.id+"doesn't match folder on disk "+e),void o(null);var s=new r(t,n);t.isPublic&&(s._publicId=e,s._writable=!1),"pendingDelete"===n.current.compositeState?(t._pendingDeletes.push(s),o(null)):(t._libraries.push(s),t._libraryIdMap[s.id]=s,s._loadRenditionCache(o))})}else o(null)}if(o||!i)return void e(null);var s=new u;i.forEach(function(e){s.addOperation(n,[e])}),t.isPublic||s.addOperation(t._bookmarkManager.load,[],t._bookmarkManager),s.run(function(o){a.log("Loaded "+t._libraries.length+" libraries and "+t._pendingDeletes.length+" pending deletes"),e(null)},function(e){t._reportCommitError(e)})})},i.prototype._removeFromPendingDeletes=function(e){var t=this._pendingDeletes.indexOf(e);-1!==t&&this._pendingDeletes.splice(t,1)},i.prototype._handlePendingDeletes=function(e){var t=this,o=new u;this._pendingDeletes.forEach(function(e){o.addOperation(function(o){e._deleteFromServer(!1,function(i){return i&&i.code===n.UPDATE_CONFLICT?(t._removeFromPendingDeletes(e),t._libraries.push(e),t._libraryIdMap[e.id]=e,e._markDeletedLocally(!1),t._updateSyncState(),t._notifyChange(!0),void o(null,!0)):i?void o(i):(t._removeFromPendingDeletes(e),e._deletedFromDisk=!0,void h.deleteLibraryFromDisk(t,e.id,function(e){o(e,!0)}))})})}),o.run(e)},i.prototype._doesLibraryExist=function(e){if(this._libraryIdMap[e])return!0;var t;for(t=0;t<this._pendingDeletes.length;t++)if(this._pendingDeletes[t].id===e)return!0;return!1},i.prototype._syncNewLibrary=function(e,t,o,i){var s=this,c=t||this._syncManager.getCompositePath(e),l=a.hasFileSystem()&&this._getCompositeDir(e),d=a.dcx.newCompositeWithHref(c,l);s._libraryIdMap[e]="pending",s._updateSyncState(),s._syncManager.pullComposite(d,s,function(t,a){return t||!a?(delete s._libraryIdMap[e],s._updateSyncState(),t=t?t.code===n.NO_COMPOSITE||t.code===n.DELETED_COMPOSITE?null:f.getSyncError(t,e):new p(p.NETWORK_ERROR,"No pulled branch"),void i(t,!0)):void d.resolvePullWithBranch(a,function(t){if(t||!s.isPublic&&d.id!==e)return delete s._libraryIdMap[e],s._updateSyncState(),t=t?f.getCommitError(t,e):new p(p.CORRUPTED_LIBRARY,"Library id does not match sync group id"),void i(t,!0);var n=new r(s,d);s.isPublic&&(n._publicId=e,n._writable=!1),s._libraries.push(n),s._libraryIdMap[n.id]=n,s._updateSyncState(),n._setCollaboration(o),y.prefetchRenditions(n),s._notifyChange(!0),i(null,!0)})})},i.prototype._syncNewLibraries=function(e,t){var o=this,i=new u;if(this._loadingHint){var n=[];e.forEach(function(e){-1!==o._loadingHint.indexOf(e.name)&&n.push(e)}),e.forEach(function(e){-1===o._loadingHint.indexOf(e.name)&&n.push(e)}),e=n}e.forEach(function(e){var t=e.name;o._doesLibraryExist(e.name)||i.addOperation(o._syncNewLibrary,[t,void 0,e],o)}),i.run(t)},i.prototype._syncExistingLibraries=function(e,t){var o=this,i=new u;this._libraries.forEach(function(t){var n=e&&e[t.id];n&&(t._setCollaboration(n),t._deletedFromServer&&(t._deletedFromServer=!1,t._notifyChange()));var r=!e||n&&n.isUnmodified;void 0===t.collaboration?i.addOperation(t._sync,[r],t):r?i.addOperation(function(e){o._syncManager.hasCompositeChangedOnServer(t._dcxComposite,function(o){t._sync(!o,e)})}):i.addOperation(t._sync,[!1],t)}),i.run(t)},i.prototype._dosync=function(e){var t=this;this._clearSyncErrors(),this._syncManager.getServerComposites(function(o,i,n){if(o)return o=f.getSyncError(o,void 0,{403:p.ACCESS_DENIED}),t._reportSyncError(o),void e(null,!1);var r=new u;r.addOperation(t._syncNewLibraries,[i],t),r.addOperation(t._syncExistingLibraries,[n],t),r.addOperation(t._handlePendingDeletes,[],t),r.addOperation(t._bookmarkManager.sync,[],t._bookmarkManager),r.run(function(t,o){e(null,o)},function(e){t._reportSyncError(e)})})},i.prototype._reportSyncError=function(e){e&&(a.log("Sync error: "+f.errorToString(e)),this._syncErrors.push(e))},i.prototype._clearSyncErrors=function(e){if(e){var t=[];this._syncErrors.forEach(function(o){o.libraryId!==e&&t.push(o)}),this._syncErrors=t}else this._syncErrors=[]},i.prototype._reportCommitError=function(e){this._lastCommitError=e,e&&(a.log("Commit error: "+f.errorToString(e)),this._listenerManager.notify("commitError",[e]))},i.prototype._updateRetryState=function(){if(!this._retryTimeoutId&&"syncing"!==this._syncState){if("error"===this._syncState){var e=this.getPrimarySyncError();if(e&&e.code===p.RETRYABLE_SERVER_ERROR){if(this._numRetries++,this._numRetries>s.ERROR_RETRY_INTERVALS.length)return this._retryTime="never",a.log("Retry Failed"),void(s.MAX_SYNC_INTERVAL=s.RETRY_FAIL_MAX_SYNC_INTERVAL);a.log("Retry "+this._numRetries);var t=e.underlyingError&&e.underlyingError.response&&e.underlyingError.response.headers,o=1e3*m.getRetryAfterHeader(t);o>0?(this._numRetries=s.ERROR_RETRY_INTERVALS.length,a.log("Got Retry-After header")):o=1e3*s.ERROR_RETRY_INTERVALS[this._numRetries-1],a.log("Retrying after "+o+"ms"),this._retryTime=(new Date).valueOf()+o;var i=this;return void(this._retryTimeoutId=setTimeout(function(){i._retryTimeoutId=void 0,i._retryTime=void 0,a.log("Starting retry"),i._syncWithParameters(!1)},o))}if(e&&e.code===p.EXCEEDS_QUOTA)return s.MAX_SYNC_INTERVAL=s.RETRY_FAIL_MAX_SYNC_INTERVAL,this._numRetries=s.ERROR_RETRY_INTERVALS.length+1,void(this._retryTime="never")}this._numRetries=0,this._retryTime=void 0}},i.prototype._updateSyncState=function(){var e=this,t=this._initialSyncInProgress;Object.keys(this._libraryIdMap).forEach(function(o){var i=e._libraryIdMap[o],n="pending"===i||i._isSyncing();t=t||n});var o;t?o="syncing":(this._syncErrors.length>0?(o="error",e._syncManager.clearSyncGroupCache(),d.reportError(this.getPrimarySyncError())):o="ok",this._syncProgressMap={},this._syncProgress=void 0);var i=this._syncState;this._syncState=o,this._updateRetryState(),(i!==o||"error"===this._syncState)&&this._listenerManager.notify("sync"),e._ensureDefaultLibrary()},i.prototype._updateProgress=function(e,t,o){o?this._syncProgressMap[e]={bytesLoaded:t||0,bytesTotal:o}:this._syncProgressMap[e]?(0===this._syncProgressMap[e].bytesTotal&&(this._syncProgressMap[e].bytesTotal=1e4),this._syncProgressMap[e].bytesLoaded=this._syncProgressMap[e].bytesTotal):this._syncProgressMap[e]={bytesLoaded:0,bytesTotal:0};var i=!1,n=t||0,r=o||0,a=r>0?Math.max(0,Math.min(100,Math.round(n/o*100))):void 0;this._syncProgressMap[e].progress!==a&&(this._syncProgressMap[e].progress=a,i=!0);var s=0,c=0,l=0,d=0,p=this._syncProgressMap;Object.keys(p).forEach(function(e){s++,p[e].bytesTotal>0&&c++,l+=p[e].bytesLoaded,d+=p[e].bytesTotal});var u=d>0?l*c/(d*s):0,h=Math.max(0,Math.min(100,Math.round(100*u)));(!this._syncProgress||this._syncProgress<h||100===this._syncProgress&&100>h)&&(this._syncProgress=h,i=!0),i&&this._listenerManager.notify("sync")},i.prototype._updateExternalLinkDownloadProgress=function(e,t,o,i){var n,r=e.element.library.id+"."+e.element.id+"."+e.id;o?(t=t||0,n=Math.max(0,Math.min(100,Math.round(t/o*100)))):i&&(n=-1),n!==this._externalLinkDownloadProgressMap[r]&&(void 0===n?delete this._externalLinkDownloadProgressMap[r]:this._externalLinkDownloadProgressMap[r]=n,this._listenerManager.notify("sync"))},i.prototype._getExternalLinkDownloadProgress=function(e){var t=e.element.library.id+"."+e.element.id+"."+e.id;return this._externalLinkDownloadProgressMap[t]},i.prototype._setInitialSyncState=function(e,t){this._initialSyncInProgress=e,this._loadingHint=t,this._updateSyncState()},i.prototype._resetPollBackoff=function(){this._backoffTicks=0,this._numBackoffs=0},i.prototype._getBaseDir=function(){var e=a.getPathSeparator(),t=this._userId.replace(/@/g,"_"),o=this._rootDir+e+t;return this._isPublic&&t!==s.PUBLIC_USER_ID&&(o+=e+s.PUBLIC_USER_ID),o+e+this._cloudId},i.prototype._getCompositeDir=function(e){var t=a.getPathSeparator(),o=this._getBaseDir()+t+"dcx";return e&&(o+=t+e),o},i.prototype._getTempDir=function(){var e=a.getPathSeparator();return this._getBaseDir()+e+".tmp"},i.prototype._getRenditionCacheDir=function(e){var t=a.getPathSeparator(),o=this._getBaseDir()+t+"renditions";return e&&(o+=t+e),o},i.prototype._ensureDefaultLibrary=function(){var e="ok"===this.syncState&&!this.isInitialSyncInProgress&&s.SYNCING_ENABLED,t=0;this.libraries.forEach(function(e){e.isDeletedLocally||e.isDeletedFromServer||t++}),!this.isPublic&&s.DEFAULT_LIBRARY_NAME&&e&&0===t&&(a.log("Creating default library: "+s.DEFAULT_LIBRARY_NAME),this.createLibrary(s.DEFAULT_LIBRARY_NAME))},i.prototype._doRemoveLibrary=function(e,t){var o=this,i=function(e){t&&t(e)},n=this._libraries.indexOf(e);-1!==n&&(this._libraries.splice(n,1),
delete this._libraryIdMap[e.id]),e._removeAllListeners(),s.SHARED_LOCAL_STORAGE?(e._dcxBranch.compositeState="pendingDelete",e._commit(!1,!0),e._markDeletedLocally(!0),i(null)):(o._pendingDeletes.push(e),s.SYNCING_ENABLED?e._deleteFromServer(!0,function(t){return e._markDeletedLocally(!0),t?void i(null):(o._removeFromPendingDeletes(e),e._deletedFromDisk=!0,void h.deleteLibraryFromDisk(o,e.id,i))}):(e._dcxBranch.compositeState="pendingDelete",e._commit(!0,!0),e._markDeletedLocally(!0),i(null))),this._notifyChange(!0)},Object.defineProperties(i.prototype,{libraries:{get:function(){return this._libraries},set:function(){throw new p(p.READ_ONLY,"Cannot modify libraries list directly")}},commitError:{get:function(){return this._lastCommitError},set:function(){throw new p(p.READ_ONLY,"commitError is a read-only property")}},syncState:{get:function(){return this._syncState},set:function(){throw new p(p.READ_ONLY,"syncState is a read-only property")}},syncErrors:{get:function(){return this._syncErrors},set:function(){throw new p(p.READ_ONLY,"syncErrors is a read-only property")}},syncProgress:{get:function(){return this._syncProgress},set:function(){throw new p(p.READ_ONLY,"syncProgress is a read-only property")}},isInitialSyncInProgress:{get:function(){return this._initialSyncInProgress},set:function(){throw new p(p.READ_ONLY,"isInitialSyncInProgress is a read-only property")}},isPolling:{get:function(){return void 0!==this._pollTimerId},set:function(){throw new p(p.READ_ONLY,"isPolling is a read-only property")}},isLoggedIn:{get:function(){return s.SHARED_LOCAL_STORAGE?void 0:this._syncManager.isLoggedIn()},set:function(){throw new p(p.READ_ONLY,"isLoggedIn is a read-only property")}},retryTime:{get:function(){return"never"!==this._retryTime?this._retryTime:void 0},set:function(){throw new p(p.READ_ONLY,"retryTime is a read-only property")}},userId:{get:function(){return this._userId},set:function(){throw new p(p.READ_ONLY,"userId is a read-only property")}},cloudId:{get:function(){return this._cloudId},set:function(){throw new p(p.READ_ONLY,"cloudId is a read-only property")}},cloudInfo:{get:function(){return this._cloudInfo},set:function(){throw new p(p.READ_ONLY,"cloudInfo is a read-only property")}},isPublic:{get:function(){return!1},set:function(){throw new p(p.READ_ONLY,"isPublic is a read-only property")}},bookmarks:{get:function(){return this._bookmarkManager.getBookmarks()},set:function(){throw new p(p.READ_ONLY,"bookmarks is a read-only property")}}}),i.prototype.addChangeListener=function(e){this._listenerManager.add("change",e)},i.prototype.removeChangeListener=function(e){this._listenerManager.remove("change",e)},i.prototype.addDeepChangeListener=function(e){this._listenerManager.add("deepchange",e)},i.prototype.removeDeepChangeListener=function(e){this._listenerManager.remove("deepchange",e)},i.prototype.createLibrary=function(e){var t=a.uuid(),o=s.COMPOSITE_TYPE,i=this._getCompositeDir(t),n=a.dcx.newEmptyComposite(e,o,i,t);n.current.rootNode.setValue(s.VERSION_KEY,s.VERSION),this._syncManager.prepareCompositeForPush(n);var c=new r(this,n);return c._updateCreatedTime(),this._libraries.push(c),this._libraryIdMap[c.id]=c,this._notifyChange(!0),c._commit(!1,!0),d.reportCreateLibrary(c),c},i.prototype.removeLibrary=function(e,t){this._doRemoveLibrary(e,t),d.reportDeleteLibrary(e)},i.prototype.removeDeletedLibraries=function(e,t){function o(e,t){var o=i._libraries.indexOf(e);-1!==o&&(i._libraries.splice(o,1),delete i._libraryIdMap[e.id]),e._deletedFromDisk=!0,h.deleteLibraryFromDisk(i,e.id,t),e._markDeletedLocally(!0)}var i=this;"function"==typeof e&&(t=e,e=void 0);var n=e&&e.exclude||[],r=new u,a=!1;this._libraries.forEach(function(e){if(e.isDeletedFromServer){var t=!0;n.forEach(function(o){t=t&&e!==o}),t&&(a=!0,r.addOperation(o,[e]))}}),r.run(function(e){a&&i._notifyChange(!0),t(e)})},i.prototype.sync=function(e){this._syncWithParameters(!1,!1,e)},i.prototype.syncFull=function(e){this._syncManager.clearSyncGroupCache(),this._syncWithParameters(!1,!1,e)},i.prototype.syncBookmarks=function(e){var t=function(t){e&&e(t)};this._bookmarkManager.sync(t)},i.prototype._syncWithParameters=function(e,t,o){var i=this,n=function(){o&&o(null)};if(s.SHARED_LOCAL_STORAGE)return a.storageInterface.sync(this),void n();if(!s.SYNCING_ENABLED)return void n();if(this._retryTimeoutId)return void n();if(e||this._resetPollBackoff(),this.isPolling){if(this._syncing)return void n()}else if(this._syncing)return void i._pendingSyncs.push(n);var r=(new Date).valueOf();return r<this._lastSyncTime+s.MAX_SYNC_INTERVAL?t?void n():void setTimeout(function(){i._syncWithParameters(e,!0,n)},s.MAX_SYNC_INTERVAL):(a.log("Start Sync: "+this.cloudId+(e?" [polling]":"")),this._syncing=!0,this._lastSyncTime=(new Date).valueOf(),void this._dosync(function(e,t){if(i._syncing=!1,i._updateSyncState(),a.log("End Sync: "+i.cloudId),t&&(i._backoffTicks=0,i._numBackoffs=0),i._pendingSyncs.length>0){var o=i._pendingSyncs;i._pendingSyncs=[],i.sync(function(){o.forEach(function(e){e()})})}n()}))},i.prototype.addSyncListener=function(e){this._listenerManager.add("sync",e)},i.prototype.removeSyncListener=function(e){this._listenerManager.remove("sync",e)},i.prototype.getPrimarySyncError=function(){var e=this._syncErrors[0];return this._syncErrors.forEach(function(t){var o=f.getErrorPriority(t),i=f.getErrorPriority(e);o>i?e=t:o===i&&e.code===t.code&&e.libraryId!==t.libraryId&&(e=new p(e.code,"multiple errors (see libraryCollection.syncErrors)",void 0))}),e},i.prototype.getNewLibrarySyncProgress=function(){var e=this;if(this._newLibraryProgress)return this._newLibraryProgress;var t=[];return Object.keys(this._libraryIdMap).forEach(function(o){"pending"===e._libraryIdMap[o]&&t.push({id:o,progress:e._syncProgressMap[o]&&e._syncProgressMap[o].progress})}),t},i.prototype.addCommitErrorListener=function(e){this._listenerManager.add("commitError",e)},i.prototype.removeCommitErrorListener=function(e){this._listenerManager.remove("commitError",e)},i.prototype.startPolling=function(){if(s.SHARED_LOCAL_STORAGE)throw new p(p.NOT_SUPPORTED,"startPolling() not supported with shared local storage");if(!this.isPolling){var e=this,t=6e4*s.POLL_INTERVAL;this._pollTimerId=setInterval(function(){if("never"!==e._retryTime){if(e._backoffTicks>0)return void e._backoffTicks--;0===e._backoffTicks&&(e._numBackoffs++,e._backoffTicks=m.getBackoffTicks(e._numBackoffs)),e._syncWithParameters(!0)}},t)}},i.prototype.stopPolling=function(){if(s.SHARED_LOCAL_STORAGE)throw new p(p.NOT_SUPPORTED,"stopPolling() not supported with shared local storage");this.isPolling&&(clearInterval(this._pollTimerId),delete this._pollTimerId),this._retryTimeoutId&&(clearTimeout(this._retryTimeoutId),delete this._retryTimeoutId)},i.prototype.createBookmark=function(e,t,o){this._bookmarkManager.createBookmark(e,t,o)},i.prototype.removeBookmark=function(e,t){this._bookmarkManager.removeBookmark(e,t)},i.prototype.findBookmark=function(e){var t;return this.bookmarks&&this.bookmarks.some(function(o){return o.url===e._dcxComposite.href?(t=o,!0):void 0}),t},i.prototype.getDefaultLibrary=function(){var e;return this.libraries.forEach(function(t){"incoming"!==t.collaboration&&(!e||(e.created||0)>(t.created||0))&&(e=t)}),e},i.prototype.getLibraryById=function(e){var t;return this.libraries.forEach(function(o){o.id===e&&(t=o)}),t},i.prototype.updateAccessToken=function(e){if(s.SHARED_LOCAL_STORAGE)throw new p(p.NOT_SUPPORTED,"updateAccessToken() not supported with shared local storage");this._syncManager.updateAccessToken(e),a.log("defined")},i.prototype.getTempDir=function(e){if(!a.hasFileSystem())return void e(new p(p.REQUIRES_FILESYSTEM,"getTempDir only supported when you have a filesystem"));var t=this._getTempDir();h.ensurePathExists(t,function(o){e(o,t)})},i}),i("AdobeLibraryPublicCollection",["require","exports","module","./AdobeLibraryCollection","./AdobeLibraryError","./AdobeLibraryConfig","./AdobeLibraryServices","./utils/AdobeLibraryAsyncJoin","./utils/AdobeLibraryFileUtils"],function(e,t,o){"use strict";function i(e){e.IS_PUBLIC=!0,e.USER_ID=e.USER_ID||a.PUBLIC_USER_ID,this._newLibrariesLoading={},n.call(this,e)}var n=e("./AdobeLibraryCollection"),r=e("./AdobeLibraryError"),a=e("./AdobeLibraryConfig"),s=e("./AdobeLibraryServices"),c=e("./utils/AdobeLibraryAsyncJoin"),l=e("./utils/AdobeLibraryFileUtils");return Object.keys(n.prototype).forEach(function(e){0===e.indexOf("_")&&(i.prototype[e]=n.prototype[e])}),i.prototype._dosync=function(e){var t=this;this._clearSyncErrors();var o=new c;this._libraries.forEach(function(e){o.addOperation(function(o){t._syncManager.hasCompositeChangedOnServer(e._dcxComposite,function(t){e._sync(!t,o)})})}),o.run(function(t,o){e(null,o)},function(e){t._reportSyncError(e)})},Object.defineProperties(i.prototype,{libraries:{get:function(){return this._libraries},set:function(){throw new r(r.READ_ONLY,"Cannot modify libraries list directly")}},commitError:{get:function(){return this._lastCommitError},set:function(){throw new r(r.READ_ONLY,"commitError is a read-only property")}},syncState:{get:function(){return this._syncState},set:function(){throw new r(r.READ_ONLY,"syncState is a read-only property")}},syncErrors:{get:function(){return this._syncErrors},set:function(){throw new r(r.READ_ONLY,"syncErrors is a read-only property")}},syncProgress:{get:function(){return this._syncProgress},set:function(){throw new r(r.READ_ONLY,"syncProgress is a read-only property")}},isPolling:{get:function(){return void 0!==this._pollTimerId},set:function(){throw new r(r.READ_ONLY,"isPolling is a read-only property")}},retryTime:{get:function(){return"never"!==this._retryTime?this._retryTime:void 0},set:function(){throw new r(r.READ_ONLY,"retryTime is a read-only property")}},userId:{get:function(){return this._userId},set:function(){throw new r(r.READ_ONLY,"userId is a read-only property")}},cloudId:{get:function(){return this._cloudId},set:function(){throw new r(r.READ_ONLY,"cloudId is a read-only property")}},cloudInfo:{get:function(){return this._cloudInfo},set:function(){throw new r(r.READ_ONLY,"cloudInfo is a read-only property")}},isPublic:{get:function(){return!0},set:function(){throw new r(r.READ_ONLY,"isPublic is a read-only property")}}}),i.prototype.addChangeListener=function(e){n.prototype.addChangeListener.call(this,e)},i.prototype.removeChangeListener=function(e){n.prototype.removeChangeListener.call(this,e)},i.prototype.addDeepChangeListener=function(e){n.prototype.addDeepChangeListener.call(this,e)},i.prototype.removeDeepChangeListener=function(e){n.prototype.removeDeepChangeListener.call(this,e)},i.prototype.canLoadLibrary=function(e){var t=new RegExp(this._syncManager.getSyncGroupPath()+"/(.+)");return e.match(t)?!0:!1},i.prototype.loadLibrary=function(e,t,o){function i(t,o){var i=n._newLibrariesLoading[e];delete n._newLibrariesLoading[e],i.forEach(function(e){e(t,o)})}var n=this,c=this.getLibraryById(e);if(c)return void o(null,c);if(t&&!this.canLoadLibrary(t))return void o(new r(r.INVALID_PARAMETER,"Invalid library url"));var l=this._newLibrariesLoading[e];return l?void l.push(o):(this._newLibrariesLoading[e]=[o],a.SHARED_LOCAL_STORAGE?void s.storageInterface.loadPublicLibrary(this,e,t,i):void this._syncNewLibrary(e,t,void 0,function(t){return t?void i(t):(c=n.getLibraryById(e),c&&(c._loadedExternally=!0),void i(null,c))}))},i.prototype.unloadLibrary=function(e,t){var o=this._libraries.indexOf(e);return-1===o?void t(null):(this._libraries.splice(o,1),delete this._libraryIdMap[e.id],e._markDeletedLocally(!0),a.SHARED_LOCAL_STORAGE?s.storageInterface.unloadPublicLibrary(e,t):(e._deletedFromDisk=!0,l.deleteLibraryFromDisk(this,e.id,t)),void this._listenerManager.notify("change"))},i.prototype.removeDeletedLibraries=function(e,t){n.prototype.removeDeletedLibraries.call(this,e,t)},i.prototype.sync=function(e){n.prototype.sync.call(this,e)},i.prototype.addSyncListener=function(e){n.prototype.addSyncListener.call(this,e)},i.prototype.removeSyncListener=function(e){n.prototype.removeSyncListener.call(this,e)},i.prototype.getPrimarySyncError=function(){return n.prototype.getPrimarySyncError.call(this)},i.prototype.getNewLibrarySyncProgress=function(){return n.prototype.getNewLibrarySyncProgress.call(this)},i.prototype.addCommitErrorListener=function(e){n.prototype.addCommitErrorListener.call(this,e)},i.prototype.removeCommitErrorListener=function(e){n.prototype.removeCommitErrorListener.call(this,e)},i.prototype.startPolling=function(){n.prototype.startPolling.call(this)},i.prototype.stopPolling=function(){n.prototype.stopPolling.call(this)},i.prototype.getLibraryById=function(e){return n.prototype.getLibraryById.call(this,e)},i.prototype.getTempDir=function(e){n.prototype.getTempDir.call(this,e)},i}),i("AdobeLibraryCollectionManager",["require","exports","module","./utils/AdobeLibraryListenerManager"],function(e,t,o){"use strict";function i(){this._collections=[],this._listenerManager=new n(["change"])}var n=e("./utils/AdobeLibraryListenerManager");return i.prototype.getLibraryCollection=function(e,t){var o;return this._collections.forEach(function(i){i.isPublic||i.userId!==e||i.cloudId!==t||(o=i)}),o},i.prototype.getPublicLibraryCollection=function(e){var t;return this._collections.forEach(function(o){o.isPublic&&o.cloudId===e&&(t=o)}),t},i.prototype.addLibraryCollection=function(e){this._collections.push(e),this._listenerManager.notify("change")},i.prototype.removeLibraryCollection=function(e){var t=this._collections.indexOf(e);-1!==t&&(this._collections.splice(t,1),this._listenerManager.notify("change"))},i.prototype.removeAllLibraryCollections=function(){this._collections=[],this._listenerManager.notify("change")},i.prototype.getLoadedCollections=function(){return this._collections},i.prototype.addLoadedCollectionsListener=function(e){this._listenerManager.add("change",e)},i.prototype.removeLoadedCollectionsListener=function(e){this._listenerManager.remove("change",e)},i}),i("AdobeLibraryMessageChannel",["require","exports","module","./AdobeLibraryServices","./utils/AdobeLibraryListenerManager"],function(e,t,o){"use strict";function i(e){this._socket=e,this._listenerManager=new c,this._socketListenerManager=new c,this._pendingWriteState={},this._pendingWriteDependencyMap={},this._init()}function n(e){return e+"_req"}function r(e){return e+"_res"}function a(e,t,o){return e+"#"+t+"#"+o}var s=e("./AdobeLibraryServices"),c=e("./utils/AdobeLibraryListenerManager");return i.prototype._init=function(){var e=this;this._addSocketListener("message",function(t){var o=JSON.parse(t);e._logReceive(o.type),e._listenerManager.notify(o.type,[o.data])})},i.prototype._addSocketListener=function(e,t){this._socketListenerManager.add(e,t),this._socket.addListener(e,t)},i.prototype._removeSocketListeners=function(){var e=this;this._socketListenerManager.forEach(function(t,o){e._socket.removeListener(t,o)}),this._socketListenerManager.removeAll()},i.prototype._logSend=function(e){this._logCallback&&this._logCallback("SEND "+e)},i.prototype._logReceive=function(e){this._logCallback&&this._logCallback("RECEIVE "+e)},i.prototype._logError=function(e){this._logCallback&&this._logCallback("ERROR "+e)},i.prototype.setPendingWriteState=function(e,t,o){var i=a(e,t,o);this._pendingWriteState[i]=!0},i.prototype.setPendingWriteDependency=function(e,t,o,i,n,r){var s=a(e,t,o),c=a(i,n,r);s!==c&&(this._pendingWriteDependencyMap[s]=this._pendingWriteDependencyMap[s]||{},this._pendingWriteDependencyMap[s][c]={userId:i,cloudId:n,id:r})},i.prototype.clearPendingWriteState=function(e,t,o){var i=a(e,t,o),n=[];return Object.keys(this._pendingWriteDependencyMap[i]||{}).forEach(function(e){n.push(this._pendingWriteDependencyMap[i][e])},this),delete this._pendingWriteState[i],delete this._pendingWriteDependencyMap[i],n},i.prototype.getPendingWriteState=function(e,t,o,i){var n=a(e,t,o),r=!1;return!i&&this._pendingWriteState[n]&&(r=this._pendingWriteState[n]),Object.keys(this._pendingWriteDependencyMap).forEach(function(e){var t=this._pendingWriteDependencyMap[e];t[n]&&(r=this._pendingWriteState[e]||r)},this),r},i.prototype.setLogCallback=function(e){this._logCallback=e},i.prototype.addListener=function(e,t){this._listenerManager.add(e,t)},i.prototype.removeListener=function(e,t){this._listenerManager.remove(e,t)},i.prototype.send=function(e,t){try{this._logSend(e),this._socket.send(JSON.stringify({type:e,data:t}))}catch(o){this._logError(o),this._socketListenerManager.notify("error",[o])}},i.prototype.addCallListener=function(e,t){var o=this;this.addListener(n(e),function(i){var n=i.id;t(i.data,function(t){o.send(r(e),{id:n,data:t})})})},i.prototype.removeCallListener=function(e,t){this.removeListener(n(e),t)},i.prototype.call=function(e,t,o){var i=this,a=s.uuid(),c=function(t){t.id===a&&(i.removeListener(r(e),c),o(t.data))};this.addListener(r(e),c),this.send(n(e),{id:a,data:t})},i.prototype.onOpen=function(e){this._addSocketListener("open",e)},i.prototype.onClose=function(e){this._addSocketListener("close",e)},i.prototype.onError=function(e){this._addSocketListener("error",e)},i.prototype.shutdown=function(){var e=this;this._addSocketListener("close",function(){e._removeSocketListeners(),e._listenerManager.removeAll()}),this._socket.close()},i}),i("AdobeLibraryWebSocket",["require","exports","module","./AdobeLibraryConfig","./utils/AdobeLibraryListenerManager"],function(e,t,o){"use strict";function i(e,t){var o="ws://127.0.0.1:"+e+"/?version="+n.SHARED_LOCAL_STORAGE_VERSION;t&&(o+="&token="+t),this._socket=new WebSocket(o),this._socket.onopen=this._onSocketOpen.bind(this),this._socket.onclose=this._onSocketClose.bind(this),this._socket.onmessage=this._onSocketMessage.bind(this),this._socket.onerror=this._onSocketError.bind(this),this._listenerManager=new r(["open","close","message","error"])}var n=e("./AdobeLibraryConfig"),r=e("./utils/AdobeLibraryListenerManager");return i.prototype._onSocketOpen=function(e){this._listenerManager.notify("open")},i.prototype._onSocketClose=function(e){this._listenerManager.notify("close")},i.prototype._onSocketMessage=function(e){this._listenerManager.notify("message",[e.data])},i.prototype._onSocketError=function(e){this._listenerManager.notify("error",[e])},i.prototype.send=function(e){this._socket.send(e)},i.prototype.addListener=function(e,t){this._listenerManager.add(e,t)},i.prototype.removeListener=function(e,t){this._listenerManager.remove(e,t)},i.prototype.close=function(){this._socket.close(),this._socket.onopen=void 0,this._socket.onclose=void 0,this._socket.onmessage=void 0,this._socket.onerror=void 0,this._listenerManager.removeAll()},i}),i("AdobeLibraryStorageInterfaceFS",["require","exports","module","./AdobeLibraryError"],function(e,t,o){"use strict";function i(e){return function(t,o){e&&e(t,o)}}function n(e){this._storageInterface=e}var r=e("./AdobeLibraryError"),a={rename:!0,renameSync:!1,ftruncate:!1,ftruncateSync:!1,truncate:!1,truncateSync:!1,chown:!1,chownSync:!1,fchown:!1,fchownSync:!1,lchown:!1,lchownSync:!1,chmod:!1,chmodSync:!1,fchmod:!1,fchmodSync:!1,lchmod:!1,lchmodSync:!1,stat:!0,lstat:!1,fstat:!1,statSync:!1,lstatSync:!1,fstatSync:!1,link:!1,linkSync:!1,symlink:!1,symlinkSync:!1,readlink:!1,readlinkSync:!1,realpath:!1,realpathSync:!1,unlink:!0,unlinkSync:!1,rmdir:!0,rmdirSync:!1,mkdir:!0,mkdirSync:!1,readdir:!0,readdirSync:!1,close:!1,closeSync:!1,open:!1,openSync:!1,utimes:!0,utimesSync:!1,futimes:!1,futimesSync:!1,fsync:!1,fsyncSync:!1,write:!1,writeSync:!1,read:!1,readSync:!1,readFile:!0,readFileSync:!1,writeFile:!0,writeFileSync:!1,appendFile:!1,appendFileSync:!1,watchFile:!1,unwatchFile:!1,watch:!1,exists:!0,existsSync:!1,createReadStream:!1,createWriteStream:!1};return n.prototype._fsCall=function(e,t,o){var n=i(o),r={method:e,args:t};this._storageInterface._channel.call("fscall",r,function(e){n.apply(null,e)})},n.prototype._pipeCall=function(e,t,o,n){var r=i(n),a={readStream:{path:e,options:t},writeStream:o};this._storageInterface._channel.call("fspipe",a,r)},Object.keys(a).forEach(function(e){a[e]?n.prototype[e]=function(){var t,o=Array.prototype.slice.call(arguments);"function"==typeof o[o.length-1]&&(t=o.pop()),this._fsCall(e,o,t)}:n.prototype[e]=function(){var t=new r(r.NOT_IMPLEMENTED,e+" is not implemented in shared local storage"),o=arguments[arguments.length-1];if("function"==typeof o)return void o(t);throw t}}),n.prototype.createReadStream=function(e,t){var o=this,i={};return i.on=function(e,t){i[e]=t},i.pipe=function(t,n){o._pipeCall(e,n,t,function(e){i[e.event]&&i[e.event].apply(null,e.args)})},i},n.prototype.createWriteStream=function(e,t){return{path:e,options:t}},n}),i("AdobeLibraryStorageInterface",["require","exports","module","./components/dcx-js/src/AdobeDCXComposite","./components/dcx-js/src/AdobeDCXBranch","./AdobeLibraryCollection","./AdobeLibraryPublicCollection","./AdobeLibraryFolder","./AdobeLibraryBookmark","./AdobeLibraryError","./AdobeLibraryConfig","./AdobeLibraryServices","./AdobeLibraryMessageChannel","./AdobeLibraryWebSocket","./AdobeLibraryStorageInterfaceFS","./utils/AdobeLibraryAsyncJoin","./utils/AdobeLibraryManifestUtils","./utils/AdobeLibraryRenditionUtils"],function(e,t,o){"use strict";function i(e){this._collectionManager=e,this._acceptPushedBranchListeners=[],this._downloadRenditionListeners=[],this._rootListeners=[],this._baseBranches={},this._pendingSetRenditionCache={},this._portDiagnosis="UNKNOWN",this._logIndex=0,u.SHARED_LOCAL_STORAGE&&(this._connect(),this.fs=new m(this),h.hasFileSystem()||h.setFileSystem(this.fs))}function n(e){return function(t,o){e&&e(t,o)}}var r=e("./components/dcx-js/src/AdobeDCXComposite"),a=e("./components/dcx-js/src/AdobeDCXBranch"),s=e("./AdobeLibraryCollection"),c=e("./AdobeLibraryPublicCollection"),l=e("./AdobeLibraryFolder"),d=e("./AdobeLibraryBookmark"),p=e("./AdobeLibraryError"),u=e("./AdobeLibraryConfig"),h=e("./AdobeLibraryServices"),_=e("./AdobeLibraryMessageChannel"),f=e("./AdobeLibraryWebSocket"),m=e("./AdobeLibraryStorageInterfaceFS"),y=e("./utils/AdobeLibraryAsyncJoin"),g=e("./utils/AdobeLibraryManifestUtils"),v=e("./utils/AdobeLibraryRenditionUtils");return i.prototype._getBase=function(e){var t=this._baseBranches[e];return t&&t.base},i.prototype._setBase=function(e,t){this._baseBranches[e]=this._baseBranches[e]||{},this._baseBranches[e].base=t},i.prototype._getLogIndex=function(){return this._logIndex++},i.prototype._getServicePort=function(e){function t(t){var o;try{o=JSON.parse(t)}catch(i){}return o?void e(null,o):void e("NO_DATA")}var o=u.VULCAN_PREFIX+u.VULCAN_QUERY_REQUEST,i=u.VULCAN_PREFIX+u.VULCAN_QUERY_RESPONSE;if(h.hasCEPVulcan()){var n,r=h.getVulcanInterface(),a=h.getVulcanMessage(),s=function(o){return r.removeMessageListener(i,s),clearTimeout(n),o?void t(r.getPayload(o)):void e("NO_VULCAN_MESSAGE")};r.addMessageListener(i,s),n=setTimeout(s,3e3);var c=new a(o);c.setPayload(""),r.dispatchMessage(c)}else h.vulcanCall&&h.vulcanCall(o,"",i,t)},i.prototype._connectToPort=function(e,t){var o=t&&t.port,i=t&&t.token;if(this._portDiagnosis=t?t.portdiagnosis:"UNKNOWN",this._connectionPort=o,!this._isConnected&&o&&"SIMPLE_HOSTNAME_GOING_TO_PROXY"!==this._portDiagnosis&&"DNS_RESOLUTION_FAILED"!==this._portDiagnosis){try{var n=new f(o,i);this._channel=new _(n),this._isConnected=!0}catch(r){}this._isConnected&&(this._channel.addListener("environmentinfo",this._onEnvironmentInfo.bind(this)),this._channel.addListener("collectionadded",this._onCollectionAdded.bind(this)),this._channel.addListener("collectionremoved",this._onCollectionRemoved.bind(this)),this._channel.addListener("clearcollections",this._onClearCollections.bind(this)),this._channel.addListener("syncstate",this._onSyncState.bind(this)),this._channel.addListener("librarychange",this._onLibraryChange.bind(this)),this._channel.addListener("renditioncachechange",this._onRenditionCacheChange.bind(this)),this._channel.addListener("librarydeleted",this._onLibraryDeleted.bind(this)),this._channel.addListener("bookmarkschanged",this._onBookmarksChanged.bind(this)),this._channel.onOpen(this._sendConfiguration.bind(this)),this._channel.onClose(this._onDisconnect.bind(this)))}},i.prototype._connect=function(){this._getServicePort(this._connectToPort.bind(this))},i.prototype.shutdown=function(){this._collectionManager.removeAllLibraryCollections(),this._isConnected&&this._onDisconnect()},i.prototype._onDisconnect=function(){this._isConnected=!1,this._collectionManager.removeAllLibraryCollections(),this._channel.shutdown(),this._channel=void 0},i.prototype._sendConfiguration=function(){this._channel.send("configure",{CLIENT_DESCRIPTION:u.CLIENT_DESCRIPTION,RENDITION_SIZES:u.RENDITION_SIZES,FULL_RENDITION_CONFIG:u.FULL_RENDITION_CONFIG,DEFAULT_LIBRARY_NAME:u.DEFAULT_LIBRARY_NAME,SHARED_LOCAL_STORAGE_ANALYTICS:u.SHARED_LOCAL_STORAGE_ANALYTICS})},i.prototype._onEnvironmentInfo=function(e){this._serviceInfo=e,e.whitelistedDomains&&(u.WHITELISTED_DOMAINS=e.whitelistedDomains),this._collectionManager._collections.forEach(function(e){e._listenerManager.notify("sync")})},i.prototype._onCollectionAdded=function(e){var t=this;u.ROOT_DIR=e.rootDir;var o,i=new y,n={USER_ID:e.userId,CLOUD_ID:e.cloudId,CLOUD_INFO:e.cloudInfo,STORAGE_HOSTNAME:e.storageHost,REQUIRES_COMMUNITY_SESSION:e.requiresCommunitySession};o=e.isPublic?new c(n):new s(n),e.libraries.forEach(function(e){i.addOperation(t.loadExistingLibrary,[o,e.id,e.path,e.manifest,e.isDeletedFromServer,e.renditionCache],t)}),i.run(function(){t._collectionManager.addLibraryCollection(o)})},i.prototype._getLibraryCollection=function(e){return e.isPublic?this._collectionManager.getPublicLibraryCollection(e.cloudId):this._collectionManager.getLibraryCollection(e.userId,e.cloudId)},i.prototype._onCollectionRemoved=function(e){var t=this._getLibraryCollection(e);t&&this._collectionManager.removeLibraryCollection(t)},i.prototype._onClearCollections=function(){this._collectionManager.removeAllLibraryCollections()},i.prototype._onSyncState=function(e){var t=this._getLibraryCollection(e);t&&(t._syncState=e.state,t._syncProgress=e.progress,t._syncProgressMap=e.progressMap,t._externalLinkDownloadProgressMap=e.externalLinkDownloadProgressMap||{},t._newLibraryProgress=e.newLibraryProgress,t._initialSyncInProgress=e.initialSyncInProgress,t._syncErrors=[],e.errors.forEach(function(e){t._syncErrors.push(new p(e.code,e.message,e.libraryId))}),e.libraryStates.forEach(function(e){var o=t.getLibraryById(e.id);o&&(o._syncState=e.state)}),t._listenerManager.notify("sync"))},i.prototype._onLibraryChange=function(e){var t=this._getLibraryCollection(e);if(t){var o=t.getLibraryById(e.id);o?(o._deletedFromServer=e.deletedFromServer,e.renditionCache=e.renditionCache||{},o._setRenditionCache(e.renditionCache),this.updateExistingLibrary(t,o,e.manifest,void 0,function(){o._setRenditionCache(e.renditionCache)})):this.loadExistingLibrary(t,e.id,e.path,e.manifest,e.deletedFromServer,e.renditionCache)}},i.prototype._onRenditionCacheChange=function(e){var t=this._getLibraryCollection(e),o=t&&t.getLibraryById(e.id),i=o&&o.getElementById(e.elementId);i&&e.renditionCache&&(i._renditionCache=e.renditionCache)},i.prototype._onLibraryDeleted=function(e){var t=this._getLibraryCollection(e);t&&this._deleteLibrary(t,e.id)},i.prototype._onBookmarksChanged=function(e){var t=this._getLibraryCollection(e);if(t&&e.bookmarks){var o=[];e.bookmarks.forEach(function(e){o.push(new d(e._id,e._url))}),t._bookmarkManager._bookmarks=o}},i.prototype.isConnected=function(){return this._isConnected},i.prototype.reconnect=function(){this._isConnected||this._connect()},i.prototype.getServiceInfo=function(){return this._serviceInfo?{updateRequired:this._serviceInfo.updateRequired,version:this._serviceInfo.codeVersion,buildNumber:this._serviceInfo.buildNumber,apiVersion:this._serviceInfo.version,environment:this._serviceInfo.environment,syncingEnabled:this._serviceInfo.syncingEnabled,portDiagnosis:this._portDiagnosis,connectionPort:this._connectionPort}:{portDiagnosis:this._portDiagnosis,connectionPort:this._connectionPort}},i.prototype.updateConfiguration=function(){u.SHARED_LOCAL_STORAGE&&this._isConnected&&this._channel&&this._sendConfiguration()},i.prototype.sync=function(e){this._channel.send("sync",{isPublic:e.isPublic,userId:e.userId,cloudId:e.cloudId})},i.prototype.commitManifest=function(e,t){var o=this;if(u.SHARED_LOCAL_STORAGE){var i=e._dcxBranch.localData,n=this._pendingSetRenditionCache[e.id]||{data:[],callbacks:[]};delete this._pendingSetRenditionCache[e.id];var r={isPublic:e.collection.isPublic,userId:e.collection.userId,cloudId:e.collection.cloudId,id:e.id,current:i,base:this._getBase(e.id),renditions:n.data};h.log("Start commit"),this._channel.call("commit",r,function(r){h.log("Finish commit: "+(r.success?"success":"fail")),r.success?(h.log("Update base after commit"),o._setBase(e.id,i),r.renditions&&r.renditions.forEach(function(t,o){if(t){var i=t.split("/").pop(),r=n.data[o],a=e.getElementById(r.element);a&&(a._renditionCache=a._renditionCache||{},a._renditionCache[r.size]=i);var s=n.callbacks[o];s&&s(null,t)}})):(o._pendingSetRenditionCache[e.id]=n,e._waitForCommit(function(){o.notifyStartWrite(e,[],function(){e._deletedFromServer=r.deletedFromServer,o.updateExistingLibrary(e.collection,e,r.manifest,void 0,function(){e._commit(!0,!0)})})})),t()})}else e._dcxLock.obtain(function(){e._dcxComposite.commitChanges(function(o){e._dcxLock.release(),t(o)})})},i.prototype.resolvePullWithBranch=function(e,t,o,i,n){h.log("resolvePullWithBranch"),u.SHARED_LOCAL_STORAGE?(e._dcxComposite._current=t,this._setBase(e.id,o),h.log("Finished resolvePullWithBranch: shared local storage"),n()):i?e._dcxLock.obtain(function(){e._dcxComposite._current=t,e._dcxLock.release(),h.log("Finished resolvePullWithBranch: local merge"),n()}):e._dcxLock.obtain(function(){e._dcxComposite.resolvePullWithBranch(t,function(t,o){e._dcxLock.release(),h.log("Finished resolvePullWithBranch: remote merge"),n(t,o)})})},i.prototype.acceptPush=function(e,t){var o=this;h.log("acceptPush"),e._dcxLock.obtain(function(){e._dcxComposite.acceptPush(function(i){e._dcxLock.release(),h.log("Finished acceptPush"),o._acceptPushedBranchListeners.forEach(function(t){t(e)}),t(i)})})},i.prototype.onAcceptPushedBranch=function(e){this._acceptPushedBranchListeners.push(e)},i.prototype.removeOnAcceptPushedBranchListeners=function(){this._acceptPushedBranchListeners=[]},i.prototype._deleteLibrary=function(e,t,o){h.log("deleteLibrary");var i=e.getLibraryById(t);if(i){var n=e._libraries.indexOf(i);-1!==n&&(e._libraries.splice(n,1),delete e._libraryIdMap[i.id]),i._markDeletedLocally(!0),e._notifyChange(!0)}},i.prototype._loadBranch=function(e,t,o){var i;try{i=new a(void 0,o).parse(t),i._localStorage=e._localStorage}catch(n){}return i},i.prototype._addLibrary=function(e,t,o,i,n){o=o||e._getCompositeDir(t);var a=new r(null,null,o,null,null,{preserveFileExtensions:!0}),s=this._loadBranch(a,i,!1);if(!s)return void n(new p(p.CORRUPTED_LIBRARY,"Library corrupted in local storage",t));if("pendingDelete"===s.compositeState)return void n(null);a._current=s,this._setBase(t,i);var c=new l(e,a);e.isPublic&&(c._publicId=t,c._writable=!1),e._libraries.push(c),e._libraryIdMap[c.id]=c,e._notifyChange(!0),n(null,c)},i.prototype.createNewLibrary=function(e,t,o,i){var r=n(i);h.log("createNewLibrary"),this._addLibrary(e,t,void 0,o,function(e,t){return e||!t?void r(e):(t._commit(!1,!0),void t._waitForCommit(r))})},i.prototype.loadExistingLibrary=function(e,t,o,i,r,a,s){var c=n(s);h.log("loadExistingLibrary"),this._addLibrary(e,t,void 0,i,function(e,t){return e||!t?void c(e):(t._deletedFromServer=r,a&&t._setRenditionCache(a),void c(null,t))})},i.prototype.updateExistingLibrary=function(e,t,o,i,r){var a=this,s=n(r),c="updateExistingLibrary["+this._getLogIndex()+"]: ";if(g.areManifestsEqual(t._dcxBranch.localData,o))return h.log(c+"already up-to-date"),void s();h.log(c+"changes to update");var l=this._loadBranch(t._dcxComposite,o,!1);return l?void("pendingDelete"===l.compositeState?(e._doRemoveLibrary(t),s()):t._waitForCommit(function(){
if(i){if(!g.areManifestsEqual(t._dcxBranch.localData,i))return h.log(c+"Commit aborting: something changed and it's no longer a fast-forward"),void s(!0)}else i=a._getBase(t.id);var e=a._loadBranch(t._dcxComposite,i,!0)||l;h.log(c+"base "+e.changeCount+" -> updated "+l.changeCount),t._mergeAndSwitchToBranch(l,e,function(){h.log(c+"finished merge"),u.SHARED_LOCAL_STORAGE?s(null):(t._commit(!1,!0),t._waitForCommit(s))})})):void s(new p(p.CORRUPTED_LIBRARY,"Invalid manifest",t.id))},i.prototype.setRenditionCache=function(e,t,o,i){var n=this._pendingSetRenditionCache[e.library.id],r=v.addToPendingSetRenditionCache(n,e,t,o,i);this._pendingSetRenditionCache[e.library.id]=r},i.prototype.getRenditionPath=function(e,t,o,i){i=i||0;var r=this,a=n(o),s=e._lookupRenditionPath(t||"full");if(s)return void a(null,s);var c={isPublic:e.library.collection.isPublic,userId:e.library.collection.userId,cloudId:e.library.collection.cloudId,id:e.library.id,element:e.id,size:t};h.log("Get rendition path from CCLibrary process"),this._channel.call("getrenditionpath",c,function(n){return!n&&i<u.LOCAL_RENDITION_MAX_RETRIES?(h.log("getrenditionpath: rendition not found"),void setTimeout(function(){r.getRenditionPath(e,t,o,i+1)},u.LOCAL_RENDITION_RETRY_INTERVAL)):void a(null,n)})},i.prototype.notifyDownloadRendition=function(e){this._downloadRenditionListeners.forEach(function(t){t(e)})},i.prototype.onDownloadRendition=function(e){this._downloadRenditionListeners.push(e)},i.prototype.removeOnDownloadRenditionListeners=function(){this._downloadRenditionCacheListeners=[]},i.prototype.notifyStartWrite=function(e,t,o){var i=n(o);if(!u.SHARED_LOCAL_STORAGE)return void i(null);var r={userId:e.collection.userId,cloudId:e.collection.cloudId,id:e.id,dependencies:[]};t.forEach(function(e){r.dependencies.push({userId:e.collection.userId,cloudId:e.collection.cloudId,id:e.id})}),this._channel.call("startcomponentwrite",r,function(){i(null)})},i.prototype.loadPublicLibrary=function(e,t,o,i){var r=n(i),a={isPublic:e.isPublic,cloudId:e.cloudId,id:t,url:o};this._channel.call("loadpubliclibrary",a,function(){r(null)})},i.prototype.unloadPublicLibrary=function(e,t){var o=n(t),i={isPublic:e.collection.isPublic,cloudId:e.collection.cloudId,id:e.id};this._channel.call("unloadpubliclibrary",i,function(){o(null)})},i.prototype.getAssetFromURL=function(e,t,o,i,n){if(u.SHARED_LOCAL_STORAGE){var r={isPublic:e.isPublic,userId:e.userId,cloudId:e.cloudId,url:t,headers:o,tempDir:i};this._channel.call("downloadfile",r,function(e){n(e.err,e.tempFilePath,e.etag,{headers:e.responseHeaders})})}else e._syncManager.getAssetFromURL(t,o,i,void 0,n)},i.prototype.doHeadRequestOfURL=function(e,t,o){u.SHARED_LOCAL_STORAGE?o(null):e._syncManager.doHeadRequestOfURL(t,o)},i.prototype.downloadExternalLink=function(e,t){var o={isPublic:e.element.library.collection.isPublic,userId:e.element.library.collection.userId,cloudId:e.element.library.collection.cloudId,id:e.element.library.id,element:e.element.id,representation:e.id};h.log("Download external link from CCLibrary process"),this._channel.call("downloadexternallink",o,function(e){t(e.err,e.path)})},i.prototype.createBookmark=function(e,t,o,i){var r=n(i),a={isPublic:e.isPublic,cloudId:e.cloudId,userId:e.userId,id:t,url:o};this._channel.call("createBookmark",a,function(e){var t=e&&e.err,o=e&&e.bookmark;o&&(o=new d(o._id,o._url)),r(t,o)})},i.prototype.removeBookmark=function(e,t,o){var i=n(o),r={isPublic:e.isPublic,cloudId:e.cloudId,userId:e.userId,id:t.id};this._channel.call("removeBookmark",r,function(e){i(e)})},i}),i("AdobeLibraryExternalUtils",["require","exports","module","./AdobeLibraryServices","./utils/AdobeLibraryMimeTypeUtils","./utils/AdobeLibraryRenditionUtils"],function(e,t,o){"use strict";var i=e("./AdobeLibraryServices"),n=e("./utils/AdobeLibraryMimeTypeUtils"),r=e("./utils/AdobeLibraryRenditionUtils"),a={};return a.mimeTypeToExtensions=function(e){return n.getExtensions(e)},a.extensionToMimeTypes=function(e){return n.getMimeTypes(e)},a.canGenerateRenditionFromMimeType=function(e){return r.canComputeRenditionFromMimeType(e)},a.generateUuid=function(){return i.uuid()},a}),i("AdobeLibraryExternalAnalyticsUtils",["require","exports","module","./AdobeLibraryAnalytics"],function(e,t,o){"use strict";var i=e("./AdobeLibraryAnalytics"),n={};return n.reportUseElement=function(e,t,o){i.reportUseElement(e,t,o)},n.reportCheckoutElement=function(e,t,o){i.reportCheckoutElement(e,t,o)},n.reportCreateLink=function(e,t){i.reportCreateLink(e,t)},n.reportShareElementLink=function(e){i.reportShareElementLink(e)},n.reportShareLibraryLink=function(e){i.reportShareLibraryLink(e)},n}),i("main",["require","exports","module","./AdobeLibraryServices","./AdobeLibraryConfig","./AdobeLibraryCollection","./AdobeLibraryPublicCollection","./AdobeLibraryCollectionManager","./AdobeLibraryError","./AdobeLibraryStorageInterface","./AdobeLibraryExternalUtils","./AdobeLibraryExternalAnalyticsUtils","./utils/AdobeLibraryFileUtils","./utils/AdobeLibraryManifestUtils"],function(e,t,o){"use strict";function i(e,t,o){var i=e+"/"+t,n=void 0!==y[i];return y[i]=y[i]||[],y[i].push(o),n}function n(e,t){var o;o=e===a.PUBLIC_USER_ID?m.getPublicLibraryCollection(t):m.getLibraryCollection(e,t);var i=e+"/"+t,n=y[i];n&&(delete y[i],n.forEach(function(e){e(null,o)}))}var r=e("./AdobeLibraryServices"),a=e("./AdobeLibraryConfig"),s=e("./AdobeLibraryCollection"),c=e("./AdobeLibraryPublicCollection"),l=e("./AdobeLibraryCollectionManager"),d=e("./AdobeLibraryError"),p=e("./AdobeLibraryStorageInterface"),u=e("./AdobeLibraryExternalUtils"),h=e("./AdobeLibraryExternalAnalyticsUtils"),_=e("./utils/AdobeLibraryFileUtils"),f=e("./utils/AdobeLibraryManifestUtils"),m=new l,y={},g={};return g.configure=function(e,t){if(r.hasFileSystem()||void 0!==t.SHARED_LOCAL_STORAGE||(t.SHARED_LOCAL_STORAGE=!1),r.hasFileSystem()&&!t.ROOT_DIR&&t.SHARED_LOCAL_STORAGE===!1)throw new d(d.INVALID_PARAMETER,"Missing ROOT_DIR option");if(r.hasFileSystem()&&t.ROOT_DIR&&t.SHARED_LOCAL_STORAGE!==!1)throw new d(d.INVALID_PARAMETER,"ROOT_DIR option doesn't apply when using shared local storage");if(!r.hasFileSystem()&&t.ROOT_DIR)throw new d(d.REQUIRES_FILESYSTEM,"ROOT_DIR option only applies when you have a filesystem");if(t.SHARED_LOCAL_STORAGE===!1&&!t.STORAGE_API_KEY)throw new d(d.INVALID_PARAMETER,"Missing STORAGE_API_KEY option");if(t.SHARED_LOCAL_STORAGE!==!1&&!r.hasCEPVulcan()&&!e.vulcanCall)throw new d(d.INVALID_PARAMETER,"Shared local storage requires either the CEP VulcanInterface/VulcanMessage as globals, or for you to pass in the vulcanCall dependency");if(t.ROOT_DIR)for(;-1!==["/","\\"].indexOf(t.ROOT_DIR.substr(-1));)t.ROOT_DIR=t.ROOT_DIR.slice(0,-1);Object.keys(t).forEach(function(e){a.setParameter(e,t[e])}),r.analytics=e.analytics,r.vulcanCall=e.vulcanCall,r._log=e.log,r._getDisplayName=e.getDisplayName,r._getNodeTunnelOptions=e.getNodeTunnelOptions,r.storageInterface&&r.storageInterface.shutdown(),r.storageInterface=new p(m),r.log("Configure: "+(a.SHARED_LOCAL_STORAGE?"<shared local storage>":a.ROOT_DIR))},g.setOption=function(e,t){var o=["ROOT_DIR","SHARED_LOCAL_STORAGE","ELEMENT_TYPE_FILTERS","STORAGE_API_KEY"];if(-1!==o.indexOf(e))throw new d(d.INVALID_PARAMETER,"Cannot reconfigure "+e);a.setParameter(e,t),r.storageInterface.updateConfiguration()},g.getLoadedCollections=function(){return m.getLoadedCollections().slice(0)},g.getLoadedCollectionById=function(e,t){return m.getLibraryCollection(e,t)},g.getLoadedPublicCollectionById=function(e){return m.getPublicLibraryCollection(e)},g.addLoadedCollectionsListener=function(e){m.addLoadedCollectionsListener(e)},g.removeLoadedCollectionsListener=function(e){m.removeLoadedCollectionsListener(e)},g.getRootDir=function(){if(!r.hasFileSystem())throw new d(d.REQUIRES_FILESYSTEM,"ROOT_DIR option only applies when you have a filesystem");return a.ROOT_DIR},g.unloadLibraryCollection=function(e){if(a.SHARED_LOCAL_STORAGE)throw new d(d.NOT_SUPPORTED,"unloadLibraryCollection() not supported with shared local storage");e.stopPolling(),e._removeAllListeners(),m.removeLibraryCollection(e)},g.loadLibraryCollection=function(e,t){function o(){m.addLibraryCollection(c),a.AUTO_START_POLLING&&c.startPolling(),n(e.USER_ID,e.CLOUD_ID)}if("function"==typeof e)return t=e,void t(new d(d.INVALID_PARAMETER,"options argument not specified"));if(a.SHARED_LOCAL_STORAGE)return void t(new d(d.NOT_SUPPORTED,"loadLibraryCollection() not supported with shared local storage"));if(r.hasFileSystem()&&!a.SHARED_LOCAL_STORAGE&&!a.ROOT_DIR)return void t(new d(d.INVALID_PARAMETER,"ROOT_DIR not configured. Make sure you call CCLibraries.configure()"));if(e=e||{},r.hasFileSystem()&&!e.USER_ID)return void t(new d(d.INVALID_PARAMETER,"Missing USER_ID option"));if(e.CLOUD_ID=e.CLOUD_ID||a.DEFAULT_CLOUD_ID,!e.STORAGE_HOSTNAME)return void t(new d(d.INVALID_PARAMETER,"Missing STORAGE_HOSTNAME option"));var c=m.getLibraryCollection(e.USER_ID,e.CLOUD_ID),l=i(e.USER_ID,e.CLOUD_ID,t);if(c&&!l)return void n(e.USER_ID,e.CLOUD_ID);if(!l)if(c=new s(e),r.hasFileSystem())_.doesRootDirExist(c,function(e,t){c._load(function(){t||c._setInitialSyncState(!0),c.sync(function(){c._setInitialSyncState(!1)}),o()})});else if("all"===e.WAIT_FOR)c._setInitialSyncState(!0),c.sync(function(){c._setInitialSyncState(!1),o()});else if(f.validateLibraryId(e.WAIT_FOR,!1)){c._setInitialSyncState(!0,[e.WAIT_FOR]),c.sync(function(){c._setInitialSyncState(!1)});var p=function(){("syncing"!==c.syncState||"pending"!==c._libraryIdMap[e.WAIT_FOR])&&(c.removeChangeListener(p),c.removeSyncListener(p),o())};c.addChangeListener(p),c.addSyncListener(p)}else c._setInitialSyncState(!0),c.sync(function(){c._setInitialSyncState(!1)}),o()},g.loadPublicLibraryCollection=function(e,t){function o(){m.addLibraryCollection(s),a.AUTO_START_POLLING&&s.startPolling(),n(a.PUBLIC_USER_ID,e.CLOUD_ID)}if("function"==typeof e)return t=e,void t(new d(d.INVALID_PARAMETER,"options argument not specified"));if(a.SHARED_LOCAL_STORAGE)return void t(new d(d.NOT_SUPPORTED,"loadPublicLibraryCollection() not supported with shared local storage"));if(r.hasFileSystem()&&!a.SHARED_LOCAL_STORAGE&&!a.ROOT_DIR)return void t(new d(d.INVALID_PARAMETER,"ROOT_DIR not configured. Make sure you call CCLibraries.configure()"));if(e=e||{},e.CLOUD_ID=e.CLOUD_ID||a.DEFAULT_CLOUD_ID,!e.STORAGE_HOSTNAME)return void t(new d(d.INVALID_PARAMETER,"Missing STORAGE_HOSTNAME option"));var s=m.getPublicLibraryCollection(e.CLOUD_ID),l=i(a.PUBLIC_USER_ID,e.CLOUD_ID,t);return s&&!l?void n(a.PUBLIC_USER_ID,e.CLOUD_ID):void(l||(s=new c(e),r.hasFileSystem()?s._load(function(){s.sync(),o()}):o()))},g.isConnected=function(){if(!a.SHARED_LOCAL_STORAGE)throw new d(d.NOT_SUPPORTED,"isConnected() is only applicable if using shared local storage");return r.storageInterface&&r.storageInterface.isConnected()},g.reconnect=function(){if(!a.SHARED_LOCAL_STORAGE)throw new d(d.NOT_SUPPORTED,"reconnect() is only applicable if using shared local storage");r.storageInterface&&r.storageInterface.reconnect()},g.getServiceInfo=function(){if(!a.SHARED_LOCAL_STORAGE)throw new d(d.NOT_SUPPORTED,"getServiceInfo() is only applicable if using shared local storage");return r.storageInterface&&r.storageInterface.getServiceInfo()},g.isSyncingEnabled=function(){if(a.SHARED_LOCAL_STORAGE){var e=g.getServiceInfo();return e&&e.syncingEnabled?!0:!1}return a.SYNCING_ENABLED},g.enableSyncing=function(){if(a.SHARED_LOCAL_STORAGE)throw new d(d.NOT_SUPPORTED,"enableSyncing() not supported with shared local storage");a.SYNCING_ENABLED=!0,g.getLoadedCollections().forEach(function(e){e.sync()})},g.disableSyncing=function(){if(a.SHARED_LOCAL_STORAGE)throw new d(d.NOT_SUPPORTED,"disableSyncing() not supported with shared local storage");a.SYNCING_ENABLED=!1},g.resolveElementReference=function(e){e=e||"";var t,o=new RegExp("cloud-asset://([^/]+)(.+)/([A-Za-z0-9-]+);node=([A-Za-z0-9-]+)"),i=e.match(o);if(i){var n=i[1],r=i[2],a=i[3],s=i[4];g.getLoadedCollections().every(function(e){if(e._syncManager.getElementRefDomain()===n&&e._syncManager.getElementRefPath()===r){var o=e.getLibraryById(a);return o&&(t=o.getElementById(s)),!1}return!0})}return t},g.errors=d,g.utils=u,g.analyticsUtils=h,g}),o("main")});
//# sourceMappingURL=cc-libraries-api.min.js.map